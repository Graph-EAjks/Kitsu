import{_ as M,N as H,m as E,a as L,q as J,u as K,r as l,c as r,o as n,f as u,e as s,t as o,F as f,g as k,d,O as Q,H as W,T as X,Q as Y,R as Z,U as tt,E as et,W as st,X as nt,J as it,Y as ot,Z as rt,B as at,z as lt,l as g,w as C,k as y,$ as b,n as ct,a0 as w,a1 as ut}from"./index-HPQhSyHW.js";import{E as dt,a as ht,b as pt,c as _t,e as mt}from"./EntityTaskList-C1yFBvS-.js";import{C as yt}from"./ConceptCard-D-llkLUr.js";import{E as ft}from"./EntityChat-CmUbrNe-.js";import{P as kt}from"./PeopleNameCell-DKLnx6Xc.js";const gt={name:"entity-output-files",components:{PeopleNameCell:kt,Spinner:K,TaskTypeCell:J},data(){return{isLoading:!1,outputFiles:[]}},props:{entity:{type:Object,default:()=>{}}},mounted(){this.entity&&this.reset()},computed:{...L(["currentProduction","isCurrentUserArtist","personMap","fileStatusMap","outputFileTypeMap","taskMap","taskTypeMap"])},methods:{...E(["loadEntityOutputFiles","loadFileStatuses","loadOutputTypes"]),getTaskType(t){return this.taskTypeMap.get(t.task_type_id)},getFileStatus(t){return this.fileStatusMap.get(t.file_status_id)},getOutputType(t){return this.outputFileTypeMap.get(t.output_type_id)},renderFileSize:H,async reset(){this.isLoading=!0,this.fileStatusMap.size===0&&await this.loadFileStatuses(),this.outputFileTypeMap.size===0&&await this.loadOutputTypes(),this.outputFiles=await this.loadEntityOutputFiles(this.entity.id),this.isLoading=!1}},watch:{entity(){this.entity&&this.reset()}}},bt={class:"mt1 flexcolumn wrapper output-files"},At={key:0,class:"has-text-centered"},vt={key:1},Ct={class:"datatable"},St={class:"datatable-head"},Tt={class:"datatable-row-header"},wt={class:"tasktype"},It={class:"type"},Mt={class:"name"},Et={class:"extension"},Lt={class:"revision"},Pt={class:"size"},zt={class:"status"},Bt={class:"person"},Dt={class:"datatable-body"},qt={class:"datatable-row"},Nt={class:"type"},Ot={class:"name"},$t={class:"extension"},Vt={class:"revision"},Ft={class:"size"},Ut={class:"status"},jt={key:0,class:"datatable-row"},xt={colspan:"10"},Rt={key:2,class:"empty"};function Gt(t,i,h,p,e,c){const S=l("spinner"),A=l("task-type-cell"),v=l("people-name-cell");return n(),r("div",bt,[e.isLoading?(n(),r("div",At,[u(S)])):e.outputFiles.length>0?(n(),r("div",vt,[s("table",Ct,[s("thead",St,[s("tr",Tt,[s("th",wt,o(t.$t("entities.output_files.task_type")),1),s("th",It,o(t.$t("entities.output_files.type")),1),s("th",Mt,o(t.$t("entities.output_files.name")),1),s("th",Et,o(t.$t("entities.output_files.extension")),1),s("th",Lt,o(t.$t("entities.output_files.revision")),1),s("th",Pt,o(t.$t("entities.output_files.size")),1),s("th",zt,o(t.$t("entities.output_files.status")),1),s("th",Bt,o(t.$t("entities.output_files.person")),1),i[0]||(i[0]=s("th",{class:"end-cell"},null,-1))])]),s("tbody",Dt,[(n(!0),r(f,null,k(e.outputFiles,m=>(n(),r(f,{key:m.id},[s("tr",qt,[u(A,{class:"type","task-type":c.getTaskType(m),"production-id":t.currentProduction.id},null,8,["task-type","production-id"]),s("td",Nt,o(c.getOutputType(m).name),1),s("td",Ot,o(m.name),1),s("td",$t,o(m.extension),1),s("td",Vt,o(m.revision),1),s("td",Ft,o(c.renderFileSize(m.file_size)),1),s("td",Ut,o(c.getFileStatus(m).name),1),u(v,{class:"person",person:t.personMap.get(m.person_id)},null,8,["person"]),i[1]||(i[1]=s("td",{class:"end-cell"},null,-1))]),m.path?(n(),r("tr",jt,[s("td",xt,o(m.path),1)])):d("",!0)],64))),128))])])])):(n(),r("div",Rt,o(t.$t("entities.output_files.no_output_files")),1))])}const Ht=M(gt,[["render",Gt],["__scopeId","data-v-f5ea00ce"]]),Jt={name:"asset",mixins:[mt,lt],components:{ButtonSimple:at,ConceptCard:yt,ComboboxNumber:rt,CornerLeftUpIcon:ot,ComboboxStatus:it,DescriptionCell:nt,EditAssetModal:st,EntityChat:ft,EntityNews:_t,EntityOutputFiles:Ht,EntityPreviewFiles:pt,EntityThumbnail:et,EntityTaskList:ht,EntityTimeLogs:dt,PageSubtitle:tt,RouteSectionTabs:Z,Schedule:Y,TableInfo:X,TaskInfo:W,TaskTypeName:Q},data(){return{type:"asset",currentAsset:null,currentConcept:null,currentTask:null,currentConceptStatus:null,currentConceptTask:null,localTasks:[],castIn:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...L(["assetMap","assetSearchText","assetMetadataDescriptors","conceptMap","currentEpisode","currentProduction","getTaskTypePriority","isTVShow","isCurrentUserManager","linkedConcepts","route","taskMap","taskStatusMap","taskTypeMap","shotId"]),title(){return this.currentAsset?`${this.currentAsset.asset_type_name} / ${this.currentAsset.name}`:"Loading..."},assetThumbnailPath(){return`/api/pictures/originals/preview-files/${this.currentAsset.preview_file_id}.png`},isPreview(){return this.currentAsset&&this.currentAsset.preview_file_id&&this.currentAsset.preview_file_id.length>0},nbShotsCastedIn(){return(this.currentAsset?.castInShotsBySequence||[]).reduce((i,h)=>i+h.length,0)},previousAssetPath(){const t=Array.from(this.assetMap.values());if(t.length===0)return{name:"open-productions"};const i=t.findIndex(c=>c&&this.currentAsset&&c.id===this.currentAsset.id),h=i!==0?i-1:t.length-1,p=t[h];if(!p)return{name:"open-productions"};const e={name:"asset",params:{production_id:this.currentProduction.id,asset_id:p.id},query:{search:""}};return this.currentEpisode&&(e.name="episode-asset",e.params.episode_id=this.currentEpisode.id),e},nextAssetPath(){const t=Array.from(this.assetMap.values());if(t.length===0)return{name:"open-productions"};const i=t.findIndex(c=>c&&this.currentAsset&&c.id===this.currentAsset.id),h=i===t.length-1?0:i+1,p=t[h];if(!p)return{name:"open-productions"};const e={name:"asset",params:{production_id:this.currentProduction.id,asset_id:p.id},query:{search:""}};return this.currentEpisode&&(e.name="episode-asset",e.params.episode_id=this.currentEpisode.id),e},assetsPath(){const t={name:"assets",params:{production_id:this.currentProduction.id},query:{search:this.assetSearchText||""}};return this.currentEpisode&&(t.name="episode-assets",t.params.episode_id=this.currentEpisode.id),t},assetNavOptions(){return[...this.entityNavOptions.slice(0,2),{label:this.$t("main.label.concepts"),value:"concepts"},...this.entityNavOptions.slice(2),{label:this.$t("main.label.output_files"),value:"output-files"}]},assetTabs(){return this.assetNavOptions.map(t=>({label:t.label,name:t.value}))},taskStatusList(){const t={id:null,color:"#999",name:this.$t("main.all"),short_name:this.$t("main.all")},i=ut(Array.from(this.taskStatusMap.values()).filter(h=>h.for_concept));return[t].concat(i)},filteredLinkedConcepts(){return this.currentConceptStatus?this.linkedConcepts.filter(t=>t.tasks[0].task_status_id===this.currentConceptStatus):this.linkedConcepts}},methods:{...E(["addSelectedConcepts","clearSelectedTasks","clearSelectedConcepts","editAsset","loadAsset","loadAssets","loadAssetCastIn","loadAssetCasting","loadLinkedConcepts","loadShots","setCurrentEpisode"]),changeTab(t){this.selectedTab=t},getCurrentAsset(){return new Promise((t,i)=>{const h=this.route.params.asset_id;h||t(null);let p=w.cache.assetMap.get(h)||null;if(p)return this.localTasks=p.tasks.map(e=>this.taskMap.get(e)),t(p);if(h)return this.loadAsset(h).then(()=>(p=w.cache.assetMap.get(h),this.localTasks=p.tasks.map(e=>this.taskMap.get(e)),t(p)))})},getConceptTaskStatus(t){return this.taskStatusMap.get(t.tasks[0].task_status_id)},onEditClicked(){this.modals.edit=!0},confirmEditAsset(t){t.id=this.currentAsset.id,this.loading.edit=!0,this.errors.edit=!1,this.editAsset(t).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(h=>{console.error(h),this.loading.edit=!1,this.errors.edit=!0});const i=w.cache.assetMap.get(t.id);this.currentAsset={...i}},resetData(){this.castIn.isLoading=!0,this.$route.params.episode_id==="main"&&this.setCurrentEpisode("main"),this.$nextTick(()=>{this.getCurrentAsset().then(t=>(this.currentAsset=t,this.loadAssetCastIn(this.currentAsset))).then(()=>this.loadAssetCasting(this.currentAsset)).then(()=>{this.castIn.isLoading=!1}).then(()=>this.loadLinkedConcepts(this.currentAsset)).catch(t=>{this.castIn.isError=!0,this.castIn.isLoading=!1,console.error(t)})})},conceptPath(t){return{name:"concepts",params:{production_id:this.currentProduction.id}}},shotPath(t){return{name:t.episode_id?"episode-shot":"shot",params:{production_id:this.currentProduction.id,shot_id:t.shot_id,episode_id:t.episode_id?t.episode_id:void 0}}},init(){return this.getCurrentAsset().then(t=>{this.currentAsset=t,this.currentSection=this.route.query.section||"infos",this.castIn.isLoading=!0,this.castIn.isError=!1,this.currentAsset?this.loadAssetCastIn(this.currentAsset).then(()=>this.loadAssetCasting(this.currentAsset)).then(()=>{this.castIn.isLoading=!1}).then(()=>this.loadLinkedConcepts(this.currentAsset)).catch(i=>{this.castIn.isLoading=!1,this.castIn.isError=!0,console.error(i)}):this.resetData()}).then(()=>{setTimeout(()=>{this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)},100)}).catch(console.error)},selectConcept(t){if(this.currentConcept&&this.currentConcept.id===t.id)this.currentConcept=null,this.currentConceptTask=null,this.clearSelectedConcepts();else{const i=new Map;i.set(t.id,t),this.clearSelectedConcepts(),this.addSelectedConcepts(i),this.currentConcept=t,this.currentConceptTask=t.tasks[0]}}},watch:{currentSection(){this.currentSection==="schedule"&&this.scheduleItems.length>0&&this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)},zoomLevel(){this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)}},head(){return{title:`${this.title} - Kitsu`}}},Kt={class:"columns fixed-page asset xyz-in",xyz:"fade"},Qt={class:"page column main-column"},Wt={class:"page-header flexrow"},Xt={class:"flexrow-item ml2"},Yt={class:"entity-title flexrow-item"},Zt={key:0,class:"ready-for flexrow block mr0"},te={class:"flexrow-item"},ee={class:"asset-data block"},se={class:"flexrow mt1"},ne={key:0,class:"tag tag-standby"},ie={class:"flexrow-item mt05"},oe={class:"flexcolumn infos"},re={class:"flexrow"},ae={class:"flexrow-item has-text-right"},le={class:"table-body metadata-infos"},ce={key:0,class:"datatable no-header"},ue={class:"table-body"},de={class:"datatable-row"},he={class:"field-label"},pe={class:"field-label"},_e={class:"asset-casted-in"},me={key:0},ye={key:0},fe={class:"shot-sequence"},ke={class:"shot-list"},ge={class:"break-word"},be={key:0},Ae={key:1,class:"mt1"},ve={key:2},Ce={key:0},Se={class:"asset-type"},Te={class:"asset-list"},we={class:"break-word"},Ie={key:0},Me={key:1,class:"concepts"},Ee={class:"concept-list mt1"},Le={key:1},Pe={key:2,class:"schedule mt1"},ze={class:"wrapper"},Be={class:"column side-column"},De={class:"column side-column"};function qe(t,i,h,p,e,c){const S=l("corner-left-up-icon"),A=l("router-link"),v=l("entity-thumbnail"),m=l("task-type-name"),P=l("route-section-tabs"),z=l("combobox-number"),T=l("page-subtitle"),B=l("entity-task-list"),D=l("button-simple"),q=l("description-cell"),N=l("entity-chat"),O=l("table-info"),$=l("combobox-status"),V=l("concept-card"),F=l("schedule"),U=l("entity-preview-files"),j=l("entity-time-logs"),x=l("entity-output-files"),R=l("entity-news"),I=l("task-info"),G=l("edit-asset-modal");return n(),r("div",Kt,[s("div",Qt,[s("div",Wt,[u(A,{class:"flexrow-item has-text-centered back-link ml1",to:c.assetsPath},{default:C(()=>[u(S)]),_:1},8,["to"]),s("span",Xt,[e.currentAsset?(n(),y(v,{key:0,class:"entity-thumbnail",entity:e.currentAsset,"empty-width":100,"empty-height":60,width:100},null,8,["entity"])):d("",!0)]),s("div",Yt,o(c.title),1),i[5]||(i[5]=s("div",{class:"filler"},null,-1)),e.currentAsset&&e.currentAsset.ready_for&&e.currentAsset.ready_for!=="None"?(n(),r("div",Zt,[s("span",te,o(t.$t("assets.fields.ready_for")),1),u(m,{class:"flexrow-item","task-type":t.taskTypeMap.get(e.currentAsset.ready_for),"current-production-id":t.currentProduction.id},null,8,["task-type","current-production-id"])])):d("",!0)]),s("div",ee,[u(P,{class:"section-tabs","active-tab":t.currentSection,route:t.$route,tabs:c.assetTabs},null,8,["active-tab","route","tabs"]),s("div",se,[t.currentSection==="casting"&&e.currentAsset?.is_casting_standby?(n(),r("span",ne,o(t.$t("breakdown.fields.standby")),1)):d("",!0),t.currentSection==="schedule"?(n(),r(f,{key:1},[s("span",ie,o(t.$t("schedule.zoom_level"))+": ",1),u(z,{class:"zoom-level flexrow-item","is-simple":"",options:t.zoomOptions,modelValue:t.zoomLevel,"onUpdate:modelValue":i[0]||(i[0]=a=>t.zoomLevel=a)},null,8,["options","modelValue"])],64)):d("",!0)]),g(s("div",oe,[u(T,{text:t.$t("main.tasks")},null,8,["text"]),u(B,{class:"task-list",entries:e.localTasks,"is-loading":!e.currentAsset,"is-error":!1,onTaskSelected:t.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",re,[u(T,{text:t.$t("main.info")},null,8,["text"]),i[6]||(i[6]=s("div",{class:"filler"},null,-1)),s("div",ae,[t.isCurrentUserManager?(n(),y(D,{key:0,icon:"edit",title:t.$t("assets.edit_title"),onClick:i[1]||(i[1]=a=>e.modals.edit=!0)},null,8,["title"])):d("",!0)])]),s("div",le,[e.currentAsset?(n(),r("table",ce,[s("tbody",ue,[s("tr",de,[s("td",he,o(t.$t("assets.fields.description")),1),u(q,{entry:e.currentAsset,full:!0},null,8,["entry"])]),(n(!0),r(f,null,k(t.assetMetadataDescriptors,a=>(n(),r("tr",{key:a.id,class:"datatable-row"},[s("td",pe,o(a.name),1),s("td",null,o(e.currentAsset.data?e.currentAsset.data[a.field_name]:""),1)]))),128))])])):d("",!0)])],512),[[b,t.currentSection==="infos"]]),t.currentSection==="chat"?(n(),y(N,{key:0,entity:e.currentAsset,name:e.currentAsset?.full_name},null,8,["entity","name"])):d("",!0),g(s("div",_e,[e.currentAsset?(n(),r("div",me,[e.currentAsset.castInShotsBySequence&&e.currentAsset.castInShotsBySequence[0].length>0?(n(),r("div",ye,[s("em",null,"Casted in "+o(c.nbShotsCastedIn)+" shots",1),e.currentAsset.castInShotsBySequence.length>0&&e.currentAsset.castInShotsBySequence[0][0].sequence_name?(n(!0),r(f,{key:0},k(e.currentAsset.castInShotsBySequence||[],a=>(n(),r("div",{class:"sequence-shots",key:a?.length>0?a[0].sequence_name:""},[s("div",fe,o(a?.length>0?a[0].sequence_name:""),1),s("div",ke,[(n(!0),r(f,null,k(a,_=>(n(),y(A,{class:"shot-link",key:_.shot_id,to:c.shotPath(_)},{default:C(()=>[u(v,{class:"entity-thumbnail",entity:_,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["entity"]),s("div",null,[s("span",ge,o(_.shot_name),1),_.nb_occurences>1?(n(),r("span",be," ("+o(_.nb_occurences)+") ",1)):d("",!0)])]),_:2},1032,["to"]))),128))])]))),128)):d("",!0)])):d("",!0),e.currentAsset&&e.currentAsset.castingAssetsByType&&e.currentAsset.castingAssetsByType[0]?.length===0?(n(),r("div",Ae,o(t.$t("assets.no_cast_in")),1)):d("",!0)])):(n(),y(O,{key:1,"is-loading":e.castIn.isLoading,"is-error":e.castIn.isError},null,8,["is-loading","is-error"])),e.currentAsset&&e.currentAsset.castingAssetsByType&&e.currentAsset.castingAssetsByType[0].length>0?(n(),r("div",ve,[u(T,{text:t.$t("assets.linked")},null,8,["text"]),e.currentAsset.castingAssetsByType&&e.currentAsset.castingAssetsByType[0].length>0?(n(),r("div",Ce,[(n(!0),r(f,null,k(e.currentAsset.castingAssetsByType,a=>(n(),r("div",{class:"type-assets",key:a.length>0?a[0].asset_type_name:""},[s("div",Se,o(a.length>0?a[0].asset_type_name:"")+" ("+o(a.length)+") ",1),s("div",Te,[(n(!0),r(f,null,k(a,_=>(n(),y(A,{class:"asset-link",key:_.id,to:{name:"asset",params:{production_id:t.currentProduction.id,asset_id:_.asset_id}}},{default:C(()=>[u(v,{class:"entity-thumbnail",entity:_,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["entity"]),s("div",null,[s("span",we,o(_.asset_name),1),_.nb_occurences>1?(n(),r("span",Ie," ("+o(_.nb_occurences)+") ",1)):d("",!0)])]),_:2},1032,["to"]))),128))])]))),128))])):d("",!0)])):d("",!0)],512),[[b,t.currentSection==="casting"]]),e.currentAsset?g((n(),r("div",Me,[u($,{label:t.$t("main.status"),"task-status-list":c.taskStatusList,modelValue:e.currentConceptStatus,"onUpdate:modelValue":i[2]||(i[2]=a=>e.currentConceptStatus=a)},null,8,["label","task-status-list","modelValue"]),s("div",Ee,[c.filteredLinkedConcepts.length?(n(!0),r(f,{key:0},k(c.filteredLinkedConcepts,a=>(n(),y(V,{class:ct(["concept",{selected:e.currentConcept?.id===a.id}]),key:"concept-"+a.id,concept:a,onClick:_=>c.selectConcept(a)},null,8,["class","concept","onClick"]))),128)):(n(),r("div",Le,o(t.$t("assets.no_concept")),1))])],512)),[[b,t.currentSection==="concepts"]]):d("",!0),t.scheduleItems[0].children.length>0?g((n(),r("div",Pe,[s("div",ze,[u(F,{ref:"schedule-widget","start-date":t.tasksStartDate,"end-date":t.tasksEndDate,hierarchy:t.scheduleItems,"zoom-level":t.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1,onItemChanged:t.saveTaskScheduleItem,onEstimationChanged:i[3]||(i[3]=a=>t.saveTaskScheduleItem(a.item))},null,8,["start-date","end-date","hierarchy","zoom-level","onItemChanged"])])],512)),[[b,t.currentSection==="schedule"]]):d("",!0),t.currentSection==="preview-files"?(n(),y(U,{key:3,entity:e.currentAsset},null,8,["entity"])):d("",!0),t.currentSection==="time-logs"?(n(),y(j,{key:4,entity:e.currentAsset},null,8,["entity"])):d("",!0),t.currentSection==="output-files"?(n(),y(x,{key:5,entity:e.currentAsset},null,8,["entity"])):d("",!0)])]),g(s("div",Be,[u(I,{task:e.currentTask,"entity-type":"Asset","with-actions":""},{default:C(()=>[u(R,{class:"news-column",entity:e.currentAsset},null,8,["entity"])]),_:1},8,["task"])],512),[[b,t.currentSection==="infos"]]),g(s("div",De,[u(I,{"entity-type":"Concept",task:e.currentConceptTask},null,8,["task"])],512),[[b,t.currentSection==="concepts"]]),u(G,{ref:"edit-asset-modal",active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"asset-to-edit":e.currentAsset,onCancel:i[4]||(i[4]=a=>e.modals.edit=!1),onConfirm:c.confirmEditAsset},null,8,["active","is-loading","is-error","asset-to-edit","onConfirm"])])}const Ue=M(Jt,[["render",qe],["__scopeId","data-v-801c0f55"]]);export{Ue as default};
//# sourceMappingURL=Asset-B0ZGFlIK.js.map
