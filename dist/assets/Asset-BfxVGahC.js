import{_ as P,N as Q,m as z,a as B,q as W,u as X,r as l,c as a,o as n,f as u,e as s,t as r,F as f,g as k,d,O as Y,H as Z,T as tt,Q as et,R as st,U as nt,E as it,W as ot,X as rt,J as at,Y as lt,Z as ct,B as ut,z as dt,l as g,w as C,k as y,$ as b,n as ht,a0 as L,a1 as pt}from"./index-hEeDez_K.js";import{E as _t,a as mt,b as yt,c as ft,e as kt}from"./EntityTaskList-3TG2qHD5.js";import{C as gt}from"./ConceptCard-Bm-3WADS.js";import{E as bt}from"./EntityChat-BQ_NCJP5.js";import{P as At}from"./PeopleNameCell-DikL0R8Y.js";const vt={name:"entity-output-files",components:{PeopleNameCell:At,Spinner:X,TaskTypeCell:W},data(){return{isLoading:!1,outputFiles:[]}},props:{entity:{type:Object,default:()=>{}}},mounted(){this.entity&&this.reset()},computed:{...B(["currentProduction","isCurrentUserArtist","personMap","fileStatusMap","outputFileTypeMap","taskMap","taskTypeMap"])},methods:{...z(["loadEntityOutputFiles","loadFileStatuses","loadOutputTypes"]),getTaskType(t){return this.taskTypeMap.get(t.task_type_id)},getFileStatus(t){return this.fileStatusMap.get(t.file_status_id)},getOutputType(t){return this.outputFileTypeMap.get(t.output_type_id)},renderFileSize:Q,async reset(){this.isLoading=!0,this.fileStatusMap.size===0&&await this.loadFileStatuses(),this.outputFileTypeMap.size===0&&await this.loadOutputTypes(),this.outputFiles=await this.loadEntityOutputFiles(this.entity.id),this.isLoading=!1}},watch:{entity(){this.entity&&this.reset()}}},Ct={class:"mt1 flexcolumn wrapper output-files"},Tt={key:0,class:"has-text-centered"},St={key:1},wt={class:"datatable"},It={class:"datatable-head"},Et={class:"datatable-row-header"},Mt={class:"tasktype"},Lt={class:"type"},Pt={class:"name"},zt={class:"extension"},Bt={class:"revision"},Dt={class:"size"},Nt={class:"status"},Ot={class:"person"},Vt={class:"datatable-body"},$t={class:"datatable-row"},Ft={class:"type"},Ut={class:"name"},qt={class:"extension"},xt={class:"revision"},jt={class:"size"},Rt={class:"status"},Gt={key:0,class:"datatable-row"},Ht={colspan:"10"},Jt={key:2,class:"empty"};function Kt(t,i,h,p,e,c){const T=l("spinner"),A=l("task-type-cell"),v=l("people-name-cell");return n(),a("div",Ct,[e.isLoading?(n(),a("div",Tt,[u(T)])):e.outputFiles.length>0?(n(),a("div",St,[s("table",wt,[s("thead",It,[s("tr",Et,[s("th",Mt,r(t.$t("entities.output_files.task_type")),1),s("th",Lt,r(t.$t("entities.output_files.type")),1),s("th",Pt,r(t.$t("entities.output_files.name")),1),s("th",zt,r(t.$t("entities.output_files.extension")),1),s("th",Bt,r(t.$t("entities.output_files.revision")),1),s("th",Dt,r(t.$t("entities.output_files.size")),1),s("th",Nt,r(t.$t("entities.output_files.status")),1),s("th",Ot,r(t.$t("entities.output_files.person")),1),i[0]||(i[0]=s("th",{class:"end-cell"},null,-1))])]),s("tbody",Vt,[(n(!0),a(f,null,k(e.outputFiles,m=>(n(),a(f,{key:m.id},[s("tr",$t,[u(A,{class:"type","task-type":c.getTaskType(m),"production-id":t.currentProduction.id},null,8,["task-type","production-id"]),s("td",Ft,r(c.getOutputType(m).name),1),s("td",Ut,r(m.name),1),s("td",qt,r(m.extension),1),s("td",xt,r(m.revision),1),s("td",jt,r(c.renderFileSize(m.file_size)),1),s("td",Rt,r(c.getFileStatus(m).name),1),u(v,{class:"person",person:t.personMap.get(m.person_id)},null,8,["person"]),i[1]||(i[1]=s("td",{class:"end-cell"},null,-1))]),m.path?(n(),a("tr",Gt,[s("td",Ht,r(m.path),1)])):d("",!0)],64))),128))])])])):(n(),a("div",Jt,r(t.$t("entities.output_files.no_output_files")),1))])}const Qt=P(vt,[["render",Kt],["__scopeId","data-v-f5ea00ce"]]),Wt={name:"asset",mixins:[kt,dt],components:{ButtonSimple:ut,ConceptCard:gt,ComboboxNumber:ct,CornerLeftUpIcon:lt,ComboboxStatus:at,DescriptionCell:rt,EditAssetModal:ot,EntityChat:bt,EntityNews:ft,EntityOutputFiles:Qt,EntityPreviewFiles:yt,EntityThumbnail:it,EntityTaskList:mt,EntityTimeLogs:_t,PageSubtitle:nt,RouteSectionTabs:st,Schedule:et,TableInfo:tt,TaskInfo:Z,TaskTypeName:Y},data(){return{type:"asset",currentAsset:null,currentConcept:null,currentTask:null,currentConceptStatus:null,currentConceptTask:null,localTasks:[],castIn:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...B(["assetMap","assetSearchText","assetMetadataDescriptors","conceptMap","currentEpisode","currentProduction","getTaskTypePriority","isTVShow","isCurrentUserManager","linkedConcepts","route","taskMap","taskStatusMap","taskTypeMap","shotId"]),title(){return this.currentAsset?`${this.currentAsset.asset_type_name} / ${this.currentAsset.name}`:"Loading..."},assetThumbnailPath(){return`/api/pictures/originals/preview-files/${this.currentAsset.preview_file_id}.png`},isPreview(){return this.currentAsset&&this.currentAsset.preview_file_id&&this.currentAsset.preview_file_id.length>0},nbShotsCastedIn(){var i;return(((i=this.currentAsset)==null?void 0:i.castInShotsBySequence)||[]).reduce((h,p)=>h+p.length,0)},previousAssetPath(){const t=Array.from(this.assetMap.values());if(t.length===0)return{name:"open-productions"};const i=t.findIndex(c=>c&&this.currentAsset&&c.id===this.currentAsset.id),h=i!==0?i-1:t.length-1,p=t[h];if(!p)return{name:"open-productions"};const e={name:"asset",params:{production_id:this.currentProduction.id,asset_id:p.id},query:{search:""}};return this.currentEpisode&&(e.name="episode-asset",e.params.episode_id=this.currentEpisode.id),e},nextAssetPath(){const t=Array.from(this.assetMap.values());if(t.length===0)return{name:"open-productions"};const i=t.findIndex(c=>c&&this.currentAsset&&c.id===this.currentAsset.id),h=i===t.length-1?0:i+1,p=t[h];if(!p)return{name:"open-productions"};const e={name:"asset",params:{production_id:this.currentProduction.id,asset_id:p.id},query:{search:""}};return this.currentEpisode&&(e.name="episode-asset",e.params.episode_id=this.currentEpisode.id),e},assetsPath(){const t={name:"assets",params:{production_id:this.currentProduction.id},query:{search:this.assetSearchText||""}};return this.currentEpisode&&(t.name="episode-assets",t.params.episode_id=this.currentEpisode.id),t},assetNavOptions(){return[...this.entityNavOptions.slice(0,2),{label:this.$t("main.label.concepts"),value:"concepts"},...this.entityNavOptions.slice(2),{label:this.$t("main.label.output_files"),value:"output-files"}]},assetTabs(){return this.assetNavOptions.map(t=>({label:t.label,name:t.value}))},taskStatusList(){const t={id:null,color:"#999",name:this.$t("main.all"),short_name:this.$t("main.all")},i=pt(Array.from(this.taskStatusMap.values()).filter(h=>h.for_concept));return[t].concat(i)},filteredLinkedConcepts(){return this.currentConceptStatus?this.linkedConcepts.filter(t=>t.tasks[0].task_status_id===this.currentConceptStatus):this.linkedConcepts}},methods:{...z(["addSelectedConcepts","clearSelectedTasks","clearSelectedConcepts","editAsset","loadAsset","loadAssets","loadAssetCastIn","loadAssetCasting","loadLinkedConcepts","loadShots","setCurrentEpisode"]),changeTab(t){this.selectedTab=t},getCurrentAsset(){return new Promise((t,i)=>{const h=this.route.params.asset_id;this.currentAssetId=h,h||t(null);let p=L.cache.assetMap.get(h)||null;if(p)return this.localTasks=p.tasks.map(e=>this.taskMap.get(e)),t(p);if(h)return this.loadAsset(h).then(()=>(p=L.cache.assetMap.get(h),this.localTasks=p.tasks.map(e=>this.taskMap.get(e)),t(p)))})},getConceptTaskStatus(t){return this.taskStatusMap.get(t.tasks[0].task_status_id)},onEditClicked(){this.modals.edit=!0},confirmEditAsset(t){t.id=this.currentAsset.id,this.loading.edit=!0,this.errors.edit=!1,this.editAsset(t).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(i=>{console.error(i),this.loading.edit=!1,this.errors.edit=!0})},resetData(){this.castIn.isLoading=!0,this.$route.params.episode_id==="main"&&this.setCurrentEpisode("main"),this.$nextTick(()=>{this.getCurrentAsset().then(t=>(this.currentAsset=t,this.loadAssetCastIn(this.currentAsset))).then(()=>this.loadAssetCasting(this.currentAsset)).then(()=>{this.castIn.isLoading=!1}).then(()=>this.loadLinkedConcepts(this.currentAsset)).catch(t=>{this.castIn.isError=!0,this.castIn.isLoading=!1,console.error(t)})})},conceptPath(t){return{name:"concepts",params:{production_id:this.currentProduction.id}}},shotPath(t){return{name:t.episode_id?"episode-shot":"shot",params:{production_id:this.currentProduction.id,shot_id:t.shot_id,episode_id:t.episode_id?t.episode_id:void 0}}},init(){return this.getCurrentAsset().then(t=>{this.currentAsset=t,this.currentSection=this.route.query.section||"infos",this.castIn.isLoading=!0,this.castIn.isError=!1,this.currentAsset?this.loadAssetCastIn(this.currentAsset).then(()=>this.loadAssetCasting(this.currentAsset)).then(()=>{this.castIn.isLoading=!1}).then(()=>this.loadLinkedConcepts(this.currentAsset)).catch(i=>{this.castIn.isLoading=!1,this.castIn.isError=!0,console.error(i)}):this.resetData()}).then(()=>{setTimeout(()=>{this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)},100)}).catch(console.error)},selectConcept(t){if(this.currentConcept&&this.currentConcept.id===t.id)this.currentConcept=null,this.currentConceptTask=null,this.clearSelectedConcepts();else{const i=new Map;i.set(t.id,t),this.clearSelectedConcepts(),this.addSelectedConcepts(i),this.currentConcept=t,this.currentConceptTask=t.tasks[0]}}},watch:{currentSection(){this.currentSection==="schedule"&&this.scheduleItems.length>0&&this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)},zoomLevel(){this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)}},head(){return{title:`${this.title} - Kitsu`}}},Xt={class:"columns fixed-page asset xyz-in",xyz:"fade"},Yt={class:"page column main-column"},Zt={class:"page-header flexrow"},te={class:"flexrow-item ml2"},ee={class:"entity-title flexrow-item"},se={key:0,class:"ready-for flexrow block mr0"},ne={class:"flexrow-item"},ie={class:"asset-data block"},oe={class:"flexrow mt1"},re={key:0,class:"tag tag-standby"},ae={class:"flexrow-item mt05"},le={class:"flexcolumn infos"},ce={class:"flexrow"},ue={class:"flexrow-item has-text-right"},de={class:"table-body metadata-infos"},he={key:0,class:"datatable no-header"},pe={class:"table-body"},_e={class:"datatable-row"},me={class:"field-label"},ye={class:"field-label"},fe={class:"asset-casted-in"},ke={key:0},ge={key:0},be={class:"shot-sequence"},Ae={class:"shot-list"},ve={class:"break-word"},Ce={key:0},Te={key:1,class:"mt1"},Se={key:2},we={key:0},Ie={class:"asset-type"},Ee={class:"asset-list"},Me={class:"break-word"},Le={key:0},Pe={key:1,class:"concepts"},ze={class:"concept-list mt1"},Be={key:1},De={key:2,class:"schedule mt1"},Ne={class:"wrapper"},Oe={class:"column side-column"},Ve={class:"column side-column"};function $e(t,i,h,p,e,c){var I,E,M;const T=l("corner-left-up-icon"),A=l("router-link"),v=l("entity-thumbnail"),m=l("task-type-name"),D=l("route-section-tabs"),N=l("combobox-number"),S=l("page-subtitle"),O=l("entity-task-list"),V=l("button-simple"),$=l("description-cell"),F=l("entity-chat"),U=l("table-info"),q=l("combobox-status"),x=l("concept-card"),j=l("schedule"),R=l("entity-preview-files"),G=l("entity-time-logs"),H=l("entity-output-files"),J=l("entity-news"),w=l("task-info"),K=l("edit-asset-modal");return n(),a("div",Xt,[s("div",Yt,[s("div",Zt,[u(A,{class:"flexrow-item has-text-centered back-link ml1",to:c.assetsPath},{default:C(()=>[u(T)]),_:1},8,["to"]),s("span",te,[e.currentAsset?(n(),y(v,{key:0,class:"entity-thumbnail",entity:e.currentAsset,"empty-width":100,"empty-height":60,width:100},null,8,["entity"])):d("",!0)]),s("div",ee,r(c.title),1),i[5]||(i[5]=s("div",{class:"filler"},null,-1)),e.currentAsset&&e.currentAsset.ready_for&&e.currentAsset.ready_for!=="None"?(n(),a("div",se,[s("span",ne,r(t.$t("assets.fields.ready_for")),1),u(m,{class:"flexrow-item","task-type":t.taskTypeMap.get(e.currentAsset.ready_for),"current-production-id":t.currentProduction.id},null,8,["task-type","current-production-id"])])):d("",!0)]),s("div",ie,[u(D,{class:"section-tabs","active-tab":t.currentSection,route:t.$route,tabs:c.assetTabs},null,8,["active-tab","route","tabs"]),s("div",oe,[t.currentSection==="casting"&&((I=e.currentAsset)!=null&&I.is_casting_standby)?(n(),a("span",re,r(t.$t("breakdown.fields.standby")),1)):d("",!0),t.currentSection==="schedule"?(n(),a(f,{key:1},[s("span",ae,r(t.$t("schedule.zoom_level"))+": ",1),u(N,{class:"zoom-level flexrow-item","is-simple":"",options:t.zoomOptions,modelValue:t.zoomLevel,"onUpdate:modelValue":i[0]||(i[0]=o=>t.zoomLevel=o)},null,8,["options","modelValue"])],64)):d("",!0)]),g(s("div",le,[u(S,{text:t.$t("main.tasks")},null,8,["text"]),u(O,{class:"task-list",entries:e.localTasks,"is-loading":!e.currentAsset,"is-error":!1,onTaskSelected:t.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",ce,[u(S,{text:t.$t("main.info")},null,8,["text"]),i[6]||(i[6]=s("div",{class:"filler"},null,-1)),s("div",ue,[t.isCurrentUserManager?(n(),y(V,{key:0,icon:"edit",onClick:i[1]||(i[1]=o=>e.modals.edit=!0)})):d("",!0)])]),s("div",de,[e.currentAsset?(n(),a("table",he,[s("tbody",pe,[s("tr",_e,[s("td",me,r(t.$t("assets.fields.description")),1),u($,{entry:e.currentAsset,full:!0},null,8,["entry"])]),(n(!0),a(f,null,k(t.assetMetadataDescriptors,o=>(n(),a("tr",{key:o.id,class:"datatable-row"},[s("td",ye,r(o.name),1),s("td",null,r(e.currentAsset.data?e.currentAsset.data[o.field_name]:""),1)]))),128))])])):d("",!0)])],512),[[b,t.currentSection==="infos"]]),t.currentSection==="chat"?(n(),y(F,{key:0,entity:e.currentAsset,name:(E=e.currentAsset)==null?void 0:E.full_name},null,8,["entity","name"])):d("",!0),g(s("div",fe,[e.currentAsset?(n(),a("div",ke,[e.currentAsset.castInShotsBySequence&&e.currentAsset.castInShotsBySequence[0].length>0?(n(),a("div",ge,[s("em",null,"Casted in "+r(c.nbShotsCastedIn)+" shots",1),e.currentAsset.castInShotsBySequence.length>0&&e.currentAsset.castInShotsBySequence[0][0].sequence_name?(n(!0),a(f,{key:0},k(e.currentAsset.castInShotsBySequence||[],o=>(n(),a("div",{class:"sequence-shots",key:(o==null?void 0:o.length)>0?o[0].sequence_name:""},[s("div",be,r((o==null?void 0:o.length)>0?o[0].sequence_name:""),1),s("div",Ae,[(n(!0),a(f,null,k(o,_=>(n(),y(A,{class:"shot-link",key:_.shot_id,to:c.shotPath(_)},{default:C(()=>[u(v,{class:"entity-thumbnail",entity:_,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["entity"]),s("div",null,[s("span",ve,r(_.shot_name),1),_.nb_occurences>1?(n(),a("span",Ce," ("+r(_.nb_occurences)+") ",1)):d("",!0)])]),_:2},1032,["to"]))),128))])]))),128)):d("",!0)])):d("",!0),e.currentAsset&&e.currentAsset.castingAssetsByType&&((M=e.currentAsset.castingAssetsByType[0])==null?void 0:M.length)===0?(n(),a("div",Te,r(t.$t("assets.no_cast_in")),1)):d("",!0)])):(n(),y(U,{key:1,"is-loading":e.castIn.isLoading,"is-error":e.castIn.isError},null,8,["is-loading","is-error"])),e.currentAsset&&e.currentAsset.castingAssetsByType&&e.currentAsset.castingAssetsByType[0].length>0?(n(),a("div",Se,[u(S,{text:t.$t("assets.linked")},null,8,["text"]),e.currentAsset.castingAssetsByType&&e.currentAsset.castingAssetsByType[0].length>0?(n(),a("div",we,[(n(!0),a(f,null,k(e.currentAsset.castingAssetsByType,o=>(n(),a("div",{class:"type-assets",key:o.length>0?o[0].asset_type_name:""},[s("div",Ie,r(o.length>0?o[0].asset_type_name:"")+" ("+r(o.length)+") ",1),s("div",Ee,[(n(!0),a(f,null,k(o,_=>(n(),y(A,{class:"asset-link",key:_.id,to:{name:"asset",params:{production_id:t.currentProduction.id,asset_id:_.asset_id}}},{default:C(()=>[u(v,{class:"entity-thumbnail",entity:_,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["entity"]),s("div",null,[s("span",Me,r(_.asset_name),1),_.nb_occurences>1?(n(),a("span",Le," ("+r(_.nb_occurences)+") ",1)):d("",!0)])]),_:2},1032,["to"]))),128))])]))),128))])):d("",!0)])):d("",!0)],512),[[b,t.currentSection==="casting"]]),e.currentAsset?g((n(),a("div",Pe,[u(q,{label:t.$t("main.status"),"task-status-list":c.taskStatusList,modelValue:e.currentConceptStatus,"onUpdate:modelValue":i[2]||(i[2]=o=>e.currentConceptStatus=o)},null,8,["label","task-status-list","modelValue"]),s("div",ze,[c.filteredLinkedConcepts.length?(n(!0),a(f,{key:0},k(c.filteredLinkedConcepts,o=>{var _;return n(),y(x,{class:ht(["concept",{selected:((_=e.currentConcept)==null?void 0:_.id)===o.id}]),key:"concept-"+o.id,concept:o,onClick:Fe=>c.selectConcept(o)},null,8,["class","concept","onClick"])}),128)):(n(),a("div",Be,r(t.$t("assets.no_concept")),1))])],512)),[[b,t.currentSection==="concepts"]]):d("",!0),t.scheduleItems[0].children.length>0?g((n(),a("div",De,[s("div",Ne,[u(j,{ref:"schedule-widget","start-date":t.tasksStartDate,"end-date":t.tasksEndDate,hierarchy:t.scheduleItems,"zoom-level":t.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1,onItemChanged:t.saveTaskScheduleItem,onEstimationChanged:i[3]||(i[3]=o=>t.saveTaskScheduleItem(o.item))},null,8,["start-date","end-date","hierarchy","zoom-level","onItemChanged"])])],512)),[[b,t.currentSection==="schedule"]]):d("",!0),t.currentSection==="preview-files"?(n(),y(R,{key:3,entity:e.currentAsset},null,8,["entity"])):d("",!0),t.currentSection==="time-logs"?(n(),y(G,{key:4,entity:e.currentAsset},null,8,["entity"])):d("",!0),t.currentSection==="output-files"?(n(),y(H,{key:5,entity:e.currentAsset},null,8,["entity"])):d("",!0)])]),g(s("div",Oe,[u(w,{task:e.currentTask,"entity-type":"Asset","with-actions":""},{default:C(()=>[u(J,{class:"news-column",entity:e.currentAsset},null,8,["entity"])]),_:1},8,["task"])],512),[[b,t.currentSection==="infos"]]),g(s("div",Ve,[u(w,{"entity-type":"Concept",task:e.currentConceptTask},null,8,["task"])],512),[[b,t.currentSection==="concepts"]]),u(K,{ref:"edit-asset-modal",active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"asset-to-edit":e.currentAsset,onCancel:i[4]||(i[4]=o=>e.modals.edit=!1),onConfirm:c.confirmEditAsset},null,8,["active","is-loading","is-error","asset-to-edit","onConfirm"])])}const Ge=P(Wt,[["render",$e],["__scopeId","data-v-52ea6137"]]);export{Ge as default};
//# sourceMappingURL=Asset-BfxVGahC.js.map
