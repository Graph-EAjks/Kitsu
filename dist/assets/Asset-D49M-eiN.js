import{x as J,y as K,m as E,b as L,L as Q,_ as P,r as l,o as n,c as a,f as u,e as s,t as r,F as g,g as b,d as _,s as W,B as X,M as Y,N as Z,H as tt,O as et,Q as st,E as nt,R as it,U as ot,W as rt,T as at,J as lt,X as ct,Y as ut,Z as M,w as C,l as y,n as f,$ as k,p as dt}from"./index-D1nSJh8R.js";import{e as ht,E as pt,a as _t,b as mt,c as yt}from"./EntityTaskList-DHezf_HD.js";import{C as ft}from"./ConceptCard-epHQCW4n.js";import{E as kt}from"./EntityChat-C4LanBuh.js";import{P as gt}from"./PeopleNameCell-CUAMMz42.js";const bt={name:"entity-output-files",components:{PeopleNameCell:gt,Spinner:J,TaskTypeCell:K},data(){return{isLoading:!1,outputFiles:[]}},props:{entity:{type:Object,default:()=>{}}},mounted(){this.entity&&this.reset()},computed:{...E(["currentProduction","isCurrentUserArtist","personMap","fileStatusMap","outputFileTypeMap","taskMap","taskTypeMap"])},methods:{...L(["loadEntityOutputFiles","loadFileStatuses","loadOutputTypes"]),getTaskType(t){return this.taskTypeMap.get(t.task_type_id)},getFileStatus(t){return this.fileStatusMap.get(t.file_status_id)},getOutputType(t){return this.outputFileTypeMap.get(t.output_type_id)},renderFileSize:Q,async reset(){this.isLoading=!0,this.fileStatusMap.size===0&&await this.loadFileStatuses(),this.outputFileTypeMap.size===0&&await this.loadOutputTypes(),this.outputFiles=await this.loadEntityOutputFiles(this.entity.id),this.isLoading=!1}},watch:{entity(){this.entity&&this.reset()}}},vt={class:"mt1 flexcolumn wrapper output-files"},At={key:0,class:"has-text-centered"},Ct={key:1},St={class:"datatable"},wt={class:"datatable-head"},Tt={class:"datatable-row-header"},It={class:"tasktype"},Mt={class:"type"},Et={class:"name"},Lt={class:"extension"},Pt={class:"revision"},zt={class:"size"},Bt={class:"status"},Dt={class:"person"},Ot={class:"datatable-body"},Nt={class:"datatable-row"},$t={class:"type"},Ft={class:"name"},Vt={class:"extension"},Ut={class:"revision"},qt={class:"size"},xt={class:"status"},jt={key:0,class:"datatable-row"},Rt={colspan:"10"},Gt={key:2,class:"empty"};function Ht(t,i,d,h,e,c){const S=l("spinner"),v=l("task-type-cell"),A=l("people-name-cell");return n(),a("div",vt,[e.isLoading?(n(),a("div",At,[u(S)])):e.outputFiles.length>0?(n(),a("div",Ct,[s("table",St,[s("thead",wt,[s("tr",Tt,[s("th",It,r(t.$t("entities.output_files.task_type")),1),s("th",Mt,r(t.$t("entities.output_files.type")),1),s("th",Et,r(t.$t("entities.output_files.name")),1),s("th",Lt,r(t.$t("entities.output_files.extension")),1),s("th",Pt,r(t.$t("entities.output_files.revision")),1),s("th",zt,r(t.$t("entities.output_files.size")),1),s("th",Bt,r(t.$t("entities.output_files.status")),1),s("th",Dt,r(t.$t("entities.output_files.person")),1),i[0]||(i[0]=s("th",{class:"end-cell"},null,-1))])]),s("tbody",Ot,[(n(!0),a(g,null,b(e.outputFiles,m=>(n(),a(g,{key:m.id},[s("tr",Nt,[u(v,{class:"type","task-type":c.getTaskType(m),"production-id":t.currentProduction.id},null,8,["task-type","production-id"]),s("td",$t,r(c.getOutputType(m).name),1),s("td",Ft,r(m.name),1),s("td",Vt,r(m.extension),1),s("td",Ut,r(m.revision),1),s("td",qt,r(c.renderFileSize(m.file_size)),1),s("td",xt,r(c.getFileStatus(m).name),1),u(A,{class:"person",person:t.personMap.get(m.person_id)},null,8,["person"]),i[1]||(i[1]=s("td",{class:"end-cell"},null,-1))]),m.path?(n(),a("tr",jt,[s("td",Rt,r(m.path),1)])):_("",!0)],64))),128))])])])):(n(),a("div",Gt,r(t.$t("entities.output_files.no_output_files")),1))])}const Jt=P(bt,[["render",Ht],["__scopeId","data-v-f5ea00ce"]]),Kt={name:"asset",mixins:[ht,W],components:{ButtonSimple:X,ConceptCard:ft,ComboboxNumber:Y,CornerLeftUpIcon:Z,ComboboxStatus:tt,DescriptionCell:et,EditAssetModal:st,EntityChat:kt,EntityNews:pt,EntityOutputFiles:Jt,EntityPreviewFiles:_t,EntityThumbnail:nt,EntityTaskList:mt,EntityTimeLogs:yt,PageSubtitle:it,RouteSectionTabs:ot,Schedule:rt,TableInfo:at,TaskInfo:lt,TaskTypeName:ct},data(){return{type:"asset",currentAsset:null,currentConcept:null,currentTask:null,currentConceptStatus:null,currentConceptTask:null,localTasks:[],castIn:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1,preview:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...E(["assetMap","assetSearchText","assetMetadataDescriptors","conceptMap","currentEpisode","currentProduction","getTaskTypePriority","isTVShow","isCurrentUserManager","linkedConcepts","route","taskMap","taskStatusMap","taskTypeMap","shotId"]),title(){return this.currentAsset?`${this.currentAsset.asset_type_name} / ${this.currentAsset.name}`:"Loading..."},assetThumbnailPath(){return`/api/pictures/originals/preview-files/${this.currentAsset.preview_file_id}.png`},isPreview(){return this.currentAsset&&this.currentAsset.preview_file_id&&this.currentAsset.preview_file_id.length>0},nbShotsCastedIn(){var i;return(((i=this.currentAsset)==null?void 0:i.castInShotsBySequence)||[]).reduce((d,h)=>d+h.length,0)},previousAssetPath(){const t=Array.from(this.assetMap.values());if(t.length===0)return{name:"open-productions"};const i=t.findIndex(c=>c&&this.currentAsset&&c.id===this.currentAsset.id),d=i!==0?i-1:t.length-1,h=t[d];if(!h)return{name:"open-productions"};const e={name:"asset",params:{production_id:this.currentProduction.id,asset_id:h.id},query:{search:""}};return this.currentEpisode&&(e.name="episode-asset",e.params.episode_id=this.currentEpisode.id),e},nextAssetPath(){const t=Array.from(this.assetMap.values());if(t.length===0)return{name:"open-productions"};const i=t.findIndex(c=>c&&this.currentAsset&&c.id===this.currentAsset.id),d=i===t.length-1?0:i+1,h=t[d];if(!h)return{name:"open-productions"};const e={name:"asset",params:{production_id:this.currentProduction.id,asset_id:h.id},query:{search:""}};return this.currentEpisode&&(e.name="episode-asset",e.params.episode_id=this.currentEpisode.id),e},assetsPath(){const t={name:"assets",params:{production_id:this.currentProduction.id},query:{search:this.assetSearchText||""}};return this.currentEpisode&&(t.name="episode-assets",t.params.episode_id=this.currentEpisode.id),t},assetNavOptions(){return[...this.entityNavOptions.slice(0,2),{label:"Concepts",value:"concepts"},...this.entityNavOptions.slice(2),{label:"Output Files",value:"output-files"}]},assetTabs(){return this.assetNavOptions.map(t=>({label:t.label,name:t.value}))},taskStatusList(){const t={id:null,color:"#999",name:this.$t("main.all"),short_name:this.$t("main.all")},i=ut(Array.from(this.taskStatusMap.values()).filter(d=>d.for_concept));return[t].concat(i)},filteredLinkedConcepts(){return this.currentConceptStatus?this.linkedConcepts.filter(t=>t.tasks[0].task_status_id===this.currentConceptStatus):this.linkedConcepts}},methods:{...L(["addSelectedConcepts","clearSelectedTasks","clearSelectedConcepts","editAsset","loadAsset","loadAssets","loadAssetCastIn","loadAssetCasting","loadLinkedConcepts","loadShots","setCurrentEpisode"]),changeTab(t){this.selectedTab=t},getCurrentAsset(){return new Promise((t,i)=>{const d=this.route.params.asset_id;this.currentAssetId=d,d||t(null);let h=M.cache.assetMap.get(d)||null;if(h)return this.localTasks=h.tasks.map(e=>this.taskMap.get(e)),t(h);if(d)return this.loadAsset(d).then(()=>(h=M.cache.assetMap.get(d),this.localTasks=h.tasks.map(e=>this.taskMap.get(e)),t(h)))})},getConceptTaskStatus(t){return this.taskStatusMap.get(t.tasks[0].task_status_id)},onEditClicked(){this.modals.edit=!0},confirmEditAsset(t){t.id=this.currentAsset.id,this.loading.edit=!0,this.errors.edit=!1,this.editAsset(t).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(i=>{console.error(i),this.loading.edit=!1,this.errors.edit=!0})},resetData(){this.castIn.isLoading=!0,this.$route.params.episode_id==="main"&&this.setCurrentEpisode("main"),this.$nextTick(()=>{this.getCurrentAsset().then(t=>(this.currentAsset=t,this.loadAssetCastIn(this.currentAsset))).then(()=>this.loadAssetCasting(this.currentAsset)).then(()=>{this.castIn.isLoading=!1}).then(()=>this.loadLinkedConcepts(this.currentAsset)).catch(t=>{this.castIn.isError=!0,this.castIn.isLoading=!1,console.error(t)})})},conceptPath(t){return{name:"concepts",params:{production_id:this.currentProduction.id}}},shotPath(t){return{name:t.episode_id?"episode-shot":"shot",params:{production_id:this.currentProduction.id,shot_id:t.shot_id,episode_id:t.episode_id?t.episode_id:void 0}}},init(){return this.getCurrentAsset().then(t=>{this.currentAsset=t,this.currentSection=this.route.query.section||"infos",this.castIn.isLoading=!0,this.castIn.isError=!1,this.currentAsset?this.loadAssetCastIn(this.currentAsset).then(()=>this.loadAssetCasting(this.currentAsset)).then(()=>{this.castIn.isLoading=!1}).then(()=>this.loadLinkedConcepts(this.currentAsset)).catch(i=>{this.castIn.isLoading=!1,this.castIn.isError=!0,console.error(i)}):this.resetData()}).then(()=>{setTimeout(()=>{this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)},100)}).catch(console.error)},selectConcept(t){if(this.currentConcept&&this.currentConcept.id===t.id)this.currentConcept=null,this.currentConceptTask=null,this.clearSelectedConcepts();else{const i=new Map;i.set(t.id,t),this.clearSelectedConcepts(),this.addSelectedConcepts(i),this.currentConcept=t,this.currentConceptTask=t.tasks[0]}}},watch:{$route(){const t=this.route.params.asset_id;this.currentAsset&&this.currentAsset.id!==t&&this.init(),this.currentSection=this.route.query.section||"infos"},currentSection(){this.currentSection==="schedule"&&this.scheduleItems.length>0&&this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)},zoomLevel(){this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)}},head(){return{title:`${this.title} - Kitsu`}}},Qt={class:"columns fixed-page asset xyz-in",xyz:"fade"},Wt={class:"page column main-column"},Xt={class:"page-header flexrow"},Yt={class:"flexrow-item ml2"},Zt={class:"entity-title flexrow-item"},te={key:0,class:"ready-for flexrow block mr0"},ee={class:"flexrow-item"},se={class:"asset-data block"},ne={class:"flexrow mt1"},ie={class:"flexrow infos"},oe={class:"flexrow-item flexcolumn entity-infos"},re={class:"flexrow"},ae={class:"flexrow-item has-text-right"},le={class:"table-body"},ce={key:0,class:"datatable no-header"},ue={class:"table-body"},de={class:"datatable-row"},he={class:"field-label"},pe={class:"field-label"},_e={class:"asset-casted-in"},me={key:0},ye={key:0},fe={class:"shot-sequence"},ke={class:"shot-list"},ge={class:"break-word"},be={key:0},ve={key:1},Ae={key:2},Ce={key:0},Se={class:"asset-type"},we={class:"asset-list"},Te={class:"break-word"},Ie={key:0},Me={key:1,class:"concepts"},Ee={class:"concept-list mt1"},Le={key:1},Pe={key:2,class:"schedule mt1"},ze={class:"wrapper"},Be={class:"column side-column"},De={class:"column side-column"};function Oe(t,i,d,h,e,c){var I;const S=l("corner-left-up-icon"),v=l("router-link"),A=l("entity-thumbnail"),m=l("task-type-name"),z=l("route-section-tabs"),B=l("combobox-number"),w=l("page-subtitle"),D=l("entity-task-list"),O=l("button-simple"),N=l("description-cell"),$=l("entity-chat"),F=l("table-info"),V=l("combobox-status"),U=l("concept-card"),q=l("schedule"),x=l("entity-preview-files"),j=l("entity-time-logs"),R=l("entity-output-files"),G=l("entity-news"),T=l("task-info"),H=l("edit-asset-modal");return n(),a("div",Qt,[s("div",Wt,[s("div",Xt,[u(v,{class:"flexrow-item has-text-centered back-link ml1",to:c.assetsPath},{default:C(()=>[u(S)]),_:1},8,["to"]),s("span",Yt,[e.currentAsset?(n(),y(A,{key:0,class:"entity-thumbnail",entity:e.currentAsset,"empty-width":100,"empty-height":60,width:100},null,8,["entity"])):_("",!0)]),s("div",Zt,r(c.title),1),i[5]||(i[5]=s("div",{class:"filler"},null,-1)),e.currentAsset&&e.currentAsset.ready_for&&e.currentAsset.ready_for!=="None"?(n(),a("div",te,[s("span",ee,r(t.$t("assets.fields.ready_for")),1),u(m,{class:"flexrow-item","task-type":t.taskTypeMap.get(e.currentAsset.ready_for),"current-production-id":t.currentProduction.id},null,8,["task-type","current-production-id"])])):_("",!0)]),s("div",se,[u(z,{class:"section-tabs","active-tab":t.currentSection,route:t.$route,tabs:c.assetTabs},null,8,["active-tab","route","tabs"]),s("div",ne,[f(s("span",{class:"tag tag-standby"},r(t.$t("breakdown.fields.standby")),513),[[k,t.currentSection==="casting"&&e.currentAsset.is_casting_standby]]),f(s("span",{class:"flexrow-item mt05"},r(t.$t("schedule.zoom_level"))+": ",513),[[k,t.currentSection==="schedule"]]),f(u(B,{class:"zoom-level flexrow-item",options:t.zoomOptions,"is-simple":"",modelValue:t.zoomLevel,"onUpdate:modelValue":i[0]||(i[0]=o=>t.zoomLevel=o)},null,8,["options","modelValue"]),[[k,t.currentSection==="schedule"]])]),f(s("div",ie,[s("div",oe,[u(w,{text:t.$t("main.tasks")},null,8,["text"]),u(D,{class:"task-list",entries:e.localTasks,"is-loading":!e.currentAsset,"is-error":!1,onTaskSelected:t.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",re,[u(w,{text:t.$t("main.info")},null,8,["text"]),i[6]||(i[6]=s("div",{class:"filler"},null,-1)),s("div",ae,[t.isCurrentUserManager?(n(),y(O,{key:0,icon:"edit",onClick:i[1]||(i[1]=o=>e.modals.edit=!0)})):_("",!0)])]),s("div",le,[e.currentAsset?(n(),a("table",ce,[s("tbody",ue,[s("tr",de,[s("td",he,r(t.$t("assets.fields.description")),1),u(N,{entry:e.currentAsset,full:!0},null,8,["entry"])]),(n(!0),a(g,null,b(t.assetMetadataDescriptors,o=>(n(),a("tr",{key:o.id,class:"datatable-row"},[s("td",pe,r(o.name),1),s("td",null,r(e.currentAsset.data?e.currentAsset.data[o.field_name]:""),1)]))),128))])])):_("",!0)])])],512),[[k,t.currentSection==="infos"]]),t.currentSection==="chat"?(n(),y($,{key:0,entity:e.currentAsset,name:(I=e.currentAsset)==null?void 0:I.full_name},null,8,["entity","name"])):_("",!0),f(s("div",_e,[e.currentAsset?(n(),a("div",me,[e.currentAsset.castInShotsBySequence&&e.currentAsset.castInShotsBySequence[0].length>0?(n(),a("div",ye,[s("em",null,"Casted in "+r(c.nbShotsCastedIn)+" shots",1),e.currentAsset.castInShotsBySequence.length>0&&e.currentAsset.castInShotsBySequence[0][0].sequence_name?(n(!0),a(g,{key:0},b(e.currentAsset.castInShotsBySequence||[],o=>(n(),a("div",{class:"sequence-shots",key:(o==null?void 0:o.length)>0?o[0].sequence_name:""},[s("div",fe,r((o==null?void 0:o.length)>0?o[0].sequence_name:""),1),s("div",ke,[(n(!0),a(g,null,b(o,p=>(n(),y(v,{class:"shot-link",key:p.shot_id,to:c.shotPath(p)},{default:C(()=>[u(A,{class:"entity-thumbnail",entity:p,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["entity"]),s("div",null,[s("span",ge,r(p.shot_name),1),p.nb_occurences>1?(n(),a("span",be," ("+r(p.nb_occurences)+") ",1)):_("",!0)])]),_:2},1032,["to"]))),128))])]))),128)):(n(),a("div",ve,r(t.$t("assets.no_cast_in")),1))])):_("",!0)])):(n(),y(F,{key:1,"is-loading":e.castIn.isLoading,"is-error":e.castIn.isError},null,8,["is-loading","is-error"])),e.currentAsset&&e.currentAsset.castingAssetsByType&&e.currentAsset.castingAssetsByType[0].length>0?(n(),a("div",Ae,[u(w,{text:t.$t("assets.linked")},null,8,["text"]),e.currentAsset.castingAssetsByType&&e.currentAsset.castingAssetsByType[0].length>0?(n(),a("div",Ce,[(n(!0),a(g,null,b(e.currentAsset.castingAssetsByType,o=>(n(),a("div",{class:"type-assets",key:o.length>0?o[0].asset_type_name:""},[s("div",Se,r(o.length>0?o[0].asset_type_name:"")+" ("+r(o.length)+") ",1),s("div",we,[(n(!0),a(g,null,b(o,p=>(n(),y(v,{class:"asset-link",key:p.id,to:{name:"asset",params:{production_id:t.currentProduction.id,asset_id:p.asset_id}}},{default:C(()=>[u(A,{class:"entity-thumbnail",entity:p,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["entity"]),s("div",null,[s("span",Te,r(p.asset_name),1),p.nb_occurences>1?(n(),a("span",Ie," ("+r(p.nb_occurences)+") ",1)):_("",!0)])]),_:2},1032,["to"]))),128))])]))),128))])):_("",!0)])):_("",!0)],512),[[k,t.currentSection==="casting"]]),e.currentAsset?f((n(),a("div",Me,[u(V,{label:t.$t("main.status"),"task-status-list":c.taskStatusList,modelValue:e.currentConceptStatus,"onUpdate:modelValue":i[2]||(i[2]=o=>e.currentConceptStatus=o)},null,8,["label","task-status-list","modelValue"]),s("div",Ee,[c.filteredLinkedConcepts.length?(n(!0),a(g,{key:0},b(c.filteredLinkedConcepts,o=>{var p;return n(),y(U,{class:dt(["concept",{selected:((p=e.currentConcept)==null?void 0:p.id)===o.id}]),key:"concept-"+o.id,concept:o,onClick:Ne=>c.selectConcept(o)},null,8,["class","concept","onClick"])}),128)):(n(),a("div",Le,r(t.$t("assets.no_concept")),1))])],512)),[[k,t.currentSection==="concepts"]]):_("",!0),t.scheduleItems[0].children.length>0?f((n(),a("div",Pe,[s("div",ze,[u(q,{ref:"schedule-widget","start-date":t.tasksStartDate,"end-date":t.tasksEndDate,hierarchy:t.scheduleItems,"zoom-level":t.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1,onItemChanged:t.saveTaskScheduleItem,onEstimationChanged:i[3]||(i[3]=o=>t.saveTaskScheduleItem(o.item))},null,8,["start-date","end-date","hierarchy","zoom-level","onItemChanged"])])],512)),[[k,t.currentSection==="schedule"]]):_("",!0),t.currentSection==="preview-files"?(n(),y(x,{key:3,entity:e.currentAsset},null,8,["entity"])):_("",!0),t.currentSection==="time-logs"?(n(),y(j,{key:4,entity:e.currentAsset},null,8,["entity"])):_("",!0),t.currentSection==="output-files"?(n(),y(R,{key:5,entity:e.currentAsset},null,8,["entity"])):_("",!0)])]),f(s("div",Be,[u(T,{task:e.currentTask,"entity-type":"Asset","with-actions":""},{default:C(()=>[u(G,{class:"news-column",entity:e.currentAsset},null,8,["entity"])]),_:1},8,["task"])],512),[[k,t.currentSection==="infos"]]),f(s("div",De,[u(T,{"entity-type":"Concept",task:e.currentConceptTask},null,8,["task"])],512),[[k,t.currentSection==="concepts"]]),u(H,{ref:"edit-asset-modal",active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"asset-to-edit":e.currentAsset,onCancel:i[4]||(i[4]=o=>e.modals.edit=!1),onConfirm:c.confirmEditAsset},null,8,["active","is-loading","is-error","asset-to-edit","onConfirm"])])}const xe=P(Kt,[["render",Oe],["__scopeId","data-v-cda9f92b"]]);export{xe as default};
//# sourceMappingURL=Asset-D49M-eiN.js.map
