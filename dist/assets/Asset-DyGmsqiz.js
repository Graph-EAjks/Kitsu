import{x as K,y as Q,m as L,b as P,L as W,_ as z,r as l,o as n,c as a,f as u,e as s,t as r,F as f,g as k,d,s as X,B as Y,M as Z,N as tt,H as et,O as st,Q as nt,E as it,R as ot,U as rt,W as at,T as lt,J as ct,X as ut,Y as dt,Z as E,w as C,l as y,n as g,$ as b,p as ht}from"./index-CSUCxZUI.js";import{e as pt,E as _t,a as mt,b as yt,c as ft}from"./EntityTaskList-CTSl5KJO.js";import{C as kt}from"./ConceptCard-D_RrqeaW.js";import{E as gt}from"./EntityChat-CJA41RgM.js";import{P as bt}from"./PeopleNameCell-CIUkCe9E.js";const vt={name:"entity-output-files",components:{PeopleNameCell:bt,Spinner:K,TaskTypeCell:Q},data(){return{isLoading:!1,outputFiles:[]}},props:{entity:{type:Object,default:()=>{}}},mounted(){this.entity&&this.reset()},computed:{...L(["currentProduction","isCurrentUserArtist","personMap","fileStatusMap","outputFileTypeMap","taskMap","taskTypeMap"])},methods:{...P(["loadEntityOutputFiles","loadFileStatuses","loadOutputTypes"]),getTaskType(t){return this.taskTypeMap.get(t.task_type_id)},getFileStatus(t){return this.fileStatusMap.get(t.file_status_id)},getOutputType(t){return this.outputFileTypeMap.get(t.output_type_id)},renderFileSize:W,async reset(){this.isLoading=!0,this.fileStatusMap.size===0&&await this.loadFileStatuses(),this.outputFileTypeMap.size===0&&await this.loadOutputTypes(),this.outputFiles=await this.loadEntityOutputFiles(this.entity.id),this.isLoading=!1}},watch:{entity(){this.entity&&this.reset()}}},At={class:"mt1 flexcolumn wrapper output-files"},Ct={key:0,class:"has-text-centered"},wt={key:1},St={class:"datatable"},Tt={class:"datatable-head"},It={class:"datatable-row-header"},Mt={class:"tasktype"},Et={class:"type"},Lt={class:"name"},Pt={class:"extension"},zt={class:"revision"},Bt={class:"size"},Dt={class:"status"},Ot={class:"person"},Nt={class:"datatable-body"},$t={class:"datatable-row"},Ft={class:"type"},Vt={class:"name"},Ut={class:"extension"},qt={class:"revision"},xt={class:"size"},jt={class:"status"},Rt={key:0,class:"datatable-row"},Gt={colspan:"10"},Ht={key:2,class:"empty"};function Jt(t,i,h,p,e,c){const w=l("spinner"),v=l("task-type-cell"),A=l("people-name-cell");return n(),a("div",At,[e.isLoading?(n(),a("div",Ct,[u(w)])):e.outputFiles.length>0?(n(),a("div",wt,[s("table",St,[s("thead",Tt,[s("tr",It,[s("th",Mt,r(t.$t("entities.output_files.task_type")),1),s("th",Et,r(t.$t("entities.output_files.type")),1),s("th",Lt,r(t.$t("entities.output_files.name")),1),s("th",Pt,r(t.$t("entities.output_files.extension")),1),s("th",zt,r(t.$t("entities.output_files.revision")),1),s("th",Bt,r(t.$t("entities.output_files.size")),1),s("th",Dt,r(t.$t("entities.output_files.status")),1),s("th",Ot,r(t.$t("entities.output_files.person")),1),i[0]||(i[0]=s("th",{class:"end-cell"},null,-1))])]),s("tbody",Nt,[(n(!0),a(f,null,k(e.outputFiles,m=>(n(),a(f,{key:m.id},[s("tr",$t,[u(v,{class:"type","task-type":c.getTaskType(m),"production-id":t.currentProduction.id},null,8,["task-type","production-id"]),s("td",Ft,r(c.getOutputType(m).name),1),s("td",Vt,r(m.name),1),s("td",Ut,r(m.extension),1),s("td",qt,r(m.revision),1),s("td",xt,r(c.renderFileSize(m.file_size)),1),s("td",jt,r(c.getFileStatus(m).name),1),u(A,{class:"person",person:t.personMap.get(m.person_id)},null,8,["person"]),i[1]||(i[1]=s("td",{class:"end-cell"},null,-1))]),m.path?(n(),a("tr",Rt,[s("td",Gt,r(m.path),1)])):d("",!0)],64))),128))])])])):(n(),a("div",Ht,r(t.$t("entities.output_files.no_output_files")),1))])}const Kt=z(vt,[["render",Jt],["__scopeId","data-v-f5ea00ce"]]),Qt={name:"asset",mixins:[pt,X],components:{ButtonSimple:Y,ConceptCard:kt,ComboboxNumber:Z,CornerLeftUpIcon:tt,ComboboxStatus:et,DescriptionCell:st,EditAssetModal:nt,EntityChat:gt,EntityNews:_t,EntityOutputFiles:Kt,EntityPreviewFiles:mt,EntityThumbnail:it,EntityTaskList:yt,EntityTimeLogs:ft,PageSubtitle:ot,RouteSectionTabs:rt,Schedule:at,TableInfo:lt,TaskInfo:ct,TaskTypeName:ut},data(){return{type:"asset",currentAsset:null,currentConcept:null,currentTask:null,currentConceptStatus:null,currentConceptTask:null,localTasks:[],castIn:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1,preview:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...L(["assetMap","assetSearchText","assetMetadataDescriptors","conceptMap","currentEpisode","currentProduction","getTaskTypePriority","isTVShow","isCurrentUserManager","linkedConcepts","route","taskMap","taskStatusMap","taskTypeMap","shotId"]),title(){return this.currentAsset?`${this.currentAsset.asset_type_name} / ${this.currentAsset.name}`:"Loading..."},assetThumbnailPath(){return`/api/pictures/originals/preview-files/${this.currentAsset.preview_file_id}.png`},isPreview(){return this.currentAsset&&this.currentAsset.preview_file_id&&this.currentAsset.preview_file_id.length>0},nbShotsCastedIn(){var i;return(((i=this.currentAsset)==null?void 0:i.castInShotsBySequence)||[]).reduce((h,p)=>h+p.length,0)},previousAssetPath(){const t=Array.from(this.assetMap.values());if(t.length===0)return{name:"open-productions"};const i=t.findIndex(c=>c&&this.currentAsset&&c.id===this.currentAsset.id),h=i!==0?i-1:t.length-1,p=t[h];if(!p)return{name:"open-productions"};const e={name:"asset",params:{production_id:this.currentProduction.id,asset_id:p.id},query:{search:""}};return this.currentEpisode&&(e.name="episode-asset",e.params.episode_id=this.currentEpisode.id),e},nextAssetPath(){const t=Array.from(this.assetMap.values());if(t.length===0)return{name:"open-productions"};const i=t.findIndex(c=>c&&this.currentAsset&&c.id===this.currentAsset.id),h=i===t.length-1?0:i+1,p=t[h];if(!p)return{name:"open-productions"};const e={name:"asset",params:{production_id:this.currentProduction.id,asset_id:p.id},query:{search:""}};return this.currentEpisode&&(e.name="episode-asset",e.params.episode_id=this.currentEpisode.id),e},assetsPath(){const t={name:"assets",params:{production_id:this.currentProduction.id},query:{search:this.assetSearchText||""}};return this.currentEpisode&&(t.name="episode-assets",t.params.episode_id=this.currentEpisode.id),t},assetNavOptions(){return[...this.entityNavOptions.slice(0,2),{label:"Concepts",value:"concepts"},...this.entityNavOptions.slice(2),{label:"Output Files",value:"output-files"}]},assetTabs(){return this.assetNavOptions.map(t=>({label:t.label,name:t.value}))},taskStatusList(){const t={id:null,color:"#999",name:this.$t("main.all"),short_name:this.$t("main.all")},i=dt(Array.from(this.taskStatusMap.values()).filter(h=>h.for_concept));return[t].concat(i)},filteredLinkedConcepts(){return this.currentConceptStatus?this.linkedConcepts.filter(t=>t.tasks[0].task_status_id===this.currentConceptStatus):this.linkedConcepts}},methods:{...P(["addSelectedConcepts","clearSelectedTasks","clearSelectedConcepts","editAsset","loadAsset","loadAssets","loadAssetCastIn","loadAssetCasting","loadLinkedConcepts","loadShots","setCurrentEpisode"]),changeTab(t){this.selectedTab=t},getCurrentAsset(){return new Promise((t,i)=>{const h=this.route.params.asset_id;this.currentAssetId=h,h||t(null);let p=E.cache.assetMap.get(h)||null;if(p)return this.localTasks=p.tasks.map(e=>this.taskMap.get(e)),t(p);if(h)return this.loadAsset(h).then(()=>(p=E.cache.assetMap.get(h),this.localTasks=p.tasks.map(e=>this.taskMap.get(e)),t(p)))})},getConceptTaskStatus(t){return this.taskStatusMap.get(t.tasks[0].task_status_id)},onEditClicked(){this.modals.edit=!0},confirmEditAsset(t){t.id=this.currentAsset.id,this.loading.edit=!0,this.errors.edit=!1,this.editAsset(t).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(i=>{console.error(i),this.loading.edit=!1,this.errors.edit=!0})},resetData(){this.castIn.isLoading=!0,this.$route.params.episode_id==="main"&&this.setCurrentEpisode("main"),this.$nextTick(()=>{this.getCurrentAsset().then(t=>(this.currentAsset=t,this.loadAssetCastIn(this.currentAsset))).then(()=>this.loadAssetCasting(this.currentAsset)).then(()=>{this.castIn.isLoading=!1}).then(()=>this.loadLinkedConcepts(this.currentAsset)).catch(t=>{this.castIn.isError=!0,this.castIn.isLoading=!1,console.error(t)})})},conceptPath(t){return{name:"concepts",params:{production_id:this.currentProduction.id}}},shotPath(t){return{name:t.episode_id?"episode-shot":"shot",params:{production_id:this.currentProduction.id,shot_id:t.shot_id,episode_id:t.episode_id?t.episode_id:void 0}}},init(){return this.getCurrentAsset().then(t=>{this.currentAsset=t,this.currentSection=this.route.query.section||"infos",this.castIn.isLoading=!0,this.castIn.isError=!1,this.currentAsset?this.loadAssetCastIn(this.currentAsset).then(()=>this.loadAssetCasting(this.currentAsset)).then(()=>{this.castIn.isLoading=!1}).then(()=>this.loadLinkedConcepts(this.currentAsset)).catch(i=>{this.castIn.isLoading=!1,this.castIn.isError=!0,console.error(i)}):this.resetData()}).then(()=>{setTimeout(()=>{this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)},100)}).catch(console.error)},selectConcept(t){if(this.currentConcept&&this.currentConcept.id===t.id)this.currentConcept=null,this.currentConceptTask=null,this.clearSelectedConcepts();else{const i=new Map;i.set(t.id,t),this.clearSelectedConcepts(),this.addSelectedConcepts(i),this.currentConcept=t,this.currentConceptTask=t.tasks[0]}}},watch:{$route(){const t=this.route.params.asset_id;this.currentAsset&&this.currentAsset.id!==t&&this.init(),this.currentSection=this.route.query.section||"infos"},currentSection(){this.currentSection==="schedule"&&this.scheduleItems.length>0&&this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)},zoomLevel(){this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)}},head(){return{title:`${this.title} - Kitsu`}}},Wt={class:"columns fixed-page asset xyz-in",xyz:"fade"},Xt={class:"page column main-column"},Yt={class:"page-header flexrow"},Zt={class:"flexrow-item ml2"},te={class:"entity-title flexrow-item"},ee={key:0,class:"ready-for flexrow block mr0"},se={class:"flexrow-item"},ne={class:"asset-data block"},ie={class:"flexrow mt1"},oe={key:0,class:"tag tag-standby"},re={class:"flexrow-item mt05"},ae={class:"flexrow infos"},le={class:"flexrow-item flexcolumn entity-infos"},ce={class:"flexrow"},ue={class:"flexrow-item has-text-right"},de={class:"table-body"},he={key:0,class:"datatable no-header"},pe={class:"table-body"},_e={class:"datatable-row"},me={class:"field-label"},ye={class:"field-label"},fe={class:"asset-casted-in"},ke={key:0},ge={key:0},be={class:"shot-sequence"},ve={class:"shot-list"},Ae={class:"break-word"},Ce={key:0},we={key:1},Se={key:2},Te={key:0},Ie={class:"asset-type"},Me={class:"asset-list"},Ee={class:"break-word"},Le={key:0},Pe={key:1,class:"concepts"},ze={class:"concept-list mt1"},Be={key:1},De={key:2,class:"schedule mt1"},Oe={class:"wrapper"},Ne={class:"column side-column"},$e={class:"column side-column"};function Fe(t,i,h,p,e,c){var I,M;const w=l("corner-left-up-icon"),v=l("router-link"),A=l("entity-thumbnail"),m=l("task-type-name"),B=l("route-section-tabs"),D=l("combobox-number"),S=l("page-subtitle"),O=l("entity-task-list"),N=l("button-simple"),$=l("description-cell"),F=l("entity-chat"),V=l("table-info"),U=l("combobox-status"),q=l("concept-card"),x=l("schedule"),j=l("entity-preview-files"),R=l("entity-time-logs"),G=l("entity-output-files"),H=l("entity-news"),T=l("task-info"),J=l("edit-asset-modal");return n(),a("div",Wt,[s("div",Xt,[s("div",Yt,[u(v,{class:"flexrow-item has-text-centered back-link ml1",to:c.assetsPath},{default:C(()=>[u(w)]),_:1},8,["to"]),s("span",Zt,[e.currentAsset?(n(),y(A,{key:0,class:"entity-thumbnail",entity:e.currentAsset,"empty-width":100,"empty-height":60,width:100},null,8,["entity"])):d("",!0)]),s("div",te,r(c.title),1),i[5]||(i[5]=s("div",{class:"filler"},null,-1)),e.currentAsset&&e.currentAsset.ready_for&&e.currentAsset.ready_for!=="None"?(n(),a("div",ee,[s("span",se,r(t.$t("assets.fields.ready_for")),1),u(m,{class:"flexrow-item","task-type":t.taskTypeMap.get(e.currentAsset.ready_for),"current-production-id":t.currentProduction.id},null,8,["task-type","current-production-id"])])):d("",!0)]),s("div",ne,[u(B,{class:"section-tabs","active-tab":t.currentSection,route:t.$route,tabs:c.assetTabs},null,8,["active-tab","route","tabs"]),s("div",ie,[t.currentSection==="casting"&&((I=e.currentAsset)!=null&&I.is_casting_standby)?(n(),a("span",oe,r(t.$t("breakdown.fields.standby")),1)):d("",!0),t.currentSection==="schedule"?(n(),a(f,{key:1},[s("span",re,r(t.$t("schedule.zoom_level"))+": ",1),u(D,{class:"zoom-level flexrow-item","is-simple":"",options:t.zoomOptions,modelValue:t.zoomLevel,"onUpdate:modelValue":i[0]||(i[0]=o=>t.zoomLevel=o)},null,8,["options","modelValue"])],64)):d("",!0)]),g(s("div",ae,[s("div",le,[u(S,{text:t.$t("main.tasks")},null,8,["text"]),u(O,{class:"task-list",entries:e.localTasks,"is-loading":!e.currentAsset,"is-error":!1,onTaskSelected:t.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",ce,[u(S,{text:t.$t("main.info")},null,8,["text"]),i[6]||(i[6]=s("div",{class:"filler"},null,-1)),s("div",ue,[t.isCurrentUserManager?(n(),y(N,{key:0,icon:"edit",onClick:i[1]||(i[1]=o=>e.modals.edit=!0)})):d("",!0)])]),s("div",de,[e.currentAsset?(n(),a("table",he,[s("tbody",pe,[s("tr",_e,[s("td",me,r(t.$t("assets.fields.description")),1),u($,{entry:e.currentAsset,full:!0},null,8,["entry"])]),(n(!0),a(f,null,k(t.assetMetadataDescriptors,o=>(n(),a("tr",{key:o.id,class:"datatable-row"},[s("td",ye,r(o.name),1),s("td",null,r(e.currentAsset.data?e.currentAsset.data[o.field_name]:""),1)]))),128))])])):d("",!0)])])],512),[[b,t.currentSection==="infos"]]),t.currentSection==="chat"?(n(),y(F,{key:0,entity:e.currentAsset,name:(M=e.currentAsset)==null?void 0:M.full_name},null,8,["entity","name"])):d("",!0),g(s("div",fe,[e.currentAsset?(n(),a("div",ke,[e.currentAsset.castInShotsBySequence&&e.currentAsset.castInShotsBySequence[0].length>0?(n(),a("div",ge,[s("em",null,"Casted in "+r(c.nbShotsCastedIn)+" shots",1),e.currentAsset.castInShotsBySequence.length>0&&e.currentAsset.castInShotsBySequence[0][0].sequence_name?(n(!0),a(f,{key:0},k(e.currentAsset.castInShotsBySequence||[],o=>(n(),a("div",{class:"sequence-shots",key:(o==null?void 0:o.length)>0?o[0].sequence_name:""},[s("div",be,r((o==null?void 0:o.length)>0?o[0].sequence_name:""),1),s("div",ve,[(n(!0),a(f,null,k(o,_=>(n(),y(v,{class:"shot-link",key:_.shot_id,to:c.shotPath(_)},{default:C(()=>[u(A,{class:"entity-thumbnail",entity:_,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["entity"]),s("div",null,[s("span",Ae,r(_.shot_name),1),_.nb_occurences>1?(n(),a("span",Ce," ("+r(_.nb_occurences)+") ",1)):d("",!0)])]),_:2},1032,["to"]))),128))])]))),128)):(n(),a("div",we,r(t.$t("assets.no_cast_in")),1))])):d("",!0)])):(n(),y(V,{key:1,"is-loading":e.castIn.isLoading,"is-error":e.castIn.isError},null,8,["is-loading","is-error"])),e.currentAsset&&e.currentAsset.castingAssetsByType&&e.currentAsset.castingAssetsByType[0].length>0?(n(),a("div",Se,[u(S,{text:t.$t("assets.linked")},null,8,["text"]),e.currentAsset.castingAssetsByType&&e.currentAsset.castingAssetsByType[0].length>0?(n(),a("div",Te,[(n(!0),a(f,null,k(e.currentAsset.castingAssetsByType,o=>(n(),a("div",{class:"type-assets",key:o.length>0?o[0].asset_type_name:""},[s("div",Ie,r(o.length>0?o[0].asset_type_name:"")+" ("+r(o.length)+") ",1),s("div",Me,[(n(!0),a(f,null,k(o,_=>(n(),y(v,{class:"asset-link",key:_.id,to:{name:"asset",params:{production_id:t.currentProduction.id,asset_id:_.asset_id}}},{default:C(()=>[u(A,{class:"entity-thumbnail",entity:_,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["entity"]),s("div",null,[s("span",Ee,r(_.asset_name),1),_.nb_occurences>1?(n(),a("span",Le," ("+r(_.nb_occurences)+") ",1)):d("",!0)])]),_:2},1032,["to"]))),128))])]))),128))])):d("",!0)])):d("",!0)],512),[[b,t.currentSection==="casting"]]),e.currentAsset?g((n(),a("div",Pe,[u(U,{label:t.$t("main.status"),"task-status-list":c.taskStatusList,modelValue:e.currentConceptStatus,"onUpdate:modelValue":i[2]||(i[2]=o=>e.currentConceptStatus=o)},null,8,["label","task-status-list","modelValue"]),s("div",ze,[c.filteredLinkedConcepts.length?(n(!0),a(f,{key:0},k(c.filteredLinkedConcepts,o=>{var _;return n(),y(q,{class:ht(["concept",{selected:((_=e.currentConcept)==null?void 0:_.id)===o.id}]),key:"concept-"+o.id,concept:o,onClick:Ve=>c.selectConcept(o)},null,8,["class","concept","onClick"])}),128)):(n(),a("div",Be,r(t.$t("assets.no_concept")),1))])],512)),[[b,t.currentSection==="concepts"]]):d("",!0),t.scheduleItems[0].children.length>0?g((n(),a("div",De,[s("div",Oe,[u(x,{ref:"schedule-widget","start-date":t.tasksStartDate,"end-date":t.tasksEndDate,hierarchy:t.scheduleItems,"zoom-level":t.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1,onItemChanged:t.saveTaskScheduleItem,onEstimationChanged:i[3]||(i[3]=o=>t.saveTaskScheduleItem(o.item))},null,8,["start-date","end-date","hierarchy","zoom-level","onItemChanged"])])],512)),[[b,t.currentSection==="schedule"]]):d("",!0),t.currentSection==="preview-files"?(n(),y(j,{key:3,entity:e.currentAsset},null,8,["entity"])):d("",!0),t.currentSection==="time-logs"?(n(),y(R,{key:4,entity:e.currentAsset},null,8,["entity"])):d("",!0),t.currentSection==="output-files"?(n(),y(G,{key:5,entity:e.currentAsset},null,8,["entity"])):d("",!0)])]),g(s("div",Ne,[u(T,{task:e.currentTask,"entity-type":"Asset","with-actions":""},{default:C(()=>[u(H,{class:"news-column",entity:e.currentAsset},null,8,["entity"])]),_:1},8,["task"])],512),[[b,t.currentSection==="infos"]]),g(s("div",$e,[u(T,{"entity-type":"Concept",task:e.currentConceptTask},null,8,["task"])],512),[[b,t.currentSection==="concepts"]]),u(J,{ref:"edit-asset-modal",active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"asset-to-edit":e.currentAsset,onCancel:i[4]||(i[4]=o=>e.modals.edit=!1),onConfirm:c.confirmEditAsset},null,8,["active","is-loading","is-error","asset-to-edit","onConfirm"])])}const Ge=z(Qt,[["render",Fe],["__scopeId","data-v-a3e59d63"]]);export{Ge as default};
//# sourceMappingURL=Asset-DyGmsqiz.js.map
