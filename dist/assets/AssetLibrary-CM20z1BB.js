import{B as h,C as o,a as d,D as p,E as m,m as l,b as c,n as u,c as f,P as y,d as _,S as g,T as b,f as n}from"./index-CcBNbOMa.js";import{P as v}from"./PageLayout-CDI1ENu8.js";const C={name:"manage-library",components:{ButtonSimple:h,Combobox:o,ComboboxProduction:d,DeleteEntities:p,EntityThumbnail:m},props:{extendable:{type:Boolean,default:!0}},data(){return{productionId:null,entityTypeId:null,entityIds:[],loading:!1,error:!1}},async mounted(){var s;this.productionId=(s=this.openProductions[0])==null?void 0:s.id,this.$nextTick(()=>{var t;this.entityTypeId=(t=this.productionEntityTypes[0])==null?void 0:t.value}),await this.refresh()},computed:{...l(["assetTypes","assetTypeMap","openProductions","productionMap","selectedAssets","unsharedAssets"]),productionEntityTypes(){var e;const s=this.productionMap.get(this.productionId);return s?((e=s.asset_types)!=null&&e.length?this.assetTypes.filter(i=>s.asset_types.includes(i.id)):this.assetTypes).map(i=>({label:i.name,value:i.id})):[]},productionUnsharedEntities(){return this.unsharedAssets.filter(s=>s.project_id===this.productionId&&s.entity_type_id===this.entityTypeId)},selectedEntities(){return[...this.selectedAssets.values()]}},methods:{...c(["clearSelectedAssets","loadUnsharedAssets","shareAssets","unshareAssets"]),async refresh(){this.loading=!0,this.entityIds=[];const s=this.productionMap.get(this.productionId);try{await this.loadUnsharedAssets({production:s})}catch(t){console.error(t)}this.loading=!1},toggleEntities(s){const t=s.every(e=>this.isSelected(e));s.forEach(e=>this.toggleEntity(e,!t))},toggleEntity(s,t=!1){t||!this.isSelected(s)?this.entityIds.push(s.id):this.entityIds=this.entityIds.filter(e=>e!==s.id)},isSelected(s){return this.entityIds.includes(s.id)},async importFromProduction(s){this.loading=!0;const t=this.productionMap.get(s);try{await this.shareAssets({production:t}),this.$emit("library-updated")}catch(e){console.error(e)}this.loading=!1,await this.refresh()},async importFromAssetType(s,t){this.loading=!0;const e=this.productionMap.get(s),i=this.assetTypeMap.get(t);try{await this.shareAssets({production:e,assetType:i}),this.$emit("library-updated")}catch(a){console.error(a)}this.loading=!1,await this.refresh()},async importFromEntityIds(s){this.loading=!0;try{await this.shareAssets({assetIds:s}),this.$emit("library-updated")}catch(t){console.error(t)}this.loading=!1,await this.refresh()},async removeSharedEntities(s){this.loading=!0;const t=s.map(e=>e.id);try{await this.unshareAssets({assetIds:t}),this.$emit("library-updated"),this.clearSelectedAssets()}catch(e){console.error(e)}this.loading=!1,await this.refresh()}},watch:{productionId(){this.refresh()}}};var x=function(){var t=this,e=t._self._c;return e("div",{staticClass:"side-wrapper"},[t.extendable?e("div",{staticClass:"extend-bar",on:{mousedown:function(i){i.preventDefault()},touchstart:function(i){i.preventDefault()}}}):t._e(),e("div",{staticClass:"side manage-library"},[t.selectedEntities.length?e("div",{staticClass:"flexrowcolumn"},[e("delete-entities",{attrs:{"error-text":t.$t("assets.multiple_delete_error"),"is-loading":t.loading,"is-error":t.error,text:t.$tc("library.remove_selected_assets",t.selectedEntities.length,{nbSelectedAssets:t.selectedEntities.length})},on:{confirm:function(i){return t.removeSharedEntities(t.selectedEntities)}}}),e("div",{staticClass:"has-text-centered pa1"},[e("a",{on:{click:function(i){return t.clearSelectedAssets()}}},[t._v(t._s(t.$t("main.clear_selection")))])])],1):t._e(),t.selectedEntities.length?e("hr"):t._e(),e("h2",{staticClass:"mt0"},[t._v(t._s(t.$t("library.manage")))]),t.openProductions.length?[e("div",{staticClass:"flexcolumn mt2"},[e("combobox-production",{staticClass:"flexrow-item",attrs:{label:t.$t("library.select_production"),"production-list":t.openProductions,"with-margin":!1},model:{value:t.productionId,callback:function(i){t.productionId=i},expression:"productionId"}}),e("combobox",{staticClass:"flexrow-item mt2",attrs:{disabled:!t.productionId,label:t.$t("library.select_asset_type"),options:t.productionEntityTypes,"with-margin":!1},model:{value:t.entityTypeId,callback:function(i){t.entityTypeId=i},expression:"entityTypeId"}})],1),e("div",{staticClass:"flexcolumn mt2"},[e("button-simple",{staticClass:"flexrow-item mb05",attrs:{disabled:!t.productionId,"is-loading":t.loading,text:t.$t("library.import_from_production")},on:{click:function(i){return t.importFromProduction(t.productionId)}}}),e("button-simple",{staticClass:"flexrow-item",attrs:{disabled:!t.productionId,"is-loading":t.loading,text:t.$t("library.import_from_asset_type")},on:{click:function(i){return t.importFromAssetType(t.productionId,t.entityTypeId)}}}),e("hr",{staticClass:"mt1"}),e("button-simple",{staticClass:"flexrow-item",attrs:{disabled:!t.entityIds.length,"is-loading":t.loading,text:t.$t("library.import_from_list")},on:{click:function(i){return t.importFromEntityIds(t.entityIds)}}})],1),e("div",{staticClass:"flexcolumn"},[t.productionUnsharedEntities.length?e("div",{staticClass:"unshared-entities mt1"},[e("table",{staticClass:"datatable"},t._l(t.productionUnsharedEntities,function(i){return e("tr",{key:i.id,staticClass:"datatable-row"},[e("td",{staticClass:"datatable-row-header pointer",on:{click:function(a){return t.toggleEntity(i)}}},[e("div",{staticClass:"flexrow"},[e("input",{staticClass:"flexrow-item",attrs:{type:"checkbox"},domProps:{checked:t.isSelected(i)}}),e("entity-thumbnail",{staticClass:"entity-thumbnail flexrow-item",attrs:{entity:i,width:50,height:30,"empty-width":50,"empty-height":32}}),e("span",{staticClass:"entity-name ml05"},[t._v(" "+t._s(i.name)+" ")])],1)])])}),0)]):e("div",{staticClass:"mt1"},[t._v(" "+t._s(t.$t("library.no_entities"))+" ")])])]:e("div",{staticClass:"has-text-centered mt2"},[t._v(" "+t._s(t.$t("library.no_open_productions"))+" ")])],2)])},w=[],A=u(C,x,w,!1,null,"12cd53be");const I=A.exports,$={name:"asset-library",components:{Combobox:o,ComboboxProduction:d,EntityPreview:f,ManageLibrary:I,PageLayout:v,PageTitle:y,ProductionName:_,SearchField:g,TableInfo:b},data(){return{errors:{sharedAssets:!1},filters:{productionId:null},loading:{sharedAssets:!1},sorting:{current:"name",options:["name","production","created_at","updated_at"].map(s=>({label:s,value:s}))}}},mounted(){this.filters.productionId=this.$route.query.production||void 0,this.searchField.setValue(this.$route.query.search||void 0)},computed:{...l(["displayedSharedAssets","displayedSharedAssetsByType","isCurrentUserManager","openProductions","productionMap","selectedAssets"]),searchField(){return this.$refs["search-field"]},productionList(){return[{name:this.$t("main.all")},...this.openProductions]},sortedSharedAssetsByType(){const s=(e,i)=>e.name.localeCompare(i.name,void 0,{numeric:!0}),t=(e,i)=>e.production.name.localeCompare(i.production.name,void 0,{numeric:!0});return this.displayedSharedAssetsByType.map(e=>this.sorting.current==="production"?e.sort(n(t).thenBy(s)):this.sorting.current==="created_at"?e.sort(n("created_at")):this.sorting.current==="updated_at"?e.sort(n("updated_at",-1)):e.sort(n(s).thenBy(t)))}},methods:{...c(["loadSharedAssets","setAssetSelection","setSharedAssetSearch"]),async refresh(s=!1){this.loading.sharedAssets=!s;const t=this.productionMap.get(this.filters.productionId);try{await this.loadSharedAssets({production:t})}catch(e){console.error(e),this.errors.sharedAssets=!0}this.loading.sharedAssets=!1},toggleEntity(s){const t=this.isSelected(s);this.setAssetSelection({asset:s,selected:!t})},isSelected(s){return this.selectedAssets.has(s.id)},onSearchChange(){const s=this.searchField.getValue()||"";this.setSharedAssetSearch(s),this.updateRoute({search:s})},updateRoute({production:s,search:t}){const e={...this.$route.query,production:s||void 0,search:t||void 0};JSON.stringify(e)!==JSON.stringify(this.$route.query)&&this.$router.push({query:e})}},watch:{"filters.productionId"(s){this.updateRoute({production:s}),this.refresh()}},metaInfo(){return{title:`${this.$t("library.asset_library")} - Kitsu`}}};var S=function(){var t=this,e=t._self._c;return e("page-layout",{attrs:{side:t.isCurrentUserManager},scopedSlots:t._u([{key:"main",fn:function(){return[e("div",{staticClass:"asset-library"},[e("header",{staticClass:"flexrow"},[e("page-title",{staticClass:"mt1 filler",attrs:{text:t.$t("library.asset_library")}})],1),e("div",{staticClass:"filters flexrow"},[e("search-field",{directives:[{name:"focus",rawName:"v-focus"}],ref:"search-field",staticClass:"flexrow-item",attrs:{"can-save":!1},on:{change:t.onSearchChange}}),e("combobox-production",{staticClass:"flexrow-item",attrs:{label:t.$t("main.production"),"production-list":t.productionList},model:{value:t.filters.productionId,callback:function(i){t.$set(t.filters,"productionId",i)},expression:"filters.productionId"}}),e("span",{staticClass:"filler"}),e("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("main.sorted_by"),options:t.sorting.options,"locale-key-prefix":"library.fields."},model:{value:t.sorting.current,callback:function(i){t.$set(t.sorting,"current",i)},expression:"sorting.current"}})],1),e("div",{staticClass:"entities mb2"},[t.loading.sharedAssets||t.errors.sharedAssets?e("table-info",{attrs:{"is-loading":t.loading.sharedAssets,"is-error":t.errors.sharedAssets}}):t.displayedSharedAssets.length?t._l(t.sortedSharedAssetsByType,function(i,a){return e("div",{key:a,staticClass:"pb1"},[e("h2",{staticClass:"mt0"},[t._v(" "+t._s(i[0].asset_type_name)+" ("+t._s(i.length)+") ")]),e("ul",{staticClass:"items"},t._l(i,function(r){return e("li",{key:r.id,staticClass:"item flexcolumn",class:{"selectable-item":t.isCurrentUserManager,"selected-item":t.isSelected(r)},on:{click:function(k){t.isCurrentUserManager&&t.toggleEntity(r)}}},[e("div",{staticClass:"card",attrs:{title:r.full_name}},[e("entity-preview",{attrs:{"empty-height":100,"empty-width":150,height:100,width:150,entity:r,"is-rounded-top-border":""}}),e("div",{staticClass:"item-description flexrow"},[e("production-name",{staticClass:"flexrow-item mr0",attrs:{production:r.production,size:20,"only-avatar":""}}),e("div",{staticClass:"entity-name ml1 flexrow-item"},[t._v(" "+t._s(r.name)+" ")])],1)],1)])}),0)])}):e("div",{staticClass:"has-text-centered"},[t._v(" "+t._s(t.$t("library.no_shared_assets"))+" ")])],2)])]},proxy:!0},{key:"side",fn:function(){return[e("manage-library",{on:{"library-updated":function(i){return t.refresh(!0)}}})]},proxy:!0}])})},E=[],T=u($,S,E,!1,null,"55e51ba0");const M=T.exports;export{M as default};
//# sourceMappingURL=AssetLibrary-CM20z1BB.js.map
