import{B as $,C as E,a as C,D as L,E as N,m as T,b as V,_ as P,r as d,o as n,c as a,d as A,e as r,f as c,t as h,F as f,g as I,h as q,P as D,i as R,S as j,T as z,j as _,k as J,l as x,w as k,n as O,p as G}from"./index-CjJwuIVu.js";import{P as K}from"./PageLayout-Di1vNYFL.js";const Q={name:"manage-library",components:{ButtonSimple:$,Combobox:E,ComboboxProduction:C,DeleteEntities:L,EntityThumbnail:N},props:{extendable:{type:Boolean,default:!0}},emits:["library-updated"],data(){return{productionId:null,entityTypeId:null,entityIds:[],loading:!1,error:!1}},async mounted(){var e;this.productionId=(e=this.openProductions[0])==null?void 0:e.id,this.$nextTick(()=>{var t;this.entityTypeId=(t=this.productionEntityTypes[0])==null?void 0:t.value}),await this.refresh()},computed:{...T(["assetTypes","assetTypeMap","openProductions","productionMap","selectedAssets","unsharedAssets"]),productionEntityTypes(){var s;const e=this.productionMap.get(this.productionId);return e?((s=e.asset_types)!=null&&s.length?this.assetTypes.filter(u=>e.asset_types.includes(u.id)):this.assetTypes).map(u=>({label:u.name,value:u.id})):[]},productionUnsharedEntities(){return this.unsharedAssets.filter(e=>e.project_id===this.productionId&&e.entity_type_id===this.entityTypeId)},selectedEntities(){return[...this.selectedAssets.values()]}},methods:{...V(["clearSelectedAssets","loadUnsharedAssets","shareAssets","unshareAssets"]),async refresh(){this.loading=!0,this.entityIds=[];const e=this.productionMap.get(this.productionId);try{await this.loadUnsharedAssets({production:e})}catch(t){console.error(t)}this.loading=!1},toggleEntities(e){const t=e.every(s=>this.isSelected(s));e.forEach(s=>this.toggleEntity(s,!t))},toggleEntity(e,t=!1){t||!this.isSelected(e)?this.entityIds.push(e.id):this.entityIds=this.entityIds.filter(s=>s!==e.id)},isSelected(e){return this.entityIds.includes(e.id)},async importFromProduction(e){this.loading=!0;const t=this.productionMap.get(e);try{await this.shareAssets({production:t}),this.$emit("library-updated")}catch(s){console.error(s)}this.loading=!1,await this.refresh()},async importFromAssetType(e,t){this.loading=!0;const s=this.productionMap.get(e),u=this.assetTypeMap.get(t);try{await this.shareAssets({production:s,assetType:u}),this.$emit("library-updated")}catch(i){console.error(i)}this.loading=!1,await this.refresh()},async importFromEntityIds(e){this.loading=!0;try{await this.shareAssets({assetIds:e}),this.$emit("library-updated")}catch(t){console.error(t)}this.loading=!1,await this.refresh()},async removeSharedEntities(e){this.loading=!0;const t=e.map(s=>s.id);try{await this.unshareAssets({assetIds:t}),this.$emit("library-updated"),this.clearSelectedAssets()}catch(s){console.error(s)}this.loading=!1,await this.refresh()}},watch:{productionId(){this.refresh()}}},H={class:"side-wrapper"},W={key:0,class:"extend-bar"},X={class:"side manage-library"},Y={key:0,class:"flexrowcolumn"},Z={class:"has-text-centered pa1"},ee={key:1},te={class:"mt0"},se={key:2,class:"has-text-centered mt2"},ie={class:"flexcolumn mt2"},re={class:"flexcolumn mt2"},oe={class:"flexcolumn"},ne={key:0,class:"mt1"},le={key:1,class:"unshared-entities mt1"},ae={class:"datatable"},de=["onClick"],ce={class:"flexrow"},ue=["checked"],he={class:"entity-name ml05"};function pe(e,t,s,u,i,o){const g=d("delete-entities"),b=d("combobox-production"),v=d("combobox"),y=d("button-simple"),w=d("entity-thumbnail");return n(),a("div",H,[s.extendable?(n(),a("div",W)):A("",!0),r("div",X,[o.selectedEntities.length?(n(),a("div",Y,[c(g,{"error-text":e.$t("assets.multiple_delete_error"),"is-loading":i.loading,"is-error":i.error,text:e.$tc("library.remove_selected_assets",o.selectedEntities.length,{nbSelectedAssets:o.selectedEntities.length}),onConfirm:t[0]||(t[0]=l=>o.removeSharedEntities(o.selectedEntities))},null,8,["error-text","is-loading","is-error","text"]),r("div",Z,[r("a",{onClick:t[1]||(t[1]=l=>e.clearSelectedAssets())},h(e.$t("main.clear_selection")),1)])])):A("",!0),o.selectedEntities.length?(n(),a("hr",ee)):A("",!0),r("h2",te,h(e.$t("library.manage")),1),e.openProductions.length?(n(),a(f,{key:3},[r("div",ie,[c(b,{class:"flexrow-item",label:e.$t("library.select_production"),"production-list":e.openProductions,"with-margin":!1,modelValue:i.productionId,"onUpdate:modelValue":t[2]||(t[2]=l=>i.productionId=l)},null,8,["label","production-list","modelValue"]),c(v,{class:"flexrow-item mt2",disabled:!i.productionId,label:e.$t("library.select_asset_type"),options:o.productionEntityTypes,"with-margin":!1,modelValue:i.entityTypeId,"onUpdate:modelValue":t[3]||(t[3]=l=>i.entityTypeId=l)},null,8,["disabled","label","options","modelValue"])]),r("div",re,[c(y,{class:"flexrow-item mb05",disabled:!i.productionId,"is-loading":i.loading,text:e.$t("library.import_from_production"),onClick:t[4]||(t[4]=l=>o.importFromProduction(i.productionId))},null,8,["disabled","is-loading","text"]),c(y,{class:"flexrow-item",disabled:!i.productionId,"is-loading":i.loading,text:e.$t("library.import_from_asset_type"),onClick:t[5]||(t[5]=l=>o.importFromAssetType(i.productionId,i.entityTypeId))},null,8,["disabled","is-loading","text"]),t[7]||(t[7]=r("hr",{class:"mt1"},null,-1)),c(y,{class:"flexrow-item",disabled:!i.entityIds.length,"is-loading":i.loading,text:e.$t("library.import_from_list"),onClick:t[6]||(t[6]=l=>o.importFromEntityIds(i.entityIds))},null,8,["disabled","is-loading","text"])]),r("div",oe,[o.productionUnsharedEntities.length?(n(),a("div",le,[r("table",ae,[(n(!0),a(f,null,I(o.productionUnsharedEntities,l=>(n(),a("tr",{class:"datatable-row",key:l.id},[r("td",{class:"datatable-row-header pointer",onClick:S=>o.toggleEntity(l)},[r("div",ce,[r("input",{type:"checkbox",class:"flexrow-item",checked:o.isSelected(l)},null,8,ue),c(w,{class:"entity-thumbnail flexrow-item",entity:l,width:50,height:30,"empty-width":50,"empty-height":32},null,8,["entity"]),r("span",he,h(l.name),1)])],8,de)]))),128))])])):(n(),a("div",ne,h(e.$t("library.no_entities")),1))])],64)):(n(),a("div",se,h(e.$t("library.no_open_productions")),1))])])}const me=P(Q,[["render",pe],["__scopeId","data-v-dfd54a62"]]),ye={name:"asset-library",components:{Combobox:E,ComboboxProduction:C,EntityPreview:q,ManageLibrary:me,PageLayout:K,PageTitle:D,ProductionName:R,SearchField:j,TableInfo:z},data(){return{errors:{sharedAssets:!1},filters:{productionId:null},loading:{sharedAssets:!1},sorting:{current:"name",options:["name","production","created_at","updated_at"].map(e=>({label:e,value:e}))}}},mounted(){this.filters.productionId=this.$route.query.production||void 0,this.searchField.setValue(this.$route.query.search||void 0)},computed:{...T(["displayedSharedAssets","displayedSharedAssetsByType","isCurrentUserManager","openProductions","productionMap","selectedAssets"]),searchField(){return this.$refs["search-field"]},productionList(){return[{name:this.$t("main.all")},...this.openProductions]},sortedSharedAssetsByType(){const e=(s,u)=>s.name.localeCompare(u.name,void 0,{numeric:!0}),t=(s,u)=>s.production.name.localeCompare(u.production.name,void 0,{numeric:!0});return this.displayedSharedAssetsByType.map(s=>this.sorting.current==="production"?s.sort(_(t).thenBy(e)):this.sorting.current==="created_at"?s.sort(_("created_at")):this.sorting.current==="updated_at"?s.sort(_("updated_at",-1)):s.sort(_(e).thenBy(t)))}},methods:{...V(["loadSharedAssets","setAssetSelection","setSharedAssetSearch"]),async refresh(e=!1){this.loading.sharedAssets=!e;const t=this.productionMap.get(this.filters.productionId);try{await this.loadSharedAssets({production:t})}catch(s){console.error(s),this.errors.sharedAssets=!0}this.loading.sharedAssets=!1},toggleEntity(e){const t=this.isSelected(e);this.setAssetSelection({asset:e,selected:!t})},isSelected(e){return this.selectedAssets.has(e.id)},onSearchChange(){const e=this.searchField.getValue()||"";this.setSharedAssetSearch(e),this.updateRoute({search:e})},updateRoute({production:e,search:t}){const s={...this.$route.query,production:e||void 0,search:t||void 0};JSON.stringify(s)!==JSON.stringify(this.$route.query)&&this.$router.push({query:s})}},watch:{"filters.productionId"(e){this.updateRoute({production:e}),this.refresh()}},head(){return{title:`${this.$t("library.asset_library")} - Kitsu`}}},_e={class:"asset-library"},fe={class:"flexrow"},ge={class:"filters flexrow"},be={class:"entities mb2"},ve={key:1,class:"has-text-centered"},we={class:"mt0"},Ae={class:"items"},Ie=["onClick"],Se=["title"],xe={class:"item-description flexrow"},ke={class:"entity-name ml1 flexrow-item"};function Ee(e,t,s,u,i,o){const g=d("page-title"),b=d("search-field"),v=d("combobox-production"),y=d("combobox"),w=d("table-info"),l=d("entity-preview"),S=d("production-name"),B=d("manage-library"),F=d("page-layout"),M=J("focus");return n(),x(F,{side:e.isCurrentUserManager},{main:k(()=>[r("div",_e,[r("header",fe,[c(g,{class:"mt1 filler",text:e.$t("library.asset_library")},null,8,["text"])]),r("div",ge,[O(c(b,{ref:"search-field",class:"flexrow-item",onChange:o.onSearchChange,"can-save":!1},null,8,["onChange"]),[[M]]),c(v,{class:"flexrow-item",label:e.$t("main.production"),"production-list":o.productionList,modelValue:i.filters.productionId,"onUpdate:modelValue":t[0]||(t[0]=p=>i.filters.productionId=p)},null,8,["label","production-list","modelValue"]),t[3]||(t[3]=r("span",{class:"filler"},null,-1)),c(y,{class:"flexrow-item",label:e.$t("main.sorted_by"),options:i.sorting.options,"locale-key-prefix":"library.fields.",modelValue:i.sorting.current,"onUpdate:modelValue":t[1]||(t[1]=p=>i.sorting.current=p)},null,8,["label","options","modelValue"])]),r("div",be,[i.loading.sharedAssets||i.errors.sharedAssets?(n(),x(w,{key:0,"is-loading":i.loading.sharedAssets,"is-error":i.errors.sharedAssets},null,8,["is-loading","is-error"])):e.displayedSharedAssets.length?(n(!0),a(f,{key:2},I(o.sortedSharedAssetsByType,(p,U)=>(n(),a("div",{class:"pb1",key:U},[r("h2",we,h(p[0].asset_type_name)+" ("+h(p.length)+") ",1),r("ul",Ae,[(n(!0),a(f,null,I(p,m=>(n(),a("li",{class:G(["item flexcolumn",{"selectable-item":e.isCurrentUserManager,"selected-item":o.isSelected(m)}]),key:m.id,onClick:Ce=>e.isCurrentUserManager&&o.toggleEntity(m)},[r("div",{class:"card",title:m.full_name},[c(l,{"empty-height":100,"empty-width":150,height:100,width:150,entity:m,"is-rounded-top-border":""},null,8,["entity"]),r("div",xe,[c(S,{class:"flexrow-item mr0",production:m.production,size:20,"only-avatar":""},null,8,["production"]),r("div",ke,h(m.name),1)])],8,Se)],10,Ie))),128))])]))),128)):(n(),a("div",ve,h(e.$t("library.no_shared_assets")),1))])])]),side:k(()=>[c(B,{onLibraryUpdated:t[2]||(t[2]=p=>o.refresh(!0))})]),_:1},8,["side"])}const Pe=P(ye,[["render",Ee],["__scopeId","data-v-bbe422a1"]]);export{Pe as default};
//# sourceMappingURL=AssetLibrary-D9DZ9gNl.js.map
