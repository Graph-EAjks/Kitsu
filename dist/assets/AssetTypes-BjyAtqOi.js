import{a1 as V,a2 as D,T as $,Y as x,m as C,a3 as M,_ as E,r as d,o,c as r,e as n,t as p,F as v,g,a4 as B,f as m,d as f,l as b,a5 as N,C as L,a6 as F,a7 as U,a8 as H,a9 as O,Z as S,b as w,k as I,aa as R,n as j,p as q,ab as z,ac as G,ad as K}from"./index-Q_8bUN11.js";import{L as P}from"./ListPageHeader-DkIiWeTN.js";import{R as Y}from"./RouteTabs-BoSsBPtt.js";const Z={name:"asset-type-list",components:{HelpCircleIcon:V,RowActionsCell:D,TableInfo:$,TaskTypeName:x},props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["delete-clicked","edit-clicked"],computed:{...C(["taskTypeMap"])},methods:{sortTaskTypes(e=[]){const t=e.map(i=>this.taskTypeMap.get(i));return M(t)}}},J={class:"data-list"},Q={class:"datatable-wrapper"},W={class:"datatable"},X={class:"datatable-head"},ee={scope:"col",class:"name"},te={scope:"col",class:"short-name"},se={scope:"col",class:"task-types"},ae={key:0,class:"datatable-body"},ie={class:"name"},oe=["title"],le={class:"short-name"},ne={key:0,class:"task-types"},re={key:1,class:"task-types"},de={class:"has-text-centered nb-asset-types"};function ce(e,t,i,y,s,a){const h=d("help-circle-icon"),u=d("task-type-name"),T=d("row-actions-cell"),k=d("table-info");return o(),r("div",J,[n("div",Q,[n("table",W,[n("thead",X,[n("tr",null,[n("th",ee,p(e.$t("asset_types.fields.name")),1),n("th",te,p(e.$t("asset_types.fields.short_name")),1),n("th",se,p(e.$t("asset_types.fields.task_types")),1),t[0]||(t[0]=n("th",{scope:"col",class:"actions"},null,-1))])]),i.entries.length>0?(o(),r("tbody",ae,[(o(!0),r(v,null,g(i.entries,c=>(o(),r("tr",{class:"datatable-row",key:c.id},[n("td",ie,[B(p(c.name)+" ",1),c.description?(o(),r("span",{key:0,title:c.description},[m(h,{class:"icon is-small"})],8,oe)):f("",!0)]),n("td",le,p(c.short_name),1),(c.task_types||[]).length>0?(o(),r("td",ne,[(o(!0),r(v,null,g(a.sortTaskTypes(c.task_types),_=>(o(),r("span",{key:_.id,class:"task-type-name flexrow-item"},[_.id?(o(),b(u,{key:0,"task-type":_},null,8,["task-type"])):f("",!0)]))),128))])):(o(),r("td",re,p(e.$t("asset_types.include_all")),1)),m(T,{"entry-id":c.id,onEditClicked:_=>e.$emit("edit-clicked",c),onDeleteClicked:_=>e.$emit("delete-clicked",c)},null,8,["entry-id","onEditClicked","onDeleteClicked"])]))),128))])):f("",!0)])]),m(k,{"is-loading":i.isLoading,"is-error":i.isError},null,8,["is-loading","is-error"]),n("p",de,p(i.entries.length)+" "+p(e.$tc("asset_types.number",i.entries.length)),1)])}const pe=E(Z,[["render",ce],["__scopeId","data-v-5584ef0b"]]),me={name:"edit-asset-type-modal",mixins:[N],components:{Combobox:L,ComboboxBoolean:F,ModalFooter:U,TaskTypeName:x,TextareaField:H,TextField:O},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},assetTypeToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{name:"",short_name:"",description:"",task_types:[]}}},computed:{...C(["taskTypes","taskTypeMap","assetTypes","assetTypeStatusOptions"]),isEditing(){return this.assetTypeToEdit&&this.assetTypeToEdit.id},availableTaskTypes(){const e=S(this.taskTypes.filter(t=>this.form.task_types.indexOf(t.id)===-1&&t.for_entity==="Asset"));return[{name:"+ Task Type",id:"-"},...e].map(t=>({label:t.name,value:t.id}))}},methods:{...w(["loadTaskTypes"]),removeTaskType(e){const t=this.form.task_types.indexOf(e);t>=0&&this.form.task_types.splice(t,1)},runConfirmation(){this.$emit("confirm",this.form)}},watch:{active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)},assetTypeToEdit(){if(this.assetTypeToEdit.id){const e=this.assetTypeToEdit.task_types||[];this.form={name:this.assetTypeToEdit.name,short_name:this.assetTypeToEdit.short_name,description:this.assetTypeToEdit.description,task_types:[...e],archived:String(this.assetTypeToEdit.archived===!0)}}else this.form={name:"",short_name:"",description:"",task_types:[],archived:"false"}}}},ye={class:"modal-content"},_e={class:"box"},he={key:0,class:"title"},fe={key:1,class:"title"},ue={class:"label"},Te={class:"flexrow task-types mb1"},ke=["onClick"];function be(e,t,i,y,s,a){const h=d("text-field"),u=d("textarea-field"),T=d("combobox-boolean"),k=d("task-type-name"),c=d("combobox"),_=d("modal-footer"),A=I("focus");return o(),r("div",{class:q({modal:!0,"is-active":i.active})},[n("div",{class:"modal-background",onClick:t[0]||(t[0]=l=>e.$emit("cancel"))}),n("div",ye,[n("div",_e,[i.assetTypeToEdit&&i.assetTypeToEdit.id?(o(),r("h1",he,p(e.$t("asset_types.edit_title"))+" "+p(i.assetTypeToEdit.name),1)):(o(),r("h1",fe,p(e.$t("asset_types.new_asset_type")),1)),n("form",{onSubmit:t[6]||(t[6]=R(()=>{},["prevent"]))},[j(m(h,{ref:"nameField",label:e.$t("asset_types.fields.name"),maxlength:30,modelValue:s.form.name,"onUpdate:modelValue":t[1]||(t[1]=l=>s.form.name=l),onEnter:a.runConfirmation},null,8,["label","modelValue","onEnter"]),[[A]]),m(h,{ref:"shortNameField",label:e.$t("asset_types.fields.short_name"),maxlength:30,modelValue:s.form.short_name,"onUpdate:modelValue":t[2]||(t[2]=l=>s.form.short_name=l),onEnter:a.runConfirmation},null,8,["label","modelValue","onEnter"]),m(u,{label:e.$t("asset_types.fields.description"),modelValue:s.form.description,"onUpdate:modelValue":t[3]||(t[3]=l=>s.form.description=l),onEnter:a.runConfirmation},null,8,["label","modelValue","onEnter"]),a.isEditing?(o(),b(T,{key:0,label:e.$t("main.archived"),onEnter:a.runConfirmation,modelValue:s.form.archived,"onUpdate:modelValue":t[4]||(t[4]=l=>s.form.archived=l)},null,8,["label","onEnter","modelValue"])):f("",!0),n("label",ue,p(e.$t("asset_types.fields.task_types")),1),n("div",Te,[(o(!0),r(v,null,g(s.form.task_types,l=>(o(),r("div",{class:"flexrow-item mb1",key:l,onClick:xe=>a.removeTaskType(l)},[l?(o(),b(k,{key:0,"task-type":e.taskTypeMap.get(l),deletable:!0},null,8,["task-type"])):f("",!0)],8,ke))),128)),a.availableTaskTypes.length>1?(o(),b(c,{key:0,class:"flexrow-item mb1",options:a.availableTaskTypes,"with-margin":!1,"onUpdate:modelValue":t[5]||(t[5]=l=>{e.taskTypeMap.get(l)&&s.form.task_types.push(l)})},null,8,["options"])):f("",!0)])],32),m(_,{"error-text":e.$t("asset_types.create_error"),"is-error":i.isError,"is-loading":i.isLoading,onConfirm:a.runConfirmation,onCancel:t[7]||(t[7]=l=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const ve=E(me,[["render",be],["__scopeId","data-v-938bca69"]]),ge={name:"asset-types",components:{AssetTypeList:pe,DeleteModal:z,EditAssetTypeModal:ve,ListPageHeader:P,RouteTabs:Y},data(){return{activeTab:"active",assetTypeToDelete:null,assetTypeToEdit:{},choices:[],errors:{del:!1,edit:!1,list:!1},modals:{del:!1,edit:!1},loading:{del:!1,edit:!1,list:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},mounted(){this.activeTab=this.$route.query.tab||"active"},computed:{...C(["assetTypes","archivedAssetTypes","getAssetType","taskTypeMap"]),isActiveTab(){return this.activeTab==="active"},assetTypesList(){return this.isActiveTab?this.assetTypes:this.archivedAssetTypes},deleteText(){const e=this.assetTypeToDelete;return e?this.$t("asset_types.delete_text",{name:e.name}):""}},methods:{...w(["deleteAssetType","editAssetType","newAssetType","loadAssetTypes"]),confirmEditAssetType(e){let t="newAssetType";this.assetTypeToEdit&&this.assetTypeToEdit.id&&(t="editAssetType",e.id=this.assetTypeToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this[t](e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(i=>{console.error(i),this.loading.edit=!1,this.errors.edit=!0})},confirmDeleteAssetType(){this.loading.del=!0,this.errors.del=!1,this.deleteAssetType(this.assetTypeToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(e=>{console.error(e),this.errors.del=!0,this.loading.del=!1})},onExportClicked(){const e=G.slugify(this.$t("asset_types.title")),i=[[this.$t("main.type"),this.$t("asset_types.fields.name"),this.$t("asset_types.fields.short_name"),this.$t("asset_types.fields.description"),this.$t("asset_types.fields.task_types")]].concat(this.assetTypes.map(y=>[y.type,y.name,y.short_name,y.description,y.task_types.length?y.task_types.map(s=>{var a;return(a=this.taskTypeMap.get(s))==null?void 0:a.name}).join(", "):this.$t("asset_types.include_all")]));K.buildCsvFile(e,i)},onNewClicked(){this.assetTypeToEdit={},this.errors.edit=!1,this.modals.edit=!0},onEditClicked(e){this.assetTypeToEdit=e,this.errors.edit=!1,this.modals.edit=!0},onDeleteClicked(e){this.assetTypeToDelete=e,this.errors.del=!1,this.modals.del=!0}},watch:{$route(){this.activeTab=this.$route.query.tab||"active"}},head(){return{title:`${this.$t("asset_types.title")} - Kitsu`}}},Ce={class:"asset-types page fixed-page"};function Ee(e,t,i,y,s,a){const h=d("list-page-header"),u=d("route-tabs"),T=d("asset-type-list"),k=d("edit-asset-type-modal"),c=d("delete-modal");return o(),r("div",Ce,[m(h,{title:e.$t("asset_types.title"),"new-entry-label":e.$t("asset_types.new_asset_type"),"is-exportable":a.isActiveTab,onExportClicked:a.onExportClicked,onNewClicked:a.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),m(u,{class:"mt2","active-tab":s.activeTab,tabs:s.tabs,"route-name":"asset-types"},null,8,["active-tab","tabs"]),m(T,{class:"asset-type-list",entries:a.assetTypesList,"is-loading":s.loading.list,"is-error":s.errors.list,onEditClicked:a.onEditClicked,onDeleteClicked:a.onDeleteClicked},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked"]),m(k,{active:s.modals.edit,"is-loading":s.loading.edit,"is-error":s.errors.edit,"asset-type-to-edit":s.assetTypeToEdit,onCancel:t[0]||(t[0]=_=>s.modals.edit=!1),onConfirm:a.confirmEditAssetType},null,8,["active","is-loading","is-error","asset-type-to-edit","onConfirm"]),m(c,{active:s.modals.del,"is-loading":s.loading.del,"is-error":s.errors.del,text:a.deleteText,"error-text":e.$t("asset_types.delete_error"),onCancel:t[1]||(t[1]=_=>s.modals.del=!1),onConfirm:a.confirmDeleteAssetType},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const De=E(ge,[["render",Ee],["__scopeId","data-v-9b072ed3"]]);export{De as default};
//# sourceMappingURL=AssetTypes-BjyAtqOi.js.map
