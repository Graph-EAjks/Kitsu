import{_ as x,a4 as E,af as D,ag as A,ah as V,ai as L,a8 as F,r as l,o as d,c as u,e as i,t as m,a9 as S,f as r,a3 as C,F as U,l as h,w as R,d as _,aj as N,p as B,ak as M,B as G,al as I,am as O,an as q,P as j,S as z,m as H,b as K}from"./index-CjJwuIVu.js";import{E as Q,a as J,P as W}from"./PeopleList-DhlYF7I-.js";import{E as X}from"./eye-off-DPiQ4OS8.js";import"./ComboboxStudio-CuD897fN.js";import"./DepartmentNamesCell-Cs0QDY2r.js";import"./PeopleNameCell-DaNtAYKn.js";const Y={name:"new-token-modal",mixins:[E,D],components:{AlertTriangleIcon:A,DateField:V,EyeIcon:L,EyeOffIcon:X,TextField:F},props:{active:{type:Boolean,default:!1},person:{type:Object,default:()=>{}}},emits:["cancel","close","generate-token"],data(){return{form:{expiration_date:null},message:null,visible:!1}},computed:{isValidExpirationDate(){return!this.form.expiration_date||new Date(this.form.expiration_date)>new Date}},methods:{generateToken(){this.$emit("generate-token",{id:this.person.id,expiration_date:this.form.expiration_date})},async copyClicked(){this.message=null,await navigator.clipboard.writeText(this.person.access_token),this.message=this.$t("bots.token_copied"),setTimeout(()=>{this.message=null},5e3)},resetForm(){this.form={expiration_date:this.person.expiration_date},this.message=null,this.visible=!1}},watch:{active(){this.active&&this.resetForm()}}},Z={class:"modal-content"},$={class:"box"},ee={class:"title"},te={class:"mb2 warning-text"},oe={class:"flexrow right"},se=["disabled"],ie={class:"mb2 warning-text"},le={class:"token"},ne={class:"flexrow right"},re={key:0,class:"success has-text-right mr05"},ae=["disabled"];function de(e,t,n,p,o,s){const f=l("alert-triangle-icon"),v=l("date-field"),g=l("text-field"),k=l("eye-off-icon"),b=l("eye-icon");return d(),u("div",{class:B(["modal",{"is-active":n.active}])},[t[8]||(t[8]=i("div",{class:"modal-background"},null,-1)),i("div",Z,[i("div",$,[i("h1",ee,m(e.$t("bots.new_token_title",{name:n.person.full_name})),1),n.person.access_token?(d(),u(U,{key:1},[i("p",ie,[r(f,{class:"icon mr05 warning"}),C(" "+m(e.$t("bots.copy_token_warning")),1)]),i("div",le,[r(g,{ref:"token",disabled:!o.visible,"input-class":" token-input",readonly:!0,type:o.visible?"text":"password","model-value":n.person.access_token},null,8,["disabled","type","model-value"]),o.visible?(d(),h(k,{key:0,class:"icon",onClick:t[4]||(t[4]=a=>o.visible=!1)})):(d(),h(b,{key:1,class:"icon",onClick:t[5]||(t[5]=a=>o.visible=!0)}))]),i("div",ne,[r(N,{name:"fade"},{default:R(()=>[o.message?(d(),u("p",re,m(o.message),1)):_("",!0)]),_:1}),i("button",{class:"button flexrow-item is-primary",onClick:t[6]||(t[6]=(...a)=>s.copyClicked&&s.copyClicked(...a)),disabled:!n.person.access_token},m(e.$t("main.copy")),9,ae),i("button",{class:"button flexrow-item is-link",onClick:t[7]||(t[7]=a=>e.$emit("close"))},m(e.$t("main.close")),1)])],64)):(d(),u("form",{key:0,class:"form",onSubmit:t[3]||(t[3]=S(()=>{},["prevent"]))},[i("p",te,[r(f,{class:"icon mr05 warning"}),C(" "+m(e.$t("bots.new_token_warning")),1)]),r(v,{invalid:!s.isValidExpirationDate,label:e.$t("bots.fields.expiration_date"),"min-date":e.today,modelValue:o.form.expiration_date,"onUpdate:modelValue":t[0]||(t[0]=a=>o.form.expiration_date=a)},null,8,["invalid","label","min-date","modelValue"]),i("div",oe,[i("button",{class:"button flexrow-item is-primary",disabled:!s.isValidExpirationDate,onClick:t[1]||(t[1]=(...a)=>s.generateToken&&s.generateToken(...a))},m(e.$t("bots.generate")),9,se),i("button",{class:"button flexrow-item is-link",onClick:t[2]||(t[2]=a=>e.$emit("cancel"))},m(e.$t("main.cancel")),1)])],32))])])],2)}const me=x(Y,[["render",de],["__scopeId","data-v-3bc778f6"]]),ce={name:"bots",mixins:[M],components:{ButtonSimple:G,ComboboxDepartment:I,ComboboxStyled:O,EditAvatarModal:Q,EditPersonModal:J,HardDeleteModal:q,NewTokenModal:me,PageTitle:j,PeopleList:W,SearchField:z},data(){return{role:"all",roleOptions:[{label:"all",value:"all"},{label:"admin",value:"admin"},{label:"client",value:"client"},{label:"manager",value:"manager"},{label:"supervisor",value:"supervisor"},{label:"user",value:"user"},{label:"vendor",value:"vendor"}],errors:{avatar:!1,del:!1,edit:!1,userLimit:!1},loading:{del:!1,deletingAvatar:!1,edit:!1,updatingAvatar:!1},modals:{avatar:!1,del:!1,edit:!1,newToken:!1},personToDelete:{},personToEdit:{role:"user"},selectedDepartment:""}},mounted(){this.role=this.$route.query.role||"all",this.selectedDepartment=this.$route.query.department||"",this.setSearchFromUrl(),this.loadPeople(()=>{this.onSearchChange()})},watch:{"modals.edit"(){this.modals.edit&&(this.errors.edit=!1,this.errors.userLimit=!1,this.loading.edit=!1)},selectedDepartment(){this.updateRoute()},role(){this.updateRoute()}},computed:{...H(["displayedPeople","isCurrentUserAdmin","isPeopleLoading","isPeopleLoadingError"]),currentPeople(){let e=this.displayedPeople.filter(t=>t.is_bot);return this.role!=="all"&&(e=e.filter(t=>t.role===this.role)),this.selectedDepartment&&(e=e.filter(t=>t.departments.includes(this.selectedDepartment))),e},deleteText(){var t;const e=(t=this.personToDelete)==null?void 0:t.full_name;return e?this.$t("people.delete_text",{personName:e}):""},searchField(){return this.$refs["search-field"]}},methods:{...K(["clearPersonAvatar","deletePeople","editPerson","generateToken","loadPeople","newPerson","setPeopleSearch","uploadPersonAvatar"]),async deleteAvatar(){this.loading.deletingAvatar=!0;try{await this.clearPersonAvatar(this.personToEdit),this.modals.avatar=!1}catch{this.errors.avatar=!0}this.loading.deletingAvatar=!1},async updateAvatar(e){this.loading.updatingAvatar=!0;try{await this.uploadPersonAvatar({person:this.personToEdit,formData:e}),this.modals.avatar=!1}catch{this.errors.avatar=!0}this.loading.updatingAvatar=!1},confirmGenerateToken(e){this.generateToken(e).then(t=>{this.updatePersonToEdit(t)}).catch(console.error)},confirmEditPeople(e){let t="editPerson";this.personToEdit.id===void 0?t="newPerson":e.id=this.personToEdit.id,this.loading.edit=!0,this.errors.edit=!1,this.errors.userLimit=!1,this[t](e).then(n=>{this.loading.edit=!1,this.modals.edit=!1;const p=n.access_token;p!=null&&p.length&&(this.updatePersonToEdit(n),this.modals.newToken=!0)}).catch(n=>{var o,s;console.error(n),((s=(o=n.body)==null?void 0:o.message)==null?void 0:s.includes("limit"))??!1?this.errors.userLimit=!0:this.errors.edit=!0,this.loading.edit=!1})},confirmDeletePeople(){this.loading.del=!0,this.errors.del=!1,this.deletePeople(this.personToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(e=>{console.error(e),this.loading.del=!1,this.errors.del=!0})},onSearchChange(){if(!this.searchField)return;const e=this.searchField.getValue();e.length!==1&&(this.setPeopleSearch(e),this.updateRoute())},onAvatarClicked(e){this.updatePersonToEdit(e),this.errors.avatar=!1,this.modals.avatar=!0},onDeleteClicked(e){this.personToDelete=e,this.modals.del=!0},onEditClicked(e){this.updatePersonToEdit(e),this.modals.edit=!0},onRefreshClicked(e){this.updatePersonToEdit(e),this.modals.newToken=!0},onNewClicked(){this.updatePersonToEdit({role:"user"}),this.modals.edit=!0},updatePersonToEdit(e){this.personToEdit={...e,expiration_date:e.expiration_date?new Date(e.expiration_date):null}},updateRoute(){const e=this.searchField.getValue(),t=this.selectedDepartment,n=this.role;this.$router.push({query:{search:e,department:t,role:n}})}},head(){return{title:`${this.$t("bots.title")} - Kitsu`}}},pe={class:"bots page fixed-page"},ue={class:"flexrow page-header"},he={class:"flexrow search-options"},fe={key:1,class:"has-text-centered strong"};function ve(e,t,n,p,o,s){const f=l("page-title"),v=l("button-simple"),g=l("search-field"),k=l("combobox-department"),b=l("combobox-styled"),a=l("people-list"),w=l("edit-avatar-modal"),y=l("edit-person-modal"),T=l("new-token-modal"),P=l("hard-delete-modal");return d(),u("div",pe,[i("div",ue,[r(f,{class:"flexrow-item filler",text:e.$t("bots.title")},null,8,["text"]),e.isCurrentUserAdmin?(d(),h(v,{key:0,class:"flexrow-item",text:e.$t("bots.new_bot"),"is-responsive":!0,icon:"plus",onClick:s.onNewClicked},null,8,["text","onClick"])):_("",!0)]),i("div",he,[r(g,{ref:"search-field",class:"search flexrow-item",onChange:s.onSearchChange,placeholder:"ex: gazu bot"},null,8,["onChange"]),r(k,{class:"flexrow-item",label:e.$t("main.department"),modelValue:o.selectedDepartment,"onUpdate:modelValue":t[0]||(t[0]=c=>o.selectedDepartment=c)},null,8,["label","modelValue"]),r(b,{class:"flexrow-item",label:e.$t("people.fields.role"),"locale-key-prefix":"people.role.",options:o.roleOptions,modelValue:o.role,"onUpdate:modelValue":t[1]||(t[1]=c=>o.role=c)},null,8,["label","options","modelValue"])]),t[7]||(t[7]=i("div",{class:"query-list"},null,-1)),e.isPeopleLoading||s.currentPeople.length>0?(d(),h(a,{key:0,entries:s.currentPeople,"is-bots":!0,"is-loading":e.isPeopleLoading,"is-error":e.isPeopleLoadingError,onAvatarClicked:s.onAvatarClicked,onDeleteClicked:s.onDeleteClicked,onEditClicked:s.onEditClicked,onRefreshClicked:s.onRefreshClicked},null,8,["entries","is-loading","is-error","onAvatarClicked","onDeleteClicked","onEditClicked","onRefreshClicked"])):(d(),u("div",fe,[i("p",null,m(e.$t("bots.no_bot")),1),e.isCurrentUserAdmin?(d(),h(v,{key:0,class:"mt1",text:e.$t("bots.new_bot"),"is-responsive":!0,onClick:s.onNewClicked},null,8,["text","onClick"])):_("",!0)])),r(w,{active:o.modals.avatar,"error-text":e.$t("bots.edit_avatar_error"),"is-deleting":o.loading.deletingAvatar,"is-error":o.errors.avatar,"is-updating":o.loading.updatingAvatar,person:o.personToEdit,onClose:t[2]||(t[2]=c=>o.modals.avatar=!1),onDelete:s.deleteAvatar,onUpdate:s.updateAvatar},null,8,["active","error-text","is-deleting","is-error","is-updating","person","onDelete","onUpdate"]),r(y,{active:o.modals.edit,"is-bot":!0,"is-error":o.errors.edit,"is-loading":o.loading.edit,"is-user-limit-error":o.errors.userLimit,"person-to-edit":o.personToEdit,onCancel:t[3]||(t[3]=c=>o.modals.edit=!1),onConfirm:s.confirmEditPeople},null,8,["active","is-error","is-loading","is-user-limit-error","person-to-edit","onConfirm"]),r(T,{active:o.modals.newToken,person:o.personToEdit,onCancel:t[4]||(t[4]=c=>o.modals.newToken=!1),onClose:t[5]||(t[5]=c=>o.modals.newToken=!1),onGenerateToken:s.confirmGenerateToken},null,8,["active","person","onGenerateToken"]),r(P,{active:o.modals.del,"error-text":e.$t("people.delete_error"),"is-loading":o.loading.del,"is-error":o.errors.del,"lock-text":o.personToDelete?o.personToDelete.full_name:"",text:s.deleteText,onCancel:t[6]||(t[6]=c=>o.modals.del=!1),onConfirm:s.confirmDeletePeople},null,8,["active","error-text","is-loading","is-error","lock-text","text","onConfirm"])])}const we=x(ce,[["render",ve],["__scopeId","data-v-1d6c6396"]]);export{we as default};
//# sourceMappingURL=Bots-BEMgq713.js.map
