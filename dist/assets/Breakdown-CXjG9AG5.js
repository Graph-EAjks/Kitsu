import{n as c,K as v,C as _,M as C,e as b,U as f,a4 as y,a5 as w,E as k,m as g,a6 as S,a0 as E,a7 as x,B as $,a2 as T,Q as I,a8 as M,y as A,a9 as D,aa as O,S as F,ab as L,ac as B,j as q,ad as R,ae as d,b as P,af as m,W as p,ag as u,ah as N}from"./index-DKo3EM5C.js";import{B as H}from"./ButtonHrefLink-DU5S--vT.js";import"./upload-B__Mfep3.js";const V={name:"available-asset-block",props:{asset:{default:()=>({id:"",name:""}),type:Object},active:{default:!1,type:Boolean},textMode:{default:!1,type:Boolean},bigMode:{default:!0,type:Boolean}},methods:{addOneAsset(t){this.active&&this.$emit("add-one",this.asset.id)},addTenAssets(t){this.active&&this.$emit("add-ten",this.asset.id)}}};var z=function(){var e=this,s=e._self._c;return e.textMode?s("div",{staticClass:"asset-text flexrow-item flexrow",class:{shared:e.asset.shared}},[s("span",{staticClass:"asset-text-name flexrow-item"},[e._v(" "+e._s(e.asset.name)+" ")]),s("span",{staticClass:"modify-asset flexrow-item",on:{click:e.addOneAsset}},[e._v(" + 1 ")])]):s("div",{staticClass:"asset",class:{active:e.active,"big-asset":e.bigMode,shared:e.asset.shared},attrs:{id:`casting-${e.asset.id}`,title:e.asset.name}},[s("div",{staticClass:"asset-add",on:{click:e.addOneAsset}},[e._v("+ 1")]),s("div",{staticClass:"asset-add-10",on:{click:e.addTenAssets}},[e._v("+ 10")]),e.asset.preview_file_id?s("div",{staticClass:"asset-picture"},[s("img",{attrs:{loading:"lazy",alt:"",src:`/api/pictures/thumbnails-square/preview-files/${e.asset.preview_file_id}.png`}})]):s("div",{staticClass:"asset-picture"},[s("span",{staticClass:"empty-picture"},[e._v(" "+e._s(e.asset.name)+" ")])])])},W=[],K=c(V,z,W,!1,null,"d0040da9");const U=K.exports,j={name:"edit-label-modal",mixins:[v],components:{Combobox:_,ModalFooter:C},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},label:{type:String}},mounted(){this.form.label=this.label},data(){return{form:{label:"animate"},typeOptions:[{label:this.$t("breakdown.options.animate"),value:"animate"},{label:this.$t("breakdown.options.fixed"),value:"fixed"}]}},methods:{confirm(){return this.$emit("confirm",this.form)}},watch:{label(){this.form.label=this.label}}};var Q=function(){var e=this,s=e._self._c;return s("div",{class:{modal:!0,"is-active":e.active}},[s("div",{staticClass:"modal-background",on:{click:function(i){return e.$emit("cancel")}}}),s("div",{staticClass:"modal-content"},[s("div",{staticClass:"box content"},[s("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("breakdown.edit_label"))+" ")]),s("form",{on:{submit:function(i){i.preventDefault()}}},[s("combobox",{directives:[{name:"focus",rawName:"v-focus"}],ref:"typeField",attrs:{label:e.$t("breakdown.label"),options:e.typeOptions},on:{enter:e.confirm},model:{value:e.form.label,callback:function(i){e.$set(e.form,"label",i)},expression:"form.label"}}),s("modal-footer",{attrs:{"is-error":e.isError,"is-loading":e.isLoading},on:{confirm:e.confirm,cancel:function(i){return e.$emit("cancel")}}})],1)])])])},G=[],Y=c(j,Q,G,!1,null,"bd7ffeb2");const X=Y.exports,J={name:"asset-block",mixins:[b],props:{asset:{default:()=>({id:"",name:""}),type:Object},nbOccurences:{default:1,type:Number},active:{default:!0,type:Boolean},readOnly:{default:!1,type:Boolean},textMode:{default:!1,type:Boolean},bigMode:{default:!1,type:Boolean}},methods:{removeOneAsset(t){this.pauseEvent(t),this.$emit("remove-one",this.asset.asset_id,this.nbOccurences)},addOneAsset(t){this.pauseEvent(t),this.$emit("add-one",this.asset.asset_id,this.nbOccurences)},shortenName(t){return f.shortenText(t,13)},onEditLabelClicked(){this.readOnly||this.$emit("edit-label",this.asset,this.asset.label)}}};var Z=function(){var e=this,s=e._self._c;return e.textMode?s("div",{staticClass:"asset-text flexrow-item flexrow",class:{shared:e.asset.shared}},[s("span",{staticClass:"asset-text-name flexrow-item"},[e._v(" "+e._s(e.asset.name)+" ("+e._s(e.nbOccurences)+") ")]),s("span",{staticClass:"filler"}),e.readOnly?e._e():s("span",{staticClass:"modify-asset flexrow-item",on:{click:e.removeOneAsset}},[e._v(" - 1 ")])]):s("div",{staticClass:"asset big casted labelled",class:{active:e.active,"big-asset":e.bigMode,shared:e.asset.shared},attrs:{title:`${e.asset.name} (${e.nbOccurences})`}},[s("div",{staticClass:"asset-wrapper"},[e.readOnly?e._e():s("div",{staticClass:"asset-add-1",on:{click:e.addOneAsset}},[e._v("+ 1")]),e.readOnly?e._e():s("div",{staticClass:"asset-add",on:{click:e.removeOneAsset}},[e._v("- 1")]),e.asset.preview_file_id?s("div",{staticClass:"asset-picture"},[s("img",{attrs:{loading:"lazy",alt:"",src:`/api/pictures/thumbnails-square/preview-files/${e.asset.preview_file_id}.png`}}),e.nbOccurences>1?s("span",{staticClass:"nb-occurences"},[e._v(" "+e._s(e.nbOccurences)+" ")]):e._e()]):s("div",{staticClass:"asset-picture"},[s("span",{staticClass:"empty-picture"},[e._v(" "+e._s(e.shortenName(e.asset.name))+" ("+e._s(e.nbOccurences)+") ")])])]),s("div",{staticClass:"asset-label",attrs:{label:e.asset.label},on:{click:e.onEditLabelClicked}},[e._v(" "+e._s(e.asset.label||e.$t("breakdown.options.animate"))+" ")])])},ee=[],se=c(J,Z,ee,!1,null,"041ceae1");const te=se.exports,ie={name:"shot-line",mixins:[y,w],components:{AssetBlock:te,EntityThumbnail:k},props:{entity:{default:()=>{},type:Object},previewFileId:{default:"",type:String},selected:{default:!1,type:Boolean},name:{default:"",type:String},assets:{default:()=>[],type:Array},assetTypes:{default:()=>[],type:Array},readOnly:{default:!1,type:Boolean},textMode:{default:!1,type:Boolean},metadataDescriptors:{default:()=>[],type:Array},metadataDisplayHeaders:{default:()=>{},type:Object},bigMode:{default:!1,type:Boolean},isDescription:{default:!0,type:Boolean},isSaveError:{default:!1,type:Boolean},columnWidth:{default:()=>{},type:Object}},computed:{...g(["assetMap","isCurrentUserManager","isCurrentUserSupervisor","isFrameIn","isFrameOut","isFrames","isShowInfosBreakdown","user"]),chunks(){return this.name.split(" / ").filter(e=>e&&e!=="undefined")},assetsByAssetTypesMap(){const t={};return this.assets.forEach(e=>{e[0]&&(t[e[0].asset_type_name]=e)}),t}},methods:{onClicked(t){this.$emit("click",this.entity.id,t)},onEditLabelClicked(t,e){this.$emit("edit-label",t,e,this.entity.id)},removeOneAsset(t,e){this.$emit("remove-one",t,this.entity.id,e)},addOneAsset(t,e){this.$emit("add-one",t,this.entity.id,e)},onDescriptionChanged(t,e){this.$emit("description-changed",t,e.target.value)},onStandbyChanged(t,e){this.$emit("standby-changed",t,e.target.checked)},renderMarkdown:S,nbAssetsForType(t){return this.assetsByAssetTypesMap[t].reduce((e,s)=>e+s.nb_occurences,0)}}};var ae=function(){var e=this,s=e._self._c;return s("div",{class:{shot:!0,selected:e.selected,unselectable:!0,stdby:e.entity?e.entity.is_casting_standby:!1,"text-mode":e.textMode},attrs:{id:e.entity.id},on:{click:function(i){return e.onClicked(i)}}},[s("div",{staticClass:"flexrow-item sticky",style:{"max-width":e.columnWidth.name?e.columnWidth.name+"px":"250px"}},[e.isSaveError?s("p",{staticClass:"error has-text-left info-message"},[e._v(" "+e._s(e.$t("breakdown.save_error"))+" ")]):e._e(),s("div",{staticClass:"flexrow"},[s("entity-thumbnail",{staticClass:"flexrow-item mr1",attrs:{entity:{},height:e.bigMode?100:60,width:e.bigMode?150:90,"empty-height":e.bigMode?100:60,"empty-width":e.bigMode?150:90,"preview-file-id":e.previewFileId}}),s("div",{staticClass:"shot-name flexrow-item ml05"},e._l(e.chunks,function(i,a){return s("div",{key:`chunk-${a}`},[e._v(" "+e._s(i)+" ")])}),0)],1)]),e.isShowInfosBreakdown?s("div",{staticClass:"standby-column flexrow-item"},[s("input",{style:[e.isCurrentUserManager?{cursor:"pointer"}:{cursor:"auto"}],attrs:{type:"checkbox",disabled:!e.isCurrentUserManager},domProps:{checked:e.entity?e.entity.is_casting_standby:!1},on:{input:i=>e.onStandbyChanged(e.entity,i)}})]):e._e(),e.isShowInfosBreakdown&&e.isDescription?s("div",{staticClass:"description-column flexrow-item"},[e.readOnly?s("div",{staticClass:"tooltip-text",domProps:{innerHTML:e._s(e.renderMarkdown(e.entity.description))}}):s("textarea",{ref:"text",staticClass:"tooltip-editor",domProps:{value:e.entity.description},on:{input:i=>e.onDescriptionChanged(e.entity,i)}})]):e._e(),e.isFrames&&e.isShowInfosBreakdown&&e.metadataDisplayHeaders.frames?s("div",{staticClass:"frames-column flexrow-item"},[e.isCurrentUserManager?s("input",{staticClass:"input-editor",attrs:{step:"1",type:"number",min:"0"},domProps:{value:e.entity.nb_frames},on:{input:i=>e.onNbFramesChanged(e.entity,i.target.value)}}):s("span",{staticClass:"metadata-value selectable"},[e._v(" "+e._s(e.entity.nb_frames)+" ")])]):e._e(),e.isFrameIn&&e.isShowInfosBreakdown&&e.metadataDisplayHeaders.frameIn?s("div",{staticClass:"frames-column flexrow-item"},[e.isCurrentUserManager?s("input",{staticClass:"input-editor",attrs:{step:"1",type:"number",min:"0"},domProps:{value:e.getMetadataFieldValue({field_name:"frame_in"},e.entity)},on:{input:i=>e.onMetadataFieldChanged(e.entity,{field_name:"frame_in",data_type:"number"},i)}}):s("span",{staticClass:"metadata-value selectable"},[e._v(" "+e._s(e.getMetadataFieldValue({field_name:"frame_in"},e.entity))+" ")])]):e._e(),e.isFrameOut&&e.isShowInfosBreakdown&&e.metadataDisplayHeaders.frameOut?s("div",{staticClass:"frames-column flexrow-item"},[e.isCurrentUserManager?s("input",{staticClass:"input-editor",attrs:{step:"1",type:"number",min:"0"},domProps:{value:e.getMetadataFieldValue({field_name:"frame_out"},e.entity)},on:{input:i=>e.onMetadataFieldChanged(e.entity,{field_name:"frame_out",data_type:"number"},i)}}):s("span",{staticClass:"metadata-value selectable"},[e._v(" "+e._s(e.getMetadataFieldValue({field_name:"frame_out"},e.entity))+" ")])]):e._e(),e._l(e.visibleMetadataDescriptors,function(i){return e.isShowInfosBreakdown?s("div",{key:"desc"+e.entity.id+"-"+i.id,staticClass:"metadata-descriptor flexrow-item",style:{"min-width":e.columnWidth[i.id]?e.columnWidth[i.id]+"px":"110px","max-width":e.columnWidth[i.id]?e.columnWidth[i.id]+"px":"110px"},attrs:{title:e.entity.data?e.entity.data[i.field_name]:""}},[i.choices.length===0&&(e.isCurrentUserManager||e.isSupervisorInDepartments(i.departments))?s("input",{staticClass:"input-editor",domProps:{value:e.getMetadataFieldValue(i,e.entity)},on:{input:a=>e.onMetadataFieldChanged(e.entity,i,a)}}):i.choices.length>0&&e.getDescriptorChecklistValues(i).length>0?s("div",{staticClass:"metadata-value selectable"},e._l(e.getDescriptorChecklistValues(i),function(a,n){return s("p",{key:`${e.entity.id}-${i.id}-${n}-${a.text}-div`},[s("input",{style:[e.isCurrentUserManager||e.isSupervisorInDepartments(i.departments)?{cursor:"pointer"}:{cursor:"auto"}],attrs:{type:"checkbox",id:`${e.entity.id}-${i.id}-${n}-${a.text}-input`,disabled:!(e.isCurrentUserManager||e.isSupervisorInDepartments(i.departments))},domProps:{checked:e.getMetadataChecklistValues(i,e.entity)[a.text]},on:{change:r=>e.onMetadataChecklistChanged(e.entity,i,a.text,r)}}),s("label",{style:[e.isCurrentUserManager||e.isSupervisorInDepartments(i.departments)?{cursor:"pointer"}:{cursor:"auto"}],attrs:{for:`${e.entity.id}-${i.id}-${n}-${a.text}-input`}},[e._v(" "+e._s(a.text)+" ")])])}),0):e.isCurrentUserManager||e.isSupervisorInDepartments(i.departments)?s("span",{staticClass:"select"},[s("select",{staticClass:"select-input",on:{change:a=>e.onMetadataFieldChanged(e.entity,i,a)}},e._l(e.getDescriptorChoicesOptions(i),function(a,n){return s("option",{key:`desc-value-${e.entity.id}-${i.id}-${n}-${a.label}-${a.value}`,domProps:{value:a.value,selected:e.getMetadataFieldValue(i,e.entity)===a.value}},[e._v(" "+e._s(a.label)+" ")])}),0)]):s("span",{staticClass:"metadata-value selectable"},[e._v(" "+e._s(e.getMetadataFieldValue(i,e.entity))+" ")])]):e._e()}),e._l(e.assetTypes,function(i){return s("div",{key:e.entity.id+"-"+i,staticClass:"asset-list flexrow-item"},[e.assetsByAssetTypesMap[i]!==void 0?s("div",{staticClass:"asset-type-line flexcolumn"},[s("div",{staticClass:"flexrow-item mb05"},[e._v(" "+e._s(e.nbAssetsForType(i))+" "+e._s(e.$tc("assets.number",e.nbAssetsForType(i)))+" ")]),s("div",{staticClass:"asset-type-items flexrow-item"},e._l(e.assetsByAssetTypesMap[i],function(a){return s("asset-block",{key:a.id,staticClass:"flexrow-item",attrs:{asset:a,active:e.selected,"nb-occurences":a.nb_occurences,"read-only":e.readOnly,"text-mode":e.textMode,"big-mode":e.bigMode},on:{"edit-label":e.onEditLabelClicked,"remove-one":e.removeOneAsset,"add-one":e.addOneAsset}})}),1),s("div",{staticClass:"actions filler"})]):s("div",{staticClass:"asset-type-line flexrow empty mt05 mb05"},[e._v(" "+e._s(e.$t("breakdown.empty"))+" ")])])})],2)},ne=[],re=c(ie,ae,ne,!1,null,"0e76d5fc");const oe=re.exports,le={name:"breakdown",mixins:[y,E],components:{AvailableAssetBlock:U,BuildFilterModal:x,ButtonHrefLink:H,ButtonSimple:$,ComboboxStyled:T,DeleteModal:I,DepartmentName:M,EditAssetModal:A,EditLabelModal:X,ImportModal:D,ImportRenderModal:O,SearchField:F,SearchQueryList:L,ShotLine:oe,ShowInfosButton:B,Spinner:q,TableMetadataSelectorMenu:R},data(){return{assetTypeId:"",castingType:"shot",columnSelectorDisplayed:!1,editedAsset:null,editedEntityId:null,editedAssetLinkLabel:null,episodeId:"",importCsvFormData:{},isBigMode:!1,isLocked:!1,isLoading:!1,isOnlyCurrentEpisode:!1,isTextMode:!1,libraryDisplayed:!1,optionalCsvColumns:["Label"],parsedCSV:[],removalData:{},saveErrors:{},selection:{},sequenceId:"all",errors:{edit:!1,editLabel:!1,importing:!1,importingError:null,remove:!1,stay:!1},loading:{edit:!1,editLabel:!1,importing:!1,remove:!1,stay:!1},metadataDisplayHeaders:{stdby:!0,fps:!1,frameIn:!0,frameOut:!0,frames:!0,estimation:!1,maxRetakes:!1,resolution:!1,timeSpent:!1},modals:{isBuildFilterDisplayed:!1,isEditLabelDisplayed:!1,isNewDisplayed:!1,isImportRenderDisplayed:!1,isRemoveConfirmationDisplayed:!1,importing:!1},success:{edit:!1},columnWidth:{}}},mounted(){this.isLoading||this.reset(),this.resetSequenceOption(),this.setLastProductionScreen("breakdown"),this.isTextMode=d.getBoolPreference("breakdown:text-mode"),window.addEventListener("keydown",this.onKeyDown,!1),this.resetDisplayHeaders(),this.resetColumnWidth()},beforeDestroy(){window.removeEventListener("keydown",this.onKeyDown)},computed:{...g(["assetMap","assetMetadataDescriptors","assetTypeMap","assetsByType","breakdownSearchQueries","breakdownSearchFilterGroups","casting","castingAssetTypeAssets","castingAssetTypesOptions","castingByType","castingCurrentShot","castingEpisodes","castingSequenceShots","castingSequencesOptions","currentEpisode","currentProduction","departmentMap","displayedSequences","displayedShots","episodeMap","episodes","isAssetsLoading","isCurrentUserManager","isFrameIn","isFrameOut","isFrames","isShotsLoading","isShowInfosBreakdown","isTVShow","sequenceMap","shotMap","shotMetadataDescriptors"]),searchField(){return this.$refs["search-field"]},castingTypeOptions(){const t=this.currentProduction.production_type==="assets",e=this.currentProduction.production_type==="shots",s=[];return e||s.push({label:this.$t("assets.title"),value:"asset"}),!t&&(!this.isTVShow||this.currentEpisode&&this.currentEpisode.id!=="main")&&s.unshift({label:this.$t("shots.title"),value:"shot"}),s},availableAssetsByType(){const t=[];return this.assetsByType.forEach(e=>{let s=e.filter(i=>!i.canceled);this.isTVShow&&this.isOnlyCurrentEpisode&&(s=e.filter(i=>{var a;return i.episode_id===this.currentEpisode.id||((a=i.casting_episode_ids)==null?void 0:a.includes(this.currentEpisode.id))})),s.length>0&&t.push(s)}),t},exportUrlPath(){let t=`/api/export/csv/projects/${this.currentProduction.id}/casting.csv`,e=!1;return this.currentEpisode&&(t+=`?episode_id=${this.currentEpisode.id}`,e=!0),this.isShotCasting&&(t+=`${e?"&":"?"}is_shot_casting=${this.isShotCasting}`),t},isEpisodeCasting(){return this.currentEpisode&&this.currentEpisode.id==="all"},isAssetCasting(){return!this.isEpisodeCasting&&this.castingType==="asset"},isShotCasting(){return!this.isEpisodeCasting&&this.castingType==="shot"},castingEntities(){return this.isEpisodeCasting?this.castingEpisodes:this.isShotCasting?this.castingSequenceShots:this.isTVShow&&this.currentEpisode.id!=="main"?this.castingAssetTypeAssets.filter(t=>{var e;return t.episode_id===this.currentEpisode.id||((e=t.casting_episode_ids)==null?void 0:e.includes(this.currentEpisode.id))}):this.isTVShow&&this.currentEpisode.id==="main"?this.castingAssetTypeAssets.filter(t=>!t.episode_id):this.castingAssetTypeAssets},castingAssetTypes(){const t=[],e={};return this.castingEntities.forEach(s=>{this.castingByType[s.id]&&this.castingByType[s.id].forEach(i=>{i[0]&&!e[i[0].asset_type_name]&&(e[i[0].asset_type_name]=!0,t.push(i[0].asset_type_name))})}),t.sort()},editLabelModal(){return this.$refs["edit-label-modal"]},filteredCasting(){const t={};return this.castingEntities.forEach(e=>{this.castingByType[e.id]&&this.castingByType[e.id].forEach(s=>{s.forEach(i=>{const a=`${i.asset_name}${i.asset_type_name}${i.name}`;t[a]=!0})})}),t},isDescription(){return this.castingEntities.some(t=>t.description&&t.description.length>0)},csvColumns(){var t;return this.isTVShow&&((t=this.currentEpisode)==null?void 0:t.id)!=="all"?["Episode","Parent","Name","Asset Type","Asset","Occurences"]:["Parent","Name","Asset Type","Asset","Occurences"]},renderColumns(){return[...this.csvColumns,...this.optionalCsvColumns]},dataMatchers(){return this.isTVShow?["Episode","Name","Asset Type","Asset"]:["Name","Asset Type","Asset"]},metadataDescriptors(){return this.isEpisodeCasting?[]:this.isShotCasting?this.shotMetadataDescriptors:this.assetMetadataDescriptors}},methods:{...P(["addAssetToCasting","editEpisode","editShot","editAsset","displayMoreAssets","loadEpisodeCasting","loadEpisodes","loadAssetCasting","loadAssets","loadShotCasting","loadShots","newAsset","removeAssetFromCasting","removeBreakdownSearch","saveBreakdownSearch","loadSequences","saveBreakdownSearchFilterGroup","saveCasting","setAssetLinkLabel","setAssetSearch","setCastingEpisodes","setCastingAssetType","setCastingAssetTypes","setCastingEpisode","setCastingForProductionEpisodes","setCastingSequence","setCurrentEpisode","setEntityCasting","setLastProductionScreen","uploadCastingFile"]),reset(){if(!this.isTVShow){const t={...this.$route};t&&t.params&&t.params.episode_id&&(t.name="breakdown",t.params.episode_id=null,this.$router.push(t))}this.isLoading=!0,setTimeout(()=>{this.reloadEntities()},100)},async reloadEntities(){this.isLoading=!0,await this.loadSequences(),await this.loadShots(),this.isTVShow?(this.currentEpisode&&(this.episodeId=this.currentEpisode.id),this.setCastingEpisode(this.episodeId),this.setCastingForProductionEpisodes()):this.setCastingEpisode(null),this.loadAssets({all:!0,withTasks:!1}).then(()=>{this.isLoading=!1,this.displayMoreAssets(),this.setCastingAssetTypes(),this.assetTypeId?this.setCastingAssetType(this.assetTypeId):this.setCastingSequence(this.sequenceId||"all"),this.resetSequenceOption(),this.resetSelection(),(this.currentEpisode&&this.currentEpisode.id==="main"||this.currentProduction.production_type==="assets")&&(this.castingType="asset")})},resetSequenceOption(){this.currentProduction.production_style==="nft"&&(this.sequenceId=this.castingSequencesOptions[1].value)},resetSelection(){const t={};this.isEpisodeCasting?this.castingEpisodes.forEach(e=>{t[e.id]=!1}):this.isShotCasting?this.castingSequenceShots.forEach(e=>{t[e.id]=!1}):this.castingAssetTypeAssets.forEach(e=>{t[e.id]=!1}),this.selection=t},confirmBuildFilter(t){this.modals.isBuildFilterDisplayed=!1,this.$refs["search-field"].setValue(t),this.onSearchChange(t)},onSearchChange(t){this.setAssetSearch(t),this.displayMoreAssets(),this.displayMoreAssets()},selectEntity(t,e){const s={...this.selection};!(e.ctrlKey||e.metaKey)&&!e.shitKey&&this.clearSelection(),this.previousEntityId&&e.shiftKey&&this.selectRange(this.previousEntityId,t),(!this.previousEntityId||!e.shiftKey)&&(this.previousEntityId=t);const i=Object.keys(s).filter(a=>s[a]).length;!s[t]||i>1&&!(e.ctrlKey||e.metaKey)?this.selection[t]=!0:s[t]&&(e.ctrlKey||e.metaKey)&&(this.selection[t]=!1)},clearSelection(){Object.keys(this.selection).filter(t=>this.selection[t]).forEach(t=>{this.selection[t]=!1})},selectRange(t,e){const s=Object.keys(this.selection),i=s.findIndex(r=>r===t),a=s.findIndex(r=>r===e);let n=[];i<a?n=m(i,a):n=m(a,i),n.forEach(r=>{r>=0&&(this.selection[s[r]]=!0)})},setLock(){this.$options.lockTimeout||(this.$options.lockTimeout=setTimeout(()=>{this.isLocked=!1},3e3))},async addOneAsset(t,e=1){this.isLocked=!0;const s=Object.keys(this.selection).filter(i=>this.selection[i]);for(const i of s){this.addAssetToCasting({entityId:i,assetId:t,nbOccurences:e,label:this.castingType==="shot"?"animate":"fixed"}),delete this.saveErrors[i];try{await this.saveCasting(i),this.setLock()}catch(a){this.saveErrors[i]=!0,console.error(a)}}},async addTenAssets(t){this.addOneAsset(t,10)},confirmAssetRemoval(){this.saveAssetRemoval(this.removalData.entityId,this.removalData.assetId,this.removalData.nbOccurences)},saveAssetRemoval(t,e,s){return this.loading.remove=!0,this.removeAssetFromCasting({entityId:t,assetId:e,nbOccurences:s}),delete this.saveErrors[t],this.saveCasting(t).then(()=>{this.setLock(),this.modals.isRemoveConfirmationDisplayed=!1}).catch(i=>{this.saveErrors[t]=!0,this.errors.remove=!0,console.error(i)}).finally(()=>{this.loading.remove=!1})},async removeOneAssetFromSelection(t){const e=Object.keys(this.selection).filter(s=>this.selection[s]);for(const s of e){const i=this.casting[s].find(a=>a.asset_id===t).nb_occurences;await this.removeOneAsset(t,s,i)}},removeOneAsset(t,e,s){return this.isLocked=!0,this.isEpisodeCasting&&s===1?(this.removalData={assetId:t,entityId:e,nbOccurences:s},this.modals.isRemoveConfirmationDisplayed=!0,Promise.resolve()):this.saveAssetRemoval(e,t,1)},onAssetListScroll(t,e){const s=this.$refs["asset-list"];s.scrollHeight-s.offsetHeight<e.scrollTop+100&&this.displayMoreAssets()},showImportModal(){this.modals.importing=!0},hideImportModal(){this.modals.importing=!1},showImportRenderModal(){this.modals.isImportRenderDisplayed=!0},hideImportRenderModal(){this.modals.isImportRenderDisplayed=!1},renderImport(t,e){this.loading.importing=!0,this.errors.importing=!1,e==="file"&&(t=t.get("file")),p.processCSV(t).then(s=>{this.parsedCSV=s,this.hideImportModal(),this.loading.importing=!1,this.showImportRenderModal()})},uploadImportFile(t){const e=new FormData,s="import.csv",i=p.turnEntriesToCsvString(t),a=new File([i],s,{type:"text/csv"});e.append("file",a),this.loading.importing=!0,this.errors.importing=!1,this.errors.importingError=null,this.importCsvFormData=e,this.uploadCastingFile(this.importCsvFormData).then(()=>{this.hideImportRenderModal(),this.sequenceId&&this.setCastingSequence(this.sequenceId||"all")}).catch(n=>{this.errors.importingError=n,this.errors.importing=!0}).finally(()=>{this.loading.importing=!1})},resetImport(){this.errors.importing=!1,this.errors.importingError=null,this.hideImportRenderModal(),this.importCsvFormData=void 0,this.$refs["import-modal"].reset(),this.showImportModal()},updateUrl(){let t=!1,e={};if(this.isEpisodeCasting?this.$route.params.episode_id!==this.episodeId&&(t=!0,e={name:"breakdown-episode",params:{production_id:this.currentProduction.id,episode_id:this.episodeId}}):this.isAssetCasting?this.$route.params.asset_type_id!==this.assetTypeId&&(t=!0,e={name:"breakdown-asset-type",params:{production_id:this.currentProduction.id,asset_type_id:this.assetTypeId}}):(this.$route.params.sequence_id||"all")!==this.sequenceId&&(t=!0,e={name:"breakdown-sequence",params:{production_id:this.currentProduction.id,sequence_id:this.sequenceId||"all"}}),t){let s=this.$route.params.episode_id;!s&&this.currentEpisode&&(s=this.currentEpisode.id),s&&(e.name=`episode-${e.name}`,e.params.episode_id=s,s==="all"&&(e.params.sequence_id="all")),this.$router.push(e)}},onEditLabelClicked(t,e,s){this.editedAsset=t,this.editedEntityId=s,this.editedAssetLinkLabel=e,this.modals.isEditLabelDisplayed=!0},confirmEditLabel(t={}){const e=t.label;this.loading.editLabel=!0,this.setAssetLinkLabel({label:e,asset:this.editedAsset,targetEntityId:this.editedEntityId}).then(()=>{this.modals.isEditLabelDisplayed=!1,this.loading.editLabel=!1}).catch(s=>{console.error(s),this.errors.editLabel=!0,this.loading.editLabel=!1})},toggleTextMode(){this.isTextMode=!this.isTextMode,localStorage.setItem("breakdown:text-mode",this.isTextMode)},toggleColumnSelector(){this.columnSelectorDisplayed=!this.columnSelectorDisplayed},confirmNewAssetStay(t){this.loading.stay=!0,this.success.edit=!1,this.newAsset(t).then(e=>{this.loading.stay=!1,this.loading.edit=!1,this.resetLightEditModal(e),this.$refs["edit-asset-modal"].focusName(),this.success.edit=!0}).catch(e=>{console.error(e),this.loading.stay=!1,this.loading.edit=!1,this.success.edit=!1,this.errors.edit=!0})},confirmNewAsset(t){this.loading.edit=!0,this.errors.edit=!1,this.newAsset(t).then(()=>{this.loading.edit=!1,this.modals.isNewDisplayed=!1}).catch(e=>{console.error(e),this.loading.edit=!1,this.errors.edit=!0})},resetLightEditModal(t){const e={name:"",entity_type_id:t.entit_type_id,production_id:this.currentProduction.id};this.assetToEdit=e},onKeyDown(t){["INPUT","TEXTAREA"].includes(t.target.tagName)||((t.ctrlKey||t.metaKey)&&t.keyCode===67?this.copyCasting():(t.ctrlKey||t.metaKey)&&t.keyCode===86&&this.pasteCasting())},copyCasting(){const t=Object.keys(this.selection).find(s=>this.selection[s]),e=this.casting[t];u.copyCasting(e)},async pasteCasting(){const t=u.pasteCasting();if(!t||t.length===0)return;const e=Object.keys(this.selection).filter(s=>this.selection[s]);for(const s of e)this.setEntityCasting({entityId:s,casting:t}),delete this.saveErrors[s],await this.saveCasting(s).then(this.setLock).catch(i=>{this.saveErrors[s]=!0,console.error(i)});return t},onMetadataChanged({entry:t,descriptor:e,value:s}){const i={};i[e.field_name]=s;const a={id:t.id,data:i};this.isEpisodeCasting?this.editEpisode(a):this.isShotCasting?this.editShot(a):this.editAsset(a)},onDescriptionChanged(t,e){const s={id:t.id,description:e};this.isEpisodeCasting?this.editEpisode(s):this.isShotCasting?this.editShot(s):this.editAsset(s)},onStandbyChanged(t,e){const s={id:t.id,is_casting_standby:e};this.isEpisodeCasting?this.editEpisode(s):this.isShotCasting?this.editShot(s):this.editAsset(s)},descriptorCurrentDepartments(t){return(t.departments||[]).map(s=>this.departmentMap.get(s))},getEntityName(t){return this.sequenceId==="all"&&(!this.isTVShow||this.isTVShow&&this.currentEpisode.id!=="all")?t.sequence_name+" / "+t.name:t.name},getCsvFileName(){const t=[N().format("YYYY-MM-DD"),"kitsu",this.castingType+"s",this.currentProduction.name,this.$t("breakdown.title")];return this.isTVShow?this.currentEpisode&&(this.currentEpisode.id==="all"?t.splice(4,0,"all"):this.currentEpisode.id==="main"?(t.splice(4,0,"main pack"),this.assetTypeId!=="all"&&this.castingType==="asset"&&t.splice(5,0,this.assetTypeMap.get(this.assetTypeId).name)):(t.splice(4,0,this.currentEpisode.name),this.sequenceId!=="all"&&this.castingType==="shot"&&t.splice(5,0,this.sequenceMap.get(this.sequenceId).name),this.assetTypeId!=="all"&&this.castingType==="asset"&&t.splice(5,0,this.assetTypeMap.get(this.assetTypeId).name))):(this.sequenceId!=="all"&&this.castingType==="shot"&&t.splice(5,0,this.sequenceMap.get(this.sequenceId).name),this.assetTypeId!=="all"&&this.castingType==="asset"&&t.splice(5,0,this.assetTypeMap.get(this.assetTypeId).name)),f.slugify(t.join("_"))},getCsvFileHeaders(){const t=[this.$t("shots.fields.name"),this.$t("breakdown.fields.standby")];return this.isFrames&&t.push(this.$t("main.frames")),this.isFrameIn&&t.push(this.$t("main.frame_in")),this.isFrameOut&&t.push(this.$t("main.frame_out")),this.metadataDescriptors.forEach(e=>{t.push(e.name)}),t.concat(this.castingAssetTypes)},getCsvEntries(){return this.castingEntities.map(e=>{const s=[e.name,e.is_casting_standby?"X":""];this.isFrames&&s.push(e.nb_frames),this.isFrameIn&&s.push(e.data.frame_in),this.isFrameOut&&s.push(e.data.frame_out),this.metadataDescriptors.forEach(n=>{s.push(e.data[n.field_name]||"")});const i=this.castingByType[e.id]||[],a={};return i.forEach(n=>{a[n[0].asset_type_name]=n}),this.castingAssetTypes.forEach(n=>{const r=a[n]||[],o=r.reduce((l,h)=>l+h.nb_occurences,0);if(o>0){let l=o+" assets: ";l+=r.map(h=>h.asset_name+" ("+h.nb_occurences+")").join(", "),s.push(l)}else s.push("")}),s})},exportViewToCsv(){const t=this.getCsvEntries(),e=this.getCsvFileName(),s=this.getCsvFileHeaders();p.buildCsvFile(e,[s].concat(t))},removeSearchQuery(t){this.removeBreakdownSearch(t).catch(console.error)},saveSearchQuery(t){this.loading.savingSearch||(this.loading.savingSearch=!0,this.saveBreakdownSearch(t).catch(console.error).finally(()=>{this.loading.savingSearch=!1}))},initResize(t,e,s){this.resizedKnobRefName=t+(s||""),this.resizedRefName=e+(s||""),this.resizedDescriptorId=s,window.addEventListener("mousemove",this.startResizing),window.addEventListener("mouseup",this.stopResizing)},startResizing(t){const e=this.resizedKnobRefName,s=this.resizedRefName,i=this.$refs[e][0]?this.$refs[e][0]:this.$refs[e],a=this.$refs[s][0]?this.$refs[s][0]:this.$refs[s],n=t.clientX-i.getBoundingClientRect().left,r=a.getBoundingClientRect().width;if(this.columnWidth={...this.columnWidth},this.resizedDescriptorId){const o=Math.max(r+n,110);this.columnWidth[this.resizedDescriptorId]=o;const l=`breakdown:column-width-descriptor-${this.resizedDescriptorId}`;d.setPreference(l,o)}else{const o=Math.max(r+n,160);this.columnWidth.name=o;const l=`breakdown:column-width-name-${this.castingType}-${this.currentProduction.id}`;d.setPreference(l,o)}},stopResizing(){window.removeEventListener("mousemove",this.startResizing),window.removeEventListener("mouseup",this.stopResizing),this.resizedKnobRefName=null,this.resizedRefName=null,this.resizedDescriptorId=null},resetDisplayHeaders(){this.isEpisodeCasting?this.metadataDisplayHeaders={}:this.isShotCasting?this.metadataDisplayHeaders={stdby:!0,fps:!1,frameIn:!0,frameOut:!0,frames:!0,estimation:!1,maxRetakes:!1,resolution:!1,timeSpent:!1}:this.metadataDisplayHeaders={estimation:!1,readyFor:!1,timeSpent:!1}},resetColumnWidth(){const t=`breakdown:column-width-name-${this.castingType}-${this.currentProduction.id}`,e=d.getPreference(t);e&&(this.columnWidth.name=e),this.metadataDescriptors.forEach(s=>{const i=d.getPreference(`breakdown:column-width-descriptor-${s.id}`);i&&(this.columnWidth[s.id]=i)})},onCastingHeaderScroll(t,e){this.$refs["casting-list"].scrollLeft=e.scrollLeft},onCastingScroll(t,e){this.$refs["casting-header"].scrollLeft=e.scrollLeft}},watch:{castingType(){if(this.isShotCasting&&this.displayedSequences.length>0&&(this.sequenceId=this.displayedSequences[0].id,this.assetTypeId=""),this.isAssetCasting&&this.castingAssetTypesOptions.length>0){const t=this.$route.params.asset_type_id;this.sequenceId="all",this.castingType="asset",t?this.assetTypeId=t:this.castingAssetTypesOptions.length>0&&(this.assetTypeId=this.castingAssetTypesOptions[0].value)}this.resetDisplayHeaders(),this.resetColumnWidth()},sequenceId(){this.sequenceId&&this.displayedSequences&&this.displayedSequences.length>0&&!this.isAssetCasting&&(this.setCastingSequence(this.sequenceId),this.updateUrl(),this.resetSelection())},assetTypeId(){this.assetTypeId&&this.castingAssetTypesOptions.length>0&&(this.setCastingAssetType(this.assetTypeId),this.updateUrl(),this.resetSelection())},episodeId(){this.episodeId&&this.episodes&&this.episodes.length>0&&(this.episodeId==="all"&&this.setCastingForProductionEpisodes(this.episodeId),this.resetSelection())},castingSequencesOptions(){if(this.$route.path.indexOf("asset-type")<0){const t=this.$route.params.sequence_id||"all";t&&this.sequenceMap.get(t)?this.sequenceId=t:this.castingSequencesOptions.length>0?this.sequenceId=this.castingSequencesOptions[0].value:this.sequenceId="all"}},castingAssetTypesOptions(){if(this.$route.path.indexOf("asset-type")>0){const t=this.$route.params.asset_type_id;this.castingType="asset",t?this.assetTypeId=t:this.castingAssetTypesOptions.length>0?this.assetTypeId=this.castingAssetTypesOptions[0].value:this.assetTypeId=""}},currentProduction(){this.isLoading||(this.reset(),this.resetColumnWidth())},currentEpisode(){this.currentEpisode&&this.episodeId!==this.currentEpisode.id&&!this.isLoading&&(this.currentEpisode.id==="all"?this.episodeId="all":this.reset())},displayedSequences(){this.$store.commit("CASTING_SET_SEQUENCES",this.displayedSequences)}},socket:{events:{"episode:casting-update"(t){const e=this.episodeMap.get(t.episode_id);e&&!this.isLocked&&this.loadEpisodeCasting(e)},"shot:casting-update"(t){const e=this.shotMap.get(t.shot_id);e&&e.sequence_id===this.sequenceId&&!this.isLocked&&this.loadShotCasting(e)},"asset:casting-update"(t){const e=this.assetMap.get(t.asset_id);e&&e.asset_type_id===this.assetTypeId&&!this.isLocked&&this.loadAssetCasting(e)}}},metaInfo(){const t=this.$t("breakdown.title");return{title:`${this.currentProduction.name} ${t} - Kitsu`}}};var de=function(){var e=this,s=e._self._c;return s("div",{staticClass:"breakdown page"},[s("div",{staticClass:"breakdown-columns"},[s("div",{staticClass:"breakdown-column casting-column"},[s("div",{staticClass:"flexrow mb1"},[e.isEpisodeCasting?s("div",[s("h2",{staticClass:"subtitle mt05"},[e._v(" "+e._s(e.$t("breakdown.episode_casting"))+" ")])]):e._e(),e.isEpisodeCasting?e._e():s("combobox-styled",{staticClass:"mr1",attrs:{label:e.$t("main.for"),options:e.castingTypeOptions},model:{value:e.castingType,callback:function(i){e.castingType=i},expression:"castingType"}}),e.isShotCasting?s("combobox-styled",{attrs:{label:e.$t("shots.fields.sequence"),options:e.castingSequencesOptions},model:{value:e.sequenceId,callback:function(i){e.sequenceId=i},expression:"sequenceId"}}):e._e(),e.isAssetCasting?s("combobox-styled",{attrs:{label:e.$t("tasks.fields.asset_type"),options:e.castingAssetTypesOptions},model:{value:e.assetTypeId,callback:function(i){e.assetTypeId=i},expression:"assetTypeId"}}):e._e(),s("span",{staticClass:"filler"}),s("show-infos-button",{staticClass:"flexrow-item",attrs:{"is-breakdown":!0}}),s("button-simple",{staticClass:"flexrow-item",attrs:{title:e.isTextMode?e.$t("breakdown.picture_mode"):e.$t("breakdown.text_mode"),icon:"type","is-on":e.isTextMode,"is-responsive":!0},on:{click:e.toggleTextMode}}),s("button-simple",{staticClass:"flexrow-item",attrs:{icon:"big-thumbnail","is-on":e.isBigMode,title:e.$t("tasks.big_thumbnails")},on:{click:function(i){e.isBigMode=!e.isBigMode}}}),e.isCurrentUserManager?s("button-simple",{staticClass:"flexrow-item",attrs:{title:e.$t("main.csv.import_file"),icon:"import","is-responsive":!0},on:{click:e.showImportModal}}):e._e(),s("button-simple",{staticClass:"flexrow-item",attrs:{icon:"export","is-responsive":!0,title:e.$t("main.csv.export_current_view")},on:{click:e.exportViewToCsv}}),e.isCurrentUserManager?s("button-href-link",{staticClass:"flexrow-item",attrs:{title:e.$t("main.csv.export_file"),icon:"export-lines","is-responsive":!0,path:e.exportUrlPath}}):e._e()],1),e.isLoading?s("spinner",{staticClass:"mt1"}):e._e(),s("div",{staticClass:"flexrow mb05 list-options"},[e.isShowInfosBreakdown?s("table-metadata-selector-menu",{directives:[{name:"show",rawName:"v-show",value:e.columnSelectorDisplayed,expression:"columnSelectorDisplayed"}],ref:"headerMetadataSelectorMenu",attrs:{namespace:"breakdown",descriptors:e.metadataDescriptors,exclude:{fps:!0,estimation:!0,resolution:!0,maxRetakes:!0,timeSpent:!0},"metadata-display-headers":e.metadataDisplayHeaders},on:{"update:metadataDisplayHeaders":function(i){e.metadataDisplayHeaders=i},"update:metadata-display-headers":function(i){e.metadataDisplayHeaders=i}}}):e._e(),s("span",{staticClass:"filler"}),e.isShowInfosBreakdown?s("button-simple",{staticClass:"is-small mr05",attrs:{icon:"down"},on:{click:e.toggleColumnSelector}}):e._e()],1),e.isLoading?e._e():s("div",{directives:[{name:"scroll",rawName:"v-scroll",value:e.onCastingHeaderScroll,expression:"onCastingHeaderScroll"}],ref:"casting-header",staticClass:"casting-header flexrow"},[s("div",{ref:"name-header",staticClass:"entity-header",style:{"min-width":e.columnWidth.name?e.columnWidth.name+"px":"250px"}},[s("div",[e._v(" "+e._s(e.$t("shots.fields.name"))+" ")]),s("div",{staticClass:"filler"}),s("div",{ref:"resizable-knob-name",staticClass:"resizable-knob",on:{mousedown:function(i){return i.preventDefault(),e.initResize("resizable-knob-name","name-header")}}})]),e.isShowInfosBreakdown?s("div",{staticClass:"standby-header"},[e._v(" "+e._s(e.$t("breakdown.fields.standby"))+" ")]):e._e(),e.isShowInfosBreakdown&&e.isDescription?s("div",{staticClass:"description-header"},[e._v(" "+e._s(e.$t("shots.fields.description"))+" ")]):e._e(),e.isShotCasting&&e.isFrames&&e.isShowInfosBreakdown&&e.metadataDisplayHeaders.frames?s("div",{staticClass:"frames-header"},[e._v(" "+e._s(e.$t("shots.fields.nb_frames"))+" ")]):e._e(),e.isShotCasting&&e.isFrameIn&&e.isShowInfosBreakdown&&e.metadataDisplayHeaders.frameIn?s("div",{staticClass:"frames-header"},[e._v(" "+e._s(e.$t("shots.fields.frame_in"))+" ")]):e._e(),e.isShotCasting&&e.isFrameOut&&e.isShowInfosBreakdown&&e.metadataDisplayHeaders.frameOut?s("div",{staticClass:"frames-header"},[e._v(" "+e._s(e.$t("shots.fields.frame_out"))+" ")]):e._e(),e._l(e.visibleMetadataDescriptors,function(i){return s("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowInfosBreakdown,expression:"isShowInfosBreakdown"}],key:"descriptor-header-"+i.id,ref:"descriptor-header-"+i.id,refInFor:!0,staticClass:"descriptor-header",style:{"min-width":e.columnWidth[i.id]?e.columnWidth[i.id]+"px":"110px"}},[e.descriptorCurrentDepartments(i).length?s("div",{staticClass:"mr1"},e._l(e.descriptorCurrentDepartments(i),function(a){return s("department-name",{key:a.id,attrs:{department:a,"no-padding":"","only-dot":""}})}),1):e._e(),s("span",{staticClass:"flexrow-item ellipsis descriptor-name filler",attrs:{title:i.name}},[e._v(" "+e._s(i.name)+" ")]),s("div",{ref:"resizable-knob-descriptor-"+i.id,refInFor:!0,staticClass:"resizable-knob",on:{mousedown:function(a){return a.preventDefault(),e.initResize("resizable-knob-descriptor-","descriptor-header-",i.id)}}})])}),e._l(e.castingAssetTypes,function(i){return s("div",{key:i,staticClass:"asset-type-header"},[e._v(" "+e._s(i)+" ")])}),s("div",{staticClass:"actions filler"})],2),e.isLoading?e._e():s("div",{directives:[{name:"scroll",rawName:"v-scroll",value:e.onCastingScroll,expression:"onCastingScroll"}],ref:"casting-list",staticClass:"casting-list"},[s("div",{staticClass:"shot-lines"},e._l(e.castingEntities,function(i){return s("shot-line",{key:i.id,attrs:{entity:i,"preview-file-id":i.preview_file_id,selected:e.selection[i.id],name:e.getEntityName(i),assets:e.castingByType[i.id]||[],"asset-types":e.castingAssetTypes,"read-only":!e.isCurrentUserManager,"text-mode":e.isTextMode,"metadata-descriptors":e.metadataDescriptors,"metadata-display-headers":e.metadataDisplayHeaders,"big-mode":e.isBigMode,"is-description":e.isDescription,"is-save-error":e.saveErrors[i.id],"column-width":e.columnWidth},on:{"add-one":e.addOneAsset,click:e.selectEntity,"description-changed":e.onDescriptionChanged,"edit-label":e.onEditLabelClicked,"metadata-changed":e.onMetadataChanged,"remove-one":e.removeOneAssetFromSelection,"standby-changed":e.onStandbyChanged}})}),1)])],1),e.isCurrentUserManager?s("div",{directives:[{name:"scroll",rawName:"v-scroll",value:e.onAssetListScroll,expression:"onAssetListScroll"}],ref:"asset-list",staticClass:"breakdown-column assets-column"},[s("h2",{staticClass:"subtitle"},[e._v(" "+e._s(e.$t("breakdown.all_assets"))+" ")]),s("div",{staticClass:"flexrow mt1 mb1"},[e.isOnlyCurrentEpisode?e._e():s("button-simple",{staticClass:"flexrow-item",attrs:{title:e.$t("assets.new_asset"),icon:"plus"},on:{click:function(i){e.modals.isNewDisplayed=!0}}}),s("span",{staticClass:"filler"}),e.isOnlyCurrentEpisode?e._e():s("button-simple",{staticClass:"flexrow-item",attrs:{text:e.$t("breakdown.show_library"),icon:"assets","is-on":e.libraryDisplayed},on:{click:function(i){e.libraryDisplayed=!e.libraryDisplayed}}}),e.isTVShow&&!e.isEpisodeCasting?s("button-simple",{staticClass:"flexrow-item",attrs:{text:e.$t("assets.only_current_episode"),"is-on":e.isOnlyCurrentEpisode},on:{click:function(i){e.isOnlyCurrentEpisode=!e.isOnlyCurrentEpisode}}}):e._e()],1),s("div",{staticClass:"filters-area flexrow"},[s("search-field",{ref:"search-field",staticClass:"flexrow-item",attrs:{"can-save":!0},on:{save:e.saveSearchQuery,change:e.onSearchChange}}),s("button-simple",{staticClass:"flexrow-item",attrs:{title:e.$t("entities.build_filter.title"),icon:"filter"},on:{click:function(i){e.modals.isBuildFilterDisplayed=!0}}})],1),s("div",{staticClass:"query-list"},[s("search-query-list",{attrs:{groups:e.breakdownSearchFilterGroups,"is-group-enabled":!0,queries:e.breakdownSearchQueries,type:"breakdown"},on:{"change-search":e.changeSearch,"remove-search":e.removeSearchQuery}})],1),e.isAssetsLoading?s("spinner"):e._l(e.availableAssetsByType,function(i){return s("div",{key:i.length>0?i[0].asset_type_name:"",staticClass:"type-assets"},[s("div",{staticClass:"asset-type"},[e._v(" "+e._s(i.length>0?i[0].asset_type_name:"")+" ")]),s("div",{staticClass:"asset-list"},e._l(i,function(a){return s("available-asset-block",{directives:[{name:"show",rawName:"v-show",value:e.libraryDisplayed||!a.shared,expression:"libraryDisplayed || !asset.shared"}],key:a.id,attrs:{asset:a,active:Object.keys(e.selection).length>0,"text-mode":e.isTextMode,"big-mode":e.isBigMode},on:{"add-one":e.addOneAsset,"add-ten":e.addTenAssets}})}),1)])})],2):e._e()]),s("import-render-modal",{attrs:{active:e.modals.isImportRenderDisplayed,"is-loading":e.loading.importing,"is-error":e.errors.importing,"import-error":e.errors.importingError,"parsed-csv":e.parsedCSV,"form-data":e.importCsvFormData,columns:e.renderColumns,"data-matchers":e.dataMatchers,database:e.filteredCasting,"disable-update":!0},on:{reupload:e.resetImport,cancel:e.hideImportRenderModal,confirm:e.uploadImportFile}}),s("import-modal",{ref:"import-modal",attrs:{active:e.modals.importing,"is-loading":e.loading.importing,"is-error":e.errors.importing,"form-data":e.importCsvFormData,columns:e.csvColumns,"optional-columns":e.optionalCsvColumns},on:{cancel:e.hideImportModal,confirm:e.renderImport}}),s("edit-label-modal",{ref:"edit-label-modal",attrs:{active:e.modals.isEditLabelDisplayed,"is-loading":e.loading.editLabel,"is-error":e.loading.editError,asset:e.editedAsset,label:e.editedAssetLinkLabel},on:{cancel:function(i){e.modals.isEditLabelDisplayed=!1},confirm:e.confirmEditLabel}}),s("build-filter-modal",{ref:"build-filter-modal",attrs:{active:e.modals.isBuildFilterDisplayed},on:{confirm:e.confirmBuildFilter,cancel:function(i){e.modals.isBuildFilterDisplayed=!1}}}),s("edit-asset-modal",{ref:"edit-asset-modal",attrs:{active:e.modals.isNewDisplayed,"asset-to-edit":{},"is-error":e.errors.edit,"is-loading":e.loading.edit,"is-loading-stay":e.loading.stay,"is-success":e.success.edit},on:{confirm:e.confirmNewAsset,confirmAndStay:e.confirmNewAssetStay,cancel:function(i){e.modals.isNewDisplayed=!1}}}),s("delete-modal",{attrs:{active:e.modals.isRemoveConfirmationDisplayed,"delete-button-text":e.$t("breakdown.remove.confirm"),"error-text":e.$t("breakdown.remove.error"),"is-loading":e.loading.remove,"is-error":e.loading.error,text:e.$t("breakdown.remove.text")},on:{confirm:e.confirmAssetRemoval,cancel:function(i){e.modals.isRemoveConfirmationDisplayed=!1}}})],1)},ce=[],he=c(le,de,ce,!1,null,"fde94124");const fe=he.exports;export{fe as default};
//# sourceMappingURL=Breakdown-CXjG9AG5.js.map
