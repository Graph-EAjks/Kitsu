{"version":3,"file":"Budget-BtqxCE5X.js","sources":["../../src/components/mixins/page.js","../../src/components/pages/budget/BudgetList.vue","../../src/components/modals/BaseModal.vue","../../src/components/modals/EditBudgetModal.vue","../../src/components/widgets/MonthField.vue","../../src/components/modals/EditBudgetEntryModal.vue","../../src/components/pages/budget/Budget.vue"],"sourcesContent":["/*\n * This mixin is used to format the page title based on the current context.\n */\nimport { mapGetters } from 'vuex'\n\nexport const pageMixin = {\n  computed: {\n    ...mapGetters(['currentProduction, currentEpisode, isTVShow'])\n  },\n\n  methods: {},\n\n  head() {\n    if (this.currentProduction) {\n      if (this.isTVSHow && this.currentEpisode) {\n        return {\n          title:\n            `${this.currentProduction.name} - ` +\n            `${this.currentEpisode.name} | {this.pageTitle} - Kitsu`\n        }\n      } else {\n        return {\n          title: `${this.currentProduction.name} | ${this.pageTitle} - Kitsu`\n        }\n      }\n    } else {\n      return {\n        title: `${this.pageTitle} - Kitsu`\n      }\n    }\n  }\n}\n","<template>\n  <div class=\"budget-data\">\n    <div class=\"has-text-centered mt2\" v-if=\"isLoading\">\n      <spinner />\n    </div>\n\n    <div class=\"flexrow mt2\" v-else-if=\"isError\">\n      <p class=\"list-error\">\n        {{ $t('budget.budget_entries_error') }}\n      </p>\n    </div>\n\n    <div class=\"mt2\" v-else-if=\"budgetDepartments.length === 0\">\n      <p class=\"has-text-centered mt1\">\n        {{ $t('budget.no_budget_entries_found') }}\n      </p>\n      <p class=\"has-text-centered mt1\">\n        <button-simple\n          :text=\"$t('budget.add_entry')\"\n          @click=\"$emit('add-budget-entry')\"\n        />\n      </p>\n    </div>\n\n    <div class=\"data-list filler\" v-else>\n      <div ref=\"body\" class=\"datatable-wrapper flexcolumn filler\">\n        <table class=\"datatable\">\n          <thead class=\"datatable-head\">\n            <tr>\n              <th\n                class=\"datatable-row-header department-header-header\"\n                colspan=\"3\"\n              >\n                <div class=\"flexrow\">\n                  <div class=\"flexrow-item\">\n                    {{ $t('budget.fields.department') }}\n                  </div>\n                  <div class=\"filler\"></div>\n                  <button-simple\n                    :text=\"$t('budget.add_entry')\"\n                    is-thin\n                    @click=\"$emit('add-budget-entry')\"\n                  />\n                </div>\n              </th>\n              <th\n                :key=\"month\"\n                class=\"month datatable-row-header\"\n                v-for=\"month in monthsBetweenProductionDates\"\n              >\n                {{\n                  month.month() === 0\n                    ? month.format('MMM / YY')\n                    : month.format('MMM')\n                }}\n              </th>\n              <th class=\"datatable-row-header has-text-right\">\n                {{ $t('main.total') }} ({{ currency }})\n              </th>\n              <th class=\"actions datatable-row-header\"></th>\n            </tr>\n          </thead>\n\n          <tbody\n            class=\"datatable-body\"\n            @mousedown=\"startBrowsing\"\n            @touchstart=\"startBrowsing\"\n          >\n            <tr class=\"datatable-row\">\n              <td class=\"datatable-row-header\" colspan=\"3\">\n                <div class=\"pa05\">\n                  {{ $t('main.total') }}\n                </div>\n              </td>\n              <td\n                :key=\"month\"\n                class=\"month\"\n                v-for=\"month in monthsBetweenProductionDates\"\n              >\n                {{\n                  totalEntry.monthCosts[\n                    month.format('YYYY-MM')\n                  ]?.toLocaleString()\n                }}\n              </td>\n              <td class=\"total-cost\">\n                {{ totalEntry.total.toLocaleString() }}\n              </td>\n              <td class=\"actions\"></td>\n            </tr>\n\n            <template\n              v-for=\"departmentEntry in budgetDepartments\"\n              :key=\"departmentEntry.id\"\n            >\n              <tr\n                class=\"datatable-row department-row pointer\"\n                @click=\"toggleDepartment(departmentEntry.id)\"\n              >\n                <td\n                  class=\"datatable-row-header strong department-header\"\n                  colspan=\"3\"\n                >\n                  <div\n                    class=\"flexrow department-header-content\"\n                    :style=\"getDepartmentStyle(departmentEntry.id, '99')\"\n                  >\n                    <chevron-right-icon\n                      class=\"flexrow-item\"\n                      v-if=\"collapsedDepartments[departmentEntry.id]\"\n                    />\n                    <chevron-down-icon class=\"flexrow-item\" v-else />\n                    <div class=\"flexrow-item\">\n                      {{ departmentMap.get(departmentEntry.id).name }}\n                    </div>\n                  </div>\n                </td>\n                <td\n                  :key=\"month\"\n                  class=\"month\"\n                  :style=\"getDepartmentStyle(departmentEntry.id, '33')\"\n                  v-for=\"month in monthsBetweenProductionDates\"\n                >\n                  {{\n                    departmentEntry.monthCosts[\n                      month.format('YYYY-MM')\n                    ]?.toLocaleString()\n                  }}\n                </td>\n                <td\n                  class=\"total-cost\"\n                  :style=\"getDepartmentStyle(departmentEntry.id, '33')\"\n                >\n                  {{ departmentEntry.total.toLocaleString() }}\n                </td>\n                <td\n                  class=\"actions\"\n                  :style=\"getDepartmentStyle(departmentEntry.id, '33')\"\n                ></td>\n              </tr>\n\n              <template v-if=\"!collapsedDepartments[departmentEntry.id]\">\n                <tr\n                  class=\"datatable-row\"\n                  :key=\"personEntry.id\"\n                  v-for=\"personEntry in departmentEntry.persons\"\n                >\n                  <td class=\"position datatable-row-header\">\n                    {{\n                      $t('budget.positions.' + personEntry.position || 'artist')\n                    }}\n                  </td>\n                  <td class=\"seniority datatable-row-header\">\n                    {{\n                      $t(\n                        'budget.seniorities.' + personEntry.seniority ||\n                          'junior'\n                      )\n                    }}\n                  </td>\n                  <td class=\"name datatable-row-header\">\n                    <div class=\"flexrow\">\n                      <people-avatar\n                        class=\"flexrow-item\"\n                        :person=\"personMap.get(personEntry.person_id)\"\n                        :is-link=\"false\"\n                        :font-size=\"12\"\n                        :size=\"20\"\n                        v-if=\"personEntry.person_id\"\n                      />\n                      <people-name\n                        :person=\"personMap.get(personEntry.person_id)\"\n                        v-if=\"personEntry.person_id\"\n                      />\n                      <span class=\"new-hiring\" v-else>\n                        {{ $t('budget.new_hiring') }}\n                      </span>\n                    </div>\n                  </td>\n                  <td\n                    :key=\"month\"\n                    class=\"month\"\n                    v-for=\"month in monthsBetweenProductionDates\"\n                  >\n                    {{\n                      personEntry.monthCosts[\n                        month.format('YYYY-MM')\n                      ]?.toLocaleString()\n                    }}\n                  </td>\n                  <td class=\"total-cost\">\n                    {{ personEntry.total.toLocaleString() }}\n                  </td>\n                  <row-actions-cell\n                    class=\"actions\"\n                    :entry-id=\"personEntry.id\"\n                    :hide-avatar=\"true\"\n                    :hide-change-password=\"true\"\n                    :hide-delete=\"false\"\n                    :hide-refresh=\"true\"\n                    @delete-clicked=\"$emit('delete-budget-entry', personEntry)\"\n                    @edit-clicked=\"$emit('edit-budget-entry', personEntry)\"\n                  />\n                </tr>\n              </template>\n            </template>\n          </tbody>\n        </table>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters, mapActions } from 'vuex'\n\nimport { domMixin } from '@/components/mixins/dom'\nimport { grabListMixin } from '@/components/mixins/grablist'\n\nimport { ChevronDownIcon, ChevronRightIcon } from 'lucide-vue-next'\n\nimport ButtonSimple from '@/components/widgets/ButtonSimple.vue'\nimport PeopleName from '@/components/widgets/PeopleName.vue'\nimport PeopleAvatar from '@/components/widgets/PeopleAvatar.vue'\nimport RowActionsCell from '@/components/cells/RowActionsCell.vue'\nimport Spinner from '@/components/widgets/Spinner.vue'\n\nexport default {\n  name: 'budget-list',\n\n  mixins: [domMixin, grabListMixin],\n\n  emits: ['add-budget-entry', 'delete-budget-entry', 'edit-budget-entry'],\n\n  components: {\n    ButtonSimple,\n    ChevronDownIcon,\n    ChevronRightIcon,\n    PeopleName,\n    PeopleAvatar,\n    RowActionsCell,\n    Spinner\n  },\n\n  props: {\n    budgets: {\n      type: Array,\n      default: () => []\n    },\n    budgetEntries: {\n      type: Array,\n      default: () => []\n    },\n    budgetDepartments: {\n      type: Array,\n      default: () => []\n    },\n    monthsBetweenProductionDates: {\n      type: Array,\n      default: () => []\n    },\n    currency: {\n      type: String,\n      default: 'USD'\n    },\n    isLoading: {\n      type: Boolean,\n      default: false\n    },\n    isError: {\n      type: Boolean,\n      default: false\n    },\n    totalEntry: {\n      type: Object,\n      default: () => ({})\n    }\n  },\n\n  data() {\n    return {\n      collapsedDepartments: {},\n      domEvents: [\n        ['mousemove', this.onMouseMove],\n        ['touchmove', this.onMouseMove],\n        ['mouseup', this.stopBrowsing],\n        ['mouseleave', this.stopBrowsing],\n        ['touchend', this.stopBrowsing],\n        ['touchcancel', this.stopBrowsing],\n        ['keyup', this.stopBrowsing]\n      ]\n    }\n  },\n\n  mounted() {\n    this.addEvents(this.domEvents)\n  },\n\n  beforeUnmount() {\n    this.removeEvents(this.domEvents)\n    document.body.style.cursor = 'default'\n  },\n\n  computed: {\n    ...mapGetters(['departmentMap', 'personMap'])\n  },\n\n  methods: {\n    ...mapActions([]),\n\n    toggleDepartment(departmentId) {\n      this.collapsedDepartments[departmentId] =\n        !this.collapsedDepartments[departmentId]\n    },\n\n    getDepartmentStyle(departmentId, opacity) {\n      return {\n        backgroundColor: this.departmentMap.get(departmentId).color + opacity\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.datatable-wrapper {\n  border-bottom-right-radius: 10px;\n  border-bottom-left-radius: 10px;\n}\n\n.department-header-header {\n  max-width: 400px;\n  width: 400px;\n  z-index: 5;\n}\n\n.data-list {\n  margin-top: 2em;\n}\n\n.department-header {\n  min-width: 400px;\n  position: sticky;\n  padding: 0;\n}\n\n.department-header-content {\n  color: white;\n  height: 100%;\n  min-width: 400px;\n  padding: 0.6em 1em;\n}\n\nth.month {\n  text-align: center;\n  max-width: 80px;\n  min-width: 80px;\n  width: 80px;\n}\n\ntd.month {\n  text-align: right;\n  max-width: 80px;\n  min-width: 80px;\n  width: 80px;\n}\n\n.position {\n  max-width: 100px;\n  min-width: 100px;\n  width: 100px;\n}\n\n.seniority {\n  max-width: 100px;\n  min-width: 100px;\n  width: 100px;\n}\n\n.name {\n  max-width: 200px;\n  width: 200px;\n}\n\ntd.datatable-row-header.seniority {\n  left: 100px;\n}\n\ntd.datatable-row-header.name {\n  left: 200px;\n}\n\n.actions {\n  max-width: 120px;\n  width: 120px;\n  min-width: 120px;\n}\n\n.total-cost {\n  font-weight: bold;\n  text-align: right;\n  max-width: 100px;\n  width: 100px;\n}\n\n.new-hiring {\n  background: $light-grey-light;\n  color: $dark-grey-2;\n  padding: 0.5em 1em;\n  border-radius: 5px;\n  font-size: 0.8rem;\n\n  .dark & {\n    background: $dark-grey-light;\n    color: $light-grey;\n  }\n}\n</style>\n","<template>\n  <div\n    :class=\"{\n      modal: true,\n      'is-active': active\n    }\"\n  >\n    <div class=\"modal-background\" @click=\"onBackgroundClicked\"></div>\n\n    <div class=\"modal-content\">\n      <div class=\"box\">\n        <h1 class=\"title\">\n          {{ title }}\n        </h1>\n        <slot />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n/*\n */\nimport { modalMixin } from './base_modal'\n\nexport default {\n  name: 'base-modal',\n\n  mixins: [modalMixin],\n\n  emits: ['cancel'],\n\n  components: {},\n\n  props: {\n    active: {\n      type: Boolean,\n      default: false\n    },\n    title: {\n      type: String,\n      default: ''\n    }\n  },\n\n  data() {\n    return {}\n  },\n\n  methods: {\n    onBackgroundClicked() {\n      this.$emit('cancel')\n    }\n  },\n\n  watch: {}\n}\n</script>\n\n<style scoped>\n.modal {\n  display: none;\n\n  &.is-active {\n    display: flex;\n  }\n}\n</style>\n","<template>\n  <base-modal :active=\"active\" :title=\"modalTitle\" @cancel=\"$emit('cancel')\">\n    <form @submit.prevent>\n      <div class=\"field\">\n        <label class=\"label\">\n          {{ $t('budget.fields.revision') }}\n        </label>\n\n        <p class=\"revision-number\">\n          v{{ isEditing ? budgetToEdit.revision : lastRevision + 1 }}\n        </p>\n      </div>\n\n      <text-field\n        ref=\"nameField\"\n        :label=\"$t('budget.fields.name')\"\n        :maxlength=\"30\"\n        v-model=\"form.name\"\n        @enter=\"runConfirmation\"\n        v-focus\n      />\n\n      <combobox\n        :label=\"$t('budget.fields.currency')\"\n        :options=\"currencieOptions\"\n        v-model=\"form.currency\"\n      />\n    </form>\n\n    <modal-footer\n      :error-text=\"$t('budget.create_budget_error')\"\n      :is-error=\"isError\"\n      :is-loading=\"isLoading\"\n      :is-disabled=\"isDisabled\"\n      @confirm=\"runConfirmation\"\n      @cancel=\"$emit('cancel')\"\n    />\n  </base-modal>\n</template>\n\n<script>\nimport { mapGetters, mapActions } from 'vuex'\nimport { modalMixin } from '@/components/modals/base_modal'\n\nimport BaseModal from '@/components/modals/BaseModal.vue'\nimport ModalFooter from '@/components/modals/ModalFooter.vue'\nimport TextField from '@/components/widgets/TextField.vue'\nimport Combobox from '@/components/widgets/Combobox.vue'\n\nexport default {\n  name: 'edit-budget-modal',\n\n  mixins: [modalMixin],\n\n  components: {\n    BaseModal,\n    Combobox,\n    ModalFooter,\n    TextField\n  },\n\n  props: {\n    active: {\n      type: Boolean,\n      default: false\n    },\n    isError: {\n      type: Boolean,\n      default: false\n    },\n    isLoading: {\n      type: Boolean,\n      default: false\n    },\n    budgetToEdit: {\n      type: Object,\n      default: () => {}\n    },\n    lastRevision: {\n      type: Number,\n      default: 1\n    }\n  },\n\n  emits: ['cancel', 'confirm'],\n\n  data() {\n    return {\n      form: {\n        name: '',\n        currency: 'USD'\n      },\n      currencieOptions: [\n        { label: 'USD', value: 'USD' },\n        { label: 'EUR', value: 'EUR' },\n        { label: 'GBP', value: 'GBP' },\n        { label: 'CAD', value: 'CAD' },\n        { label: 'AUD', value: 'AUD' },\n        { label: 'CHF', value: 'CHF' },\n        { label: 'JPY', value: 'JPY' },\n        { label: 'CNY', value: 'CNY' },\n        { label: 'INR', value: 'INR' }\n      ]\n    }\n  },\n\n  computed: {\n    ...mapGetters([]),\n\n    isDisabled() {\n      return this.form.name.length === 0\n    },\n\n    isEditing() {\n      return this.budgetToEdit && this.budgetToEdit.id\n    },\n\n    modalTitle() {\n      return this.isEditing\n        ? this.$t('budget.edit_budget')\n        : this.$t('budget.create_budget')\n    }\n  },\n\n  methods: {\n    ...mapActions(['']),\n\n    runConfirmation() {\n      this.$emit('confirm', this.form)\n    }\n  },\n\n  watch: {\n    active() {\n      if (this.active) {\n        setTimeout(() => {\n          this.$refs.nameField.focus()\n        }, 100)\n      }\n    },\n\n    budgetToEdit() {\n      if (this.budgetToEdit.id) {\n        this.form = {\n          id: this.budgetToEdit.id,\n          name: this.budgetToEdit.name,\n          currency: this.budgetToEdit.currency || 'USD'\n        }\n      } else {\n        this.form = {\n          id: null,\n          name: '',\n          currency: 'USD'\n        }\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.modal-content .box p.text {\n  margin-bottom: 1em;\n}\n\n.revision-number {\n  font-size: 1.4rem;\n  font-weight: bold;\n}\n\n.task-types {\n  flex-wrap: wrap;\n}\n</style>\n","<template>\n  <div class=\"month-field flexcolumn\">\n    <label class=\"label\" v-if=\"label.length > 0\">\n      {{ label }}\n    </label>\n    <div class=\"date-selector\">\n      <combobox-number :options=\"availableYears\" v-model=\"selectedYear\" />\n      <combobox-number :options=\"availableMonths\" v-model=\"selectedMonth\" />\n    </div>\n  </div>\n</template>\n<script>\nimport moment from 'moment'\nimport { range } from '@/lib/time'\n\nimport ComboboxNumber from '@/components/widgets/ComboboxNumber.vue'\n\nexport default {\n  name: 'month-field',\n\n  emits: ['update:modelValue'],\n  components: {\n    ComboboxNumber\n  },\n\n  props: {\n    label: {\n      type: String,\n      default: ''\n    },\n    minDate: {\n      type: Date,\n      required: true\n    },\n    maxDate: {\n      type: Date,\n      required: true\n    },\n    modelValue: {}\n  },\n\n  data() {\n    return {\n      selectedMonth: null,\n      selectedYear: null,\n      months: []\n    }\n  },\n\n  mounted() {\n    this.months = range(1, 12).map(month => ({\n      value: month - 1,\n      label: moment()\n        .month(month - 1)\n        .format('MMMM')\n    }))\n    if (this.modelValue && this.modelValue.getMonth) {\n      this.selectedMonth = this.modelValue.getMonth()\n      this.selectedYear = this.modelValue.getFullYear()\n    }\n  },\n\n  computed: {\n    availableYears() {\n      const years = []\n      const startYear = this.minDate.getFullYear()\n      const endYear = this.maxDate.getFullYear()\n\n      for (let year = startYear; year <= endYear; year++) {\n        years.push(year)\n      }\n      return years.map(year => ({\n        value: year,\n        label: year\n      }))\n    },\n\n    availableMonths() {\n      const currentYear = this.selectedYear || this.availableYears[0].value\n      const startYear = this.minDate.getFullYear()\n      const endYear = this.maxDate.getFullYear()\n      const minMonth = this.minDate.getMonth()\n      const maxMonth = this.maxDate.getMonth()\n\n      return this.months\n        .filter(month => {\n          if (currentYear === startYear && currentYear === endYear) {\n            // If same year, only show months between start and end\n            return month.value >= minMonth && month.value <= maxMonth\n          } else if (currentYear === startYear) {\n            // If start year, only show months after start date\n            return month.value >= minMonth\n          } else if (currentYear === endYear) {\n            // If end year, only show months before end date\n            return month.value <= maxMonth\n          }\n          return true\n        })\n        .map(month => ({\n          value: month.value,\n          label: month.label\n        }))\n    }\n  },\n\n  watch: {\n    modelValue() {\n      this.$options.silent = true\n      if (this.modelValue && this.modelValue.getMonth) {\n        this.selectedMonth = this.modelValue.getMonth()\n        this.selectedYear = this.modelValue.getFullYear()\n      }\n      this.$nextTick(() => {\n        this.$options.silent = false\n      })\n    },\n\n    selectedMonth(newMonth) {\n      if (this.$options.silent) return\n      const date = moment(new Date(this.selectedYear, newMonth, 1, 0, 0, 0, 0))\n      this.$emit('update:modelValue', date.startOf('month').toDate())\n    },\n\n    selectedYear(newYear) {\n      if (this.$options.silent) return\n      this.$nextTick(() => {\n        this.selectedMonth = this.availableMonths[0].value\n        const date = moment(\n          new Date(newYear, this.selectedMonth, 1, 0, 0, 0, 0)\n        )\n        this.$emit('update:modelValue', date.startOf('month').toDate())\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.date-selector {\n  display: flex;\n  gap: 1rem;\n}\n</style>\n","<template>\n  <base-modal\n    :active=\"active\"\n    :title=\"isEditing ? $t('budget.edit_budget_entry') : $t('budget.add_entry')\"\n    @cancel=\"$emit('cancel')\"\n  >\n    <form @submit.prevent>\n      <combobox-department\n        :label=\"$t('budget.fields.department')\"\n        v-model=\"form.department_id\"\n        @enter=\"runConfirmation\"\n        v-focus\n      />\n\n      <people-field\n        class=\"mt2\"\n        :label=\"$t('budget.fields.person')\"\n        :people=\"activePeople\"\n        @select=\"onPersonChanged\"\n        @enter=\"runConfirmation\"\n        v-model=\"form.person\"\n      />\n\n      <combobox\n        class=\"mt2\"\n        :label=\"$t('budget.fields.position')\"\n        :options=\"positionOptions\"\n        locale-key-prefix=\"people.position.\"\n        v-model=\"form.position\"\n        @enter=\"runConfirmation\"\n      />\n\n      <combobox\n        class=\"mt2\"\n        :label=\"$t('budget.fields.seniority')\"\n        :options=\"seniorityOptions\"\n        locale-key-prefix=\"people.seniority.\"\n        v-model=\"form.seniority\"\n        @enter=\"runConfirmation\"\n      />\n\n      <div class=\"flexrow\">\n        <month-field\n          class=\"mr1\"\n          :label=\"$t('budget.fields.start_date')\"\n          :min-date=\"projectStartDate\"\n          :max-date=\"projectEndDate\"\n          v-model=\"form.start_date\"\n        />\n\n        <text-field\n          class=\"month-duration\"\n          type=\"number\"\n          :min=\"1\"\n          :max=\"maxDuration\"\n          :label=\"$t('budget.fields.months_duration')\"\n          v-model=\"form.months_duration\"\n          @enter=\"runConfirmation\"\n        />\n      </div>\n      <div class=\"mt0\">\n        <span class=\"salary-label\">{{ $t('budget.fields.start_date') }}</span>\n        <span class=\"salary-value\">{{\n          formatDate(form.start_date).substring(0, 7)\n        }}</span>\n        <br />\n        <span class=\"salary-label\">{{ $t('budget.fields.end_date') }}</span>\n        <span class=\"salary-value\">{{ endMonth }}</span>\n        <br />\n        <span class=\"salary-label\">\n          {{ $t('budget.fields.monthly_salary') }}\n        </span>\n        <span class=\"salary-value\">{{ monthlySalary }}</span>\n        <br />\n        <span class=\"salary-label\">{{ $t('budget.fields.total_salary') }}</span>\n        <span class=\"salary-value\">{{ totalSalary }}</span>\n      </div>\n    </form>\n\n    <modal-footer\n      :error-text=\"$t('budget.create_budget_error')\"\n      :is-error=\"isError\"\n      :is-loading=\"isLoading\"\n      :is-disabled=\"isDisabled\"\n      @confirm=\"runConfirmation\"\n      @cancel=\"$emit('cancel')\"\n    />\n  </base-modal>\n</template>\n\n<script>\nimport moment from 'moment'\nimport { mapGetters, mapActions } from 'vuex'\n\nimport { modalMixin } from '@/components/modals/base_modal'\nimport { parseSimpleDate, formatSimpleDate } from '@/lib/time'\n\nimport BaseModal from '@/components/modals/BaseModal.vue'\nimport Combobox from '@/components/widgets/Combobox.vue'\nimport ComboboxDepartment from '@/components/widgets/ComboboxDepartment.vue'\nimport ModalFooter from '@/components/modals/ModalFooter.vue'\nimport MonthField from '@/components/widgets/MonthField.vue'\nimport PeopleField from '@/components/widgets/PeopleField.vue'\nimport TextField from '@/components/widgets/TextField.vue'\n\nexport default {\n  name: 'edit-budget-entry-modal',\n\n  mixins: [modalMixin],\n\n  components: {\n    BaseModal,\n    Combobox,\n    ComboboxDepartment,\n    ModalFooter,\n    MonthField,\n    PeopleField,\n    TextField\n  },\n\n  props: {\n    active: {\n      type: Boolean,\n      default: false\n    },\n    budgetEntryToEdit: {\n      type: Object,\n      default: () => {}\n    },\n    isError: {\n      type: Boolean,\n      default: false\n    },\n    isLoading: {\n      type: Boolean,\n      default: false\n    },\n    salaryScale: {\n      type: Object,\n      default: () => {}\n    }\n  },\n\n  emits: ['cancel', 'confirm'],\n\n  data() {\n    return {\n      form: {\n        department_id: '',\n        person: null,\n        position: 'artist',\n        seniority: 'junior',\n        start_date: null,\n        months_duration: 1\n      },\n      positionOptions: [\n        { label: 'artist', value: 'artist' },\n        { label: 'supervisor', value: 'supervisor' },\n        { label: 'lead', value: 'lead' }\n      ],\n      refreshKeys: {\n        endMonth: 0,\n        monthlySalary: 0,\n        totalSalary: 0\n      },\n      seniorityOptions: [\n        { label: 'junior', value: 'junior' },\n        { label: 'mid', value: 'mid' },\n        { label: 'senior', value: 'senior' }\n      ]\n    }\n  },\n\n  computed: {\n    ...mapGetters(['activePeople', 'currentProduction', 'personMap']),\n\n    isDisabled() {\n      return !this.form.department_id || this.form.months_duration < 1\n    },\n\n    isEditing() {\n      return this.budgetEntryToEdit && this.budgetEntryToEdit.id\n    },\n\n    projectStartDate() {\n      return parseSimpleDate(this.currentProduction.start_date).toDate()\n    },\n\n    projectEndDate() {\n      return parseSimpleDate(this.currentProduction.end_date).toDate()\n    },\n\n    endMonth() {\n      this.refreshKeys.endMonth\n      const startDate = parseSimpleDate(this.form.start_date)\n      const projectEndDate = parseSimpleDate(this.currentProduction.end_date)\n      let endDate = startDate.add('months', this.form.months_duration)\n      endDate = moment.min(endDate, projectEndDate)\n      return endDate.format('YYYY-MM')\n    },\n\n    dailySalary() {\n      if (!this.form.department_id) {\n        return 0\n      } else if (!this.form.person || !this.form.person.daily_salary) {\n        const departmentScale = this.salaryScale[this.form.department_id]\n        return departmentScale[this.form.position || 'artist'][\n          this.form.seniority || 'junior'\n        ].salary\n      } else {\n        return this.form.person.daily_salary\n      }\n    },\n\n    monthlySalary() {\n      return this.dailySalary * 20\n    },\n\n    totalSalary() {\n      if (!this.form.department_id) {\n        return 0\n      } else {\n        const duration = Math.min(this.form.months_duration, this.maxDuration)\n        return this.monthlySalary * duration\n      }\n    },\n\n    maxDuration() {\n      const startDate = parseSimpleDate(this.form.start_date)\n      const projectEndDate = parseSimpleDate(\n        this.currentProduction.end_date\n      ).endOf('month')\n      const maxDuration = projectEndDate.diff(startDate, 'months')\n      return maxDuration > 0 ? maxDuration : 1\n    }\n  },\n\n  methods: {\n    ...mapActions(['']),\n\n    runConfirmation() {\n      this.$emit('confirm', {\n        ...this.form,\n        person_id: this.form.person?.id,\n        duration: Math.min(this.form.months_duration, this.maxDuration),\n        salary: this.monthlySalary,\n        total_salary: this.totalSalary,\n        daily_salary: this.dailySalary\n      })\n    },\n\n    onPersonChanged(person) {\n      if (person) {\n        this.form.position = person.position\n        this.form.seniority = person.seniority\n      } else {\n        this.form.position = 'artist'\n        this.form.seniority = 'junior'\n      }\n    },\n\n    formatDate(date) {\n      return formatSimpleDate(date)\n    },\n\n    resetForm() {\n      if (this.isEditing) {\n        const person = this.personMap.get(this.budgetEntryToEdit.person_id)\n        Object.assign(this.form, {\n          id: this.budgetEntryToEdit.id,\n          department_id: this.budgetEntryToEdit.department_id,\n          person,\n          position: this.budgetEntryToEdit.position,\n          seniority: this.budgetEntryToEdit.seniority,\n          start_date: parseSimpleDate(\n            this.budgetEntryToEdit.start_date\n          ).toDate(),\n          months_duration: this.budgetEntryToEdit.months_duration\n        })\n        this.form.person = person\n      } else {\n        this.form = {\n          id: null,\n          department_id: '',\n          person: null,\n          position: 'artist',\n          seniority: 'junior',\n          start_date: parseSimpleDate(this.currentProduction.start_date)\n            .startOf('month')\n            .toDate(),\n          months_duration: 1\n        }\n      }\n    }\n  },\n\n  watch: {\n    active() {\n      if (this.active) {\n        this.resetForm()\n        setTimeout(() => {\n          this.$refs.departmentField.focus()\n        }, 100)\n      }\n    },\n\n    budgetEntryToEdit() {\n      this.resetForm()\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.salary-label {\n  display: inline-block;\n  font-weight: bold;\n  width: 120px;\n}\n\n.salary-value {\n  display: inline-block;\n  text-align: right;\n  width: 80px;\n}\n\n.month-duration {\n  margin-left: 1em;\n  width: 160px;\n}\n</style>\n","<template>\n  <page-layout>\n    <template #main>\n      <div class=\"flexcolumn page\">\n        <budget-header\n          :budgets=\"budgets\"\n          :budget-options=\"budgetOptions\"\n          :budget=\"currentBudget\"\n          :is-loading=\"loading.budgets\"\n          :is-error=\"errors.budgets\"\n          @change-budget=\"onChangeBudget\"\n          @edit-budget=\"onEditBudgetClicked\"\n          @delete-budget=\"onDeleteBudgetClicked\"\n          @new-version=\"onNewBudgetVersionClicked\"\n        />\n\n        <budget-list\n          :budget=\"currentBudget\"\n          :budget-departments=\"budgetDepartments\"\n          :budget-entries=\"budgetEntries\"\n          :currency=\"currentBudget?.currency || 'USD'\"\n          :is-loading=\"loading.entries\"\n          :is-error=\"errors.entries\"\n          :months-between-production-dates=\"monthsBetweenProductionDates\"\n          :total-entry=\"totalEntry\"\n          @add-budget-entry=\"onAddBudgetEntry\"\n          @delete-budget-entry=\"deleteBudgetEntry\"\n          @edit-budget-entry=\"editBudgetEntry\"\n          v-if=\"currentBudget.id\"\n        />\n\n        <edit-budget-modal\n          :active=\"modals.createBudget\"\n          :budget-to-edit=\"budgetToEdit\"\n          :last-revision=\"lastRevision\"\n          :is-loading=\"loading.createBudget || loading.editBudget\"\n          :is-error=\"errors.createBudget || errors.editBudget\"\n          @cancel=\"modals.createBudget = false\"\n          @confirm=\"createBudget\"\n        />\n\n        <edit-budget-entry-modal\n          :active=\"modals.createBudgetEntry\"\n          :budget-entry-to-edit=\"budgetEntryToEdit\"\n          :salary-scale=\"salaryScale\"\n          :is-loading=\"loading.createBudgetEntry\"\n          :is-error=\"errors.createBudgetEntry || errors.editBudgetEntry\"\n          @cancel=\"modals.createBudgetEntry = false\"\n          @confirm=\"confirmCreateBudgetEntry\"\n        />\n\n        <hard-delete-modal\n          :active=\"modals.deleteBudget\"\n          :error-text=\"$t('budget.delete_budget_error')\"\n          :is-loading=\"loading.del\"\n          :is-error=\"errors.deleteBudget\"\n          :lock-text=\"currentBudget?.name\"\n          :text=\"$t('budget.delete_budget_message')\"\n          @cancel=\"modals.deleteBudget = false\"\n          @confirm=\"deleteBudget\"\n        />\n\n        <delete-modal\n          :active=\"modals.deleteBudgetEntry\"\n          :error-text=\"$t('budget.delete_budget_entry_error')\"\n          :is-loading=\"loading.deleteBudgetEntry\"\n          :is-error=\"errors.deleteBudgetEntry\"\n          :text=\"$t('budget.delete_budget_entry_message')\"\n          @cancel=\"modals.deleteBudgetEntry = false\"\n          @confirm=\"confirmDeleteBudgetEntry\"\n        />\n      </div>\n    </template>\n\n    <template #side>\n      <budget-analytics\n        :amount=\"totalEntry.total\"\n        :currency=\"currentBudget.currency\"\n        :budgets=\"budgets\"\n        :budget-departments=\"budgetDepartments\"\n        :budget-entries=\"budgetEntries\"\n        :months-between-production-dates=\"monthsBetweenProductionDates\"\n        :pie-chart-data=\"pieChartData\"\n        :pie-chart-colors=\"pieChartColors\"\n        :column-chart-data=\"columnChartData\"\n      />\n    </template>\n  </page-layout>\n</template>\n\n<script>\nimport { mapGetters, mapActions } from 'vuex'\nimport moment from 'moment'\n\nimport { pageMixin } from '@/components/mixins/page'\nimport { formatMonth, parseSimpleDate } from '@/lib/time'\n\nimport BudgetAnalytics from '@/components/pages/budget/BudgetAnalytics.vue'\nimport BudgetHeader from '@/components/pages/budget/BudgetHeader.vue'\nimport BudgetList from '@/components/pages/budget/BudgetList.vue'\nimport DeleteModal from '@/components/modals/DeleteModal.vue'\nimport EditBudgetModal from '@/components/modals/EditBudgetModal.vue'\nimport EditBudgetEntryModal from '@/components/modals/EditBudgetEntryModal.vue'\nimport HardDeleteModal from '@/components/modals/HardDeleteModal.vue'\nimport PageLayout from '@/components/layouts/PageLayout.vue'\n\nconst helpers = {\n  resetDepartmentTotals(departmentData) {\n    departmentData.total = departmentData.persons.reduce(\n      (acc, person) => acc + person.total,\n      0\n    )\n    departmentData.monthCosts = departmentData.persons.reduce((acc, person) => {\n      Object.keys(person.monthCosts).forEach(month => {\n        acc[month] = (acc[month] || 0) + person.monthCosts[month]\n      })\n      return acc\n    }, {})\n  }\n}\n\nexport default {\n  name: 'budget',\n\n  mixins: [pageMixin],\n\n  components: {\n    BudgetAnalytics,\n    BudgetHeader,\n    BudgetList,\n    DeleteModal,\n    EditBudgetEntryModal,\n    EditBudgetModal,\n    HardDeleteModal,\n    PageLayout\n  },\n\n  data() {\n    return {\n      budgets: [],\n      budgetEntries: [],\n      budgetEntryToEdit: {},\n      budgetOptions: [],\n      budgetToEdit: {},\n      currentBudget: {},\n      errors: {\n        budgets: false,\n        createBudget: false,\n        editBudget: false,\n        editBudgetEntry: false,\n        entries: false,\n        deleteBudget: false,\n        deleteBudgetEntry: false\n      },\n      loading: {\n        budgets: true,\n        createBudget: false,\n        editBudget: false,\n        editBudgetEntry: false,\n        entries: true,\n        deleteBudget: false,\n        deleteBudgetEntry: false\n      },\n      modals: {\n        createBudget: false,\n        createBudgetEntry: false,\n        editBudgetEntry: false,\n        deleteBudget: false,\n        deleteBudgetEntry: false\n      },\n      monthsBetweenProductionDates: [],\n      salaryScale: {}\n    }\n  },\n\n  async mounted() {\n    this.pageTitle = this.$t('budget.title')\n    await this.setSalaryScale()\n    await this.loadBudgets()\n    await this.loadBudgetEntries()\n    this.monthsBetweenProductionDates = this.getMonthsBetweenDates(\n      this.currentProduction.start_date,\n      this.currentProduction.end_date\n    )\n  },\n\n  computed: {\n    ...mapGetters([\n      'currentProduction',\n      'departments',\n      'departmentMap',\n      'personMap'\n    ]),\n\n    lastRevision() {\n      return this.budgets.length > 0 ? this.budgets[0].revision : 0\n    },\n\n    budgetDepartments() {\n      const departmentIds = new Set(\n        this.budgetEntries.map(entry => entry.department_id)\n      )\n      const budgetDepartments = []\n      Array.from(departmentIds).map(departmentId => {\n        const departmentEntries = this.budgetEntries.filter(\n          entry => entry.department_id === departmentId\n        )\n        const departmentData = {\n          id: departmentId,\n          monthCosts: {},\n          total: 0,\n          duration: 0,\n          persons: []\n        }\n        departmentEntries.forEach(entry => {\n          const monthlySalary = entry.daily_salary * 20\n          const monthCosts = {}\n          for (let i = 0; i < entry.months_duration; i++) {\n            const month = moment(entry.start_date).add(i, 'month')\n            monthCosts[month.format('YYYY-MM')] = monthlySalary\n          }\n          departmentData.persons.push({\n            id: entry.id,\n            person_id: entry.person_id,\n            budget_entry_id: entry.id,\n            department_id: entry.department_id,\n            monthCosts: monthCosts,\n            position: entry.position,\n            seniority: entry.seniority,\n            total: entry.months_duration * monthlySalary,\n            months_duration: entry.months_duration,\n            start_date: entry.start_date\n          })\n          departmentData.persons.sort(this.sortDepartmentPersons)\n        })\n        helpers.resetDepartmentTotals(departmentData)\n        budgetDepartments.push(departmentData)\n      })\n      return budgetDepartments\n    },\n\n    totalEntry() {\n      const total = this.budgetDepartments.reduce(\n        (acc, department) => acc + department.total,\n        0\n      )\n      const monthCosts = this.budgetDepartments.reduce((acc, department) => {\n        Object.keys(department.monthCosts).forEach(month => {\n          acc[month] = (acc[month] || 0) + department.monthCosts[month]\n        })\n        return acc\n      }, {})\n      return {\n        total,\n        monthCosts: monthCosts\n      }\n    },\n\n    pieChartData() {\n      return this.budgetDepartments.map(departmentEntry => {\n        const department = this.departmentMap.get(departmentEntry.id)\n        return [department.name, departmentEntry.total]\n      })\n    },\n\n    pieChartColors() {\n      return this.budgetDepartments.map(departmentEntry => {\n        const department = this.departmentMap.get(departmentEntry.id)\n        return department.color\n      })\n    },\n\n    columnChartData() {\n      return this.monthsBetweenProductionDates.map(monthDate => {\n        const monthKey = monthDate.format('YYYY-MM')\n        const [year, month] = monthKey.split('-')\n        const label = month === '01' ? `${year.slice(2)}/${month}` : month\n        return [label, this.totalEntry.monthCosts[monthKey] || 0]\n      })\n    }\n  },\n\n  methods: {\n    ...mapActions([\n      'createProductionBudgetEntry',\n      'createProductionBudget',\n      'deleteProductionBudget',\n      'deleteProductionBudgetEntry',\n      'loadProductionBudget',\n      'loadProductionBudgets',\n      'loadProductionBudgetEntry',\n      'loadProductionBudgetEntries',\n      'loadSalaryScale',\n      'updateProductionBudget',\n      'updateProductionBudgetEntry'\n    ]),\n\n    formatMonth,\n\n    sortDepartmentPersons(a, b) {\n      const seniorityWeight = {\n        junior: 1,\n        mid: 2,\n        senior: 3\n      }\n      const positionWeight = {\n        artist: 1,\n        supervisor: 2,\n        lead: 3\n      }\n      const seniorityA = seniorityWeight[a.seniority]\n      const seniorityB = seniorityWeight[b.seniority]\n      const positionA = positionWeight[a.position]\n      const positionB = positionWeight[b.position]\n      if (a.person_id === null && b.person_id === null) {\n        if (positionA === positionB) {\n          return seniorityB - seniorityA\n        } else {\n          return positionB - positionA\n        }\n      } else if (a.person_id === null) {\n        return 1\n      } else if (b.person_id === null) {\n        return -1\n      } else {\n        const personA = this.personMap.get(a.person_id)\n        const personB = this.personMap.get(b.person_id)\n        if (personA.name === personB.name) {\n          if (positionA === positionB) {\n            return seniorityB - seniorityA\n          } else {\n            return positionB - positionA\n          }\n        } else {\n          return personA.name.localeCompare(personB.name)\n        }\n      }\n    },\n\n    async setSalaryScale() {\n      this.salaryScale = await this.loadSalaryScale()\n    },\n\n    onChangeBudget(budget) {\n      this.currentBudget = budget\n    },\n\n    onEditBudgetClicked() {\n      this.budgetToEdit = this.currentBudget\n      this.modals.createBudget = true\n    },\n\n    onNewBudgetVersionClicked() {\n      this.budgetToEdit = {}\n      this.modals.createBudget = true\n    },\n\n    async createBudget(budget) {\n      try {\n        this.loading.createBudget = true\n        if (budget.id) {\n          await this.updateProductionBudget({\n            productionId: this.currentProduction.id,\n            budget: {\n              id: this.currentBudget.id,\n              name: budget.name,\n              currency: budget.currency\n            }\n          })\n          const oldBudget = this.budgets.find(\n            b => b.id === this.currentBudget.id\n          )\n          if (oldBudget) {\n            Object.assign(oldBudget, {\n              name: budget.name,\n              currency: budget.currency\n            })\n          }\n        } else {\n          this.loading.createBudget = true\n          const newBudget = await this.createProductionBudget({\n            productionId: this.currentProduction.id,\n            budget\n          })\n          this.budgets.unshift(newBudget)\n          this.currentBudget = newBudget\n        }\n        this.resetBudgetOptions()\n        this.modals.createBudget = false\n      } catch (error) {\n        console.error(error)\n        this.errors.createBudget = true\n      } finally {\n        this.loading.createBudget = false\n      }\n    },\n\n    onDeleteBudgetClicked() {\n      this.errors.deleteBudget = false\n      this.modals.deleteBudget = true\n    },\n\n    async deleteBudget() {\n      this.loading.deleteBudget = true\n      try {\n        await this.deleteProductionBudget({\n          productionId: this.currentProduction.id,\n          budgetId: this.currentBudget.id\n        })\n        this.postDeleteBudget(this.currentBudget)\n        this.modals.deleteBudget = false\n      } catch (error) {\n        console.error(error)\n        this.errors.deleteBudget = true\n      } finally {\n        this.loading.deleteBudget = false\n      }\n    },\n\n    postDeleteBudget(budget) {\n      this.budgets = this.budgets.filter(b => b.id !== budget.id)\n      this.resetBudgetOptions()\n      if (this.budgets.length > 0) {\n        this.currentBudget = this.budgets[0]\n      } else {\n        this.currentBudget = {}\n      }\n    },\n\n    onAddBudgetEntry() {\n      this.modals.createBudgetEntry = true\n    },\n\n    async confirmCreateBudgetEntry(budgetEntry) {\n      if (budgetEntry.id) {\n        await this.runRemoteBudgetEntryEdition(budgetEntry)\n      } else {\n        await this.runRemoteBudgetEntryCreation(budgetEntry)\n      }\n    },\n\n    async runRemoteBudgetEntryCreation(budgetEntry) {\n      try {\n        this.loading.createBudgetEntry = true\n        await this.createProductionBudgetEntry({\n          productionId: this.currentProduction.id,\n          budgetId: this.currentBudget.id,\n          budgetEntry: {\n            ...budgetEntry,\n            person_id: budgetEntry.person ? budgetEntry.person.id : null\n          }\n        })\n        this.modals.createBudgetEntry = false\n      } catch (error) {\n        console.error(error)\n        this.errors.createBudgetEntry = true\n      } finally {\n        this.loading.createBudgetEntry = false\n      }\n    },\n\n    editBudgetEntry(budgetEntry) {\n      this.budgetEntryToEdit = budgetEntry\n      this.modals.createBudgetEntry = true\n    },\n\n    async runRemoteBudgetEntryEdition(budgetEntry) {\n      try {\n        this.loading.editBudgetEntry = true\n        this.errors.editBudgetEntry = false\n        await this.updateProductionBudgetEntry({\n          productionId: this.currentProduction.id,\n          budgetId: this.currentBudget.id,\n          budgetEntryId: budgetEntry.id,\n          budgetEntry: {\n            id: budgetEntry.id,\n            department_id: budgetEntry.department_id,\n            person_id: budgetEntry.person ? budgetEntry.person.id : null,\n            position: budgetEntry.position,\n            seniority: budgetEntry.seniority,\n            start_date: budgetEntry.start_date,\n            months_duration: budgetEntry.duration,\n            daily_salary: budgetEntry.daily_salary\n          }\n        })\n        this.modals.createBudgetEntry = false\n      } catch (error) {\n        console.error(error)\n        this.errors.editBudgetEntry = true\n      } finally {\n        this.loading.editBudgetEntry = false\n      }\n    },\n\n    afterEditBudgetEntry(budgetEntry) {\n      const oldBudgetEntry = this.budgetEntries.find(\n        b => b.id === budgetEntry.id\n      )\n      if (oldBudgetEntry) {\n        Object.assign(oldBudgetEntry, budgetEntry)\n      }\n    },\n\n    async deleteBudgetEntry(budgetEntry) {\n      this.loading.deleteBudgetEntry = false\n      this.errors.deleteBudgetEntry = false\n      this.modals.deleteBudgetEntry = true\n      this.budgetEntryToDelete = budgetEntry\n    },\n\n    async confirmDeleteBudgetEntry() {\n      this.loading.deleteBudgetEntry = true\n      try {\n        await this.deleteProductionBudgetEntry({\n          productionId: this.currentProduction.id,\n          budgetId: this.currentBudget.id,\n          budgetEntryId: this.budgetEntryToDelete.budget_entry_id\n        })\n        this.postDeleteBudgetEntry(this.budgetEntryToDelete)\n        this.modals.deleteBudgetEntry = false\n      } catch (error) {\n        console.error(error)\n        this.errors.deleteBudgetEntry = true\n      } finally {\n        this.loading.deleteBudgetEntry = false\n      }\n    },\n\n    postDeleteBudgetEntry(budgetEntry) {\n      this.budgetEntries = this.budgetEntries.filter(\n        entry => entry.id !== budgetEntry.id\n      )\n    },\n\n    async loadBudgets() {\n      try {\n        this.loading.budgets = true\n        this.errors.budgets = false\n        this.budgets = await this.loadProductionBudgets(\n          this.currentProduction.id\n        )\n        this.budgets.sort((a, b) => b.revision - a.revision)\n        this.currentBudget = this.budgets.length > 0 ? this.budgets[0] : {}\n        this.resetBudgetOptions()\n      } catch (error) {\n        console.error(error)\n        this.errors.budgets = true\n      } finally {\n        this.loading.budgets = false\n      }\n    },\n\n    async loadBudgetEntries() {\n      if (!this.currentBudget || !this.currentBudget.id) return\n      try {\n        this.loading.entries = true\n        this.errors.entries = false\n        this.budgetEntries = await this.loadProductionBudgetEntries({\n          productionId: this.currentProduction.id,\n          budgetId: this.currentBudget.id\n        })\n      } catch (error) {\n        console.error(error)\n        this.errors.entries = true\n      } finally {\n        this.loading.entries = false\n      }\n    },\n\n    resetBudgetOptions() {\n      this.budgetOptions = this.budgets.map(budget => {\n        return {\n          label: `v${budget.revision} - ${budget.name}`,\n          value: budget\n        }\n      })\n    },\n\n    getMonthsBetweenDates(startDate, endDate) {\n      const months = []\n      const current = parseSimpleDate(startDate)\n      const end = parseSimpleDate(endDate)\n\n      while (current <= end) {\n        months.push(moment(current))\n        current.add(1, 'month')\n      }\n      return months\n    }\n  },\n\n  watch: {\n    currentProduction() {\n      this.loadBudgets()\n    },\n\n    currentBudget() {\n      this.loadBudgetEntries()\n    }\n  },\n\n  socket: {\n    events: {\n      'budget:create': async function (data) {\n        if (data.project_id !== this.currentProduction.id) return\n        const budget = await this.loadProductionBudget({\n          productionId: this.currentProduction.id,\n          budgetId: data.budget_id\n        })\n        const oldBudget = this.budgets.find(b => b.id === budget.id)\n        if (budget && !oldBudget) {\n          this.budgets.unshift(budget)\n          this.resetBudgetOptions()\n        }\n      },\n\n      'budget:update': async function (data) {\n        if (data.project_id !== this.currentProduction.id) return\n        const budget = await this.loadProductionBudget({\n          productionId: this.currentProduction.id,\n          budgetId: data.budget_id\n        })\n        if (budget) {\n          const oldBudget = this.budgets.find(b => b.id === budget.id)\n          if (oldBudget) {\n            Object.assign(oldBudget, {\n              name: budget.name,\n              currency: budget.currency\n            })\n            this.resetBudgetOptions()\n          }\n        }\n      },\n\n      'budget:delete': function (data) {\n        if (data.project_id !== this.currentProduction.id) return\n        const oldBudget = this.budgets.find(b => b.id === data.budget_id)\n        const isCurrentBudgetDeleted = this.currentBudget.id === data.budget_id\n        if (oldBudget) {\n          this.budgets = this.budgets.filter(b => b.id !== data.budget_id)\n          this.resetBudgetOptions()\n          if (isCurrentBudgetDeleted) {\n            this.currentBudget = this.budgets[0]\n          }\n        }\n      },\n\n      'budget-entry:create': async function (data) {\n        if (data.project_id !== this.currentProduction.id) return\n        if (data.budget_id !== this.currentBudget.id) return\n        const oldBudgetEntry = this.budgetEntries.find(\n          b => b.id === data.budget_entry_id\n        )\n        if (oldBudgetEntry) return\n        const budgetEntry = await this.loadProductionBudgetEntry({\n          productionId: this.currentProduction.id,\n          budgetId: this.currentBudget.id,\n          budgetEntryId: data.budget_entry_id\n        })\n        this.budgetEntries.push(budgetEntry)\n      },\n\n      'budget-entry:update': async function (data) {\n        if (data.project_id !== this.currentProduction.id) return\n        if (data.budget_id !== this.currentBudget.id) return\n        const oldBudgetEntry = this.budgetEntries.find(\n          b => b.id === data.budget_entry_id\n        )\n        if (!oldBudgetEntry) return\n\n        const budgetEntry = await this.loadProductionBudgetEntry({\n          productionId: this.currentProduction.id,\n          budgetId: this.currentBudget.id,\n          budgetEntryId: data.budget_entry_id\n        })\n        this.afterEditBudgetEntry(budgetEntry)\n      },\n\n      'budget-entry:delete': async function (data) {\n        if (data.project_id !== this.currentProduction.id) return\n        if (data.budget_id !== this.currentBudget.id) return\n        const oldBudgetEntry = this.budgetEntries.find(\n          b => b.id === data.budget_entry_id\n        )\n        if (!oldBudgetEntry) return\n        this.postDeleteBudgetEntry({ id: data.budget_entry_id })\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.budget-data {\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n  max-height: calc(100vh - 140px);\n}\n</style>\n"],"names":["pageMixin","mapGetters","_sfc_main","domMixin","grabListMixin","ButtonSimple","ChevronDownIcon","ChevronRightIcon","PeopleName","PeopleAvatar","RowActionsCell","Spinner","mapActions","departmentId","opacity","_hoisted_1","_hoisted_4","_hoisted_6","_hoisted_7","_hoisted_10","_hoisted_11","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_28","_openBlock","_createElementBlock","$props","_hoisted_2","_createVNode","_component_spinner","_hoisted_3","_createElementVNode","_toDisplayString","_ctx","_hoisted_5","_component_button_simple","_hoisted_8","_hoisted_9","_hoisted_12","_Fragment","_renderList","month","args","_hoisted_17","_a","departmentEntry","$event","$options","_hoisted_21","_normalizeStyle","$data","_createBlock","_component_chevron_right_icon","_component_chevron_down_icon","_createCommentVNode","personEntry","_component_people_avatar","_component_people_name","_hoisted_27","_component_row_actions_cell","modalMixin","_normalizeClass","_renderSlot","BaseModal","Combobox","ModalFooter","TextField","_component_base_modal","_withCtx","_cache","_withModifiers","_component_text_field","_component_combobox","_component_modal_footer","ComboboxNumber","range","moment","years","startYear","endYear","year","currentYear","minMonth","maxMonth","newMonth","date","newYear","_component_combobox_number","ComboboxDepartment","MonthField","PeopleField","parseSimpleDate","startDate","projectEndDate","endDate","duration","maxDuration","person","formatSimpleDate","_component_combobox_department","_component_people_field","_component_month_field","helpers","departmentData","acc","BudgetAnalytics","BudgetHeader","BudgetList","DeleteModal","EditBudgetEntryModal","EditBudgetModal","HardDeleteModal","PageLayout","departmentIds","entry","budgetDepartments","departmentEntries","monthlySalary","monthCosts","i","total","department","monthDate","monthKey","formatMonth","a","b","seniorityWeight","positionWeight","seniorityA","seniorityB","positionA","positionB","personA","personB","budget","oldBudget","newBudget","error","budgetEntry","oldBudgetEntry","months","current","end","data","isCurrentBudgetDeleted","_component_page_layout","_component_budget_header","_component_budget_list","_component_edit_budget_modal","_component_edit_budget_entry_modal","_component_hard_delete_modal","_b","_component_delete_modal","_component_budget_analytics"],"mappings":"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"}