import{_ as T,m as F,a as D,H as w,T as x,S as M,I as B,J as I,b as V,B as A,aK as E,s as P,y as L,r as i,c as d,o as r,e as l,f as c,k as N,d as u,t as f,F as O,g as Q,n as K,a1 as U,aL as G,M as q,aM as z}from"./index-CoJO-_X8.js";import{C as H}from"./ConceptCard-63CF4jMv.js";const J={name:"concepts",mixins:[P,L],components:{AddPreviewModal:E,ButtonSimple:A,Combobox:V,ComboboxStatus:I,ConceptCard:H,PeopleField:B,SearchField:M,TableInfo:x,TaskInfo:w},data(){return{imgExtensions:z.IMG_EXTENSIONS_STRING,isDraggingFile:!1,loading:{addingConcept:!1,loadingConcepts:!1,savingSearch:!1},errors:{addingConcept:!1,loadingConcepts:!1},filters:{entityType:null,publisher:null,sortBy:"created_at",taskStatusId:null},form:{file:null},modals:{addConcept:!1},conceptSearchQueries:[{id:"filter-test-1",list_type:"concept",name:"test",search_query:"test"}]}},mounted(){},computed:{...D(["assetMap","currentProduction","displayedConcepts","isDarkTheme","isTVShow","personMap","selectedConcepts","taskStatusMap"]),publishers(){const e=new Map;return this.filteredConcepts.forEach(s=>{const a=s.created_by;if(!e.has(a)){const p=this.personMap.get(a);p&&e.set(a,p)}}),q([...e.values()])},currentTask(){var e,s;return(s=(e=this.currentConcept)==null?void 0:e.tasks)==null?void 0:s[0]},currentConcept(){return this.selectedConcepts.size===1?this.selectedConcepts.values().next().value:null},entityTypeOptions(){const e={label:this.$t("main.all"),value:null},s=["assets","shots","sequences","edits","episodes"].map(a=>({label:this.$t(`${a}.title`),value:a}));return[e].concat(s)},sortByOptions(){return["created_at","updated_at","last_comment_date"].map(e=>({label:e,value:e}))},filteredConcepts(){let e=[...this.displayedConcepts];return this.filters.taskStatusId&&(e=e.filter(s=>s.tasks[0].task_status_id===this.filters.taskStatusId)),this.filters.publisher&&(e=e.filter(s=>s.created_by===this.filters.publisher.id)),this.filters.entityType&&(e=e.filter(s=>{var a;return(a=s.tags)==null?void 0:a.some(p=>p.type===this.filters.entityType)})),e.sort(G.firstBy(this.filters.sortBy,-1).thenBy("created_at",-1))},searchField(){return this.$refs["search-field"]},taskStatusList(){const e={id:null,color:"#999",name:this.$t("main.all"),short_name:this.$t("main.all")},s=U(Array.from(this.taskStatusMap.values()).filter(a=>a.for_concept));return[e].concat(s)}},methods:{...F(["addSelectedConcepts","addSelectedTask","clearSelectedConcepts","clearSelectedTasks","loadAssets","loadConcepts","newConcepts","setCurrentEpisode"]),setConceptSearch:e=>Promise.resolve(),saveConceptSearch:e=>Promise.resolve(),removeConceptSearch:e=>Promise.resolve(),setSearch(e){this.searchField.setValue(e)},onSearchChange(){const e=this.searchField.getValue()||"";(e==null?void 0:e.length)!==1&&this.setConceptSearch(e),this.setSearchInUrl()},saveSearchQuery(e){this.loading.savingSearch||(this.loading.savingSearch=!0,this.saveConceptSearch(e).catch(console.error).finally(()=>{this.loading.savingSearch=!1}))},removeSearchQuery(e){this.removeConceptSearch(e).catch(s=>{s&&console.error(s)})},async refreshConcepts(){this.loading.loadingConcepts=!0;try{this.isTVShow&&this.setCurrentEpisode("all"),await this.loadAssets({all:!0}),await this.loadConcepts()}catch(e){console.error(e),this.errors.loadingConcepts=!0}finally{this.loading.loadingConcepts=!1}},isSelected(e){return this.selectedConcepts.has(e.id)},onSelectConcept(e,s=!1){const a=s?new Map(this.selectedConcepts):new Map;s&&this.isSelected(e)||!s&&e===this.currentConcept?a.delete(e.id):a.set(e.id,e),this.clearSelectedConcepts(),this.addSelectedConcepts(a),this.clearSelectedTasks(),this.currentTask&&this.addSelectedTask(this.currentTask)},openAddConceptModal(){this.modals.addConcept=!0},closeAddConceptModal(){this.modals.addConcept=!1},async confirmAddConceptModal(e){this.loading.addingConcept=!0;try{await this.newConcepts(e),this.closeAddConceptModal()}catch(s){console.error(s),this.errors.addingConcept=!0}finally{this.loading.addingConcept=!1}},reset(){this.clearSelectedConcepts(),this.clearSelectedTasks(),this.refreshConcepts()},onFileDrop(e){this.pauseEvent(e);const s=e.dataTransfer.files;this.modals.addConcept=!0,this.isDraggingFile=!1,this.$nextTick(()=>{this.$refs["add-preview-modal"].setFiles(s)})},onFileDragover(e){this.pauseEvent(e),this.isDraggingFile=!0},onFileDragLeave(){this.isDraggingFile=!1}},watch:{currentProduction:{immediate:!0,handler(){var s;const e=this.$route.params.production_id;((s=this.currentProduction)==null?void 0:s.id)===e&&this.reset()}}},head(){return{title:`${this.currentProduction.name} | ${this.$t("concepts.title")} - Kitsu`}}},R={class:"fixed-page columns"},X={class:"column main-column"},j={class:"concepts page"},W={class:"page-header"},Y={class:"filters"},Z={class:"field"},$={class:"label"},ee={class:"items"},se=["onClick"],te={key:2,class:"has-text-centered mb1 mt1 empty-concepts"},oe={class:"footer mb2"},ae={class:"column side-column"};function ne(e,s,a,p,n,t){var h;i("search-field");const C=i("combobox-status"),g=i("people-field"),_=i("combobox"),y=i("table-info"),v=i("concept-card"),S=i("button-simple"),b=i("add-preview-modal"),k=i("task-info");return r(),d("div",R,[l("div",X,[l("div",j,[l("div",W,[l("div",Y,[u("",!0),c(C,{label:e.$t("main.status"),"task-status-list":t.taskStatusList,modelValue:n.filters.taskStatusId,"onUpdate:modelValue":s[0]||(s[0]=o=>n.filters.taskStatusId=o)},null,8,["label","task-status-list","modelValue"]),l("span",Z,[l("label",$,f(e.$t("concepts.fields.publisher")),1),c(g,{small:"",people:t.publishers,modelValue:n.filters.publisher,"onUpdate:modelValue":s[1]||(s[1]=o=>n.filters.publisher=o)},null,8,["people","modelValue"])]),u("",!0),c(_,{class:"right",label:e.$t("main.sorted_by"),"locale-key-prefix":"concepts.fields.",options:t.sortByOptions,modelValue:n.filters.sortBy,"onUpdate:modelValue":s[3]||(s[3]=o=>n.filters.sortBy=o)},null,8,["label","options","modelValue"])])]),n.loading.loadingConcepts||n.errors.loadingConcepts?(r(),N(y,{key:0,"is-loading":n.loading.loadingConcepts,"is-error":n.errors.loadingConcepts},null,8,["is-loading","is-error"])):(h=t.filteredConcepts)!=null&&h.length?(r(),d("div",{key:1,ref:"concept-list",class:"concept-list pb1",onDragover:s[7]||(s[7]=(...o)=>t.onFileDragover&&t.onFileDragover(...o))},[n.isDraggingFile?(r(),d("div",{key:0,class:"drop-mask",onDrop:s[4]||(s[4]=(...o)=>t.onFileDrop&&t.onFileDrop(...o)),onDragover:s[5]||(s[5]=(...o)=>t.onFileDragover&&t.onFileDragover(...o)),onDragleave:s[6]||(s[6]=(...o)=>t.onFileDragLeave&&t.onFileDragLeave(...o))}," Drop new concepts ",32)):u("",!0),l("ul",ee,[(r(!0),d(O,null,Q(t.filteredConcepts,o=>(r(),d("li",{class:K(["item",{"selected-item":t.isSelected(o)}]),key:o.id,onClick:m=>t.onSelectConcept(o,m.ctrlKey||m.metaKey)},[c(v,{concept:o},null,8,["concept"])],10,se))),128))])],544)):(r(),d("div",te,[l("strong",null,f(e.$t("concepts.empty")),1)])),l("div",oe,[c(S,{class:"upload-button",disabled:n.loading.loadingConcepts,text:e.$t("concepts.add_new_concept"),onClick:t.openAddConceptModal},null,8,["disabled","text","onClick"])])])]),c(b,{ref:"add-preview-modal",active:n.modals.addConcept,extensions:n.imgExtensions,"is-concept":"","is-error":n.errors.addingConcept,"is-loading":n.loading.addingConcept,message:"",onCancel:t.closeAddConceptModal,onConfirm:t.confirmAddConceptModal},null,8,["active","extensions","is-error","is-loading","onCancel","onConfirm"]),l("div",ae,[c(k,{"entity-type":"Concept",task:t.currentTask,"with-actions":""},null,8,["task"])])])}const re=T(J,[["render",ne],["__scopeId","data-v-89b59319"]]);export{re as default};
//# sourceMappingURL=Concepts-CSTCnlTj.js.map
