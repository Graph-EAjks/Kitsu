import{L as c,N as d,B as p,k as h,c as u,O as f,Q as C,U as m,z as g,V as y,T as _,e as k,m as S,s as n,W as v,h as b,X as T,n as w}from"./index-uoRB9nkr.js";const M={name:"concepts",mixins:[c],components:{AddPreviewModal:d,ButtonSimple:p,Combobox:h,ComboboxStatus:u,EntityPreview:f,PeopleAvatar:C,PeopleField:m,SearchField:g,SearchQueryList:y,TableInfo:_,TaskInfo:k},data(){return{loading:{addingConcept:!1,loadingConcepts:!1,savingSearch:!1},errors:{addingConcept:!1,loadingConcepts:!1},filters:{entityType:null,publisher:null,sortBy:"created_at",taskStatusId:null},form:{file:null},modals:{addConcept:!1},conceptSearchQueries:[{id:"filter-test-1",list_type:"concept",name:"test",search_query:"test"}]}},mounted(){},computed:{...S(["assetMap","currentProduction","displayedConcepts","isDarkTheme","isTVShow","personMap","selectedConcepts","taskStatusMap"]),publishers(){const e=new Map;return this.filteredConcepts.forEach(t=>{const s=t.created_by;if(!e.has(s)){const i=this.personMap.get(s);i&&e.set(s,i)}}),n([...e.values()])},currentTask(){var e,t;return(t=(e=this.currentConcept)==null?void 0:e.tasks)==null?void 0:t[0]},currentConcept(){return this.selectedConcepts.size===1?this.selectedConcepts.values().next().value:null},entityTypeOptions(){const e={label:this.$t("main.all"),value:null},t=["assets","shots","sequences","edits","episodes"].map(s=>({label:this.$t(`${s}.title`),value:s}));return[e].concat(t)},sortByOptions(){return["created_at","updated_at","last_comment_date"].map(e=>({label:e,value:e}))},filteredConcepts(){let e=[...this.displayedConcepts];return this.filters.taskStatusId&&(e=e.filter(t=>t.tasks[0].task_status_id===this.filters.taskStatusId)),this.filters.publisher&&(e=e.filter(t=>t.created_by===this.filters.publisher.id)),this.filters.entityType&&(e=e.filter(t=>{var s;return(s=t.tags)==null?void 0:s.some(i=>i.type===this.filters.entityType)})),e.sort(v.firstBy(this.filters.sortBy,-1).thenBy("created_at",-1))},searchField(){return this.$refs["search-field"]},taskStatusList(){const e={id:null,color:"#999",name:this.$t("main.all"),short_name:this.$t("main.all")},t=n(Array.from(this.taskStatusMap.values()).filter(s=>s.for_concept));return[e].concat(t)}},methods:{...b(["addSelectedConcepts","addSelectedTask","clearSelectedConcepts","clearSelectedTasks","loadAssets","loadConcepts","newConcepts","setCurrentEpisode"]),setConceptSearch:e=>Promise.resolve(),saveConceptSearch:e=>Promise.resolve(),removeConceptSearch:e=>Promise.resolve(),setSearch(e){this.searchField.setValue(e)},onSearchChange(){const e=this.searchField.getValue()||"";(e==null?void 0:e.length)!==1&&this.setConceptSearch(e),this.setSearchInUrl()},saveSearchQuery(e){this.loading.savingSearch||(this.loading.savingSearch=!0,this.saveConceptSearch(e).catch(console.error).finally(()=>{this.loading.savingSearch=!1}))},removeSearchQuery(e){this.removeConceptSearch(e).catch(t=>{t&&console.error(t)})},async refreshConcepts(){this.loading.loadingConcepts=!0;try{this.setCurrentEpisode("all"),await this.loadAssets(!0),await this.loadConcepts()}catch(e){console.error(e),this.errors.loadingConcepts=!0}finally{this.loading.loadingConcepts=!1}},entityPath(e,t){const s=this.isTVShow?e.episode_id||"main":null;return T(e.id,this.currentProduction.id,t,s,{section:"concepts"})},getLinkedEntities(e){return e.entity_concept_links.map(t=>this.assetMap.get(t)).filter(Boolean)},getTaskStatus(e){return this.taskStatusMap.get(e.tasks[0].task_status_id)},hasTask(e){var t;return(t=e.tasks)==null?void 0:t.length},isSelected(e){return this.selectedConcepts.has(e.id)},onSelectConcept(e,t=!1){const s=t?new Map(this.selectedConcepts):new Map;t&&this.isSelected(e)||!t&&e===this.currentConcept?s.delete(e.id):s.set(e.id,e),this.clearSelectedConcepts(),this.addSelectedConcepts(s),this.clearSelectedTasks(),this.currentTask&&this.addSelectedTask(this.currentTask)},openAddConceptModal(){this.modals.addConcept=!0},closeAddConceptModal(){this.modals.addConcept=!1},async confirmAddConceptModal(e){this.loading.addingConcept=!0;try{await this.newConcepts(e),this.closeAddConceptModal()}catch(t){console.error(t),this.errors.addingConcept=!0}finally{this.loading.addingConcept=!1}},reset(){this.clearSelectedConcepts(),this.clearSelectedTasks(),this.refreshConcepts()}},watch:{currentProduction:{immediate:!0,handler(){var t;const e=this.$route.params.production_id;((t=this.currentProduction)==null?void 0:t.id)===e&&this.reset()}}},metaInfo(){return{title:`${this.$t("concepts.title")} - Kitsu`}}};var $=function(){var i,r;var t=this,s=t._self._c;return s("div",{staticClass:"fixed-page columns"},[s("div",{staticClass:"column main-column"},[s("div",{staticClass:"concepts page"},[s("div",{staticClass:"page-header"},[s("div",{staticClass:"filters"},[t._e(),s("combobox-status",{attrs:{label:t.$t("main.status"),"task-status-list":t.taskStatusList},model:{value:t.filters.taskStatusId,callback:function(a){t.$set(t.filters,"taskStatusId",a)},expression:"filters.taskStatusId"}}),s("span",{staticClass:"field small"},[s("label",{staticClass:"label"},[t._v(" "+t._s(t.$t("concepts.fields.publisher"))+" ")]),s("people-field",{attrs:{big:!0,people:t.publishers},model:{value:t.filters.publisher,callback:function(a){t.$set(t.filters,"publisher",a)},expression:"filters.publisher"}})],1),t._e(),s("combobox",{staticClass:"right",attrs:{label:t.$t("main.sorted_by"),"locale-key-prefix":"concepts.fields.",options:t.sortByOptions},model:{value:t.filters.sortBy,callback:function(a){t.$set(t.filters,"sortBy",a)},expression:"filters.sortBy"}})],1),t._e()]),s("h2",{staticClass:"mt0"},[t._v(" "+t._s(t.$t("concepts.title"))+" ("+t._s(((i=t.filteredConcepts)==null?void 0:i.length)||0)+") ")]),t.loading.loadingConcepts||t.errors.loadingConcepts?s("table-info",{attrs:{"is-loading":t.loading.loadingConcepts,"is-error":t.errors.loadingConcepts}}):(r=t.filteredConcepts)!=null&&r.length?s("div",{staticClass:"concept-list pb1"},[s("ul",{staticClass:"items"},t._l(t.filteredConcepts,function(a){return s("li",{key:a.id,staticClass:"item",class:{"selected-item":t.isSelected(a)},on:{click:function(o){return t.onSelectConcept(a,o.ctrlKey||o.metaKey)}}},[s("entity-preview",{attrs:{"empty-height":200,"empty-width":300,height:200,width:300,entity:a,"is-rounded-top-border":""}}),s("div",{staticClass:"description"},[s("ul",{staticClass:"tags"},t._l(t.getLinkedEntities(a),function(o){return s("li",{key:o.id,staticClass:"tag",on:{click:function(l){l.stopPropagation()}}},[s("router-link",{attrs:{to:t.entityPath(o,"asset")}},[t._v(" "+t._s(o.name)+" ")])],1)}),0),t.hasTask(a)?s("div",{staticClass:"status"},[s("span",{staticClass:"tag",style:{backgroundColor:t.getTaskStatus(a).color,color:"white"}},[t._v(" "+t._s(t.getTaskStatus(a).short_name)+" ")]),s("people-avatar",{attrs:{person:t.personMap.get(a.created_by),size:25,"font-size":14}})],1):t._e()])],1)}),0)]):s("div",[t._v(" "+t._s(t.$t("concepts.empty"))+" ")]),s("footer",{staticClass:"footer mt2"},[s("button-simple",{attrs:{disabled:t.loading.loadingConcepts,text:t.$t("concepts.add_new_concept")},on:{click:t.openAddConceptModal}})],1)],1)]),s("add-preview-modal",{ref:"add-preview-modal",attrs:{active:t.modals.addConcept,"is-concept":"","is-error":t.errors.addingConcept,"is-loading":t.loading.addingConcept,message:""},on:{cancel:t.closeAddConceptModal,confirm:t.confirmAddConceptModal}}),t.selectedConcepts.size?s("div",{staticClass:"column side-column"},[s("task-info",{attrs:{"entity-type":"Concept",task:t.currentTask,"with-actions":""}})],1):t._e()],1)},x=[],P=w(M,$,x,!1,null,"27562eb3",null,null);const I=P.exports;export{I as default};
//# sourceMappingURL=Concepts-N0j9bsgC.js.map
