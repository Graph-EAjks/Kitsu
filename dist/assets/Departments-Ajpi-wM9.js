import{R as d,T as l,m as i,g as r,n,h as c,K as m,j as p,M as f,k as h,o as u,p as v,q as _}from"./index-5rY6ovbw.js";import{L as b}from"./ListPageHeader-z-96cVcY.js";import{R as $}from"./RouteTabs-JN0_k7vM.js";const T={name:"department-list",props:["entries","isLoading","isError"],data(){return{}},components:{RowActionsCell:d,TableInfo:l},computed:{...i([])},methods:{...r([])}};var g=function(){var e=this,t=e._self._c;return t("div",{staticClass:"data-list"},[t("div",{staticClass:"datatable-wrapper"},[t("table",{staticClass:"datatable"},[t("thead",{staticClass:"datatable-head"},[t("tr",[t("th",{staticClass:"name",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("departments.fields.name"))+" ")]),t("th",{attrs:{scope:"col"}},[e._v(e._s(e.$t("departments.fields.color")))]),t("th",{staticClass:"actions",attrs:{scope:"col"}})])]),e.entries.length>0?t("tbody",{staticClass:"datatable-body"},e._l(e.entries,function(a){return t("tr",{key:a.id,staticClass:"datatable-row"},[t("td",{staticClass:"name"},[e._v(" "+e._s(a.name)+" ")]),t("td",{staticClass:"color"},[t("div",[t("span",{style:{background:a.color}})])]),t("row-actions-cell",{attrs:{"entry-id":a.id},on:{"edit-clicked":function(o){return e.$emit("edit-clicked",a)},"delete-clicked":function(o){return e.$emit("delete-clicked",a)}}})],1)}),0):e._e()])]),t("table-info",{attrs:{"is-loading":e.isLoading,"is-error":e.isError}}),t("p",{staticClass:"has-text-centered nb-asset-types"},[e._v(" "+e._s(e.entries.length)+" "+e._s(e.$tc("departments.number",e.entries.length))+" ")])],1)},C=[],E=n(T,g,C,!1,null,"d23abb3f",null,null);const x=E.exports,D={name:"edit-departments-modal",mixins:[c],components:{ColorField:m,ComboboxBoolean:p,ModalFooter:f,TextField:h},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},departmentToEdit:{type:Object,default:()=>{}}},data(){return{form:{name:"",color:"",id:null}}},computed:{...i(["assetTypes","assetTypeStatusOptions"]),isEditing(){return this.departmentToEdit&&this.departmentToEdit.id}},methods:{...r([]),runConfirmation(){this.$emit("confirm",this.form)}},watch:{active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)},departmentToEdit(){this.isEditing?(this.form.name=this.departmentToEdit.name,this.form.color=this.departmentToEdit.color,this.form.id=this.departmentToEdit.id,this.form.archived=this.departmentToEdit.archive):this.form={name:"",color:"",id:null,archived:String(this.departmentToEdit.archive===!0)}}}};var k=function(){var e=this,t=e._self._c;return t("div",{class:{modal:!0,"is-active":e.active}},[t("div",{staticClass:"modal-background",on:{click:function(a){return e.$emit("cancel")}}}),t("div",{staticClass:"modal-content"},[t("div",{staticClass:"box"},[e.departmentToEdit&&e.departmentToEdit.id?t("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("departments.edit_title"))+" "+e._s(e.departmentToEdit.name)+" ")]):t("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("departments.new_departments"))+" ")]),t("form",{on:{submit:function(a){a.preventDefault()}}},[t("text-field",{directives:[{name:"focus",rawName:"v-focus"}],ref:"nameField",attrs:{label:e.$t("departments.fields.name"),maxlength:30},model:{value:e.form.name,callback:function(a){e.$set(e.form,"name",a)},expression:"form.name"}}),t("color-field",{ref:"colorField",attrs:{label:e.$t("departments.fields.color")},model:{value:e.form.color,callback:function(a){e.$set(e.form,"color",a)},expression:"form.color"}}),e.isEditing?t("combobox-boolean",{attrs:{label:e.$t("main.archived")},on:{enter:e.runConfirmation},model:{value:e.form.archived,callback:function(a){e.$set(e.form,"archived",a)},expression:"form.archived"}}):e._e()],1),t("modal-footer",{attrs:{"error-text":e.$t("departments.create_error"),"is-error":e.isError,"is-loading":e.isLoading},on:{confirm:e.runConfirmation,cancel:function(a){return e.$emit("cancel")}}})],1)])])},w=[],y=n(D,k,w,!1,null,"99fdd9fe",null,null);const F=y.exports,L={name:"departments",components:{DeleteModal:u,DepartmentList:x,EditDepartmentsModal:F,ListPageHeader:b,RouteTabs:$},data(){return{activeTab:"active",departmentToEdit:null,departmentToDelete:null,errors:{departments:!1,edit:!1,del:!1},loading:{departments:!1,edit:!1,del:!1},modals:{del:!1,edit:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},mounted(){this.activeTab=this.$route.query.tab||"active",this.loading.departments=!0,this.errors.departments=!1,this.loadDepartments().then(()=>{this.loading.departments=!1,this.errors.departments=!1}).catch(()=>{this.loading.departments=!1,this.errors.departments=!0})},computed:{...i(["departments","archivedDepartments"]),isActiveTab(){return this.activeTab==="active"},departmentList(){return this.isActiveTab?this.departments:this.archivedDepartments},deleteText(){return this.departmentToDelete?this.$t("departments.delete_text",{name:this.departmentToDelete.name}):""}},methods:{...r(["deleteDepartment","loadDepartments","newDepartement"]),onExportClicked(){const s=v.slugify(this.$t("departments.title")),t=[[this.$t("main.type"),this.$t("departments.fields.name"),this.$t("departments.fields.color")]].concat(this.departments.map(a=>[a.type,a.name,a.color]));_.buildCsvFile(s,t)},onNewClicked(){this.departmentToEdit={name:"",color:"#999999"},this.modals.edit=!0},onEditClicked(s){this.departmentToEdit=s,this.modals.edit=!0},confirmEditDepartment(s){let e="newDepartement";this.departmentToEdit&&this.departmentToEdit.id&&(e="editDepartement",s.id=this.departmentToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(e,s).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(()=>{this.loading.edit=!1,this.errors.edit=!0})},onDeleteClicked(s){this.departmentToDelete=s,this.modals.del=!0},async confirmDeleteDepartment(){this.loading.del=!0,this.errors.del=!1;try{await this.deleteDepartment(this.departmentToDelete),this.loading.del=!1,this.modals.del=!1}catch{this.loading.del=!1,this.errors.del=!0}}},watch:{$route(){this.activeTab=this.$route.query.tab}},metaInfo(){return{title:`${this.$t("departments.title")} - Kitsu`}}};var R=function(){var e=this,t=e._self._c;return t("div",{staticClass:"departments page fixed-page"},[t("list-page-header",{attrs:{title:e.$t("departments.title"),"new-entry-label":e.$t("departments.new_departments"),"is-exportable":e.isActiveTab},on:{"export-clicked":e.onExportClicked,"new-clicked":e.onNewClicked}}),t("route-tabs",{staticClass:"mt2",attrs:{"active-tab":e.activeTab,tabs:e.tabs,"route-name":"departments"}}),t("department-list",{staticClass:"department-list",attrs:{entries:e.departmentList,"is-loading":e.loading.departments,"is-error":e.errors.departments},on:{"edit-clicked":e.onEditClicked,"delete-clicked":e.onDeleteClicked}}),t("edit-departments-modal",{attrs:{active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"department-to-edit":e.departmentToEdit},on:{cancel:function(a){e.modals.edit=!1},confirm:e.confirmEditDepartment}}),t("delete-modal",{attrs:{active:e.modals.del,"is-loading":e.loading.del,"is-error":e.errors.del,text:e.deleteText,"error-text":e.$t("departments.delete_error")},on:{cancel:function(a){e.modals.del=!1},confirm:e.confirmDeleteDepartment}})],1)},A=[],M=n(L,R,A,!1,null,"9cef2f1a",null,null);const j=M.exports;export{j as default};
//# sourceMappingURL=Departments-Ajpi-wM9.js.map
