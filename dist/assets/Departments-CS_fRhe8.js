import{n as i,y as n,T as o,A as d,ak as l,G as c,M as m,I as p,J as f,m as h,c as u,K as v,L as _}from"./index-B3SUarIw.js";import{L as b}from"./ListPageHeader-CVR6H3Or.js";import{R as $}from"./RouteTabs-BUSOctRD.js";const g={name:"department-list",props:["entries","isLoading","isError"],components:{RowActionsCell:n,TableInfo:o}};var C=function(){var e=this,t=e._self._c;return t("div",{staticClass:"data-list"},[t("div",{staticClass:"datatable-wrapper"},[t("table",{staticClass:"datatable"},[t("thead",{staticClass:"datatable-head"},[t("tr",[t("th",{staticClass:"name",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("departments.fields.name"))+" ")]),t("th",{attrs:{scope:"col"}},[e._v(e._s(e.$t("departments.fields.color")))]),t("th",{staticClass:"actions",attrs:{scope:"col"}})])]),e.entries.length>0?t("tbody",{staticClass:"datatable-body"},e._l(e.entries,function(a){return t("tr",{key:a.id,staticClass:"datatable-row"},[t("td",{staticClass:"name"},[e._v(" "+e._s(a.name)+" ")]),t("td",{staticClass:"color"},[t("div",[t("span",{style:{background:a.color}})])]),t("row-actions-cell",{attrs:{"entry-id":a.id},on:{"edit-clicked":function(r){return e.$emit("edit-clicked",a)},"delete-clicked":function(r){return e.$emit("delete-clicked",a)}}})],1)}),0):e._e()])]),t("table-info",{attrs:{"is-loading":e.isLoading,"is-error":e.isError}}),t("p",{staticClass:"has-text-centered nb-asset-types"},[e._v(" "+e._s(e.entries.length)+" "+e._s(e.$tc("departments.number",e.entries.length))+" ")])],1)},T=[],E=i(g,C,T,!1,null,"a5fd9f89");const x=E.exports,D={name:"edit-departments-modal",mixins:[d],components:{ColorField:l,ComboboxBoolean:c,ModalFooter:m,TextField:p},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},departmentToEdit:{type:Object,default:()=>{}}},data(){return{form:{id:null,name:"",color:"",archived:"false"}}},computed:{isEditing(){var s;return(s=this.departmentToEdit)==null?void 0:s.id}},methods:{runConfirmation(){this.$emit("confirm",this.form)}},watch:{active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)},departmentToEdit(){this.isEditing?this.form={id:this.departmentToEdit.id,name:this.departmentToEdit.name,color:this.departmentToEdit.color,archived:String(this.departmentToEdit.archived===!0)}:this.form={id:null,name:"",color:"",archived:"false"}}}};var k=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal",class:{"is-active":e.active}},[t("div",{staticClass:"modal-background",on:{click:function(a){return e.$emit("cancel")}}}),t("div",{staticClass:"modal-content"},[t("div",{staticClass:"box"},[e.isEditing?t("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("departments.edit_title"))+" "+e._s(e.departmentToEdit.name)+" ")]):t("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("departments.new_departments"))+" ")]),t("form",{on:{submit:function(a){a.preventDefault()}}},[t("text-field",{directives:[{name:"focus",rawName:"v-focus"}],ref:"nameField",attrs:{label:e.$t("departments.fields.name"),maxlength:30},model:{value:e.form.name,callback:function(a){e.$set(e.form,"name",a)},expression:"form.name"}}),t("color-field",{attrs:{label:e.$t("departments.fields.color")},model:{value:e.form.color,callback:function(a){e.$set(e.form,"color",a)},expression:"form.color"}}),e.isEditing?t("combobox-boolean",{attrs:{label:e.$t("main.archived")},on:{enter:e.runConfirmation},model:{value:e.form.archived,callback:function(a){e.$set(e.form,"archived",a)},expression:"form.archived"}}):e._e()],1),t("modal-footer",{attrs:{"error-text":e.$t("departments.create_error"),"is-error":e.isError,"is-loading":e.isLoading},on:{confirm:e.runConfirmation,cancel:function(a){return e.$emit("cancel")}}})],1)])])},w=[],y=i(D,k,w,!1,null,"211bf7a8");const L=y.exports,F={name:"departments",components:{DeleteModal:f,DepartmentList:x,EditDepartmentsModal:L,ListPageHeader:b,RouteTabs:$},data(){return{activeTab:"active",departmentToEdit:null,departmentToDelete:null,errors:{departments:!1,edit:!1,del:!1},loading:{departments:!1,edit:!1,del:!1},modals:{del:!1,edit:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},async mounted(){this.activeTab=this.$route.query.tab||"active",this.loading.departments=!0,this.errors.departments=!1;try{await this.loadDepartments()}catch(s){console.log(s),this.errors.departments=!0}this.loading.departments=!1},computed:{...h(["departments","archivedDepartments"]),isActiveTab(){return this.activeTab==="active"},departmentList(){return this.isActiveTab?this.departments:this.archivedDepartments},deleteText(){return this.departmentToDelete?this.$t("departments.delete_text",{name:this.departmentToDelete.name}):""}},methods:{...u(["deleteDepartment","loadDepartments","newDepartment"]),onExportClicked(){const s=v.slugify(this.$t("departments.title")),t=[[this.$t("main.type"),this.$t("departments.fields.name"),this.$t("departments.fields.color")]].concat(this.departments.map(a=>[a.type,a.name,a.color]));_.buildCsvFile(s,t)},onNewClicked(){this.departmentToEdit={name:"",color:"#999999"},this.modals.edit=!0},onEditClicked(s){this.departmentToEdit=s,this.modals.edit=!0},confirmEditDepartment(s){let e="newDepartment";this.departmentToEdit&&this.departmentToEdit.id&&(e="editDepartment",s.id=this.departmentToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(e,s).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(()=>{this.loading.edit=!1,this.errors.edit=!0})},onDeleteClicked(s){this.departmentToDelete=s,this.modals.del=!0},async confirmDeleteDepartment(){this.loading.del=!0,this.errors.del=!1;try{await this.deleteDepartment(this.departmentToDelete),this.loading.del=!1,this.modals.del=!1}catch{this.loading.del=!1,this.errors.del=!0}}},watch:{$route(){this.activeTab=this.$route.query.tab}},metaInfo(){return{title:`${this.$t("departments.title")} - Kitsu`}}};var A=function(){var e=this,t=e._self._c;return t("div",{staticClass:"departments page fixed-page"},[t("list-page-header",{attrs:{title:e.$t("departments.title"),"new-entry-label":e.$t("departments.new_departments"),"is-exportable":e.isActiveTab},on:{"export-clicked":e.onExportClicked,"new-clicked":e.onNewClicked}}),t("route-tabs",{staticClass:"mt2",attrs:{"active-tab":e.activeTab,tabs:e.tabs,"route-name":"departments"}}),t("department-list",{staticClass:"department-list",attrs:{entries:e.departmentList,"is-loading":e.loading.departments,"is-error":e.errors.departments},on:{"edit-clicked":e.onEditClicked,"delete-clicked":e.onDeleteClicked}}),t("edit-departments-modal",{attrs:{active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"department-to-edit":e.departmentToEdit},on:{cancel:function(a){e.modals.edit=!1},confirm:e.confirmEditDepartment}}),t("delete-modal",{attrs:{active:e.modals.del,"is-loading":e.loading.del,"is-error":e.errors.del,text:e.deleteText,"error-text":e.$t("departments.delete_error")},on:{cancel:function(a){e.modals.del=!1},confirm:e.confirmDeleteDepartment}})],1)},R=[],M=i(F,A,R,!1,null,"766a39b5");const q=M.exports;export{q as default};
//# sourceMappingURL=Departments-CS_fRhe8.js.map
