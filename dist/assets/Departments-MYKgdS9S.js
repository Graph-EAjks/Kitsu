import{_ as v,a3 as C,T as E,r as n,o as m,c as p,e as s,t as c,F as k,g as T,G as D,f as l,d as g,a6 as y,aH as w,a7 as x,a8 as $,aa as V,k as L,ab as B,n as F,l as N,p as A,ac as M,m as I,b as S,ad as H,ae as R}from"./index-CVkAUrXu.js";import{L as U}from"./ListPageHeader-CdkCbe7M.js";import{R as q}from"./RouteTabs-D1v1mhJr.js";const z={name:"department-list",props:["entries","isLoading","isError"],components:{RowActionsCell:C,TableInfo:E},emits:["delete-clicked","edit-clicked"]},G={class:"data-list"},j={class:"datatable-wrapper"},K={class:"datatable"},O={class:"datatable-head"},P={scope:"col",class:"name"},J={scope:"col"},Q={key:0,class:"datatable-body"},W={class:"name"},X={class:"color"},Y={class:"has-text-centered nb-asset-types"};function Z(e,t,o,h,i,a){const f=n("row-actions-cell"),u=n("table-info");return m(),p("div",G,[s("div",j,[s("table",K,[s("thead",O,[s("tr",null,[s("th",P,c(e.$t("departments.fields.name")),1),s("th",J,c(e.$t("departments.fields.color")),1),t[0]||(t[0]=s("th",{scope:"col",class:"actions"},null,-1))])]),o.entries.length>0?(m(),p("tbody",Q,[(m(!0),p(k,null,T(o.entries,r=>(m(),p("tr",{class:"datatable-row",key:r.id},[s("td",W,c(r.name),1),s("td",X,[s("div",null,[s("span",{style:D({background:r.color})},null,4)])]),l(f,{"entry-id":r.id,onEditClicked:_=>e.$emit("edit-clicked",r),onDeleteClicked:_=>e.$emit("delete-clicked",r)},null,8,["entry-id","onEditClicked","onDeleteClicked"])]))),128))])):g("",!0)])]),l(u,{"is-loading":o.isLoading,"is-error":o.isError},null,8,["is-loading","is-error"]),s("p",Y,c(o.entries.length)+" "+c(e.$tc("departments.number",o.entries.length)),1)])}const ee=v(z,[["render",Z],["__scopeId","data-v-939447b2"]]),te={name:"edit-departments-modal",mixins:[y],components:{ColorField:w,ComboboxBoolean:x,ModalFooter:$,TextField:V},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},departmentToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{id:null,name:"",color:"",archived:"false"}}},computed:{isEditing(){var e;return(e=this.departmentToEdit)==null?void 0:e.id}},methods:{runConfirmation(){this.$emit("confirm",this.form)}},watch:{active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)},departmentToEdit(){this.isEditing?this.form={id:this.departmentToEdit.id,name:this.departmentToEdit.name,color:this.departmentToEdit.color,archived:String(this.departmentToEdit.archived===!0)}:this.form={id:null,name:"",color:"",archived:"false"}}}},ie={class:"modal-content"},se={class:"box"},ae={key:0,class:"title"},oe={key:1,class:"title"};function ne(e,t,o,h,i,a){const f=n("text-field"),u=n("color-field"),r=n("combobox-boolean"),_=n("modal-footer"),b=L("focus");return m(),p("div",{class:A(["modal",{"is-active":o.active}])},[s("div",{class:"modal-background",onClick:t[0]||(t[0]=d=>e.$emit("cancel"))}),s("div",ie,[s("div",se,[a.isEditing?(m(),p("h1",ae,c(e.$t("departments.edit_title"))+" "+c(o.departmentToEdit.name),1)):(m(),p("h1",oe,c(e.$t("departments.new_departments")),1)),s("form",{onSubmit:t[4]||(t[4]=B(()=>{},["prevent"]))},[F(l(f,{ref:"nameField",label:e.$t("departments.fields.name"),maxlength:30,modelValue:i.form.name,"onUpdate:modelValue":t[1]||(t[1]=d=>i.form.name=d)},null,8,["label","modelValue"]),[[b]]),l(u,{label:e.$t("departments.fields.color"),modelValue:i.form.color,"onUpdate:modelValue":t[2]||(t[2]=d=>i.form.color=d)},null,8,["label","modelValue"]),a.isEditing?(m(),N(r,{key:0,label:e.$t("main.archived"),onEnter:a.runConfirmation,modelValue:i.form.archived,"onUpdate:modelValue":t[3]||(t[3]=d=>i.form.archived=d)},null,8,["label","onEnter","modelValue"])):g("",!0)],32),l(_,{"error-text":e.$t("departments.create_error"),"is-error":o.isError,"is-loading":o.isLoading,onConfirm:a.runConfirmation,onCancel:t[5]||(t[5]=d=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const re=v(te,[["render",ne],["__scopeId","data-v-2977a63b"]]),le={name:"departments",components:{DeleteModal:M,DepartmentList:ee,EditDepartmentsModal:re,ListPageHeader:U,RouteTabs:q},data(){return{activeTab:"active",departmentToEdit:null,departmentToDelete:null,errors:{departments:!1,edit:!1,del:!1},loading:{departments:!1,edit:!1,del:!1},modals:{del:!1,edit:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},async mounted(){this.activeTab=this.$route.query.tab||"active",this.loading.departments=!0,this.errors.departments=!1;try{await this.loadDepartments()}catch(e){console.error(e),this.errors.departments=!0}this.loading.departments=!1},computed:{...I(["departments","archivedDepartments"]),isActiveTab(){return this.activeTab==="active"},departmentList(){return this.isActiveTab?this.departments:this.archivedDepartments},deleteText(){return this.departmentToDelete?this.$t("departments.delete_text",{name:this.departmentToDelete.name}):""}},methods:{...S(["deleteDepartment","loadDepartments","newDepartment"]),onExportClicked(){const e=H.slugify(this.$t("departments.title")),o=[[this.$t("main.type"),this.$t("departments.fields.name"),this.$t("departments.fields.color")]].concat(this.departments.map(h=>[h.type,h.name,h.color]));R.buildCsvFile(e,o)},onNewClicked(){this.departmentToEdit={name:"",color:"#999999"},this.modals.edit=!0},onEditClicked(e){this.departmentToEdit=e,this.modals.edit=!0},confirmEditDepartment(e){let t="newDepartment";this.departmentToEdit&&this.departmentToEdit.id&&(t="editDepartment",e.id=this.departmentToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(t,e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(()=>{this.loading.edit=!1,this.errors.edit=!0})},onDeleteClicked(e){this.departmentToDelete=e,this.modals.del=!0},async confirmDeleteDepartment(){this.loading.del=!0,this.errors.del=!1;try{await this.deleteDepartment(this.departmentToDelete),this.loading.del=!1,this.modals.del=!1}catch{this.loading.del=!1,this.errors.del=!0}}},watch:{$route(){this.activeTab=this.$route.query.tab}},head(){return{title:`${this.$t("departments.title")} - Kitsu`}}},de={class:"departments page fixed-page"};function me(e,t,o,h,i,a){const f=n("list-page-header"),u=n("route-tabs"),r=n("department-list"),_=n("edit-departments-modal"),b=n("delete-modal");return m(),p("div",de,[l(f,{title:e.$t("departments.title"),"new-entry-label":e.$t("departments.new_departments"),"is-exportable":a.isActiveTab,onExportClicked:a.onExportClicked,onNewClicked:a.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),l(u,{class:"mt2","active-tab":i.activeTab,tabs:i.tabs},null,8,["active-tab","tabs"]),l(r,{class:"department-list",entries:a.departmentList,"is-loading":i.loading.departments,"is-error":i.errors.departments,onEditClicked:a.onEditClicked,onDeleteClicked:a.onDeleteClicked},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked"]),l(_,{active:i.modals.edit,"is-loading":i.loading.edit,"is-error":i.errors.edit,"department-to-edit":i.departmentToEdit,onCancel:t[0]||(t[0]=d=>i.modals.edit=!1),onConfirm:a.confirmEditDepartment},null,8,["active","is-loading","is-error","department-to-edit","onConfirm"]),l(b,{active:i.modals.del,"is-loading":i.loading.del,"is-error":i.errors.del,text:a.deleteText,"error-text":e.$t("departments.delete_error"),onCancel:t[1]||(t[1]=d=>i.modals.del=!1),onConfirm:a.confirmDeleteDepartment},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const fe=v(le,[["render",me],["__scopeId","data-v-98717cec"]]);export{fe as default};
//# sourceMappingURL=Departments-MYKgdS9S.js.map
