import{bw as h,C as d,bx as u,by as m,y as p,m as f,b as _,bz as v,bA as x,n as C}from"./index-6ce81c1a.js";import{C as g}from"./ComboboxProduction-c37532b0.js";const o=[12,24,48],b={name:"entity-search",mixins:[],components:{Checkbox:h,Combobox:d,ComboboxProduction:g,EntityPreview:u,SearchIcon:m,Spinner:p},data(){return{isLoading:!1,limit:o[0],limitOptions:o.map(i=>({label:i,value:i})),productionId:"",selectedIndex:0,searchQuery:"",searchFilter:{assets:!0,shots:!0,persons:!1},results:{assets:[],shots:[],persons:[]}}},props:{},mounted(){window.addEventListener("keydown",i=>{i.ctrlKey&&i.altKey&&i.keyCode===70?this.$refs["search-field"]&&this.$refs["search-field"].focus():i.keyCode===40?this.selectNext():i.keyCode===38&&this.selectPrevious()}),this.$route.query.search&&(this.searchQuery=this.$route.query.search),this.searchField.focus()},computed:{...f(["openProductions","productionMap"]),searchField(){return this.$refs["search-field"]},flattenResults(){let i=[];return this.searchFilter.assets&&(i=i.concat(this.results.assets)),this.searchFilter.shots&&(i=i.concat(this.results.shots)),this.searchFilter.persons&&(i=i.concat(this.results.persons)),i},noSearchFilters(){return!this.searchFilter.assets&&!this.searchFilter.shots},productionList(){return[{id:"",name:this.$t("main.all")}].concat([...this.openProductions])}},methods:{..._(["searchData"]),search(){this.isLoading=!0;const i=Object.entries(this.searchFilter).map(([s,t])=>t?s:void 0).filter(Boolean);this.searchData({query:this.searchQuery,limit:this.limit,productionId:this.productionId,index_names:i}).then(s=>{delete s.persons,this.results=s}).catch(console.error).finally(()=>{this.isLoading=!1})},selectPrevious(){this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.flattenResults.length-1),this.scrollToSelection()},selectNext(){this.selectedIndex++,this.selectedIndex>=this.flattenResults.length&&(this.selectedIndex=0),this.scrollToSelection()},scrollToSelection(){const i=this.flattenResults[this.selectedIndex];i&&document.getElementById(`result-link-${i.id}`).scrollIntoView(!1)},selectResultById(i){this.selectedIndex=this.flattenResults.findIndex(s=>s.id===i)},onResultSelected(){const i=this.flattenResults[this.selectedIndex];i&&document.getElementById(`result-link-${i.id}`).click()},clearSearchResult(){this.results={assets:[],shots:[],persons:[]}},entityPath(i,s){const r=this.productionMap.get(i.project_id).production_type==="tvshow";let a=null;return r&&(a=i.episode_id||"main"),v(i.id,i.project_id,s,a)},personPath(i){return x(i.id)},getMatchDetails(i){const s=i.matched_terms.join(", ");return this.searchQuery,this.$t("search.match_details",{target:s})}},watch:{productionId(){this.search()},searchQuery(){this.searchQuery.length?this.$router.push({query:{search:this.searchQuery}}):this.$router.push({query:{}}),this.searchQuery.length>2?this.search():this.clearSearchResult(),this.selectedIndex=0}},metaInfo(){return{title:`${this.$t("search.title")} - Kitsu`}}};var y=function(){var r,a,l,c;var s=this,t=s._self._c;return t("div",{staticClass:"entity-search page"},[t("form",{staticClass:"search-form",on:{submit:function(e){return e.preventDefault(),s.onResultSelected()}}},[t("div",[t("combobox-production",{staticClass:"flexrow-item production-field",attrs:{label:s.$t("main.production"),"production-list":s.productionList},model:{value:s.productionId,callback:function(e){s.productionId=e},expression:"productionId"}})],1),t("div",{staticClass:"search-field"},[t("span",{staticClass:"search-icon"},[t("search-icon",{attrs:{width:"20"}})],1),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:s.searchQuery,expression:"searchQuery",modifiers:{trim:!0}}],ref:"search-field",staticClass:"input",attrs:{placeholder:s.$t("search.placeholder")},domProps:{value:s.searchQuery},on:{input:function(e){e.target.composing||(s.searchQuery=e.target.value.trim())},blur:function(e){return s.$forceUpdate()}}})]),t("div",{staticClass:"search-options pa1 flexrow"},[t("checkbox",{staticClass:"flexrow-item",attrs:{toggle:!0,label:s.$t("assets.title")},on:{change:s.search},model:{value:s.searchFilter.assets,callback:function(e){s.$set(s.searchFilter,"assets",e)},expression:"searchFilter.assets"}}),t("checkbox",{staticClass:"flexrow-item",attrs:{toggle:!0,label:s.$t("shots.title")},on:{change:s.search},model:{value:s.searchFilter.shots,callback:function(e){s.$set(s.searchFilter,"shots",e)},expression:"searchFilter.shots"}}),t("div",{staticClass:"filler"}),t("span",{staticClass:"flexrow-item no-margin"},[s._v(" "+s._s(s.$t("search.limit"))+" ")]),t("combobox",{staticClass:"search-limit flexrow-item",attrs:{options:s.limitOptions,"with-margin":!1},on:{input:s.search},model:{value:s.limit,callback:function(e){s.limit=e},expression:"limit"}})],1)]),t("div",{staticClass:"search-results mb2"},[s.searchQuery.length<3?t("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.type"))+" ")]):s.noSearchFilters?t("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.no_filter"))+" ")]):s.isLoading?t("div",[t("spinner")],1):t("div",[this.searchFilter.assets?t("div",{staticClass:"pb1"},[t("h2",{staticClass:"mt0"},[s._v(" "+s._s(s.$t("assets.title"))+" ("+s._s(((r=this.results.assets)==null?void 0:r.length)||0)+") ")]),(a=this.results.assets)!=null&&a.length?t("div",{staticClass:"result-list"},s._l(this.results.assets,function(e){return t("div",{key:e.id,staticClass:"result flexcolumn",class:{"selected-result":s.flattenResults[s.selectedIndex]===e},on:{mouseover:function(n){return s.selectResultById(e.id)}}},[t("entity-preview",{attrs:{"empty-height":200,"empty-width":300,height:200,width:300,entity:e,"is-rounded-top-border":""}}),t("router-link",{staticClass:"result-description",attrs:{id:`result-link-${e.id}`,to:s.entityPath(e,"asset")}},[t("div",{staticClass:"production-name"},[s._v(" "+s._s(e.project_name)+" ")]),t("div",{staticClass:"entity-name"},[s._v(" "+s._s(e.asset_type_name)+" / "+s._s(e.name)+" ")]),t("div",{staticClass:"match"},[t("span",{staticClass:"match-icon"},[t("search-icon",{attrs:{width:"15"}})],1),s._v(" "+s._s(s.getMatchDetails(e))+" ")])])],1)}),0):t("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.no_result"))+" ")])]):s._e(),this.searchFilter.shots?t("div",{staticClass:"pb1"},[t("h2",{staticClass:"mt0"},[s._v(" "+s._s(s.$t("shots.title"))+" ("+s._s(((l=this.results.shots)==null?void 0:l.length)||0)+") ")]),(c=this.results.shots)!=null&&c.length?t("div",{staticClass:"result-list"},s._l(this.results.shots,function(e){return t("div",{key:e.id,staticClass:"result flexcolumn",class:{"selected-result":s.flattenResults[s.selectedIndex]===e},on:{mouseover:function(n){return s.selectResultById(e.id)}}},[t("entity-preview",{attrs:{"empty-height":200,"empty-width":300,height:200,width:300,entity:e,"is-rounded-top-border":""}}),t("router-link",{staticClass:"result-description",attrs:{id:`result-link-${e.id}`,to:s.entityPath(e,"shot")}},[t("div",{staticClass:"production-name"},[s._v(" "+s._s(e.project_name)+" ")]),t("div",{staticClass:"entity-name"},[e.episode_name?[s._v(" "+s._s(e.episode_name)+" / ")]:s._e(),s._v(" "+s._s(e.sequence_name)+" / "+s._s(e.name)+" ")],2),t("div",{staticClass:"match"},[t("span",{staticClass:"match-icon"},[t("search-icon",{attrs:{width:"15"}})],1),t("span",{staticClass:"match-details"},[s._v(s._s(s.getMatchDetails(e)))])])])],1)}),0):t("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.no_result"))+" ")])]):s._e()])])])},I=[],$=C(b,y,I,!1,null,"361aca2b",null,null);const F=$.exports;export{F as default};
//# sourceMappingURL=EntitySearch-232301c8.js.map
