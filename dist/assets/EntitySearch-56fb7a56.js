import{n as a,aD as n,bt as l,bw as c,y as d,m as h,bx as o,by as u,b as p}from"./index-0e3c5a09.js";const m={name:"entity-preview",props:{entity:{default:()=>{},type:Object},square:{default:!1,type:Boolean},width:{default:null,type:Number},height:{default:null,type:Number},maxWidth:{default:null,type:Number},maxHeight:{default:null,type:Number},emptyHeight:{default:30,type:Number},emptyWidth:{default:50,type:Number},previewFileId:{default:null,type:String}},computed:{originalPath(){return"/api/pictures/originals/preview-files/"+(this.previewFileId||this.entity.preview_file_id)+".png"},isPreview(){const i=this.previewFileId||this.entity.preview_file_id;return i&&i.length>0},imgStyle(){const i={},e=this.maxHeight||this.emptyHeight,t=this.maxWidth||this.emptyWidth;return i["max-height"]=e,i["min-height"]=e,i.height=e,i["max-width"]=t,i["min-width"]=t,i.width=t,i},thumbnailPath(){return"/api/pictures/previews/preview-files/"+(this.previewFileId||this.entity.preview_file_id)+".png"},thumbnailKey(){return`preview-${this.previewFileId||this.entity.preview_file_id}`}},methods:{onClicked(){if(this.noPreview)return;const i=this.previewFileId||this.entity.preview_file_id;this.$store.commit("SHOW_PREVIEW_FILE",i)}}};var y=function(){var e=this,t=e._self._c;return t("a",{staticClass:"preview-wrapper preview-picture",style:{width:e.emptyWidth+"px","min-width":e.emptyWidth+"px",height:e.emptyHeight+"px"},attrs:{target:"_blank"},on:{click:e.onClicked}},[t("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.thumbnailPath,expression:"thumbnailPath"}],key:e.thumbnailKey,staticClass:"thumbnail-picture",style:{width:"auto","max-height":e.emptyHeight+"px"},attrs:{width:e.width||""}})])},_=[],v=a(m,y,_,!1,null,"f0e996fb",null,null);const f=v.exports;const w={name:"entity-search",mixins:[],components:{EntityPreview:f,PeopleAvatar:n,PeopleName:l,SearchIcon:c,Spinner:d},data(){return{assets:[],currentTask:null,isLoading:!1,selectedIndex:0,searchQuery:""}},props:{},mounted(){window.addEventListener("keydown",i=>{i.ctrlKey&&i.altKey&&i.keyCode===70?this.$refs["global-search-field"]&&this.$refs["global-search-field"].focus():i.keyCode===40?this.selectNext():i.keyCode===38&&this.selectPrevious()}),this.searchField.focus()},computed:{...h(["currentEpisode","currentProduction","productionMap"]),searchField(){return this.$refs["global-search-field"]},entityPath(){const i="asset";return e=>{const s=this.productionMap.get(e.project_id).production_type==="tvshow";let r=null;return s&&(r=e.episode_id||"main"),o(e.id,e.project_id,i,r)}},personPath(){return i=>u(i.id)},nbResults(){return this.assets.length}},methods:{...p(["searchData"]),selectPrevious(){this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.nbResults-1)},selectNext(){this.selectedIndex++,this.selectedIndex>=this.nbResults&&(this.selectedIndex=0)},onElementSelected(){document.getElementById("result-link-"+this.selectedIndex).click(),this.searchQuery=""}},watch:{searchQuery(){this.searchQuery.length>2?(this.isLoading=!0,this.searchData({query:this.searchQuery,limit:10}).then(i=>{this.isLoading=!1,this.assets=i.assets}).catch(console.error)):this.assets=[]}},metaInfo(){return{title:`${this.$t("search.title")} - Kitsu`}}};var g=function(){var e=this,t=e._self._c;return t("div",{staticClass:"columns fixed-page"},[t("div",{staticClass:"column main-column"},[t("div",{staticClass:"global-search-field"},[t("span",{staticClass:"search-icon"},[t("search-icon",{attrs:{width:"20"}})],1),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchQuery,expression:"searchQuery"}],ref:"global-search-field",staticClass:"input",attrs:{placeholder:"Search for an entity in the database..."},domProps:{value:e.searchQuery},on:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.onElementSelected.apply(null,arguments)},input:function(s){s.target.composing||(e.searchQuery=s.target.value)}}})]),t("div",{staticClass:"search-results"},[e.searchQuery.length<3?t("div",{staticClass:"result-line has-text-centered"},[e._v(" "+e._s(e.$t("main.search.type"))+" ")]):e.isLoading?t("div",{staticClass:"search-loader",style:{"min-height":e.nbResults*60+"px"}},[t("div",[t("spinner")],1)]):e.nbResults>0?t("div",{staticClass:"result-list"},e._l(e.assets,function(s,r){return t("div",{key:s.id,class:{"result-line":!0,"selected-result":e.selectedIndex===r}},[t("div",{staticClass:"flexcolumn result"},[t("div",{},[t("entity-preview",{staticStyle:{"margin-top":"5px"},attrs:{"empty-height":200,"empty-width":300,height:200,width:300,entity:s}})],1),t("router-link",{staticClass:"result-name",attrs:{id:"result-link-"+r,to:e.entityPath(s)}},[t("div",{},[t("div",{staticClass:"production-name"},[e._v(" "+e._s(s.project_name)+" ")]),t("div",{staticClass:"asset-type-name"},[e._v(" "+e._s(s.asset_type_name)+" / "+e._s(s.name)+" ")])])])],1)])}),0):t("div",{staticClass:"result-line"},[e._v(" "+e._s(e.$t("main.search.no_result"))+" ")])])]),e.currentTask?t("div",{staticClass:"column side-column is-hidden-mobile hide-small-screen"},[t("task-info",{attrs:{task:e.currentTask,"is-loading":e.loading.currentTask}})],1):e._e()])},x=[],b=a(w,g,x,!1,null,"f607cd2d",null,null);const k=b.exports;export{k as default};
//# sourceMappingURL=EntitySearch-56fb7a56.js.map
