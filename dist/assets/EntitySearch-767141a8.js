import{n as o,B as d,bw as u,bx as p,C as m,by as _,y as f,m as v,b as y,bz as w,bA as g}from"./index-f01263d8.js";const x={name:"entity-preview",components:{ButtonSimple:d,VideoViewer:u},data(){return{isPlaying:!1}},props:{entity:{default:()=>{},type:Object},square:{default:!1,type:Boolean},width:{default:null,type:Number},height:{default:null,type:Number},maxWidth:{default:null,type:Number},maxHeight:{default:null,type:Number},emptyHeight:{default:30,type:Number},emptyWidth:{default:50,type:Number},previewFileId:{default:null,type:String},isRoundedTopBorder:{default:!1,type:Boolean}},computed:{isMovie(){return this.entity.preview_file_extension==="mp4"},isPreview(){const s=this.previewFileId||this.entity.preview_file_id;return s&&s.length>0},thumbnailPath(){return"/api/pictures/previews/preview-files/"+(this.previewFileId||this.entity.preview_file_id)+".png"},thumbnailKey(){return`preview-${this.previewFileId||this.entity.preview_file_id}`}},methods:{onPictureClicked(){if(this.noPreview)return;const s=this.previewFileId||this.entity.preview_file_id;s&&this.$store.commit("SHOW_PREVIEW_FILE",s)},onVideoClicked(){this.isPlaying?(this.$refs["video-viewer"].pause(),this.$refs["button-play"].$el.style.display="initial"):(this.$refs["video-viewer"].play(),this.$refs["button-play"].$el.style.display="none"),this.isPlaying=!this.isPlaying}}};var C=function(){var e=this,t=e._self._c;return e.isMovie?t("div",{staticClass:"preview-wrapper preview-video"},[t("video-viewer",{ref:"video-viewer",attrs:{"is-repeating":!0,"default-height":e.height,preview:{id:e.entity.preview_file_id,extension:e.entity.preview_file_extension},"is-rounded-top-border":e.isRoundedTopBorder},nativeOn:{click:function(r){return e.onVideoClicked()}}}),t("button-simple",{ref:"button-play",staticClass:"button-play",attrs:{icon:"play",title:e.$t("playlists.actions.play")},on:{click:function(r){return e.onVideoClicked()}}})],1):t("a",{staticClass:"preview-wrapper preview-picture",style:{width:e.emptyWidth+"px","min-width":e.emptyWidth+"px",height:e.emptyHeight+"px",cursor:"zoom-in","border-top-left-radius":e.isRoundedTopBorder?"10px":"","border-top-right-radius":e.isRoundedTopBorder?"10px":""},attrs:{target:"_blank"},on:{click:function(r){return e.onPictureClicked()}}},[t("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.thumbnailPath,expression:"thumbnailPath"}],key:e.thumbnailKey,staticClass:"thumbnail-picture",style:{width:"auto","max-height":e.emptyHeight+"px"},attrs:{width:e.width||""}})])},b=[],$=o(x,C,b,!1,null,"38dcaa86",null,null);const I=$.exports;const c=[10,20,50],F={name:"entity-search",mixins:[],components:{Checkbox:p,Combobox:m,EntityPreview:I,SearchIcon:_,Spinner:f},data(){return{isLoading:!1,limit:c[0],limitOptions:c.map(s=>({label:s,value:s})),selectedIndex:0,searchQuery:"",searchFilter:{assets:!0,shots:!0,persons:!1},results:{assets:[],shots:[],persons:[]}}},props:{},mounted(){window.addEventListener("keydown",s=>{s.ctrlKey&&s.altKey&&s.keyCode===70?this.$refs["search-field"]&&this.$refs["search-field"].focus():s.keyCode===40?this.selectNext():s.keyCode===38&&this.selectPrevious()}),this.$route.query.search&&(this.searchQuery=this.$route.query.search),this.searchField.focus()},computed:{...v(["productionMap"]),searchField(){return this.$refs["search-field"]},flattenResults(){let s=[];return this.searchFilter.assets&&(s=s.concat(this.results.assets)),this.searchFilter.shots&&(s=s.concat(this.results.shots)),this.searchFilter.persons&&(s=s.concat(this.results.persons)),s},noSearchFilters(){return!this.searchFilter.assets&&!this.searchFilter.shots}},methods:{...y(["searchData"]),search(){this.isLoading=!0;const s=Object.entries(this.searchFilter).map(([e,t])=>t?e:void 0).filter(Boolean);this.searchData({query:this.searchQuery,limit:this.limit,index_names:s}).then(e=>{delete e.persons,this.results=e}).catch(console.error).finally(()=>{this.isLoading=!1})},selectPrevious(){this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.flattenResults.length-1),this.scrollToSelection()},selectNext(){this.selectedIndex++,this.selectedIndex>=this.flattenResults.length&&(this.selectedIndex=0),this.scrollToSelection()},scrollToSelection(){const s=this.flattenResults[this.selectedIndex];s&&document.getElementById(`result-link-${s.id}`).scrollIntoView(!1)},selectResultById(s){this.selectedIndex=this.flattenResults.findIndex(e=>e.id===s)},onResultSelected(){const s=this.flattenResults[this.selectedIndex];s&&document.getElementById(`result-link-${s.id}`).click()},clearSearchResult(){this.results={assets:[],shots:[],persons:[]}},entityPath(s,e){const r=this.productionMap.get(s.project_id).production_type==="tvshow";let a=null;return r&&(a=s.episode_id||"main"),w(s.id,s.project_id,e,a)},personPath(s){return g(s.id)},getMatchDetails(s){var r,a,l,n;const e=(a=(r=s.matched_terms)==null?void 0:r[0])==null?void 0:a[0],t=(n=(l=s.matched_terms)==null?void 0:l[0])==null?void 0:n[1];return e!=null&&e.startsWith("data_")?this.$t("search.match_details_2",{term:t,target:e.replace("data_","")}):this.$t("search.match_details",{term:t,target:e})}},watch:{searchQuery(){this.searchQuery.length?this.$router.push({query:{search:this.searchQuery}}):this.$router.push({query:{}}),this.searchQuery.length>2?this.search():this.clearSearchResult(),this.selectedIndex=0}},metaInfo(){return{title:`${this.$t("search.title")} - Kitsu`}}};var k=function(){var r,a,l,n;var e=this,t=e._self._c;return t("div",{staticClass:"entity-search page"},[t("form",{staticClass:"search-form",on:{submit:function(i){return i.preventDefault(),e.onResultSelected()}}},[t("div",{staticClass:"search-field"},[t("span",{staticClass:"search-icon"},[t("search-icon",{attrs:{width:"20"}})],1),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.searchQuery,expression:"searchQuery",modifiers:{trim:!0}}],ref:"search-field",staticClass:"input",attrs:{placeholder:e.$t("search.placeholder")},domProps:{value:e.searchQuery},on:{input:function(i){i.target.composing||(e.searchQuery=i.target.value.trim())},blur:function(i){return e.$forceUpdate()}}})]),t("div",{staticClass:"search-options pa1 flexrow"},[t("checkbox",{staticClass:"flexrow-item",attrs:{toggle:!0,label:e.$t("assets.title")},on:{change:e.search},model:{value:e.searchFilter.assets,callback:function(i){e.$set(e.searchFilter,"assets",i)},expression:"searchFilter.assets"}}),t("checkbox",{staticClass:"flexrow-item",attrs:{toggle:!0,label:e.$t("shots.title")},on:{change:e.search},model:{value:e.searchFilter.shots,callback:function(i){e.$set(e.searchFilter,"shots",i)},expression:"searchFilter.shots"}}),t("div",{staticClass:"filler"}),t("span",{staticClass:"flexrow-item no-margin"},[e._v(" "+e._s(e.$t("search.limit"))+" ")]),t("combobox",{staticClass:"search-limit flexrow-item",attrs:{options:e.limitOptions,"with-margin":!1},on:{input:e.search},model:{value:e.limit,callback:function(i){e.limit=i},expression:"limit"}})],1)]),t("div",{staticClass:"search-results mb2"},[e.searchQuery.length<3?t("div",{staticClass:"has-text-centered"},[e._v(" "+e._s(e.$t("main.search.type"))+" ")]):e.noSearchFilters?t("div",{staticClass:"has-text-centered"},[e._v(" "+e._s(e.$t("main.search.no_filter"))+" ")]):e.isLoading?t("div",[t("spinner")],1):t("div",[this.searchFilter.assets?t("div",{staticClass:"pb1"},[t("h2",{staticClass:"mt0"},[e._v(" "+e._s(e.$t("assets.title"))+" ("+e._s(((r=this.results.assets)==null?void 0:r.length)||0)+") ")]),(a=this.results.assets)!=null&&a.length?t("div",{staticClass:"result-list"},e._l(this.results.assets,function(i){return t("div",{key:i.id,staticClass:"result flexcolumn",class:{"selected-result":e.flattenResults[e.selectedIndex]===i},on:{mouseover:function(h){return e.selectResultById(i.id)}}},[t("entity-preview",{attrs:{"empty-height":200,"empty-width":300,height:200,width:300,entity:i,"is-rounded-top-border":""}}),t("router-link",{staticClass:"result-description",attrs:{id:`result-link-${i.id}`,to:e.entityPath(i,"asset")}},[t("div",{staticClass:"production-name"},[e._v(" "+e._s(i.project_name)+" ")]),t("div",{staticClass:"entity-name"},[e._v(" "+e._s(i.asset_type_name)+" / "+e._s(i.name)+" ")]),t("div",{staticClass:"match"},[t("span",{staticClass:"match-icon"},[t("search-icon",{attrs:{width:"15"}})],1),e._v(" "+e._s(e.getMatchDetails(i))+" ")])])],1)}),0):t("div",{staticClass:"has-text-centered"},[e._v(" "+e._s(e.$t("main.search.no_result"))+" ")])]):e._e(),this.searchFilter.shots?t("div",{staticClass:"pb1"},[t("h2",{staticClass:"mt0"},[e._v(" "+e._s(e.$t("shots.title"))+" ("+e._s(((l=this.results.shots)==null?void 0:l.length)||0)+") ")]),(n=this.results.shots)!=null&&n.length?t("div",{staticClass:"result-list"},e._l(this.results.shots,function(i){return t("div",{key:i.id,staticClass:"result flexcolumn",class:{"selected-result":e.flattenResults[e.selectedIndex]===i},on:{mouseover:function(h){return e.selectResultById(i.id)}}},[t("entity-preview",{attrs:{"empty-height":200,"empty-width":300,height:200,width:300,entity:i,"is-rounded-top-border":""}}),t("router-link",{staticClass:"result-description",attrs:{id:`result-link-${i.id}`,to:e.entityPath(i,"shot")}},[t("div",{staticClass:"production-name"},[e._v(" "+e._s(i.project_name)+" ")]),t("div",{staticClass:"entity-name"},[i.episode_name?[e._v(" "+e._s(i.episode_name)+" / ")]:e._e(),e._v(" "+e._s(i.sequence_name)+" / "+e._s(i.name)+" ")],2),t("div",{staticClass:"match"},[t("span",{staticClass:"match-icon"},[t("search-icon",{attrs:{width:"15"}})],1),t("span",{staticClass:"match-details"},[e._v(e._s(e.getMatchDetails(i)))])])])],1)}),0):t("div",{staticClass:"has-text-centered"},[e._v(" "+e._s(e.$t("main.search.no_result"))+" ")])]):e._e()])])])},P=[],R=o(F,k,P,!1,null,"7945da49",null,null);const B=R.exports;export{B as default};
//# sourceMappingURL=EntitySearch-767141a8.js.map
