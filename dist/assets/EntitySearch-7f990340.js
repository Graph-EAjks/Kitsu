import{bw as h,C as d,bx as u,by as m,y as p,m as f,b as _,bz as v,bA as x,n as C}from"./index-2d0d3aff.js";import{C as g}from"./ComboboxProduction-94a0ae31.js";const o=[12,24,48],b={name:"entity-search",mixins:[],components:{Checkbox:h,Combobox:d,ComboboxProduction:g,EntityPreview:u,SearchIcon:m,Spinner:p},data(){return{isLoading:!1,limit:o[0],limitOptions:o.map(i=>({label:i,value:i})),productionId:"",selectedIndex:0,searchQuery:"",searchFilter:{assets:!0,shots:!0,persons:!1},results:{assets:[],shots:[],persons:[]}}},props:{},mounted(){window.addEventListener("keydown",i=>{i.ctrlKey&&i.altKey&&i.keyCode===70?this.$refs["search-field"]&&this.$refs["search-field"].focus():i.keyCode===40?this.selectNext():i.keyCode===38&&this.selectPrevious()}),this.$route.query.search&&(this.searchQuery=this.$route.query.search),this.searchField.focus()},computed:{...f(["openProductions","productionMap"]),searchField(){return this.$refs["search-field"]},flattenResults(){let i=[];return this.searchFilter.assets&&(i=i.concat(this.results.assets)),this.searchFilter.shots&&(i=i.concat(this.results.shots)),this.searchFilter.persons&&(i=i.concat(this.results.persons)),i},noSearchFilters(){return!this.searchFilter.assets&&!this.searchFilter.shots},productionList(){return[{id:"",name:this.$t("main.all")}].concat([...this.openProductions])}},methods:{..._(["searchData"]),search(){this.isLoading=!0;const i=Object.entries(this.searchFilter).map(([s,e])=>e?s:void 0).filter(Boolean);this.searchData({query:this.searchQuery,limit:this.limit,productionId:this.productionId,index_names:i}).then(s=>{delete s.persons,this.results=s}).catch(console.error).finally(()=>{this.isLoading=!1})},selectPrevious(){this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.flattenResults.length-1),this.scrollToSelection()},selectNext(){this.selectedIndex++,this.selectedIndex>=this.flattenResults.length&&(this.selectedIndex=0),this.scrollToSelection()},scrollToSelection(){const i=this.flattenResults[this.selectedIndex];i&&document.getElementById(`result-link-${i.id}`).scrollIntoView(!1)},selectResultById(i){this.selectedIndex=this.flattenResults.findIndex(s=>s.id===i)},onResultSelected(){const i=this.flattenResults[this.selectedIndex];i&&document.getElementById(`result-link-${i.id}`).click()},clearSearchResult(){this.results={assets:[],shots:[],persons:[]}},entityPath(i,s){const r=this.productionMap.get(i.project_id).production_type==="tvshow";let a=null;return r&&(a=i.episode_id||"main"),v(i.id,i.project_id,s,a)},personPath(i){return x(i.id)},getMatchDetails(i){const s=i.matched_terms.join(", ");return this.searchQuery,this.$t("search.match_details",{target:s})}},watch:{productionId(){this.search()},searchQuery(){this.searchQuery.length?this.$router.push({query:{search:this.searchQuery}}):this.$router.push({query:{}}),this.searchQuery.length>2?this.search():this.clearSearchResult(),this.selectedIndex=0}},metaInfo(){return{title:`${this.$t("search.title")} - Kitsu`}}};var y=function(){var r,a,l,c;var s=this,e=s._self._c;return e("div",{staticClass:"entity-search page"},[e("form",{staticClass:"search-form",on:{submit:function(t){return t.preventDefault(),s.onResultSelected()}}},[e("div",[e("combobox-production",{staticClass:"flexrow-item production-field",attrs:{label:s.$t("main.production"),"production-list":s.productionList},model:{value:s.productionId,callback:function(t){s.productionId=t},expression:"productionId"}})],1),e("div",{staticClass:"search-field"},[e("span",{staticClass:"search-icon"},[e("search-icon",{attrs:{width:"20"}})],1),e("input",{directives:[{name:"model",rawName:"v-model.trim",value:s.searchQuery,expression:"searchQuery",modifiers:{trim:!0}}],ref:"search-field",staticClass:"input",attrs:{placeholder:s.$t("search.placeholder")},domProps:{value:s.searchQuery},on:{input:function(t){t.target.composing||(s.searchQuery=t.target.value.trim())},blur:function(t){return s.$forceUpdate()}}})]),e("div",{staticClass:"search-options pa1 flexrow"},[e("checkbox",{staticClass:"flexrow-item",attrs:{toggle:!0,label:s.$t("assets.title")},on:{change:s.search},model:{value:s.searchFilter.assets,callback:function(t){s.$set(s.searchFilter,"assets",t)},expression:"searchFilter.assets"}}),e("checkbox",{staticClass:"flexrow-item",attrs:{toggle:!0,label:s.$t("shots.title")},on:{change:s.search},model:{value:s.searchFilter.shots,callback:function(t){s.$set(s.searchFilter,"shots",t)},expression:"searchFilter.shots"}}),e("div",{staticClass:"filler"}),e("span",{staticClass:"flexrow-item no-margin"},[s._v(" "+s._s(s.$t("search.limit"))+" ")]),e("combobox",{staticClass:"search-limit flexrow-item",attrs:{options:s.limitOptions,"with-margin":!1},on:{input:s.search},model:{value:s.limit,callback:function(t){s.limit=t},expression:"limit"}})],1)]),e("div",{staticClass:"search-results mb2"},[s.searchQuery.length<3?e("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.type"))+" ")]):s.noSearchFilters?e("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.no_filter"))+" ")]):s.isLoading?e("div",[e("spinner")],1):e("div",[this.searchFilter.assets?e("div",{staticClass:"pb1"},[e("h2",{staticClass:"mt0"},[s._v(" "+s._s(s.$t("assets.title"))+" ("+s._s(((r=this.results.assets)==null?void 0:r.length)||0)+") ")]),(a=this.results.assets)!=null&&a.length?e("div",{staticClass:"result-list"},s._l(this.results.assets,function(t){return e("div",{key:t.id,staticClass:"result flexcolumn",class:{"selected-result":s.flattenResults[s.selectedIndex]===t},on:{mouseover:function(n){return s.selectResultById(t.id)}}},[e("entity-preview",{attrs:{"empty-height":200,"empty-width":300,height:200,width:300,entity:t,"is-rounded-top-border":""}}),e("router-link",{staticClass:"result-description",attrs:{id:`result-link-${t.id}`,to:s.entityPath(t,"asset")}},[e("div",{staticClass:"production-name"},[s._v(" "+s._s(t.project_name)+" ")]),e("div",{staticClass:"entity-name"},[s._v(" "+s._s(t.asset_type_name)+" / "+s._s(t.name)+" ")]),e("div",{staticClass:"match"},[e("span",{staticClass:"match-icon"},[e("search-icon",{attrs:{width:"15"}})],1),s._v(" "+s._s(s.getMatchDetails(t))+" ")])])],1)}),0):e("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.no_result"))+" ")])]):s._e(),this.searchFilter.shots?e("div",{staticClass:"pb1"},[e("h2",{staticClass:"mt0"},[s._v(" "+s._s(s.$t("shots.title"))+" ("+s._s(((l=this.results.shots)==null?void 0:l.length)||0)+") ")]),(c=this.results.shots)!=null&&c.length?e("div",{staticClass:"result-list"},s._l(this.results.shots,function(t){return e("div",{key:t.id,staticClass:"result flexcolumn",class:{"selected-result":s.flattenResults[s.selectedIndex]===t},on:{mouseover:function(n){return s.selectResultById(t.id)}}},[e("entity-preview",{attrs:{"empty-height":200,"empty-width":300,height:200,width:300,entity:t,"is-rounded-top-border":""}}),e("router-link",{staticClass:"result-description",attrs:{id:`result-link-${t.id}`,to:s.entityPath(t,"shot")}},[e("div",{staticClass:"production-name"},[s._v(" "+s._s(t.project_name)+" ")]),e("div",{staticClass:"entity-name"},[t.episode_name?[s._v(" "+s._s(t.episode_name)+" / ")]:s._e(),s._v(" "+s._s(t.sequence_name)+" / "+s._s(t.name)+" ")],2),e("div",{staticClass:"match"},[e("span",{staticClass:"match-icon"},[e("search-icon",{attrs:{width:"15"}})],1),e("span",{staticClass:"match-details"},[s._v(s._s(s.getMatchDetails(t)))])])])],1)}),0):e("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.no_result"))+" ")])]):s._e()])])])},I=[],$=C(b,y,I,!1,null,"eae321bd",null,null);const F=$.exports;export{F as default};
//# sourceMappingURL=EntitySearch-7f990340.js.map
