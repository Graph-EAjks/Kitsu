import{_ as B,a$ as Q,C as j,a as D,h as E,b0 as q,x as T,m as A,b as U,ab as z,aG as K,b1 as O,r as h,o as l,c as i,e as r,f as a,n as G,aZ as H,t as n,a9 as N,F as f,g as F,p as V,w as M,a3 as g,l as S,d as u}from"./index-BX9gKNNR.js";const R=[12,24,48],Z={name:"entity-search",components:{Checkbox:Q,Combobox:j,ComboboxProduction:D,EntityPreview:E,SearchIcon:q,Spinner:T},data(){return{isLoading:!1,isLoadingMoreAssets:!1,isLoadingMoreShots:!1,limit:R[0],limitOptions:R.map(e=>({label:e,value:e})),productionId:"",selectedIndex:0,searchQuery:"",searchFilter:{assets:!0,shots:!0,persons:!1},results:{assets:[],shots:[],persons:[]}}},mounted(){window.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.altKey&&e.keyCode===70?this.searchField.focus():e.keyCode===40?this.selectNext():e.keyCode===38&&this.selectPrevious()}),this.$route.query.search&&(this.searchQuery=this.$route.query.search),this.searchField.focus()},computed:{...A(["openProductions","productionMap"]),searchField(){return this.$refs["search-field"]},flattenResults(){let e=[];return this.searchFilter.assets&&(e=e.concat(this.results.assets)),this.searchFilter.shots&&(e=e.concat(this.results.shots)),this.searchFilter.persons&&(e=e.concat(this.results.persons)),e},noSearchFilters(){return!this.searchFilter.assets&&!this.searchFilter.shots},productionList(){return[{id:"",name:this.$t("main.all")}].concat([...this.openProductions])}},methods:{...U(["searchData"]),search(){this.isLoading=!0;const e=Object.entries(this.searchFilter).map(([o,d])=>d?o:void 0).filter(Boolean);this.searchData({query:this.searchQuery,limit:this.limit,productionId:this.productionId,index_names:e}).then(o=>{delete o.persons,this.results=o}).catch(console.error).finally(()=>{this.isLoading=!1})},loadMoreResults(e){const o=[e],d=`isLoadingMore${z.capitalize(e)}`;this[d]=!0,this.searchData({query:this.searchQuery,limit:this.limit,offset:this.results[e].length,productionId:this.productionId,index_names:o}).then(m=>{this.results[e]=this.results[e].concat(m[e])}).catch(console.error).finally(()=>{this[d]=!1})},selectPrevious(){this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.flattenResults.length-1),this.scrollToSelection()},selectNext(){this.selectedIndex++,this.selectedIndex>=this.flattenResults.length&&(this.selectedIndex=0),this.scrollToSelection()},scrollToSelection(){const e=this.flattenResults[this.selectedIndex];e&&document.getElementById(`result-link-${e.id}`).scrollIntoView(!1)},selectResultById(e){this.selectedIndex=this.flattenResults.findIndex(o=>o.id===e)},onResultSelected(){const e=this.flattenResults[this.selectedIndex];e&&document.getElementById(`result-link-${e.id}`).click()},clearSearchResult(){this.results={assets:[],shots:[],persons:[]}},entityPath(e,o){const m=this.productionMap.get(e.project_id).production_type==="tvshow";let t=null;return m&&(t=e.episode_id||"main"),K(e.id,e.project_id,o,t)},personPath(e){return O(e.id)},getMatchDetails(e){const o=e.matched_terms.join(", ");return this.$t("search.match_details",{target:o})}},watch:{productionId(){this.search()},searchQuery(){this.searchQuery.length?this.$router.push({query:{search:this.searchQuery}}):this.$router.push({query:{}}),this.searchQuery.length>2?this.search():this.clearSearchResult(),this.selectedIndex=0}},head(){return{title:`${this.$t("search.title")} - Kitsu`}}},J={class:"entity-search page"},W={class:"search-field"},X={class:"search-icon"},Y=["placeholder"],$={class:"search-options pa1 flexrow"},ee={class:"flexrow-item no-margin"},se={class:"search-results mb2"},te={key:0,class:"has-text-centered"},oe={key:1,class:"has-text-centered"},le={key:2},ie={key:3},re={key:0,class:"pb1"},ne={class:"mt0"},ce={key:0,class:"has-text-centered"},ae={key:1,class:"result-list"},he=["onMouseover"],de={class:"production-name"},ue={class:"entity-name"},me={class:"match"},pe={class:"match-icon"},_e={key:2,class:"has-text-centered mt2"},fe={key:1,class:"pb1"},ge={class:"mt1"},ye={key:0,class:"has-text-centered"},ve={key:1,class:"result-list"},ke=["onMouseover"],be={class:"production-name"},Ie={class:"entity-name"},xe={class:"match"},we={class:"match-icon"},Fe={class:"match-details"},Ve={key:2,class:"has-text-centered mt2"};function Me(e,o,d,m,t,c){var b,I,x,w;const C=h("combobox-production"),p=h("search-icon"),y=h("checkbox"),L=h("combobox"),_=h("spinner"),v=h("entity-preview"),k=h("router-link");return l(),i("div",J,[r("form",{class:"search-form",onSubmit:o[5]||(o[5]=N(s=>c.onResultSelected(),["prevent"]))},[r("div",null,[a(C,{class:"flexrow-item production-field",label:e.$t("main.production"),"production-list":c.productionList,modelValue:t.productionId,"onUpdate:modelValue":o[0]||(o[0]=s=>t.productionId=s)},null,8,["label","production-list","modelValue"])]),r("div",W,[r("span",X,[a(p,{size:20})]),G(r("input",{ref:"search-field",class:"input",placeholder:e.$t("search.placeholder"),"onUpdate:modelValue":o[1]||(o[1]=s=>t.searchQuery=s)},null,8,Y),[[H,t.searchQuery,void 0,{trim:!0}]])]),r("div",$,[a(y,{class:"flexrow-item",toggle:!0,label:e.$t("assets.title"),onChange:c.search,modelValue:t.searchFilter.assets,"onUpdate:modelValue":o[2]||(o[2]=s=>t.searchFilter.assets=s)},null,8,["label","onChange","modelValue"]),a(y,{class:"flexrow-item",toggle:!0,label:e.$t("shots.title"),onChange:c.search,modelValue:t.searchFilter.shots,"onUpdate:modelValue":o[3]||(o[3]=s=>t.searchFilter.shots=s)},null,8,["label","onChange","modelValue"]),o[8]||(o[8]=r("div",{class:"filler"},null,-1)),r("span",ee,n(e.$t("search.limit")),1),a(L,{class:"search-limit flexrow-item",options:t.limitOptions,"with-margin":!1,"onUpdate:modelValue":[c.search,o[4]||(o[4]=s=>t.limit=s)],modelValue:t.limit},null,8,["options","onUpdate:modelValue","modelValue"])])],32),r("div",se,[t.searchQuery.length<3?(l(),i("div",te,n(e.$t("main.search.type")),1)):c.noSearchFilters?(l(),i("div",oe,n(e.$t("main.search.no_filter")),1)):t.isLoading?(l(),i("div",le,[a(_)])):(l(),i("div",ie,[t.searchFilter.assets?(l(),i("div",re,[r("h2",ne,n(e.$t("assets.title"))+" ("+n(((b=t.results.assets)==null?void 0:b.length)||0)+") ",1),(I=t.results.assets)!=null&&I.length?(l(),i("div",ae,[(l(!0),i(f,null,F(t.results.assets,s=>(l(),i("div",{class:V(["result flexcolumn",{"selected-result":c.flattenResults[t.selectedIndex]===s}]),key:s.id,onMouseover:P=>c.selectResultById(s.id)},[a(v,{"empty-height":200,"empty-width":300,height:200,width:300,entity:s,"is-rounded-top-border":""},null,8,["entity"]),a(k,{class:"result-description",id:`result-link-${s.id}`,to:c.entityPath(s,"asset")},{default:M(()=>[r("div",de,n(s.project_name),1),r("div",ue,n(s.asset_type_name)+" / "+n(s.name),1),r("div",me,[r("span",pe,[a(p,{size:15})]),g(" "+n(c.getMatchDetails(s)),1)])]),_:2},1032,["id","to"])],42,he))),128))])):(l(),i("div",ce,n(e.$t("main.search.no_result")),1)),t.results.assets.length!==0&&t.results.assets.length%12===0?(l(),i("p",_e,[t.isLoadingMoreAssets?(l(),S(_,{key:1})):(l(),i("button",{key:0,class:"button is-link",onClick:o[6]||(o[6]=s=>c.loadMoreResults("assets"))},n(e.$t("main.load_more")),1))])):u("",!0)])):u("",!0),t.searchFilter.shots?(l(),i("div",fe,[r("h2",ge,n(e.$t("shots.title"))+" ("+n(((x=t.results.shots)==null?void 0:x.length)||0)+") ",1),(w=t.results.shots)!=null&&w.length?(l(),i("div",ve,[(l(!0),i(f,null,F(t.results.shots,s=>(l(),i("div",{class:V(["result flexcolumn",{"selected-result":c.flattenResults[t.selectedIndex]===s}]),key:s.id,onMouseover:P=>c.selectResultById(s.id)},[a(v,{"empty-height":200,"empty-width":300,height:200,width:300,entity:s,"is-rounded-top-border":""},null,8,["entity"]),a(k,{class:"result-description",id:`result-link-${s.id}`,to:c.entityPath(s,"shot")},{default:M(()=>[r("div",be,n(s.project_name),1),r("div",Ie,[s.episode_name?(l(),i(f,{key:0},[g(n(s.episode_name)+" / ",1)],64)):u("",!0),g(" "+n(s.sequence_name)+" / "+n(s.name),1)]),r("div",xe,[r("span",we,[a(p,{size:15})]),r("span",Fe,n(c.getMatchDetails(s)),1)])]),_:2},1032,["id","to"])],42,ke))),128))])):(l(),i("div",ye,n(e.$t("main.search.no_result")),1)),t.results.shots.length!==0&&t.results.shots.length%12===0?(l(),i("p",Ve,[t.isLoadingMoreShots?(l(),S(_,{key:1})):(l(),i("button",{key:0,class:"button is-link",onClick:o[7]||(o[7]=s=>c.loadMoreResults("shots"))},n(e.$t("main.load_more")),1))])):u("",!0)])):u("",!0)]))])])}const Re=B(Z,[["render",Me],["__scopeId","data-v-d524cf5d"]]);export{Re as default};
//# sourceMappingURL=EntitySearch-C3wVfS0x.js.map
