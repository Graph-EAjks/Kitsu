import{_ as R,m as C,a as L,u as P,b5 as B,i as Q,C as j,b as D,b6 as E,r as h,c as i,o as l,e as r,f as a,l as q,b2 as T,t as n,ab as A,d as u,F as f,g as b,n as I,w as x,a5 as g,k as w,b7 as U,aN as z,ad as K}from"./index-HPQhSyHW.js";const F=[12,24,48],O={name:"entity-search",components:{Checkbox:E,Combobox:D,ComboboxProduction:j,EntityPreview:Q,SearchIcon:B,Spinner:P},data(){return{isLoading:!1,isLoadingMoreAssets:!1,isLoadingMoreShots:!1,limit:F[0],limitOptions:F.map(e=>({label:e,value:e})),productionId:"",selectedIndex:0,searchQuery:"",searchFilter:{assets:!0,shots:!0,persons:!1},results:{assets:[],shots:[],persons:[]}}},mounted(){window.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.altKey&&e.keyCode===70?this.searchField?.focus():e.keyCode===40?this.selectNext():e.keyCode===38&&this.selectPrevious()}),this.$route.query.search&&(this.searchQuery=this.$route.query.search),this.searchField.focus()},computed:{...L(["openProductions","productionMap"]),searchField(){return this.$refs["search-field"]},flattenResults(){let e=[];return this.searchFilter.assets&&(e=e.concat(this.results.assets)),this.searchFilter.shots&&(e=e.concat(this.results.shots)),this.searchFilter.persons&&(e=e.concat(this.results.persons)),e},noSearchFilters(){return!this.searchFilter.assets&&!this.searchFilter.shots},productionList(){return[{id:"",name:this.$t("main.all")}].concat([...this.openProductions])}},methods:{...C(["searchData"]),search(){this.isLoading=!0;const e=Object.entries(this.searchFilter).map(([o,d])=>d?o:void 0).filter(Boolean);this.searchData({query:this.searchQuery,limit:this.limit,productionId:this.productionId,index_names:e}).then(o=>{delete o.persons,this.results=o}).catch(console.error).finally(()=>{this.isLoading=!1})},loadMoreResults(e){const o=[e],d=`isLoadingMore${K.capitalize(e)}`;this[d]=!0,this.searchData({query:this.searchQuery,limit:this.limit,offset:this.results[e].length,productionId:this.productionId,index_names:o}).then(m=>{this.results[e]=this.results[e].concat(m[e])}).catch(console.error).finally(()=>{this[d]=!1})},selectPrevious(){this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.flattenResults.length-1),this.scrollToSelection()},selectNext(){this.selectedIndex++,this.selectedIndex>=this.flattenResults.length&&(this.selectedIndex=0),this.scrollToSelection()},scrollToSelection(){const e=this.flattenResults[this.selectedIndex];e&&document.getElementById(`result-link-${e.id}`).scrollIntoView(!1)},selectResultById(e){this.selectedIndex=this.flattenResults.findIndex(o=>o.id===e)},onResultSelected(){const e=this.flattenResults[this.selectedIndex];e&&document.getElementById(`result-link-${e.id}`).click()},clearSearchResult(){this.results={assets:[],shots:[],persons:[]}},entityPath(e,o){const m=this.productionMap.get(e.project_id).production_type==="tvshow";let t=null;return m&&(t=e.episode_id||"main"),z(e.id,e.project_id,o,t)},personPath(e){return U(e.id)},getMatchDetails(e){const o=e.matched_terms.join(", ");return this.$t("search.match_details",{target:o})}},watch:{productionId(){this.search()},searchQuery(){this.searchQuery.length?this.$router.push({query:{search:this.searchQuery}}):this.$router.push({query:{}}),this.searchQuery.length>2?this.search():this.clearSearchResult(),this.selectedIndex=0}},head(){return{title:`${this.$t("search.title")} - Kitsu`}}},N={class:"entity-search page"},G={class:"search-field"},H={class:"search-icon"},J=["placeholder"],W={class:"search-options pa1 flexrow"},X={class:"flexrow-item no-margin"},Y={class:"search-results mb2"},Z={key:0,class:"has-text-centered"},$={key:1,class:"has-text-centered"},ee={key:2},se={key:3},te={key:0,class:"pb1"},oe={class:"mt0"},le={key:0,class:"has-text-centered"},ie={key:1,class:"result-list"},re=["onMouseover"],ne={class:"production-name"},ce={class:"entity-name"},ae={class:"match"},he={class:"match-icon"},de={key:2,class:"has-text-centered mt2"},ue={key:1,class:"pb1"},me={class:"mt1"},pe={key:0,class:"has-text-centered"},_e={key:1,class:"result-list"},fe=["onMouseover"],ge={class:"production-name"},ye={class:"entity-name"},ke={class:"match"},ve={class:"match-icon"},be={class:"match-details"},Ie={key:2,class:"has-text-centered mt2"};function xe(e,o,d,m,t,c){const V=h("combobox-production"),p=h("search-icon"),y=h("checkbox"),M=h("combobox"),_=h("spinner"),k=h("entity-preview"),v=h("router-link");return l(),i("div",N,[r("form",{class:"search-form",onSubmit:o[5]||(o[5]=A(s=>c.onResultSelected(),["prevent"]))},[r("div",null,[a(V,{class:"flexrow-item production-field",label:e.$t("main.production"),"production-list":c.productionList,modelValue:t.productionId,"onUpdate:modelValue":o[0]||(o[0]=s=>t.productionId=s)},null,8,["label","production-list","modelValue"])]),r("div",G,[r("span",H,[a(p,{size:20})]),q(r("input",{ref:"search-field",class:"input",placeholder:e.$t("search.placeholder"),"onUpdate:modelValue":o[1]||(o[1]=s=>t.searchQuery=s)},null,8,J),[[T,t.searchQuery,void 0,{trim:!0}]])]),r("div",W,[a(y,{class:"flexrow-item",toggle:!0,label:e.$t("assets.title"),onChange:c.search,modelValue:t.searchFilter.assets,"onUpdate:modelValue":o[2]||(o[2]=s=>t.searchFilter.assets=s)},null,8,["label","onChange","modelValue"]),a(y,{class:"flexrow-item",toggle:!0,label:e.$t("shots.title"),onChange:c.search,modelValue:t.searchFilter.shots,"onUpdate:modelValue":o[3]||(o[3]=s=>t.searchFilter.shots=s)},null,8,["label","onChange","modelValue"]),o[8]||(o[8]=r("div",{class:"filler"},null,-1)),r("span",X,n(e.$t("search.limit")),1),a(M,{class:"search-limit flexrow-item",options:t.limitOptions,"with-margin":!1,"onUpdate:modelValue":[c.search,o[4]||(o[4]=s=>t.limit=s)],modelValue:t.limit},null,8,["options","onUpdate:modelValue","modelValue"])])],32),r("div",Y,[t.searchQuery.length<3?(l(),i("div",Z,n(e.$t("main.search.type")),1)):c.noSearchFilters?(l(),i("div",$,n(e.$t("main.search.no_filter")),1)):t.isLoading?(l(),i("div",ee,[a(_)])):(l(),i("div",se,[t.searchFilter.assets?(l(),i("div",te,[r("h2",oe,n(e.$t("assets.title"))+" ("+n(t.results.assets?.length||0)+") ",1),t.results.assets?.length?(l(),i("div",ie,[(l(!0),i(f,null,b(t.results.assets,s=>(l(),i("div",{class:I(["result flexcolumn",{"selected-result":c.flattenResults[t.selectedIndex]===s}]),key:s.id,onMouseover:S=>c.selectResultById(s.id)},[a(k,{"empty-height":200,"empty-width":300,height:200,width:300,entity:s,"is-rounded-top-border":""},null,8,["entity"]),a(v,{class:"result-description",id:`result-link-${s.id}`,to:c.entityPath(s,"asset")},{default:x(()=>[r("div",ne,n(s.project_name),1),r("div",ce,n(s.asset_type_name)+" / "+n(s.name),1),r("div",ae,[r("span",he,[a(p,{size:15})]),g(" "+n(c.getMatchDetails(s)),1)])]),_:2},1032,["id","to"])],42,re))),128))])):(l(),i("div",le,n(e.$t("main.search.no_result")),1)),t.results.assets.length!==0&&t.results.assets.length%12===0?(l(),i("p",de,[t.isLoadingMoreAssets?(l(),w(_,{key:1})):(l(),i("button",{key:0,class:"button is-link",onClick:o[6]||(o[6]=s=>c.loadMoreResults("assets"))},n(e.$t("main.load_more")),1))])):u("",!0)])):u("",!0),t.searchFilter.shots?(l(),i("div",ue,[r("h2",me,n(e.$t("shots.title"))+" ("+n(t.results.shots?.length||0)+") ",1),t.results.shots?.length?(l(),i("div",_e,[(l(!0),i(f,null,b(t.results.shots,s=>(l(),i("div",{class:I(["result flexcolumn",{"selected-result":c.flattenResults[t.selectedIndex]===s}]),key:s.id,onMouseover:S=>c.selectResultById(s.id)},[a(k,{"empty-height":200,"empty-width":300,height:200,width:300,entity:s,"is-rounded-top-border":""},null,8,["entity"]),a(v,{class:"result-description",id:`result-link-${s.id}`,to:c.entityPath(s,"shot")},{default:x(()=>[r("div",ge,n(s.project_name),1),r("div",ye,[s.episode_name?(l(),i(f,{key:0},[g(n(s.episode_name)+" / ",1)],64)):u("",!0),g(" "+n(s.sequence_name)+" / "+n(s.name),1)]),r("div",ke,[r("span",ve,[a(p,{size:15})]),r("span",be,n(c.getMatchDetails(s)),1)])]),_:2},1032,["id","to"])],42,fe))),128))])):(l(),i("div",pe,n(e.$t("main.search.no_result")),1)),t.results.shots.length!==0&&t.results.shots.length%12===0?(l(),i("p",Ie,[t.isLoadingMoreShots?(l(),w(_,{key:1})):(l(),i("button",{key:0,class:"button is-link",onClick:o[7]||(o[7]=s=>c.loadMoreResults("shots"))},n(e.$t("main.load_more")),1))])):u("",!0)])):u("",!0)]))])])}const Fe=R(O,[["render",xe],["__scopeId","data-v-b91adc22"]]);export{Fe as default};
//# sourceMappingURL=EntitySearch-CnzsTWtK.js.map
