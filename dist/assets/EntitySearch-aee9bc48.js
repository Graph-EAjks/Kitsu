import{bw as o,C as d,bx as u,by as m,y as p,m as f,b as _,bz as v,bA as x,n as C}from"./index-6070b869.js";const n=[12,24,48],g={name:"entity-search",mixins:[],components:{Checkbox:o,Combobox:d,EntityPreview:u,SearchIcon:m,Spinner:p},data(){return{isLoading:!1,limit:n[0],limitOptions:n.map(t=>({label:t,value:t})),selectedIndex:0,searchQuery:"",searchFilter:{assets:!0,shots:!0,persons:!1},results:{assets:[],shots:[],persons:[]}}},props:{},mounted(){window.addEventListener("keydown",t=>{t.ctrlKey&&t.altKey&&t.keyCode===70?this.$refs["search-field"]&&this.$refs["search-field"].focus():t.keyCode===40?this.selectNext():t.keyCode===38&&this.selectPrevious()}),this.$route.query.search&&(this.searchQuery=this.$route.query.search),this.searchField.focus()},computed:{...f(["productionMap"]),searchField(){return this.$refs["search-field"]},flattenResults(){let t=[];return this.searchFilter.assets&&(t=t.concat(this.results.assets)),this.searchFilter.shots&&(t=t.concat(this.results.shots)),this.searchFilter.persons&&(t=t.concat(this.results.persons)),t},noSearchFilters(){return!this.searchFilter.assets&&!this.searchFilter.shots}},methods:{..._(["searchData"]),search(){this.isLoading=!0;const t=Object.entries(this.searchFilter).map(([s,e])=>e?s:void 0).filter(Boolean);this.searchData({query:this.searchQuery,limit:this.limit,index_names:t}).then(s=>{delete s.persons,this.results=s}).catch(console.error).finally(()=>{this.isLoading=!1})},selectPrevious(){this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.flattenResults.length-1),this.scrollToSelection()},selectNext(){this.selectedIndex++,this.selectedIndex>=this.flattenResults.length&&(this.selectedIndex=0),this.scrollToSelection()},scrollToSelection(){const t=this.flattenResults[this.selectedIndex];t&&document.getElementById(`result-link-${t.id}`).scrollIntoView(!1)},selectResultById(t){this.selectedIndex=this.flattenResults.findIndex(s=>s.id===t)},onResultSelected(){const t=this.flattenResults[this.selectedIndex];t&&document.getElementById(`result-link-${t.id}`).click()},clearSearchResult(){this.results={assets:[],shots:[],persons:[]}},entityPath(t,s){const r=this.productionMap.get(t.project_id).production_type==="tvshow";let a=null;return r&&(a=t.episode_id||"main"),v(t.id,t.project_id,s,a)},personPath(t){return x(t.id)},getMatchDetails(t){const s=t.matched_terms.join(", ");return this.searchQuery,this.$t("search.match_details",{target:s})}},watch:{searchQuery(){this.searchQuery.length?this.$router.push({query:{search:this.searchQuery}}):this.$router.push({query:{}}),this.searchQuery.length>2?this.search():this.clearSearchResult(),this.selectedIndex=0}},metaInfo(){return{title:`${this.$t("search.title")} - Kitsu`}}};var y=function(){var r,a,l,c;var s=this,e=s._self._c;return e("div",{staticClass:"entity-search page"},[e("form",{staticClass:"search-form",on:{submit:function(i){return i.preventDefault(),s.onResultSelected()}}},[e("div",{staticClass:"search-field"},[e("span",{staticClass:"search-icon"},[e("search-icon",{attrs:{width:"20"}})],1),e("input",{directives:[{name:"model",rawName:"v-model.trim",value:s.searchQuery,expression:"searchQuery",modifiers:{trim:!0}}],ref:"search-field",staticClass:"input",attrs:{placeholder:s.$t("search.placeholder")},domProps:{value:s.searchQuery},on:{input:function(i){i.target.composing||(s.searchQuery=i.target.value.trim())},blur:function(i){return s.$forceUpdate()}}})]),e("div",{staticClass:"search-options pa1 flexrow"},[e("checkbox",{staticClass:"flexrow-item",attrs:{toggle:!0,label:s.$t("assets.title")},on:{change:s.search},model:{value:s.searchFilter.assets,callback:function(i){s.$set(s.searchFilter,"assets",i)},expression:"searchFilter.assets"}}),e("checkbox",{staticClass:"flexrow-item",attrs:{toggle:!0,label:s.$t("shots.title")},on:{change:s.search},model:{value:s.searchFilter.shots,callback:function(i){s.$set(s.searchFilter,"shots",i)},expression:"searchFilter.shots"}}),e("div",{staticClass:"filler"}),e("span",{staticClass:"flexrow-item no-margin"},[s._v(" "+s._s(s.$t("search.limit"))+" ")]),e("combobox",{staticClass:"search-limit flexrow-item",attrs:{options:s.limitOptions,"with-margin":!1},on:{input:s.search},model:{value:s.limit,callback:function(i){s.limit=i},expression:"limit"}})],1)]),e("div",{staticClass:"search-results mb2"},[s.searchQuery.length<3?e("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.type"))+" ")]):s.noSearchFilters?e("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.no_filter"))+" ")]):s.isLoading?e("div",[e("spinner")],1):e("div",[this.searchFilter.assets?e("div",{staticClass:"pb1"},[e("h2",{staticClass:"mt0"},[s._v(" "+s._s(s.$t("assets.title"))+" ("+s._s(((r=this.results.assets)==null?void 0:r.length)||0)+") ")]),(a=this.results.assets)!=null&&a.length?e("div",{staticClass:"result-list"},s._l(this.results.assets,function(i){return e("div",{key:i.id,staticClass:"result flexcolumn",class:{"selected-result":s.flattenResults[s.selectedIndex]===i},on:{mouseover:function(h){return s.selectResultById(i.id)}}},[e("entity-preview",{attrs:{"empty-height":200,"empty-width":300,height:200,width:300,entity:i,"is-rounded-top-border":""}}),e("router-link",{staticClass:"result-description",attrs:{id:`result-link-${i.id}`,to:s.entityPath(i,"asset")}},[e("div",{staticClass:"production-name"},[s._v(" "+s._s(i.project_name)+" ")]),e("div",{staticClass:"entity-name"},[s._v(" "+s._s(i.asset_type_name)+" / "+s._s(i.name)+" ")]),e("div",{staticClass:"match"},[e("span",{staticClass:"match-icon"},[e("search-icon",{attrs:{width:"15"}})],1),s._v(" "+s._s(s.getMatchDetails(i))+" ")])])],1)}),0):e("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.no_result"))+" ")])]):s._e(),this.searchFilter.shots?e("div",{staticClass:"pb1"},[e("h2",{staticClass:"mt0"},[s._v(" "+s._s(s.$t("shots.title"))+" ("+s._s(((l=this.results.shots)==null?void 0:l.length)||0)+") ")]),(c=this.results.shots)!=null&&c.length?e("div",{staticClass:"result-list"},s._l(this.results.shots,function(i){return e("div",{key:i.id,staticClass:"result flexcolumn",class:{"selected-result":s.flattenResults[s.selectedIndex]===i},on:{mouseover:function(h){return s.selectResultById(i.id)}}},[e("entity-preview",{attrs:{"empty-height":200,"empty-width":300,height:200,width:300,entity:i,"is-rounded-top-border":""}}),e("router-link",{staticClass:"result-description",attrs:{id:`result-link-${i.id}`,to:s.entityPath(i,"shot")}},[e("div",{staticClass:"production-name"},[s._v(" "+s._s(i.project_name)+" ")]),e("div",{staticClass:"entity-name"},[i.episode_name?[s._v(" "+s._s(i.episode_name)+" / ")]:s._e(),s._v(" "+s._s(i.sequence_name)+" / "+s._s(i.name)+" ")],2),e("div",{staticClass:"match"},[e("span",{staticClass:"match-icon"},[e("search-icon",{attrs:{width:"15"}})],1),e("span",{staticClass:"match-details"},[s._v(s._s(s.getMatchDetails(i)))])])])],1)}),0):e("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.no_result"))+" ")])]):s._e()])])])},b=[],$=C(g,y,b,!1,null,"b6a6e87f",null,null);const w=$.exports;export{w as default};
//# sourceMappingURL=EntitySearch-aee9bc48.js.map
