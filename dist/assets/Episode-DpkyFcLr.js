import{_ as F,m as O,a as W,O as j,H as G,T as H,Q as K,R as Q,h as X,U as Y,E as Z,X as J,Y as x,Z as $,B as ee,z as te,r as n,c as l,o,e as s,l as u,f as d,w as f,k as m,d as p,$ as h,t as r,F as g,g as E,a5 as se,b8 as ie,b9 as w}from"./index-BhbDJBAS.js";import{E as oe,a as ne,b as re,c as ae,e as le}from"./EntityTaskList-Bd0G4ssu.js";import{E as de}from"./EditEpisodeModal-BRgo851p.js";import{E as ce}from"./EntityChat-BHE3AcAp.js";import"./PeopleNameCell--1LNjVXS.js";const ue={name:"episode",mixins:[le,te],components:{ButtonSimple:ee,ComboboxNumber:$,CornerLeftUpIcon:x,DescriptionCell:J,EditEpisodeModal:de,EntityChat:ce,EntityNews:ae,EntityPreviewFiles:re,EntityTaskList:ne,EntityTimeLogs:oe,EntityThumbnail:Z,PageSubtitle:Y,PageTitle:X,RouteSectionTabs:Q,Schedule:K,TableInfo:H,TaskInfo:G,TaskTypeName:j},data(){return{type:"episode",currentEpisode:null,currentTask:null,casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...W(["currentProduction","getTaskTypePriority","episodeMap","episodeMetadataDescriptors","episodeSearchText","isCurrentUserManager","route","taskMap","taskTypeMap"]),title(){return this.currentEpisode?`${this.currentEpisode.name}`:"Loading..."},currentEntity(){return this.currentEpisode},getEpisodesRoute(){const e={name:"episodes",params:{production_id:this.currentProduction.id,project_id:this.currentProduction.id},query:{search:this.episodeSearchText}};return e.name="episodes",e},nbAssets(){let e=0;return this.currentEpisode&&this.currentSection==="casting"&&this.currentEpisode.castingAssetsByType&&this.currentEpisode.castingAssetsByType.forEach(i=>{e+=i.length}),e}},methods:{...O(["clearSelectedTasks","editEpisode","setCurrentEpisode","loadEpisodesWithTasks","loadEpisodeCasting"]),init(){this.loadCurrentEpisode().then(e=>{this.currentEpisode=e,this.currentSection=this.route.query.section||"infos",this.casting.isLoading=!0,this.casting.isError=!1,this.currentEpisode?this.loadEpisodeCasting(this.currentEpisode).then(()=>{this.casting.isLoading=!1}).catch(i=>{this.casting.isLoading=!1,this.casting.isError=!0,console.error(i)}):this.resetData()}).catch(console.error)},async loadCurrentEpisode(){const e=this.route.params.episode_id,i=w.cache.episodeMap.get(e)||null;return!i||!i.validations?(await this.loadEpisodesWithTasks(),w.cache.episodeMap.get(e)||null):i},confirmEditEpisode(e){e.id=this.currentEpisode.id,this.loading.edit=!0,this.errors.edit=!1,this.editEpisode(e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(i=>{console.error(i),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(e){const i=this.currentEpisode.id,y={name:"asset",params:{production_id:this.currentProduction.id,asset_id:e.asset_id}};return ie(y,i)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.loadCurrentEpisode().then(e=>(this.currentEpisode=e,this.loadEpisodeCasting(this.currentEpisode))).then(()=>{this.casting.isLoading=!1}).catch(e=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(e)})})}},head(){return{title:`${this.title} - Kitsu`}}},pe={class:"columns fixed-page episode xyz-in",xyz:"fade"},he={class:"column main-column"},me={class:"page-header flexrow"},_e={class:"flexrow-item ml2"},ye={class:"flexrow-item"},fe={class:"episode-data block"},ge={class:"flexrow infos"},Ee={class:"flexrow-item flexcolumn entity-infos"},ke={class:"flexrow"},be={class:"flexrow-item has-text-right"},ve={class:"table-body"},we={key:0,class:"datatable no-header"},Te={class:"table-body"},Se={class:"datatable-row"},Ce={class:"field-label"},Le={key:0,class:"datatable-row"},Me={class:"field-label"},ze={class:"field-label"},Be={class:"flexrow"},De={class:"episode-casting"},Pe={key:0},Ie={key:0},Ne={class:"asset-type"},Re={class:"asset-list"},Ae={class:"break-word"},Ve={key:0},Ue={class:"ready-for flexrow"},qe={key:1,class:"mt1"},Fe={key:0,class:"schedule mt1"},Oe={class:"wrapper"},We={class:"column side-column"};function je(e,i,y,Ge,t,_){const T=n("corner-left-up-icon"),k=n("router-link"),b=n("entity-thumbnail"),S=n("page-title"),C=n("route-section-tabs"),v=n("page-subtitle"),L=n("entity-task-list"),M=n("button-simple"),z=n("description-cell"),B=n("combobox-number"),D=n("task-type-name"),P=n("table-info"),I=n("schedule"),N=n("entity-chat"),R=n("entity-preview-files"),A=n("entity-time-logs"),V=n("entity-news"),U=n("task-info"),q=n("edit-episode-modal");return o(),l("div",pe,[s("div",he,[s("div",me,[d(k,{class:"flexrow-item has-text-centered back-link",to:_.getEpisodesRoute},{default:f(()=>[d(T)]),_:1},8,["to"]),s("span",_e,[t.currentEpisode?(o(),m(b,{key:0,class:"entity-thumbnail",entity:t.currentEpisode,"empty-width":120,"empty-height":50,width:120},null,8,["entity"])):p("",!0)]),s("div",ye,[d(S,{text:_.title,class:"entity-title"},null,8,["text"])])]),s("div",fe,[d(C,{class:"section-tabs","active-tab":e.currentSection,route:e.$route,tabs:e.entityNavOptions},null,8,["active-tab","route","tabs"]),u(s("div",ge,[s("div",Ee,[d(v,{text:e.$t("main.tasks")},null,8,["text"]),d(L,{class:"task-list",entries:e.currentTasks,"is-loading":!t.currentEpisode,"is-error":!1,onTaskSelected:e.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",ke,[d(v,{text:e.$t("main.info")},null,8,["text"]),i[3]||(i[3]=s("div",{class:"filler"},null,-1)),s("div",be,[e.isCurrentUserManager?(o(),m(M,{key:0,icon:"edit",title:e.$t("episodes.edit_title"),onClick:i[0]||(i[0]=a=>t.modals.edit=!0)},null,8,["title"])):p("",!0)])]),s("div",ve,[t.currentEpisode?(o(),l("table",we,[s("tbody",Te,[s("tr",Se,[s("td",Ce,r(e.$t("shots.fields.description")),1),d(z,{entry:t.currentEpisode,full:!0},null,8,["entry"])]),t.currentEpisode&&t.currentEpisode.data&&t.currentEpisode.data.resolution?(o(),l("tr",Le,[s("td",Me,r(e.$t("shots.fields.resolution")),1),s("td",null,r(t.currentEpisode?t.currentEpisode.data.resolution:""),1)])):p("",!0),(o(!0),l(g,null,E(e.episodeMetadataDescriptors,a=>(o(),l("tr",{key:a.id,class:"datatable-row"},[s("td",ze,r(a.name),1),s("td",null,r(t.currentEpisode.data?t.currentEpisode.data[a.field_name]:""),1)]))),128))])])):p("",!0)])])],512),[[h,e.currentSection==="infos"]]),s("div",Be,[u(s("span",null,r(_.nbAssets)+" "+r(e.$tc("assets.number",_.nbAssets)),513),[[h,e.currentSection==="casting"]]),u(s("span",{class:"tag tag-standby"},r(e.$t("breakdown.fields.standby")),513),[[h,e.currentSection==="casting"&&t.currentEpisode.is_casting_standby]]),i[4]||(i[4]=s("div",{class:"filler"},null,-1)),u(s("span",{class:"flexrow-item mt05"},r(e.$t("schedule.zoom_level"))+": ",513),[[h,e.currentSection==="schedule"]]),u(d(B,{class:"zoom-level flexrow-item",options:e.zoomOptions,"is-simple":"",modelValue:e.zoomLevel,"onUpdate:modelValue":i[1]||(i[1]=a=>e.zoomLevel=a)},null,8,["options","modelValue"]),[[h,e.currentSection==="schedule"]])]),u(s("div",De,[t.currentEpisode?(o(),l("div",Pe,[t.currentEpisode&&t.currentEpisode.castingAssetsByType&&t.currentEpisode.castingAssetsByType[0].length>0?(o(),l("div",Ie,[(o(!0),l(g,null,E(t.currentEpisode.castingAssetsByType,a=>(o(),l("div",{class:"type-assets",key:a.length>0?a[0].asset_type_name:""},[s("div",Ne,r(a.length>0?a[0].asset_type_name:"")+" ("+r(a.length)+") ",1),s("div",Re,[(o(!0),l(g,null,E(a,c=>(o(),m(k,{class:"asset-link",key:c.id,to:_.buildAssetRoute(c)},{default:f(()=>[d(b,{class:"entity-thumbnail",entity:c,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["entity"]),s("div",Ae,[se(r(c.asset_name)+" ",1),c.nb_occurences>1?(o(),l("span",Ve," ("+r(c.nb_occurences)+") ",1)):p("",!0)]),s("div",Ue,[c.ready_for?(o(),m(D,{key:0,class:"flexrow-item","task-type":e.taskTypeMap.get(c.ready_for),"current-production-id":e.currentProduction.id,title:"Ready for: "+e.taskTypeMap.get(c.ready_for).name},null,8,["task-type","current-production-id","title"])):p("",!0)])]),_:2},1032,["to"]))),128))])]))),128))])):(o(),l("div",qe,r(e.$t("episodes.no_casting")),1))])):(o(),m(P,{key:1,"is-loading":t.casting.isLoading,"is-error":t.casting.isError},null,8,["is-loading","is-error"]))],512),[[h,e.currentSection==="casting"]]),e.scheduleItems[0].children.length>0?u((o(),l("div",Fe,[s("div",Oe,[d(I,{ref:"schedule-widget","start-date":e.tasksStartDate,"end-date":e.tasksEndDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1},null,8,["start-date","end-date","hierarchy","zoom-level"])])],512)),[[h,e.currentSection==="schedule"]]):u((o(),l("div",{key:1,class:"mt1"},r(e.$t("main.empty_schedule")),513)),[[h,e.currentSection==="schedule"]]),e.currentSection==="chat"?(o(),m(N,{key:2,entity:t.currentEpisode,name:t.currentEpisode?.name},null,8,["entity","name"])):p("",!0),e.currentSection==="preview-files"?(o(),m(R,{key:3,entity:t.currentEpisode},null,8,["entity"])):p("",!0),e.currentSection==="time-logs"?(o(),m(A,{key:4,entity:t.currentEpisode},null,8,["entity"])):p("",!0)])]),u(s("div",We,[d(U,{task:t.currentTask,"entity-type":"Episode","with-actions":""},{default:f(()=>[d(V,{class:"news-column",entity:t.currentEpisode},null,8,["entity"])]),_:1},8,["task"])],512),[[h,e.currentSection==="infos"]]),d(q,{ref:"edit-episode-modal",active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"episode-to-edit":t.currentEpisode,onCancel:i[2]||(i[2]=a=>t.modals.edit=!1),onConfirm:_.confirmEditEpisode},null,8,["active","is-loading","is-error","episode-to-edit","onConfirm"])])}const Ze=F(ue,[["render",je],["__scopeId","data-v-4050b4d8"]]);export{Ze as default};
//# sourceMappingURL=Episode-DpkyFcLr.js.map
