import{v as i,b6 as c,A as u,l as d,m as h,b7 as o,b as m,b8 as p,b9 as f,ba as r,bb as n,bc as D,bd as v,n as b}from"./index-CcBNbOMa.js";const _={name:"main-schedule",components:{ComboboxNumber:i,Datepicker:c,Schedule:u},data(){return{endDate:d().add(6,"months"),scheduleItems:[],startDate:d(),selectedStartDate:null,selectedEndDate:null,zoomLevel:0,zoomOptions:[{label:"Week",value:0},{label:"1",value:1},{label:"2",value:2},{label:"3",value:3}],loading:{schedule:!1},errors:{schedule:!1}}},mounted(){let t=parseInt(this.$route.query.zoom);t=isNaN(t)?1:t,this.zoomLevel=Math.min(Math.max(t,0),3),this.init()},computed:{...h(["openProductions","taskTypeMap","user"]),locale(){return this.user.locale==="fr_FR"?o.fr:o.en}},methods:{...m(["editProduction","loadScheduleItems","saveScheduleItem"]),init(){this.openProductions.length&&(this.scheduleItems=this.convertScheduleItems(this.openProductions),this.startDate=p(this.scheduleItems),this.endDate=f(this.scheduleItems),this.selectedStartDate=this.startDate.toDate(),this.selectedEndDate=this.endDate.toDate())},convertScheduleItems(t){return t.map(e=>{const a=r(e.start_date),s=n(a,e.end_date);return{...e,avatar:e.type==="Project",color:e.color||D.fromString(e.name,!0),startDate:a,endDate:s,expanded:!1,loading:!1,editable:!0,route:v(e.id),children:[]}})},convertTaskTypeScheduleItems(t){return t.map(e=>{const a=r(e.start_date),s=n(a,e.end_date),l=this.taskTypeMap.get(e.task_type_id);return{...e,name:l.name,color:l.color,startDate:a,endDate:s,expanded:!1,loading:!1,editable:!0,children:[]}})},expandProductionElement(t){t.expanded?t.expanded=!1:(t.loading=!0,t.expanded=!0,this.loadScheduleItems(t).then(e=>{e=this.convertTaskTypeScheduleItems(e),t.children=e,t.loading=!1}))},onScheduleItemChanged(t){t.type!=="Project"?this.saveScheduleItem(t):this.editProduction({id:t.id,start_date:t.startDate.format("YYYY-MM-DD"),end_date:t.endDate.format("YYYY-MM-DD")})},updateRoute({zoom:t}){const e={...this.$route.query};t!==void 0&&(e.zoom=String(t)),JSON.stringify(e)!==JSON.stringify(this.$route.query)&&this.$router.push({query:e})}},watch:{zoomLevel(t){this.updateRoute({zoom:t})}},metaInfo(){return{title:`${this.$t("schedule.title_main")} - Kitsu`}}};var g=function(){var e=this,a=e._self._c;return a("div",{staticClass:"columns fixed-page"},[a("div",{staticClass:"column main-column"},[a("div",{staticClass:"flexrow project-dates"},[a("div",{staticClass:"flexrow-item"},[a("label",{staticClass:"label"},[e._v(" "+e._s(e.$t("main.start_date"))+" ")]),a("datepicker",{attrs:{"wrapper-class":"datepicker","input-class":"date-input input short",language:e.locale,"disabled-dates":{days:[6,0]},"monday-first":!0,format:"yyyy-MM-dd",disabled:""},model:{value:e.selectedStartDate,callback:function(s){e.selectedStartDate=s},expression:"selectedStartDate"}})],1),a("div",{staticClass:"flexrow-item field"},[a("label",{staticClass:"label"},[e._v(" "+e._s(e.$t("main.end_date"))+" ")]),a("datepicker",{attrs:{"wrapper-class":"datepicker","input-class":"date-input input short",language:e.locale,"disabled-dates":{days:[6,0]},"monday-first":!0,format:"yyyy-MM-dd",disabled:""},model:{value:e.selectedEndDate,callback:function(s){e.selectedEndDate=s},expression:"selectedEndDate"}})],1),a("combobox-number",{staticClass:"flexrow-item zoom-level",attrs:{label:e.$t("schedule.zoom_level"),options:e.zoomOptions},model:{value:e.zoomLevel,callback:function(s){e.zoomLevel=s},expression:"zoomLevel"}})],1),a("schedule",{attrs:{"end-date":e.endDate,hierarchy:e.scheduleItems,"is-loading":e.loading.schedule,"is-error":e.errors.schedule,"start-date":e.startDate,"zoom-level":e.zoomLevel,"hide-man-days":!0,"with-milestones":!1},on:{"item-changed":e.onScheduleItemChanged,"root-element-expanded":e.expandProductionElement}})],1)])},y=[],S=b(_,g,y,!1,null,"fb648ae7");const z=S.exports;export{z as default};
//# sourceMappingURL=MainSchedule-DVm5YMWV.js.map
