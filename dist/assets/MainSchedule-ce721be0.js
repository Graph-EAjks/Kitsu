import{R as d,a as c,b as i,bs as u,bt as h,bE as o,bF as n,e as m,bG as p,n as f}from"./TaskInfo-563596ae.js";import{C as D,N as _,S as v,O as r}from"./index-96a9ca19.js";const b={name:"production-schedule",components:{ComboboxNumber:D,Datepicker:_,Schedule:v},data(){return{endDate:d().add(6,"months"),scheduleItems:[],startDate:d(),selectedStartDate:null,selectedEndDate:null,zoomLevel:0,zoomOptions:[{label:"Week",value:0},{label:"1",value:1},{label:"2",value:2},{label:"3",value:3}],loading:{schedule:!1},errors:{schedule:!1}}},mounted(){this.reset()},computed:{...c(["openProductions","taskTypeMap","user"]),locale(){return this.user.locale==="fr_FR"?r.fr:r.en}},methods:{...i(["editProduction","loadScheduleItems","saveScheduleItem"]),changeZoom(t){t.wheelDelta<0&&this.zoomLevel>1&&this.zoomLevel--,t.wheelDelta>0&&this.zoomLevel<3&&this.zoomLevel++},reset(){this.scheduleItems=this.convertScheduleItems(this.openProductions),this.startDate=u(this.scheduleItems),this.endDate=h(this.scheduleItems),this.selectedStartDate=this.startDate.toDate(),this.selectedEndDate=this.endDate.toDate()},convertScheduleItems(t){return t.map(e=>{const a=o(e.start_date),s=n(a,e.end_date);return{...e,avatar:e.type==="Project",color:e.color||m.fromString(e.name,!0),startDate:a,endDate:s,expanded:!1,loading:!1,editable:!0,route:p(e.id),children:[]}})},convertTaskTypeScheduleItems(t){return t.map(e=>{const a=o(e.start_date),s=n(a,e.end_date),l=this.taskTypeMap.get(e.task_type_id);return{...e,name:l.name,color:l.color,startDate:a,endDate:s,expanded:!1,loading:!1,editable:!0,children:[]}})},expandProductionElement(t){t.expanded?t.expanded=!1:(t.loading=!0,t.expanded=!0,this.loadScheduleItems(t).then(e=>{e=this.convertTaskTypeScheduleItems(e),t.children=e,t.loading=!1}))},onScheduleItemChanged(t){t.type!=="Project"?this.saveScheduleItem(t):this.editProduction({id:t.id,start_date:t.startDate.format("YYYY-MM-DD"),end_date:t.endDate.format("YYYY-MM-DD")})}},socket:{},watch:{},metaInfo(){return{title:`${this.$t("schedule.title_main")} - Kitsu`}}};var g=function(){var e=this,a=e._self._c;return a("div",{staticClass:"columns fixed-page"},[a("div",{staticClass:"column main-column"},[a("div",{staticClass:"flexrow project-dates"},[a("div",{staticClass:"flexrow-item"},[a("label",{staticClass:"label"},[e._v(" "+e._s(e.$t("main.start_date"))+" ")]),a("datepicker",{attrs:{"wrapper-class":"datepicker","input-class":"date-input input",language:e.locale,"disabled-dates":{days:[6,0]},"monday-first":!0,format:"yyyy-MM-dd",disabled:""},model:{value:e.selectedStartDate,callback:function(s){e.selectedStartDate=s},expression:"selectedStartDate"}})],1),a("div",{staticClass:"flexrow-item field"},[a("label",{staticClass:"label"},[e._v(" "+e._s(e.$t("main.end_date"))+" ")]),a("datepicker",{attrs:{"wrapper-class":"datepicker","input-class":"date-input input",language:e.locale,"disabled-dates":{days:[6,0]},"monday-first":!0,format:"yyyy-MM-dd",disabled:""},model:{value:e.selectedEndDate,callback:function(s){e.selectedEndDate=s},expression:"selectedEndDate"}})],1),a("combobox-number",{staticClass:"flexrow-item zoom-level",attrs:{label:e.$t("schedule.zoom_level"),options:e.zoomOptions},model:{value:e.zoomLevel,callback:function(s){e.zoomLevel=s},expression:"zoomLevel"}})],1),a("schedule",{attrs:{"end-date":e.endDate,hierarchy:e.scheduleItems,"is-loading":e.loading.schedule,"is-error":e.errors.schedule,"start-date":e.startDate,"zoom-level":e.zoomLevel,"hide-man-days":!0},on:{"item-changed":e.onScheduleItemChanged,"change-zoom":e.changeZoom,"root-element-expanded":e.expandProductionElement}})],1)])},S=[],y=f(b,g,S,!1,null,"bce81af1",null,null);const z=y.exports;export{z as default};
//# sourceMappingURL=MainSchedule-ce721be0.js.map
