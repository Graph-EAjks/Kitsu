import{a3 as l,T as c,ae as d,h as u,a as p,bj as k,R as m,a0 as r,b as _,s as n,n as h}from"./TaskInfo-9c7a144a.js";import{A as y,n as f,Q as T,U as b,W as v,X as C}from"./index-01c86967.js";import{C as S}from"./ComboboxProduction-8bbc54cd.js";const x={name:"todos",components:{ActionPanel:y,ButtonSimple:l,Combobox:c,ComboboxProduction:S,ComboboxTaskType:f,TaskInfo:d,TimesheetList:T,TodosList:b,ViewPlaylistModal:v},data(){return{currentFilter:"all_tasks",currentSort:"priority",isLoading:!1,isLoadingError:!1,isPlaylist:!1,filterOptions:["all_tasks","due_this_week"].map(e=>({label:e,value:e})),productionId:"",productionList:[],selectionGrid:{},sortOptions:["entity_name","priority","due_date","estimation","last_comment_date"].map(e=>({label:e,value:e})),taskTypeId:"",taskTypeList:[],tasksToCheck:[]}},mounted(){this.isLoading=!0,this.loadTasksToCheck().then(e=>{e&&(e.forEach(u),this.buildSelectionGrid(e),this.resetProductionList(e),this.resetTaskTypeList(e),this.tasksToCheck=e,this.isLoading=!1)}).catch(e=>{console.error(e)})},afterDestroy(){},computed:{...p(["nbSelectedTasks","productionMap","taskStatusMap","taskTypeMap","selectedTasks"]),nbTasksToCheck(){return this.sortedTasks.filter(e=>this.taskStatusMap.get(e.task_status_id).is_feedback_request).length},sortedTasks(){const e=this.currentSort==="entity_name",t=this.currentSort==="priority",a=this.currentSort==="due_date";let s=this.currentFilter==="all_tasks"?[...this.tasksToCheck]:this.tasksToCheck.filter(i=>{const o=k(i.due_date);return m().startOf("week").isSame(o,"week")});return this.productionId!==""&&(s=s.filter(i=>i.project_id===this.productionId)),this.taskTypeId!==""&&(s=s.filter(i=>i.task_type_id===this.taskTypeId)),e?s.sort(r("project_name").thenBy("task_type_name").thenBy("full_entity_name")):t?s.sort(r("priority",-1).thenBy((i,o)=>i.due_date?o.due_date?i.due_date.localeCompare(o.due_date):-1:1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name")):a?s.sort(r((i,o)=>i.due_date?o.due_date?i.due_date.localeCompare(o.due_date):-1:1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name")):s.sort(r(this.currentSort,-1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name"))}},methods:{..._(["loadTasksToCheck","removeTodoSearch","saveTodoSearch","setTodosSearch"]),buildSelectionGrid(e){this.selectionGrid=C(e.length,1)},resetProductionList(e=[]){const t={},a=[];e.forEach(s=>{t[s.project_id]||(t[s.project_id]=!0,a.push(this.productionMap.get(s.project_id)))}),this.productionList=[{id:"",name:this.$t("main.all")}].concat(n(a))},resetTaskTypeList(e){const t={},a=[];e.forEach(s=>{t[s.task_type_id]||(t[s.task_type_id]=!0,a.push(this.taskTypeMap.get(s.task_type_id)))}),this.taskTypeList=[{id:"",color:"#999",name:this.$t("news.all")}].concat(n(a))},onTaskSelectionCleared(){this.buildSelectionGrid(this.sortedTasks)},onTaskSelectionAdded(e){this.selectionGrid[e.x][e.y]=!0},onTaskSelectionRemoved(e){this.selectionGrid[e.x][e.y]=!1}},socket:{events:{"task:assign"(e){},"task:unassign"(e){}}},watch:{nbSelectedTasks(){this.nbSelectedTasks===0&&this.buildSelectionGrid(this.sortedTasks)}},metaInfo(){return{title:`${this.$t("tasks.my_checks")} - Kitsu`}}};var L=function(){var t=this,a=t._self._c;return a("div",{staticClass:"columns fixed-page"},[a("div",{staticClass:"column main-column"},[a("div",{staticClass:"todos page"},[a("div",{staticClass:"flexrow"},[t.productionList.length>0?a("combobox-production",{staticClass:"flexrow-item",attrs:{label:t.$t("main.production"),"production-list":t.productionList},model:{value:t.productionId,callback:function(s){t.productionId=s},expression:"productionId"}}):t._e(),t.taskTypeList.length>0?a("combobox-task-type",{staticClass:"flexrow-item selector",attrs:{label:t.$t("news.task_type"),"task-type-list":t.taskTypeList},model:{value:t.taskTypeId,callback:function(s){t.taskTypeId=s},expression:"taskTypeId"}}):t._e(),a("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("main.show"),options:t.filterOptions,"locale-key-prefix":"tasks."},model:{value:t.currentFilter,callback:function(s){t.currentFilter=s},expression:"currentFilter"}}),a("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("main.sorted_by"),options:t.sortOptions,"locale-key-prefix":"tasks.fields."},model:{value:t.currentSort,callback:function(s){t.currentSort=s},expression:"currentSort"}})],1),a("div",{staticClass:"flexrow"},[a("h1",{staticClass:"title mt1 flerow-item"},[t._v(" "+t._s(t.nbTasksToCheck)+" tasks to check ")]),a("div",{staticClass:"filler"}),a("ButtonSimple",{staticClass:"flexrow-item",attrs:{text:"Build playlist from list"},on:{click:function(s){t.isPlaylist=!0}}})],1),a("todos-list",{attrs:{tasks:t.sortedTasks,"is-loading":t.isLoading,"is-error":t.isLoadingError,"selection-grid":t.selectionGrid,"is-to-check":!0},on:{"task-selection-cleared":t.onTaskSelectionCleared,"task-selection-addition":t.onTaskSelectionAdded,"task-selection-removal":t.onTaskSelectionRemoved}})],1)]),t.nbSelectedTasks===1?a("div",{staticClass:"column side-column"},[a("task-info",{attrs:{task:t.selectedTasks.values().next().value}})],1):t._e(),a("view-playlist-modal",{attrs:{active:t.isPlaylist,"task-ids":t.sortedTasks.map(s=>s.id)},on:{cancel:function(s){t.isPlaylist=!1}}})],1)},g=[],w=h(x,L,g,!1,null,"ffa54997",null,null);const P=w.exports;export{P as default};
//# sourceMappingURL=MyChecks-3e79b960.js.map
