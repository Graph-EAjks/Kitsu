import{_ as w,B as L,C as V,a as x,H as B,G as M,I as G,J as E,bC as P,bD as j,bE as D,m as O,K as U,bF as F,z as A,j as u,b as N,bG as R,Y as m,r as n,o as c,c as f,e as d,l as h,d as p,n as K,$ as q,f as r,t as _}from"./index-a83mlrHR.js";const z={name:"my-checks",components:{ButtonSimple:L,Combobox:V,ComboboxProduction:x,ComboboxStatus:B,ComboboxTaskType:M,PeopleField:G,TaskInfo:E,TodosList:P,ViewPlaylistModal:j},data(){return{currentFilter:"all_tasks",currentSort:"priority",episodeId:"",isLoading:!1,isLoadingError:!1,isPlaylist:!1,filterOptions:["all_tasks","due_this_week"].map(e=>({label:e,value:e})),person:{},productionId:"",productionList:[],selectionGrid:{},sortOptions:["entity_name","priority","due_date","estimation","last_comment_date"].map(e=>({label:e,value:e})),taskStatusId:"",taskTypeId:"",taskStatusList:[],taskTypeList:[],tasksToCheck:[]}},mounted(){this.isLoading=!0,this.clearSelectedTasks(),this.loadTasksToCheck().then(e=>{e&&(e.forEach(D),this.buildSelectionGrid(e),this.resetProductionList(e),this.resetTaskTypeList(e),this.resetTaskStatusList(e),this.tasksToCheck=e,this.isLoading=!1)}).catch(e=>{console.error(e)})},computed:{...O(["nbSelectedTasks","personMap","productionMap","selectedTasks","taskStatusMap","taskTypeMap"]),nbTasksToCheck(){return this.sortedTasks.filter(e=>this.taskStatusMap.get(e.task_status_id).is_feedback_request).length},assignees(){const e=[],t={};return this.tasksToCheck.forEach(l=>{l.assignees.forEach(o=>{t[o]||(e.push(this.personMap.get(o)),t[o]=!0)})}),U(e)},episodeOptions(){const e=[],t={};return this.productionId?this.productionMap.get(this.productionId).production_type!=="tvshow"?[]:(this.tasksToCheck.filter(o=>o.project_id===this.productionId).forEach(o=>{o.episode_id&&!t[o.episode_id]&&o.entity_type_name==="Shot"&&(t[o.episode_id]=!0,e.push({label:o.episode_name,value:o.episode_id}))}),[{label:this.$t("main.all"),value:"all"}].concat(e.sort((o,s)=>o.label.localeCompare(s.label,void 0,{numeric:!0})))):[]},filteredTasks(){let e=this.currentFilter==="all_tasks"?[...this.tasksToCheck]:this.tasksToCheck.filter(t=>{const l=F(t.due_date);return A().startOf("week").isSame(l,"week")});return this.productionId!==""&&(e=e.filter(t=>t.project_id===this.productionId)),this.taskTypeId!==""&&(e=e.filter(t=>t.task_type_id===this.taskTypeId)),this.taskStatusId!==""&&(e=e.filter(t=>t.task_status_id===this.taskStatusId)),this.person&&this.person.id&&(e=e.filter(t=>t.assignees.includes(this.person.id))),this.productionId&&this.episodeId&&this.episodeId!=="all"&&(e=e.filter(t=>t.episode_id===this.episodeId)),e},sortedTasks(){const e=this.currentSort==="entity_name",t=this.currentSort==="priority",l=this.currentSort==="due_date",o=[...this.filteredTasks];return e?o.sort(u("project_name").thenBy("task_type_name").thenBy("full_entity_name")):t?o.sort(u("priority",-1).thenBy((s,a)=>s.due_date?a.due_date?s.due_date.localeCompare(a.due_date):-1:1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name")):l?o.sort(u((s,a)=>s.due_date?a.due_date?s.due_date.localeCompare(a.due_date):-1:1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name")):o.sort(u(this.currentSort,-1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name"))}},methods:{...N(["clearSelectedTasks","loadTasksToCheck","removeTodoSearch","saveTodoSearch","setTodosSearch"]),buildSelectionGrid(e){this.selectionGrid=R(e.length,1)},resetProductionList(e=[]){const t={},l=[];e.forEach(o=>{t[o.project_id]||(t[o.project_id]=!0,l.push(this.productionMap.get(o.project_id)))}),this.productionList=[{id:"",name:this.$t("main.all")}].concat(m(l))},resetTaskTypeList(e){const t={},l=[];e.forEach(o=>{t[o.task_type_id]||(t[o.task_type_id]=!0,l.push(this.taskTypeMap.get(o.task_type_id)))}),this.taskTypeList=[{id:"",color:"#999",name:this.$t("news.all")}].concat(m(l))},resetTaskStatusList(e){const t={},l=[];e.forEach(o=>{t[o.task_status_id]||(t[o.task_status_id]=!0,l.push(this.taskStatusMap.get(o.task_status_id)))}),this.taskStatusList=[{id:"",color:"#999",name:this.$t("news.all"),short_name:this.$t("news.all")}].concat(m(l))},onTaskSelectionCleared(){this.buildSelectionGrid(this.sortedTasks)},onTaskSelectionAdded(e){this.selectionGrid[e.x][e.y]=!0},onTaskSelectionRemoved(e){this.selectionGrid[e.x][e.y]=!1}},socket:{events:{"task:assign"(e){},"task:unassign"(e){}}},watch:{productionId(){this.episodeId=""},nbSelectedTasks(){this.nbSelectedTasks===0&&this.buildSelectionGrid(this.sortedTasks)}},head(){return{title:`${this.$t("tasks.my_checks")} - Kitsu`}}},H={class:"columns fixed-page"},J={class:"column main-column"},Y={class:"todos page"},Q={class:"flexrow"},W={class:"field flexrow-item selector"},X={class:"label person-label"},Z={class:"flexrow"},$={class:"title mt1 flexrow-item filler"},ee={key:0,class:"column side-column"};function te(e,t,l,o,s,a){const y=n("combobox-production"),k=n("combobox"),T=n("combobox-task-type"),b=n("combobox-status"),S=n("people-field"),v=n("button-simple"),g=n("todos-list"),I=n("task-info"),C=n("view-playlist-modal");return c(),f("div",H,[d("div",J,[d("div",Y,[d("div",Q,[s.productionList.length>0?(c(),h(y,{key:0,class:"flexrow-item",label:e.$t("main.production"),"production-list":s.productionList,modelValue:s.productionId,"onUpdate:modelValue":t[0]||(t[0]=i=>s.productionId=i)},null,8,["label","production-list","modelValue"])):p("",!0),a.episodeOptions.length>0?K((c(),h(k,{key:1,class:"flexrow-item",label:e.$t("shots.fields.episode"),options:a.episodeOptions,modelValue:s.episodeId,"onUpdate:modelValue":t[1]||(t[1]=i=>s.episodeId=i)},null,8,["label","options","modelValue"])),[[q,s.productionId]]):p("",!0),s.taskTypeList.length>0?(c(),h(T,{key:2,class:"flexrow-item selector",label:e.$t("news.task_type"),"task-type-list":s.taskTypeList,modelValue:s.taskTypeId,"onUpdate:modelValue":t[2]||(t[2]=i=>s.taskTypeId=i)},null,8,["label","task-type-list","modelValue"])):p("",!0),r(b,{class:"flexrow-item selector",label:e.$t("news.task_status"),"task-status-list":s.taskStatusList,modelValue:s.taskStatusId,"onUpdate:modelValue":t[3]||(t[3]=i=>s.taskStatusId=i)},null,8,["label","task-status-list","modelValue"]),d("div",W,[d("label",X,_(e.$t("main.person")),1),r(S,{people:a.assignees,small:"",modelValue:s.person,"onUpdate:modelValue":t[4]||(t[4]=i=>s.person=i)},null,8,["people","modelValue"])]),r(k,{class:"flexrow-item",label:e.$t("main.show"),options:s.filterOptions,"locale-key-prefix":"tasks.",modelValue:s.currentFilter,"onUpdate:modelValue":t[5]||(t[5]=i=>s.currentFilter=i)},null,8,["label","options","modelValue"]),r(k,{class:"flexrow-item",label:e.$t("main.sorted_by"),options:s.sortOptions,"locale-key-prefix":"tasks.fields.",modelValue:s.currentSort,"onUpdate:modelValue":t[6]||(t[6]=i=>s.currentSort=i)},null,8,["label","options","modelValue"])]),d("div",Z,[d("h1",$,_(a.nbTasksToCheck)+" "+_(e.$tc("my_checks.title",a.nbTasksToCheck)),1),r(v,{class:"flexrow-item",onClick:t[7]||(t[7]=i=>s.isPlaylist=!0),text:e.$t("tasks.build_playlist")},null,8,["text"])]),r(g,{tasks:a.sortedTasks,"is-loading":s.isLoading,"is-error":s.isLoadingError,"selection-grid":s.selectionGrid,"is-to-check":!0,onTaskSelectionCleared:a.onTaskSelectionCleared,onTaskSelectionAddition:a.onTaskSelectionAdded,onTaskSelectionRemoval:a.onTaskSelectionRemoved},null,8,["tasks","is-loading","is-error","selection-grid","onTaskSelectionCleared","onTaskSelectionAddition","onTaskSelectionRemoval"])])]),e.nbSelectedTasks===1?(c(),f("div",ee,[r(I,{task:e.selectedTasks.values().next().value},null,8,["task"])])):p("",!0),r(C,{active:s.isPlaylist,"task-ids":a.sortedTasks.map(i=>i.id),onCancel:t[8]||(t[8]=i=>s.isPlaylist=!1)},null,8,["active","task-ids"])])}const oe=w(z,[["render",te],["__scopeId","data-v-cabfe8a8"]]);export{oe as default};
//# sourceMappingURL=MyChecks-Ckp6RpCd.js.map
