import{_ as w,a6 as C,aF as U,y as A,r as p,o,c as n,e as d,t as l,f,F as _,a5 as k,d as r,p as h,ah as F,C as M,H as L,aj as O,as as N,aa as S,m as D,ab as x,l as c,g as T,q as I,ai as P,a3 as z,T as j}from"./index-BzEHCGL3.js";import{C as R,S as q}from"./ComboboxStudio-FLvO9cNu.js";import{g as J}from"./grablist-Da7oVI-6.js";import{D as W}from"./DepartmentNamesCell-Bi7odFMc.js";import{P as Z}from"./PeopleNameCell-CNHyqRgT.js";const G={name:"edit-avatar-modal",mixins:[C],components:{PeopleAvatar:U,Spinner:A},props:{active:{type:Boolean,default:!1},errorText:{type:String,default:""},isDeleting:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isUpdating:{type:Boolean,default:!1},person:{type:Object,required:!0}},emits:["close","delete","update"],methods:{selectFile(){this.$refs["input-file"].click()},updateAvatar(e){const t=e.target.files[0],s=new FormData;s.append("file",t,t.name),this.$emit("update",s)},deleteAvatar(){this.$emit("delete")},close(){this.isUpdating||this.isDeleting||this.$emit("close")},resetForm(){this.$refs["input-file"].value=null}},watch:{active(){this.active&&this.resetForm()}}},H={class:"modal-content"},K={class:"box"},Q={class:"title"},X={class:"flexrow right mt2"},Y=["disabled"],$=["disabled"],ee=["disabled"],te={key:0,class:"error mt1 has-text-right"};function ie(e,t,s,v,a,m){const b=p("people-avatar"),y=p("spinner");return o(),n("div",{class:h(["modal",{"is-active":s.active}])},[d("div",{class:"modal-background",onClick:t[0]||(t[0]=(...u)=>m.close&&m.close(...u))}),d("div",H,[d("div",K,[d("h1",Q,l(e.$t("profile.avatar.title")),1),d("form",null,[d("input",{ref:"input-file",class:"hidden",type:"file",accept:".png,.jpg,.jpeg",onChange:t[1]||(t[1]=(...u)=>m.updateAvatar&&m.updateAvatar(...u))},null,544),f(b,{"is-lazy":!1,person:s.person,size:150,"font-size":60},null,8,["person"]),d("div",X,[d("button",{class:"button flexrow-item is-primary",disabled:s.isUpdating||s.isDeleting,type:"button",onClick:t[2]||(t[2]=(...u)=>m.selectFile&&m.selectFile(...u))},[s.isUpdating?(o(),n(_,{key:0},[f(y,{class:"mr05 mt05",size:20,"is-white":""}),k(" "+l(e.$t("profile.avatar.updating")),1)],64)):(o(),n(_,{key:1},[k(l(e.$t("profile.change_avatar")),1)],64))],8,Y),d("button",{class:"button flexrow-item",disabled:s.isUpdating||s.isDeleting,type:"button",onClick:t[3]||(t[3]=(...u)=>m.deleteAvatar&&m.deleteAvatar(...u))},[s.isDeleting?(o(),n(_,{key:0},[f(y,{class:"mr05 mt05",size:20}),k(" "+l(e.$t("profile.avatar.removing")),1)],64)):(o(),n(_,{key:1},[k(l(e.$t("profile.clear_avatar")),1)],64))],8,$),d("button",{class:"button flexrow-item is-link",disabled:s.isUpdating||s.isDeleting,type:"button",onClick:t[4]||(t[4]=(...u)=>m.close&&m.close(...u))},l(e.$t("main.close")),9,ee)])]),s.isError?(o(),n("p",te,l(s.errorText),1)):r("",!0)])])],2)}const $e=w(G,[["render",ie],["__scopeId","data-v-4ba64e80"]]),se={name:"edit-person-modal",mixins:[C,F],components:{Combobox:M,ComboboxDepartment:L,ComboboxStudio:R,DateField:O,DepartmentName:N,TextField:S},props:{active:{type:Boolean,default:!1},isBot:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isCreateInviteLoading:{type:Boolean,default:!1},isInviteLoading:{type:Boolean,default:!1},isInvitationSuccess:{type:Boolean,default:!1},isInvitationError:{type:Boolean,default:!1},isUserLimitError:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},personToEdit:{type:Object,default:()=>{}}},emits:["cancel"],data(){return{activeOptions:[{label:this.$t("main.yes"),value:"true"},{label:this.$t("main.no"),value:"false"}],contractOptions:[{label:"open-ended",value:"open-ended"},{label:"fixed-term",value:"fixed-term"},{label:"short-term",value:"short-term"},{label:"freelance",value:"freelance"},{label:"apprentice",value:"apprentice"},{label:"internship",value:"internship"}],form:{first_name:"",last_name:"",email:"",phone:"",role:"user",contract_type:"open-ended",active:"true",departments:[],studio_id:null,expiration_date:null,is_bot:!1},roleOptions:[{label:"user",value:"user"},{label:"supervisor",value:"supervisor"},{label:"manager",value:"manager"},{label:"client",value:"client"},{label:"vendor",value:"vendor"},{label:"admin",value:"admin"}],positionOptions:[{label:"artist",value:"artist"},{label:"supervisor",value:"supervisor"},{label:"lead",value:"lead"}],seniorityOptions:[{label:"senior",value:"senior"},{label:"mid",value:"mid"},{label:"junior",value:"junior"}],selectedDepartment:null}},computed:{...D(["departments","departmentMap","isCurrentUserAdmin","people","user"]),selectableDepartments(){return this.departments.filter(e=>!this.form.departments.includes(e.id))},isEditing(){var e;return!!((e=this.personToEdit)!=null&&e.id)},isValidName(){var e;return!!((e=this.form.first_name)!=null&&e.length)},isValidEmail(){var s;return!((s=this.form.email)!=null&&s.length)||!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(this.form.email)?!1:this.form.is_bot?!0:!this.people.some(v=>!v.is_bot&&v.email===this.form.email&&(!this.personToEdit||this.personToEdit.email!==v.email))},isValidForm(){return this.isValidName&&this.isValidEmail}},methods:{emitForm(e){if(!this.isValidForm)return;const t={...this.form,last_name:this.form.last_name||"",active:this.form.active==="true"||this.form.active===!0};this.$emit(e,t)},addDepartment(){this.form.departments.push(this.selectedDepartment),this.selectedDepartment=null},removeDepartment(e){const t=this.form.departments.indexOf(e);t>=0&&this.form.departments.splice(t,1)},resetForm(){this.isEditing?this.form={first_name:this.personToEdit.first_name,last_name:this.personToEdit.last_name,email:this.personToEdit.email,phone:this.personToEdit.phone,role:this.personToEdit.role,position:this.personToEdit.position,seniority:this.personToEdit.seniority,daily_salary:this.personToEdit.daily_salary,contract_type:this.personToEdit.contract_type,active:this.personToEdit.active?"true":"false",departments:[...this.personToEdit.departments||[]],studio_id:this.personToEdit.studio_id,expiration_date:this.personToEdit.expiration_date,is_bot:this.personToEdit.is_bot}:this.form={role:"user",position:"artist",seniority:"mid",daily_salary:0,contract_type:"open-ended",active:"true",departments:[],studio_id:null,expiration_date:null,is_bot:this.isBot,email:this.isBot?this.user.email:null}}},watch:{personToEdit(){this.resetForm()},active(){this.active&&(this.resetForm(),setTimeout(()=>{this.$refs["name-field"].focus()},100))}}},oe={class:"modal-content"},le={key:0,class:"title"},ae={key:1,class:"title"},ne={class:"departments field"},re={class:"label"},de={key:0,class:"empty mb1"},me=["onClick"],ue={class:"flexrow"},pe={class:"flexrow"},ce=["disabled"],fe=["disabled"],be=["disabled"],he={key:11,class:"success has-text-right mt1"},ve={key:12,class:"error has-text-right mt1"},ye={key:13,class:"error has-text-right mt1"},_e={key:14,class:"error has-text-right mt1"};function ge(e,t,s,v,a,m){const b=p("text-field"),y=p("date-field"),u=p("combobox"),E=p("department-name"),B=p("combobox-department"),V=p("combobox-studio");return o(),n("div",{class:h(["modal",{"is-active":s.active}])},[d("div",{class:"modal-background",onClick:t[0]||(t[0]=i=>e.$emit("cancel"))}),d("div",oe,[d("form",{onSubmit:t[18]||(t[18]=x(i=>m.emitForm("confirm"),["prevent"])),class:"box"},[s.personToEdit.id!==void 0?(o(),n("h1",le,l(e.$t("people.edit_title"))+" "+l(s.personToEdit.full_name),1)):(o(),n("h1",ae,l(e.$t(s.isBot?"bots.new_bot":"people.new_person")),1)),f(b,{ref:"name-field",errored:a.form.first_name&&!m.isValidName,label:e.$t(s.isBot?"bots.fields.name":"people.fields.first_name"),disabled:s.personToEdit.is_generated_from_ldap,modelValue:a.form.first_name,"onUpdate:modelValue":t[1]||(t[1]=i=>a.form.first_name=i),modelModifiers:{trim:!0}},null,8,["errored","label","disabled","modelValue"]),s.isBot?r("",!0):(o(),c(b,{key:2,label:e.$t("people.fields.last_name"),disabled:s.personToEdit.is_generated_from_ldap,modelValue:a.form.last_name,"onUpdate:modelValue":t[2]||(t[2]=i=>a.form.last_name=i),modelModifiers:{trim:!0}},null,8,["label","disabled","modelValue"])),s.isBot?r("",!0):(o(),c(b,{key:3,type:"email",errored:a.form.email&&!m.isValidEmail,label:e.$t("people.fields.email"),disabled:s.personToEdit.is_generated_from_ldap,modelValue:a.form.email,"onUpdate:modelValue":t[3]||(t[3]=i=>a.form.email=i),modelModifiers:{trim:!0}},null,8,["errored","label","disabled","modelValue"])),s.isBot?r("",!0):(o(),c(b,{key:4,label:e.$t("people.fields.phone"),modelValue:a.form.phone,"onUpdate:modelValue":t[4]||(t[4]=i=>a.form.phone=i),modelModifiers:{trim:!0}},null,8,["label","modelValue"])),s.isBot?(o(),c(y,{key:5,label:e.$t("bots.fields.expiration_date"),"min-date":e.today,disabled:m.isEditing,modelValue:a.form.expiration_date,"onUpdate:modelValue":t[5]||(t[5]=i=>a.form.expiration_date=i)},null,8,["label","min-date","disabled","modelValue"])):r("",!0),f(u,{label:e.$t("people.fields.role"),options:a.roleOptions,"locale-key-prefix":"people.role.",modelValue:a.form.role,"onUpdate:modelValue":t[6]||(t[6]=i=>a.form.role=i)},null,8,["label","options","modelValue"]),e.isCurrentUserAdmin?(o(),c(u,{key:6,label:e.$t("people.fields.position"),options:a.positionOptions,"locale-key-prefix":"people.position.",modelValue:a.form.position,"onUpdate:modelValue":t[7]||(t[7]=i=>a.form.position=i)},null,8,["label","options","modelValue"])):r("",!0),e.isCurrentUserAdmin?(o(),c(u,{key:7,label:e.$t("people.fields.seniority"),options:a.seniorityOptions,"locale-key-prefix":"people.seniority.",modelValue:a.form.seniority,"onUpdate:modelValue":t[8]||(t[8]=i=>a.form.seniority=i)},null,8,["label","options","modelValue"])):r("",!0),e.isCurrentUserAdmin?(o(),c(b,{key:8,type:"number",label:e.$t("people.fields.daily_salary"),modelValue:a.form.daily_salary,"onUpdate:modelValue":t[9]||(t[9]=i=>a.form.daily_salary=i)},null,8,["label","modelValue"])):r("",!0),!s.isBot&&a.form.role!=="client"?(o(),c(u,{key:9,label:e.$t("people.fields.contract"),options:a.contractOptions,"locale-key-prefix":"people.contract.",modelValue:a.form.contract_type,"onUpdate:modelValue":t[10]||(t[10]=i=>a.form.contract_type=i)},null,8,["label","options","modelValue"])):r("",!0),d("div",ne,[d("label",re,l(e.$t("people.fields.departments")),1),a.form.departments&&a.form.departments.length===0?(o(),n("p",de,l(e.$t("people.departments_empty")),1)):r("",!0),(o(!0),n(_,null,T(a.form.departments,i=>(o(),n("div",{class:"department-element mb1 mt05",key:i,onClick:g=>m.removeDepartment(i)},[i?(o(),c(E,{key:0,department:e.departmentMap.get(i)},null,8,["department"])):r("",!0)],8,me))),128)),d("div",ue,[m.selectableDepartments.length>0?(o(),c(B,{key:0,class:"flexrow-item","selectable-departments":m.selectableDepartments,modelValue:a.selectedDepartment,"onUpdate:modelValue":t[11]||(t[11]=i=>a.selectedDepartment=i)},null,8,["selectable-departments","modelValue"])):r("",!0),m.selectableDepartments.length>0?(o(),n("button",{key:1,class:h(["button is-success flexrow-item",{"is-disabled":a.selectedDepartment===null}]),type:"button",onClick:t[12]||(t[12]=(...i)=>m.addDepartment&&m.addDepartment(...i))},l(e.$t("main.add")),3)):r("",!0)])]),s.isBot?r("",!0):(o(),c(V,{key:10,class:"field",label:e.$t("people.fields.studio"),modelValue:a.form.studio_id,"onUpdate:modelValue":t[13]||(t[13]=i=>a.form.studio_id=i)},null,8,["label","modelValue"])),f(u,{label:e.$t("people.fields.active"),options:a.activeOptions,disabled:s.personToEdit.is_generated_from_ldap,modelValue:a.form.active,"onUpdate:modelValue":t[14]||(t[14]=i=>a.form.active=i)},null,8,["label","options","disabled","modelValue"]),d("div",pe,[m.isEditing&&e.isCurrentUserAdmin&&!s.isBot?(o(),n("button",{key:0,class:h(["button flexrow-item",{"is-loading":s.isInviteLoading}]),disabled:!m.isValidEmail,type:"button",onClick:t[15]||(t[15]=i=>m.emitForm("invite"))},l(e.$t("people.invite")),11,ce)):r("",!0),t[19]||(t[19]=d("div",{class:"filler"},null,-1)),!m.isEditing&&e.isCurrentUserAdmin&&!s.isBot?(o(),n("button",{key:1,class:h(["button is-primary flexrow-item",{"is-loading":s.isCreateInviteLoading}]),disabled:!m.isValidForm,type:"button",onClick:t[16]||(t[16]=i=>m.emitForm("confirm-invite"))},l(e.$t("people.create_invite")),11,fe)):r("",!0),d("button",{class:h(["button is-primary flexrow-item",{"is-loading":s.isLoading}]),disabled:!m.isValidForm,type:"submit"},l(m.isEditing?e.$t("people.confirm_edit"):e.$t("people.create")),11,be),d("button",{class:"button is-link flexrow-item",type:"button",onClick:t[17]||(t[17]=i=>e.$emit("cancel"))},l(e.$t("main.cancel")),1)]),s.isInvitationSuccess?(o(),n("div",he,l(e.$t("people.invite_success")),1)):r("",!0),s.isInvitationError?(o(),n("div",ve,l(e.$t("people.invite_error")),1)):r("",!0),s.isUserLimitError?(o(),n("div",ye,l(e.$t("people.user_limit_error")),1)):r("",!0),s.isError?(o(),n("div",_e,l(e.$t("people.create_error")),1)):r("",!0)],32)])],2)}const et=w(se,[["render",ge],["__scopeId","data-v-e5221851"]]),ke={name:"people-list",mixins:[I,J],components:{AlertTriangleIcon:P,DepartmentNamesCell:W,PeopleNameCell:Z,RowActionsCell:z,StudioName:q,TableInfo:j},props:{entries:{type:Array,default:()=>[]},isBots:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["avatar-clicked","change-password-clicked","delete-clicked","edit-clicked","refresh-clicked"],data(){return{domEvents:[["mousemove",this.onMouseMove],["touchmove",this.onMouseMove],["mouseup",this.stopBrowsing],["mouseleave",this.stopBrowsing],["touchend",this.stopBrowsing],["touchcancel",this.stopBrowsing],["keyup",this.stopBrowsing]]}},mounted(){this.addEvents(this.domEvents)},beforeUnmount(){this.removeEvents(this.domEvents),document.body.style.cursor="default"},computed:{...D(["isCurrentUserAdmin"]),activePeople(){return this.entries.filter(e=>e.active)},today(){return new Date().toJSON().slice(0,10)},nextWeek(){const e=new Date;return e.setDate(e.getDate()+7),e.toJSON().slice(0,10)},inactivePeople(){return this.entries.filter(e=>!e.active)},nbUsersDetails(){const e=this.entries.length,t=this.$tc(this.isBots?"bots.bots":"people.persons",e);return`${e} ${t}`}},methods:{isExpired(e){return e<this.today},isSoonExpired(e){return!this.isExpired(e)&&e<this.nextWeek}}},Ee={class:"data-list"},Be={ref:"body",class:"datatable-wrapper"},Ve={key:0,class:"datatable"},we={class:"datatable-head"},Ce={scope:"col",class:"name datatable-row-header"},De={key:0,scope:"col",class:"email"},Te={key:1,scope:"col",class:"phone"},Ue={key:2,scope:"col",class:"expiration"},Ae={scope:"col",class:"role"},Fe={scope:"col",class:"departments"},Me={key:3,scope:"col",class:"studio"},Le={key:4,scope:"col",class:"contract"},Oe={scope:"col",class:"position"},Ne={scope:"col",class:"seniority"},Se={scope:"col",class:"salary"},xe={key:0,class:"email"},Ie={key:1,class:"phone"},Pe={class:"role"},ze={key:3,class:"studio"},je={key:4,class:"contract"},Re={class:"seniority"},qe={class:"position"},Je={class:"salary"},We={key:6,class:"actions"},Ze={key:0,class:"has-text-centered footer-info"};function Ge(e,t,s,v,a,m){const b=p("people-name-cell"),y=p("alert-triangle-icon"),u=p("department-names-cell"),E=p("studio-name"),B=p("row-actions-cell"),V=p("table-info");return o(),n("div",Ee,[d("div",Be,[s.isLoading?r("",!0):(o(),n("table",Ve,[d("thead",we,[d("tr",null,[d("th",Ce,l(e.$t("people.list.name")),1),s.isBots?r("",!0):(o(),n("th",De,l(e.$t("people.list.email")),1)),s.isBots?r("",!0):(o(),n("th",Te,l(e.$t("people.list.phone")),1)),s.isBots?(o(),n("th",Ue,l(e.$t("people.list.expiration")),1)):r("",!0),d("th",Ae,l(e.$t("people.list.role")),1),d("th",Fe,l(e.$t("people.list.departments")),1),s.isBots?r("",!0):(o(),n("th",Me,l(e.$t("people.list.studio")),1)),s.isBots?r("",!0):(o(),n("th",Le,l(e.$t("people.list.contract")),1)),d("th",Oe,l(e.$t("people.list.position")),1),d("th",Ne,l(e.$t("people.list.seniority")),1),d("th",Se,l(e.$t("people.fields.daily_salary")),1),t[2]||(t[2]=d("th",{scope:"col",class:"actions"},null,-1))])]),s.entries.length>0?(o(),n("tbody",{key:0,class:"datatable-body",onMousedown:t[0]||(t[0]=(...i)=>e.startBrowsing&&e.startBrowsing(...i)),onTouchstart:t[1]||(t[1]=(...i)=>e.startBrowsing&&e.startBrowsing(...i))},[(o(!0),n(_,null,T(s.entries,i=>(o(),n("tr",{key:i.id,class:"datatable-row"},[f(b,{class:"name datatable-row-header",person:i},null,8,["person"]),s.isBots?r("",!0):(o(),n("td",xe,l(i.email),1)),s.isBots?r("",!0):(o(),n("td",Ie,l(i.phone),1)),s.isBots?(o(),n("td",{key:2,class:h(["expiration",{error:m.isExpired(i.expiration_date),warning:m.isSoonExpired(i.expiration_date)}])},[k(l(i.expiration_date)+" ",1),f(y,{class:"icon mr05"})],2)):r("",!0),d("td",Pe,l(e.$t(`people.role.${i.role}`)),1),f(u,{class:"departments",departments:i.departments},null,8,["departments"]),s.isBots?r("",!0):(o(),n("td",ze,[i.studio?(o(),c(E,{key:0,studio:i.studio},null,8,["studio"])):r("",!0)])),s.isBots?r("",!0):(o(),n("td",je,l(e.$t(`people.contract.${i.contract_type}`)),1)),d("td",Re,l(i.seniority?e.$t(`people.seniority.${i.seniority}`):""),1),d("td",qe,l(i.position?e.$t(`people.position.${i.position}`):""),1),d("td",Je,l(i.daily_salary),1),e.isCurrentUserAdmin?(o(),c(B,{key:5,"entry-id":i.id,"hide-avatar":!i.active,"hide-change-password":s.isBots||!i.active,"hide-delete":i.active,"hide-refresh":!s.isBots||!i.active,onAvatarClicked:g=>e.$emit("avatar-clicked",i),onChangePasswordClicked:g=>e.$emit("change-password-clicked",i),onEditClicked:g=>e.$emit("edit-clicked",i),onRefreshClicked:g=>e.$emit("refresh-clicked",i),onDeleteClicked:g=>e.$emit("delete-clicked",i)},null,8,["entry-id","hide-avatar","hide-change-password","hide-delete","hide-refresh","onAvatarClicked","onChangePasswordClicked","onEditClicked","onRefreshClicked","onDeleteClicked"])):(o(),n("td",We))]))),128))],32)):r("",!0)]))],512),f(V,{"is-loading":s.isLoading,"is-error":s.isError},null,8,["is-loading","is-error"]),s.isLoading?r("",!0):(o(),n("p",Ze,l(m.nbUsersDetails),1))])}const tt=w(ke,[["render",Ge],["__scopeId","data-v-62f94442"]]);export{$e as E,tt as P,et as a};
//# sourceMappingURL=PeopleList-BGSpulIe.js.map
