import{n as o,K as l,al as n,j as c,C as d,a1 as p,_ as m,a8 as f,O as _,m as r,Z as u,I as v,T as h}from"./index-D6NT0KmE.js";import{C as b,S as C}from"./ComboboxStudio-CKxnMFQm.js";import{D as x}from"./DepartmentNamesCell-BHzEblfq.js";import{P as $}from"./PeopleNameCell-B9vT2mqc.js";const g={name:"edit-avatar-modal",mixins:[l],components:{PeopleAvatar:n,Spinner:c},props:{active:{type:Boolean,default:!1},errorText:{type:String,default:""},isDeleting:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isUpdating:{type:Boolean,default:!1},person:{type:Object,required:!0}},methods:{selectFile(){this.$refs["input-file"].click()},updateAvatar(a){const t=a.target.files[0],e=new FormData;e.append("file",t,t.name),this.$emit("update",e)},deleteAvatar(){this.$emit("delete")},close(){this.isUpdating||this.isDeleting||this.$emit("close")},resetForm(){this.$refs["input-file"].value=null}},watch:{active(){this.active&&this.resetForm()}}};var y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"modal",class:{"is-active":t.active}},[e("div",{staticClass:"modal-background",on:{click:t.close}}),e("div",{staticClass:"modal-content"},[e("div",{staticClass:"box"},[e("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("profile.avatar.title"))+" ")]),e("form",[e("input",{ref:"input-file",staticClass:"hidden",attrs:{type:"file",accept:".png,.jpg,.jpeg"},on:{change:t.updateAvatar}}),e("people-avatar",{attrs:{"is-lazy":!1,person:t.person,size:150,"font-size":60}}),e("div",{staticClass:"flexrow right mt2"},[e("button",{staticClass:"button flexrow-item is-primary",attrs:{disabled:t.isUpdating||t.isDeleting,type:"button"},on:{click:t.selectFile}},[t.isUpdating?[e("spinner",{staticClass:"mr05 mt05",attrs:{size:20,"is-white":""}}),t._v(" "+t._s(t.$t("profile.avatar.updating"))+" ")]:[t._v(t._s(t.$t("profile.change_avatar")))]],2),e("button",{staticClass:"button flexrow-item",attrs:{disabled:t.isUpdating||t.isDeleting,type:"button"},on:{click:t.deleteAvatar}},[t.isDeleting?[e("spinner",{staticClass:"mr05 mt05",attrs:{size:20}}),t._v(" "+t._s(t.$t("profile.avatar.removing"))+" ")]:[t._v(t._s(t.$t("profile.clear_avatar")))]],2),e("button",{staticClass:"button flexrow-item is-link",attrs:{disabled:t.isUpdating||t.isDeleting,type:"button"},on:{click:t.close}},[t._v(" "+t._s(t.$t("main.close"))+" ")])])],1),t.isError?e("p",{staticClass:"error mt1 has-text-right"},[t._v(" "+t._s(t.errorText)+" ")]):t._e()])])])},B=[],E=o(g,y,B,!1,null,"34a2dcf7");const N=E.exports,k={name:"edit-person-modal",mixins:[l],components:{Combobox:d,ComboboxDepartment:p,ComboboxStudio:b,DateField:m,DepartmentName:f,TextField:_},props:{active:{type:Boolean,default:!1},isBot:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isCreateInviteLoading:{type:Boolean,default:!1},isInviteLoading:{type:Boolean,default:!1},isInvitationSuccess:{type:Boolean,default:!1},isInvitationError:{type:Boolean,default:!1},isUserLimitError:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},personToEdit:{type:Object,default:()=>{}}},data(){return{activeOptions:[{label:this.$t("main.yes"),value:"true"},{label:this.$t("main.no"),value:"false"}],contractOptions:[{label:"open-ended",value:"open-ended"},{label:"fixed-term",value:"fixed-term"},{label:"short-term",value:"short-term"},{label:"freelance",value:"freelance"},{label:"apprentice",value:"apprentice"},{label:"internship",value:"internship"}],form:{first_name:"",last_name:"",email:"",phone:"",role:"user",contract_type:"open-ended",active:"true",departments:[],studio_id:null,expiration_date:null,is_bot:!1},roleOptions:[{label:"user",value:"user"},{label:"supervisor",value:"supervisor"},{label:"manager",value:"manager"},{label:"client",value:"client"},{label:"vendor",value:"vendor"},{label:"admin",value:"admin"}],selectedDepartment:null}},computed:{...r(["departments","departmentMap","isCurrentUserAdmin","people","user"]),selectableDepartments(){return this.departments.filter(a=>!this.form.departments.includes(a.id))},isEditing(){var a;return!!((a=this.personToEdit)!=null&&a.id)},isValidName(){var a;return!!((a=this.form.first_name)!=null&&a.length)},isValidEmail(){var e;return!((e=this.form.email)!=null&&e.length)||!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(this.form.email)?!1:this.form.is_bot?!0:!this.people.some(s=>!s.is_bot&&s.email===this.form.email&&(!this.personToEdit||this.personToEdit.email!==s.email))},isValidForm(){return this.isValidName&&this.isValidEmail}},methods:{emitForm(a){if(!this.isValidForm)return;const t={...this.form,last_name:this.form.last_name||"",active:this.form.active==="true"||this.form.active===!0};this.$emit(a,t)},addDepartment(){this.form.departments.push(this.selectedDepartment),this.selectedDepartment=null},removeDepartment(a){const t=this.form.departments.indexOf(a);t>=0&&this.form.departments.splice(t,1)},resetForm(){this.isEditing?this.form={first_name:this.personToEdit.first_name,last_name:this.personToEdit.last_name,email:this.personToEdit.email,phone:this.personToEdit.phone,role:this.personToEdit.role,contract_type:this.personToEdit.contract_type,active:this.personToEdit.active?"true":"false",departments:[...this.personToEdit.departments||[]],studio_id:this.personToEdit.studio_id,expiration_date:this.personToEdit.expiration_date,is_bot:this.personToEdit.is_bot}:this.form={role:"user",contract_type:"open-ended",active:"true",departments:[],studio_id:null,expiration_date:null,is_bot:this.isBot,email:this.isBot?this.user.email:null}}},watch:{personToEdit(){this.resetForm()},active(){this.active&&(this.resetForm(),setTimeout(()=>{this.$refs["name-field"].focus()},100))}}};var w=function(){var t=this,e=t._self._c;return e("div",{staticClass:"modal",class:{"is-active":t.active}},[e("div",{staticClass:"modal-background",on:{click:function(s){return t.$emit("cancel")}}}),e("div",{staticClass:"modal-content"},[e("form",{staticClass:"box",on:{submit:function(s){return s.preventDefault(),t.emitForm("confirm")}}},[t.personToEdit.id!==void 0?e("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("people.edit_title"))+" "+t._s(t.personToEdit.full_name)+" ")]):e("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t(t.isBot?"bots.new_bot":"people.new_person"))+" ")]),e("text-field",{ref:"name-field",attrs:{errored:t.form.first_name&&!t.isValidName,label:t.$t(t.isBot?"bots.fields.name":"people.fields.first_name"),disabled:t.personToEdit.is_generated_from_ldap},model:{value:t.form.first_name,callback:function(s){t.$set(t.form,"first_name",typeof s=="string"?s.trim():s)},expression:"form.first_name"}}),t.isBot?t._e():e("text-field",{attrs:{label:t.$t("people.fields.last_name"),disabled:t.personToEdit.is_generated_from_ldap},model:{value:t.form.last_name,callback:function(s){t.$set(t.form,"last_name",typeof s=="string"?s.trim():s)},expression:"form.last_name"}}),t.isBot?t._e():e("text-field",{attrs:{type:"email",errored:t.form.email&&!t.isValidEmail,label:t.$t("people.fields.email"),disabled:t.personToEdit.is_generated_from_ldap},model:{value:t.form.email,callback:function(s){t.$set(t.form,"email",typeof s=="string"?s.trim():s)},expression:"form.email"}}),t.isBot?t._e():e("text-field",{attrs:{label:t.$t("people.fields.phone")},model:{value:t.form.phone,callback:function(s){t.$set(t.form,"phone",typeof s=="string"?s.trim():s)},expression:"form.phone"}}),t.isBot?e("date-field",{attrs:{label:t.$t("bots.fields.expiration_date"),"disabled-dates":{to:new Date},disabled:t.isEditing},model:{value:t.form.expiration_date,callback:function(s){t.$set(t.form,"expiration_date",s)},expression:"form.expiration_date"}}):t._e(),e("combobox",{attrs:{label:t.$t("people.fields.role"),options:t.roleOptions,"locale-key-prefix":"people.role."},model:{value:t.form.role,callback:function(s){t.$set(t.form,"role",s)},expression:"form.role"}}),t.isBot?t._e():e("combobox",{attrs:{label:t.$t("people.fields.contract"),options:t.contractOptions,"locale-key-prefix":"people.contract."},model:{value:t.form.contract_type,callback:function(s){t.$set(t.form,"contract_type",s)},expression:"form.contract_type"}}),e("div",{staticClass:"departments field"},[e("label",{staticClass:"label"},[t._v(t._s(t.$t("people.fields.departments")))]),t.form.departments&&t.form.departments.length===0?e("p",{staticClass:"empty mb1"},[t._v(" "+t._s(t.$t("people.departments_empty"))+" ")]):t._e(),t._l(t.form.departments,function(s){return e("div",{key:s,staticClass:"department-element mb1 mt05",on:{click:function(i){return t.removeDepartment(s)}}},[s?e("department-name",{attrs:{department:t.departmentMap.get(s)}}):t._e()],1)}),e("div",{staticClass:"flexrow"},[t.selectableDepartments.length>0?e("combobox-department",{staticClass:"flexrow-item",attrs:{"selectable-departments":t.selectableDepartments},model:{value:t.selectedDepartment,callback:function(s){t.selectedDepartment=s},expression:"selectedDepartment"}}):t._e(),t.selectableDepartments.length>0?e("button",{staticClass:"button is-success flexrow-item",class:{"is-disabled":t.selectedDepartment===null},attrs:{type:"button"},on:{click:t.addDepartment}},[t._v(" "+t._s(t.$t("main.add"))+" ")]):t._e()],1)],2),t.isBot?t._e():e("combobox-studio",{staticClass:"field",attrs:{label:t.$t("people.fields.studio")},model:{value:t.form.studio_id,callback:function(s){t.$set(t.form,"studio_id",s)},expression:"form.studio_id"}}),e("combobox",{attrs:{label:t.$t("people.fields.active"),options:t.activeOptions,disabled:t.personToEdit.is_generated_from_ldap},model:{value:t.form.active,callback:function(s){t.$set(t.form,"active",s)},expression:"form.active"}}),e("div",{staticClass:"flexrow"},[t.isEditing&&t.isCurrentUserAdmin&&!t.isBot?e("button",{staticClass:"button flexrow-item",class:{"is-loading":t.isInviteLoading},attrs:{disabled:!t.isValidEmail,type:"button"},on:{click:function(s){return t.emitForm("invite")}}},[t._v(" "+t._s(t.$t("people.invite"))+" ")]):t._e(),e("div",{staticClass:"filler"}),!t.isEditing&&t.isCurrentUserAdmin&&!t.isBot?e("button",{staticClass:"button is-primary flexrow-item",class:{"is-loading":t.isCreateInviteLoading},attrs:{disabled:!t.isValidForm,type:"button"},on:{click:function(s){return t.emitForm("confirm-invite")}}},[t._v(" "+t._s(t.$t("people.create_invite"))+" ")]):t._e(),e("button",{staticClass:"button is-primary flexrow-item",class:{"is-loading":t.isLoading},attrs:{disabled:!t.isValidForm,type:"submit"}},[t._v(" "+t._s(t.isEditing?t.$t("people.confirm_edit"):t.$t("people.create"))+" ")]),e("button",{staticClass:"button is-link flexrow-item",attrs:{type:"button"},on:{click:function(s){return t.$emit("cancel")}}},[t._v(" "+t._s(t.$t("main.cancel"))+" ")])]),t.isInvitationSuccess?e("div",{staticClass:"success has-text-right mt1"},[t._v(" "+t._s(t.$t("people.invite_success"))+" ")]):t._e(),t.isInvitationError?e("div",{staticClass:"error has-text-right mt1"},[t._v(" "+t._s(t.$t("people.invite_error"))+" ")]):t._e(),t.isUserLimitError?e("div",{staticClass:"error has-text-right mt1"},[t._v(" "+t._s(t.$t("people.user_limit_error"))+" ")]):t._e(),t.isError?e("div",{staticClass:"error has-text-right mt1"},[t._v(" "+t._s(t.$t("people.create_error"))+" ")]):t._e()],1)])])},D=[],T=o(k,w,D,!1,null,"d88e5a50");const I=T.exports,F={name:"people-list",components:{AlertTriangleIcon:u,DepartmentNamesCell:x,PeopleNameCell:$,RowActionsCell:v,StudioName:C,TableInfo:h},props:{entries:{type:Array,default:()=>[]},isBots:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},computed:{...r(["isCurrentUserAdmin"]),activePeople(){return this.entries.filter(a=>a.active)},today(){return new Date().toJSON().slice(0,10)},nextWeek(){const a=new Date;return a.setDate(a.getDate()+7),a.toJSON().slice(0,10)},inactivePeople(){return this.entries.filter(a=>!a.active)},nbUsersDetails(){const a=this.entries.length,t=this.activePeople.length,e=this.$tc(this.isBots?"bots.bots":"people.persons",a),s=this.$tc(this.isBots?"bots.active_bots":"people.active_persons",t);return`${a} ${e} (${t} ${s})`}},methods:{isExpired(a){return a<this.today},isSoonExpired(a){return!this.isExpired(a)&&a<this.nextWeek},onBodyScroll(a,t){this.$refs.body.style.left=`-${t.scrollLeft}px`}}};var A=function(){var t=this,e=t._self._c;return e("div",{staticClass:"data-list"},[e("div",{directives:[{name:"scroll",rawName:"v-scroll",value:t.onBodyScroll,expression:"onBodyScroll"}],ref:"body",staticClass:"datatable-wrapper"},[e("table",{staticClass:"datatable multi-section"},[e("thead",{staticClass:"datatable-head"},[e("tr",[e("th",{staticClass:"name datatable-row-header",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("people.list.name"))+" ")]),t.isBots?t._e():e("th",{staticClass:"email",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("people.list.email"))+" ")]),t.isBots?t._e():e("th",{staticClass:"phone",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("people.list.phone"))+" ")]),t.isBots?e("th",{staticClass:"expiration",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("people.list.expiration"))+" ")]):t._e(),e("th",{staticClass:"role",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("people.list.role"))+" ")]),t.isBots?t._e():e("th",{staticClass:"contract",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("people.list.contract"))+" ")]),e("th",{staticClass:"departments",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("people.list.departments"))+" ")]),t.isBots?t._e():e("th",{staticClass:"studio",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("people.list.studio"))+" ")]),e("th",{staticClass:"actions",attrs:{scope:"col"}})])]),t.activePeople.length>0?e("tbody",{staticClass:"datatable-body"},[e("tr",{staticClass:"datatable-type-header"},[e("th",{attrs:{scope:"rowgroup",colspan:"5"}},[e("span",{staticClass:"datatable-row-header"},[t._v(t._s(t.$t("people.active")))])])]),t._l(t.activePeople,function(s){return e("tr",{key:s.id,staticClass:"datatable-row"},[e("people-name-cell",{staticClass:"name datatable-row-header",attrs:{person:s}}),t.isBots?t._e():e("td",{staticClass:"email"},[t._v(t._s(s.email))]),t.isBots?t._e():e("td",{staticClass:"phone"},[t._v(t._s(s.phone))]),t.isBots?e("td",{staticClass:"expiration",class:{error:t.isExpired(s.expiration_date),warning:t.isSoonExpired(s.expiration_date)}},[t._v(" "+t._s(s.expiration_date)+" "),e("alert-triangle-icon",{staticClass:"icon mr05"})],1):t._e(),e("td",{staticClass:"role"},[t._v(t._s(t.$t(`people.role.${s.role}`)))]),t.isBots?t._e():e("td",{staticClass:"contract"},[t._v(" "+t._s(t.$t(`people.contract.${s.contract_type}`))+" ")]),e("department-names-cell",{staticClass:"departments",attrs:{departments:s.departments}}),t.isBots?t._e():e("td",{staticClass:"studio"},[s.studio?e("studio-name",{attrs:{studio:s.studio}}):t._e()],1),t.isCurrentUserAdmin?e("row-actions-cell",{attrs:{"entry-id":s.id,"hide-avatar":!1,"hide-change-password":t.isBots,"hide-delete":!0,"hide-refresh":!t.isBots},on:{"avatar-clicked":function(i){return t.$emit("avatar-clicked",s)},"change-password-clicked":function(i){return t.$emit("change-password-clicked",s)},"edit-clicked":function(i){return t.$emit("edit-clicked",s)},"refresh-clicked":function(i){return t.$emit("refresh-clicked",s)}}}):e("td",{staticClass:"actions"})],1)})],2):t._e(),t.inactivePeople.length>0?e("tbody",{staticClass:"datatable-body"},[e("tr",{staticClass:"datatable-type-header"},[e("th",{attrs:{scope:"rowgroup",colspan:"5"}},[e("span",{staticClass:"datatable-row-header"},[t._v(" "+t._s(t.$t("people.unactive"))+" ")])])]),t._l(t.inactivePeople,function(s){return e("tr",{key:s.id,staticClass:"datatable-row"},[e("people-name-cell",{staticClass:"name datatable-row-header",attrs:{person:s}}),t.isBots?t._e():e("td",{staticClass:"email"},[t._v(t._s(s.email))]),t.isBots?t._e():e("td",{staticClass:"phone"},[t._v(t._s(s.phone))]),t.isBots?e("td",{staticClass:"expiration"},[t._v(" "+t._s(s.expiration_date)+" ")]):t._e(),e("td",{staticClass:"role"},[t._v(t._s(t.$t("people.role."+s.role)))]),t.isBots?t._e():e("td",{staticClass:"contract"},[t._v(" "+t._s(t.$t("people.contract."+s.contract_type))+" ")]),e("department-names-cell",{staticClass:"departments",attrs:{departments:s.departments}}),t.isBots?t._e():e("td",{staticClass:"studio"},[s.studio?e("studio-name",{attrs:{studio:s.studio}}):t._e()],1),t.isCurrentUserAdmin?e("row-actions-cell",{attrs:{"entry-id":s.id},on:{"edit-clicked":function(i){return t.$emit("edit-clicked",s)},"delete-clicked":function(i){return t.$emit("delete-clicked",s)}}}):e("td",{staticClass:"actions"})],1)})],2):t._e()])]),e("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}}),t.isLoading?t._e():e("p",{staticClass:"has-text-centered footer-info"},[t._v(" "+t._s(t.nbUsersDetails)+" ")])],1)},U=[],S=o(F,A,U,!1,null,"5c8211bc");const z=S.exports;export{N as E,z as P,I as a};
//# sourceMappingURL=PeopleList-BxbxynEH.js.map
