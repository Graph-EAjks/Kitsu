import{_ as C,a5 as D,aF as U,y as x,r as u,o as l,c as o,e as m,t as a,f,F as y,a4 as g,d,p as h,ag as F,C as A,al as L,ai as N,as as S,a9 as I,m as w,aa as M,l as p,g as T,ah as O,a2 as P,T as z}from"./index-CBmSN8vz.js";import{C as R,S as j}from"./ComboboxStudio-CGoIUq6W.js";import{D as J}from"./DepartmentNamesCell-INFfs8wG.js";import{P as W}from"./PeopleNameCell-DPqWkUEm.js";const Z={name:"edit-avatar-modal",mixins:[D],components:{PeopleAvatar:U,Spinner:x},props:{active:{type:Boolean,default:!1},errorText:{type:String,default:""},isDeleting:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isUpdating:{type:Boolean,default:!1},person:{type:Object,required:!0}},emits:["close","delete","update"],methods:{selectFile(){this.$refs["input-file"].click()},updateAvatar(e){const i=e.target.files[0],t=new FormData;t.append("file",i,i.name),this.$emit("update",t)},deleteAvatar(){this.$emit("delete")},close(){this.isUpdating||this.isDeleting||this.$emit("close")},resetForm(){this.$refs["input-file"].value=null}},watch:{active(){this.active&&this.resetForm()}}},q={class:"modal-content"},G={class:"box"},H={class:"title"},K={class:"flexrow right mt2"},Q=["disabled"],X=["disabled"],Y=["disabled"],$={key:0,class:"error mt1 has-text-right"};function ee(e,i,t,_,r,n){const b=u("people-avatar"),v=u("spinner");return l(),o("div",{class:h(["modal",{"is-active":t.active}])},[m("div",{class:"modal-background",onClick:i[0]||(i[0]=(...c)=>n.close&&n.close(...c))}),m("div",q,[m("div",G,[m("h1",H,a(e.$t("profile.avatar.title")),1),m("form",null,[m("input",{ref:"input-file",class:"hidden",type:"file",accept:".png,.jpg,.jpeg",onChange:i[1]||(i[1]=(...c)=>n.updateAvatar&&n.updateAvatar(...c))},null,544),f(b,{"is-lazy":!1,person:t.person,size:150,"font-size":60},null,8,["person"]),m("div",K,[m("button",{class:"button flexrow-item is-primary",disabled:t.isUpdating||t.isDeleting,type:"button",onClick:i[2]||(i[2]=(...c)=>n.selectFile&&n.selectFile(...c))},[t.isUpdating?(l(),o(y,{key:0},[f(v,{class:"mr05 mt05",size:20,"is-white":""}),g(" "+a(e.$t("profile.avatar.updating")),1)],64)):(l(),o(y,{key:1},[g(a(e.$t("profile.change_avatar")),1)],64))],8,Q),m("button",{class:"button flexrow-item",disabled:t.isUpdating||t.isDeleting,type:"button",onClick:i[3]||(i[3]=(...c)=>n.deleteAvatar&&n.deleteAvatar(...c))},[t.isDeleting?(l(),o(y,{key:0},[f(v,{class:"mr05 mt05",size:20}),g(" "+a(e.$t("profile.avatar.removing")),1)],64)):(l(),o(y,{key:1},[g(a(e.$t("profile.clear_avatar")),1)],64))],8,X),m("button",{class:"button flexrow-item is-link",disabled:t.isUpdating||t.isDeleting,type:"button",onClick:i[4]||(i[4]=(...c)=>n.close&&n.close(...c))},a(e.$t("main.close")),9,Y)])]),t.isError?(l(),o("p",$,a(t.errorText),1)):d("",!0)])])],2)}const Ze=C(Z,[["render",ee],["__scopeId","data-v-4ba64e80"]]),te={name:"edit-person-modal",mixins:[D,F],components:{Combobox:A,ComboboxDepartment:L,ComboboxStudio:R,DateField:N,DepartmentName:S,TextField:I},props:{active:{type:Boolean,default:!1},isBot:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isCreateInviteLoading:{type:Boolean,default:!1},isInviteLoading:{type:Boolean,default:!1},isInvitationSuccess:{type:Boolean,default:!1},isInvitationError:{type:Boolean,default:!1},isUserLimitError:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},personToEdit:{type:Object,default:()=>{}}},emits:["cancel"],data(){return{activeOptions:[{label:this.$t("main.yes"),value:"true"},{label:this.$t("main.no"),value:"false"}],contractOptions:[{label:"open-ended",value:"open-ended"},{label:"fixed-term",value:"fixed-term"},{label:"short-term",value:"short-term"},{label:"freelance",value:"freelance"},{label:"apprentice",value:"apprentice"},{label:"internship",value:"internship"}],form:{first_name:"",last_name:"",email:"",phone:"",role:"user",contract_type:"open-ended",active:"true",departments:[],studio_id:null,expiration_date:null,is_bot:!1},roleOptions:[{label:"user",value:"user"},{label:"supervisor",value:"supervisor"},{label:"manager",value:"manager"},{label:"client",value:"client"},{label:"vendor",value:"vendor"},{label:"admin",value:"admin"}],selectedDepartment:null}},computed:{...w(["departments","departmentMap","isCurrentUserAdmin","people","user"]),selectableDepartments(){return this.departments.filter(e=>!this.form.departments.includes(e.id))},isEditing(){var e;return!!((e=this.personToEdit)!=null&&e.id)},isValidName(){var e;return!!((e=this.form.first_name)!=null&&e.length)},isValidEmail(){var t;return!((t=this.form.email)!=null&&t.length)||!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(this.form.email)?!1:this.form.is_bot?!0:!this.people.some(_=>!_.is_bot&&_.email===this.form.email&&(!this.personToEdit||this.personToEdit.email!==_.email))},isValidForm(){return this.isValidName&&this.isValidEmail}},methods:{emitForm(e){if(!this.isValidForm)return;const i={...this.form,last_name:this.form.last_name||"",active:this.form.active==="true"||this.form.active===!0};this.$emit(e,i)},addDepartment(){this.form.departments.push(this.selectedDepartment),this.selectedDepartment=null},removeDepartment(e){const i=this.form.departments.indexOf(e);i>=0&&this.form.departments.splice(i,1)},resetForm(){this.isEditing?this.form={first_name:this.personToEdit.first_name,last_name:this.personToEdit.last_name,email:this.personToEdit.email,phone:this.personToEdit.phone,role:this.personToEdit.role,contract_type:this.personToEdit.contract_type,active:this.personToEdit.active?"true":"false",departments:[...this.personToEdit.departments||[]],studio_id:this.personToEdit.studio_id,expiration_date:this.personToEdit.expiration_date,is_bot:this.personToEdit.is_bot}:this.form={role:"user",contract_type:"open-ended",active:"true",departments:[],studio_id:null,expiration_date:null,is_bot:this.isBot,email:this.isBot?this.user.email:null}}},watch:{personToEdit(){this.resetForm()},active(){this.active&&(this.resetForm(),setTimeout(()=>{this.$refs["name-field"].focus()},100))}}},ie={class:"modal-content"},se={key:0,class:"title"},le={key:1,class:"title"},oe={class:"departments field"},ae={class:"label"},ne={key:0,class:"empty mb1"},re=["onClick"],de={class:"flexrow"},me={class:"flexrow"},ce=["disabled"],ue=["disabled"],pe=["disabled"],fe={key:8,class:"success has-text-right mt1"},be={key:9,class:"error has-text-right mt1"},he={key:10,class:"error has-text-right mt1"},_e={key:11,class:"error has-text-right mt1"};function ve(e,i,t,_,r,n){const b=u("text-field"),v=u("date-field"),c=u("combobox"),E=u("department-name"),B=u("combobox-department"),V=u("combobox-studio");return l(),o("div",{class:h(["modal",{"is-active":t.active}])},[m("div",{class:"modal-background",onClick:i[0]||(i[0]=s=>e.$emit("cancel"))}),m("div",ie,[m("form",{onSubmit:i[15]||(i[15]=M(s=>n.emitForm("confirm"),["prevent"])),class:"box"},[t.personToEdit.id!==void 0?(l(),o("h1",se,a(e.$t("people.edit_title"))+" "+a(t.personToEdit.full_name),1)):(l(),o("h1",le,a(e.$t(t.isBot?"bots.new_bot":"people.new_person")),1)),f(b,{ref:"name-field",errored:r.form.first_name&&!n.isValidName,label:e.$t(t.isBot?"bots.fields.name":"people.fields.first_name"),disabled:t.personToEdit.is_generated_from_ldap,modelValue:r.form.first_name,"onUpdate:modelValue":i[1]||(i[1]=s=>r.form.first_name=s),modelModifiers:{trim:!0}},null,8,["errored","label","disabled","modelValue"]),t.isBot?d("",!0):(l(),p(b,{key:2,label:e.$t("people.fields.last_name"),disabled:t.personToEdit.is_generated_from_ldap,modelValue:r.form.last_name,"onUpdate:modelValue":i[2]||(i[2]=s=>r.form.last_name=s),modelModifiers:{trim:!0}},null,8,["label","disabled","modelValue"])),t.isBot?d("",!0):(l(),p(b,{key:3,type:"email",errored:r.form.email&&!n.isValidEmail,label:e.$t("people.fields.email"),disabled:t.personToEdit.is_generated_from_ldap,modelValue:r.form.email,"onUpdate:modelValue":i[3]||(i[3]=s=>r.form.email=s),modelModifiers:{trim:!0}},null,8,["errored","label","disabled","modelValue"])),t.isBot?d("",!0):(l(),p(b,{key:4,label:e.$t("people.fields.phone"),modelValue:r.form.phone,"onUpdate:modelValue":i[4]||(i[4]=s=>r.form.phone=s),modelModifiers:{trim:!0}},null,8,["label","modelValue"])),t.isBot?(l(),p(v,{key:5,label:e.$t("bots.fields.expiration_date"),"min-date":e.today,disabled:n.isEditing,modelValue:r.form.expiration_date,"onUpdate:modelValue":i[5]||(i[5]=s=>r.form.expiration_date=s)},null,8,["label","min-date","disabled","modelValue"])):d("",!0),f(c,{label:e.$t("people.fields.role"),options:r.roleOptions,"locale-key-prefix":"people.role.",modelValue:r.form.role,"onUpdate:modelValue":i[6]||(i[6]=s=>r.form.role=s)},null,8,["label","options","modelValue"]),t.isBot?d("",!0):(l(),p(c,{key:6,label:e.$t("people.fields.contract"),options:r.contractOptions,"locale-key-prefix":"people.contract.",modelValue:r.form.contract_type,"onUpdate:modelValue":i[7]||(i[7]=s=>r.form.contract_type=s)},null,8,["label","options","modelValue"])),m("div",oe,[m("label",ae,a(e.$t("people.fields.departments")),1),r.form.departments&&r.form.departments.length===0?(l(),o("p",ne,a(e.$t("people.departments_empty")),1)):d("",!0),(l(!0),o(y,null,T(r.form.departments,s=>(l(),o("div",{class:"department-element mb1 mt05",key:s,onClick:k=>n.removeDepartment(s)},[s?(l(),p(E,{key:0,department:e.departmentMap.get(s)},null,8,["department"])):d("",!0)],8,re))),128)),m("div",de,[n.selectableDepartments.length>0?(l(),p(B,{key:0,class:"flexrow-item","selectable-departments":n.selectableDepartments,modelValue:r.selectedDepartment,"onUpdate:modelValue":i[8]||(i[8]=s=>r.selectedDepartment=s)},null,8,["selectable-departments","modelValue"])):d("",!0),n.selectableDepartments.length>0?(l(),o("button",{key:1,class:h(["button is-success flexrow-item",{"is-disabled":r.selectedDepartment===null}]),type:"button",onClick:i[9]||(i[9]=(...s)=>n.addDepartment&&n.addDepartment(...s))},a(e.$t("main.add")),3)):d("",!0)])]),t.isBot?d("",!0):(l(),p(V,{key:7,class:"field",label:e.$t("people.fields.studio"),modelValue:r.form.studio_id,"onUpdate:modelValue":i[10]||(i[10]=s=>r.form.studio_id=s)},null,8,["label","modelValue"])),f(c,{label:e.$t("people.fields.active"),options:r.activeOptions,disabled:t.personToEdit.is_generated_from_ldap,modelValue:r.form.active,"onUpdate:modelValue":i[11]||(i[11]=s=>r.form.active=s)},null,8,["label","options","disabled","modelValue"]),m("div",me,[n.isEditing&&e.isCurrentUserAdmin&&!t.isBot?(l(),o("button",{key:0,class:h(["button flexrow-item",{"is-loading":t.isInviteLoading}]),disabled:!n.isValidEmail,type:"button",onClick:i[12]||(i[12]=s=>n.emitForm("invite"))},a(e.$t("people.invite")),11,ce)):d("",!0),i[16]||(i[16]=m("div",{class:"filler"},null,-1)),!n.isEditing&&e.isCurrentUserAdmin&&!t.isBot?(l(),o("button",{key:1,class:h(["button is-primary flexrow-item",{"is-loading":t.isCreateInviteLoading}]),disabled:!n.isValidForm,type:"button",onClick:i[13]||(i[13]=s=>n.emitForm("confirm-invite"))},a(e.$t("people.create_invite")),11,ue)):d("",!0),m("button",{class:h(["button is-primary flexrow-item",{"is-loading":t.isLoading}]),disabled:!n.isValidForm,type:"submit"},a(n.isEditing?e.$t("people.confirm_edit"):e.$t("people.create")),11,pe),m("button",{class:"button is-link flexrow-item",type:"button",onClick:i[14]||(i[14]=s=>e.$emit("cancel"))},a(e.$t("main.cancel")),1)]),t.isInvitationSuccess?(l(),o("div",fe,a(e.$t("people.invite_success")),1)):d("",!0),t.isInvitationError?(l(),o("div",be,a(e.$t("people.invite_error")),1)):d("",!0),t.isUserLimitError?(l(),o("div",he,a(e.$t("people.user_limit_error")),1)):d("",!0),t.isError?(l(),o("div",_e,a(e.$t("people.create_error")),1)):d("",!0)],32)])],2)}const qe=C(te,[["render",ve],["__scopeId","data-v-bb0f8e59"]]),ye={name:"people-list",components:{AlertTriangleIcon:O,DepartmentNamesCell:J,PeopleNameCell:W,RowActionsCell:P,StudioName:j,TableInfo:z},props:{entries:{type:Array,default:()=>[]},isBots:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["avatar-clicked","change-password-clicked","delete-clicked","edit-clicked","refresh-clicked"],computed:{...w(["isCurrentUserAdmin"]),activePeople(){return this.entries.filter(e=>e.active)},today(){return new Date().toJSON().slice(0,10)},nextWeek(){const e=new Date;return e.setDate(e.getDate()+7),e.toJSON().slice(0,10)},inactivePeople(){return this.entries.filter(e=>!e.active)},nbUsersDetails(){const e=this.entries.length,i=this.$tc(this.isBots?"bots.bots":"people.persons",e);return`${e} ${i}`}},methods:{isExpired(e){return e<this.today},isSoonExpired(e){return!this.isExpired(e)&&e<this.nextWeek}}},ke={class:"data-list"},ge={class:"datatable-wrapper"},Ee={key:0,class:"datatable"},Be={class:"datatable-head"},Ve={scope:"col",class:"name datatable-row-header"},Ce={key:0,scope:"col",class:"email"},De={key:1,scope:"col",class:"phone"},we={key:2,scope:"col",class:"expiration"},Te={scope:"col",class:"role"},Ue={key:3,scope:"col",class:"contract"},xe={scope:"col",class:"departments"},Fe={key:4,scope:"col",class:"studio"},Ae={key:0,class:"datatable-body"},Le={key:0,class:"email"},Ne={key:1,class:"phone"},Se={class:"role"},Ie={key:3,class:"contract"},Me={key:4,class:"studio"},Oe={key:6,class:"actions"},Pe={key:0,class:"has-text-centered footer-info"};function ze(e,i,t,_,r,n){const b=u("people-name-cell"),v=u("alert-triangle-icon"),c=u("department-names-cell"),E=u("studio-name"),B=u("row-actions-cell"),V=u("table-info");return l(),o("div",ke,[m("div",ge,[t.isLoading?d("",!0):(l(),o("table",Ee,[m("thead",Be,[m("tr",null,[m("th",Ve,a(e.$t("people.list.name")),1),t.isBots?d("",!0):(l(),o("th",Ce,a(e.$t("people.list.email")),1)),t.isBots?d("",!0):(l(),o("th",De,a(e.$t("people.list.phone")),1)),t.isBots?(l(),o("th",we,a(e.$t("people.list.expiration")),1)):d("",!0),m("th",Te,a(e.$t("people.list.role")),1),t.isBots?d("",!0):(l(),o("th",Ue,a(e.$t("people.list.contract")),1)),m("th",xe,a(e.$t("people.list.departments")),1),t.isBots?d("",!0):(l(),o("th",Fe,a(e.$t("people.list.studio")),1)),i[0]||(i[0]=m("th",{scope:"col",class:"actions"},null,-1))])]),t.entries.length>0?(l(),o("tbody",Ae,[(l(!0),o(y,null,T(t.entries,s=>(l(),o("tr",{key:s.id,class:"datatable-row"},[f(b,{class:"name datatable-row-header",person:s},null,8,["person"]),t.isBots?d("",!0):(l(),o("td",Le,a(s.email),1)),t.isBots?d("",!0):(l(),o("td",Ne,a(s.phone),1)),t.isBots?(l(),o("td",{key:2,class:h(["expiration",{error:n.isExpired(s.expiration_date),warning:n.isSoonExpired(s.expiration_date)}])},[g(a(s.expiration_date)+" ",1),f(v,{class:"icon mr05"})],2)):d("",!0),m("td",Se,a(e.$t(`people.role.${s.role}`)),1),t.isBots?d("",!0):(l(),o("td",Ie,a(e.$t(`people.contract.${s.contract_type}`)),1)),f(c,{class:"departments",departments:s.departments},null,8,["departments"]),t.isBots?d("",!0):(l(),o("td",Me,[s.studio?(l(),p(E,{key:0,studio:s.studio},null,8,["studio"])):d("",!0)])),e.isCurrentUserAdmin?(l(),p(B,{key:5,"entry-id":s.id,"hide-avatar":!s.active,"hide-change-password":t.isBots||!s.active,"hide-delete":s.active,"hide-refresh":!t.isBots||!s.active,onAvatarClicked:k=>e.$emit("avatar-clicked",s),onChangePasswordClicked:k=>e.$emit("change-password-clicked",s),onEditClicked:k=>e.$emit("edit-clicked",s),onRefreshClicked:k=>e.$emit("refresh-clicked",s),onDeleteClicked:k=>e.$emit("delete-clicked",s)},null,8,["entry-id","hide-avatar","hide-change-password","hide-delete","hide-refresh","onAvatarClicked","onChangePasswordClicked","onEditClicked","onRefreshClicked","onDeleteClicked"])):(l(),o("td",Oe))]))),128))])):d("",!0)]))]),f(V,{"is-loading":t.isLoading,"is-error":t.isError},null,8,["is-loading","is-error"]),t.isLoading?d("",!0):(l(),o("p",Pe,a(n.nbUsersDetails),1))])}const Ge=C(ye,[["render",ze],["__scopeId","data-v-3575e6ee"]]);export{Ze as E,Ge as P,qe as a};
//# sourceMappingURL=PeopleList-DvtOuqhp.js.map
