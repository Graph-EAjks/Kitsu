import{_ as L,o as n,c as r,t as o,p as _,ar as I,B as W,C as z,G,bN as X,bO as K,R as J,bP as Z,bQ as Q,S as $,x as tt,X as et,bR as it,z as k,m as st,b as lt,bS as at,bT as nt,aY as rt,bU as dt,j as D,bV as S,bW as ot,bX as ht,r as u,e as d,l as g,d as y,f as c,a3 as b,F as f,g as P,w as x,A as T,a9 as C}from"./index-a83mlrHR.js";const yt={name:"error-text",props:{text:{default:"",type:String},hidden:{default:!1,type:Boolean},alignRight:{default:!1,type:Boolean}}};function ut(t,e,a,p,l,i){return n(),r("p",{class:_({error:!0,"has-text-right":a.alignRight,"is-hidden":a.hidden})},o(a.text),3)}const pt=L(yt,[["render",ut]]),ct={name:"playlist",components:{BuildFilterModal:I,ButtonSimple:W,Combobox:z,ComboboxTaskType:G,ErrorText:pt,EditPlaylistModal:X,LightEntityThumbnail:K,PageSubtitle:J,PlaylistPlayer:Z,PlusIcon:Q,SearchField:$,Spinner:tt,TaskTypeName:et,XIcon:it},data(){return{currentPlaylist:{name:""},currentSort:"updated_at",currentEntities:{},isAddingEntity:!1,isListToggled:!1,page:1,taskTypeId:"",sortedPlaylists:[],sortOptions:["updated_at","created_at","name"].map(t=>({label:t,value:t})),playlistToEdit:{name:`${k().format("YYYY-MM-DD HH:mm:ss")}`,for_client:!1},previewFileMap:new Map,previewFileEntityMap:new Map,modals:{isBuildFilterDisplayed:!1,isEditDisplayed:!1},loading:{addPlaylist:!1,addDaily:!1,addEpisode:!1,addMovie:!1,addSequence:!1,addWeekly:!1,editPlaylist:!1,playlist:!1,playlists:!1,playlistsInit:!0},errors:{editPlaylist:!1,playlistLoading:!1}}},computed:{...st(["assetMap","assetSearchText","currentEpisode","currentProduction","displayedAssets","displayedAssetsByType","displayedSequences","displayedShots","displayedShotsBySequence","isAssetsLoading","isCurrentUserManager","isCurrentUserSupervisor","isShotsLoading","isTVShow","productionTaskTypes","playlistMap","playlists","playlistsPath","sequenceMap","shotsByEpisode","shotSearchText","shotMap","taskMap","taskStatusMap","taskTypeMap"]),isAdditionLoading(){return this.loading.addSequence||this.loading.addWeekly||this.loading.addDaily||this.loading.addEpisode},isAssetPlaylist(){return this.currentPlaylist.for_entity==="asset"},isSequencePlaylist(){return this.currentPlaylist.for_entity==="sequence"},currentEntityType(){return this.currentPlaylist.for_entity},isAddSearchVisible(){return this.isAssetPlaylist&&this.assetSearchText||!this.isAssetPlaylist&&this.shotSearchText},lastPlaylists(){return this.playlists},playlistPlayer(){return this.$refs["playlist-player"]},addEntitiesText(){return this.isAssetPlaylist?this.$t("playlists.add_assets"):this.isSequencePlaylist?this.$t("playlists.add_sequences"):this.$t("playlists.add_shots")},tvShowPageTitle(){const t=this.currentProduction?this.currentProduction.name:"";let e="";return this.currentEpisode&&(e=this.currentEpisode.name,this.currentEpisode.id==="all"&&(e=this.$t("main.all")),this.currentEpisode.id==="main"&&(e="Main Pack")),`${t} - ${e} | ${this.$t("playlists.title")} - Kitsu`},shortPageTitle(){return`${this.currentProduction?this.currentProduction.name:""} | ${this.$t("playlists.title")} - Kitsu`},taskTypeList(){return[{id:"",color:"#999",name:this.$t("news.all")}].concat([...this.productionTaskTypes])}},methods:{...lt(["pushEntityToPlaylist","changePlaylistOrder","changePlaylistPreview","changePlaylistType","displayMoreAssets","displayMoreShots","editPlaylist","getPending","loadEpisodes","loadMorePlaylists","loadPlaylist","loadPlaylists","loadEntityPreviewFiles","loadShots","loadAssets","newPlaylist","refreshPlaylist","removeEntityPreviewFromPlaylist","resetSequences","setAssetSearch","setSequenceSearch","setShotSearch","updatePreviewAnnotation"]),formatDate(t){return at(t)},getPlaylistPath(t,e){return nt(this.currentProduction.id,this.currentEpisode?this.currentEpisode.id:null,t,e)},playlistElementStyle(t){if(this.isListToggled)return;const e=this.taskTypeMap.get(t.task_type_id);return{"border-left":`4px solid ${(e==null?void 0:e.color)||"transparent"}`}},getTaskStatus(t){let e=this.shotMap.get(t.id);if(e||(e=this.assetMap.get(t.id)),e||(e=this.sequenceMap.get(t.id)),!e)return{};const a=t.validations.get(this.currentPlaylist.task_type_id);if(a){const p=this.taskMap.get(a);return p?this.taskStatusMap.get(p.task_status_id):{}}else return{}},async loadShotsData(){(this.displayedShots.length===0||this.displayedShots[0].project_id!==this.currentProduction.id||this.currentEpisode&&this.displayedShots[0].episode_id!==this.currentEpisode.id)&&(this.isTVShow&&this.currentEpisode&&(this.currentEpisode.id==="main"||this.currentEpisode.id==="all")||(this.isTVShow&&!this.currentEpisode&&await this.loadEpisodes(),await this.loadShots()))},loadAssetsData(){return this.isTVShow||this.displayedAssets.length===0?this.loadAssets():Promise.resolve()},loadPlaylistsData(t=!1){const e=()=>{this.setCurrentPlaylist(()=>((!this.currentPlaylist||!this.currentPlaylist.id)&&this.goFirstPlaylist(),Promise.resolve()))};return this.playlists.length===0||t?this.loadPlaylists({sortBy:this.currentSort,page:this.page,taskTypeId:this.taskTypeId}).then(()=>e()).catch(a=>(console.error(a),this.errors.loadPlaylists=!0,Promise.reject(a))):e()},onPlaylistListScroll(t){if(this.$options.silentMore)return;const e=this.$refs.playlistList,a=e.scrollHeight-e.offsetHeight,p=t.target;a<p.scrollTop+20&&(this.$options.silentMore=!0,this.page++,this.loadMorePlaylists({sortBy:this.currentSort,page:this.page,taskTypeId:this.taskTypeId}).then(l=>{setTimeout(()=>{this.$options.silentMore=!1},1e3)}).catch(l=>(console.error(l),this.$options.silentMore=!1,this.errors.loadPlaylists=!0,Promise.reject(l))))},rebuildCurrentEntities(){this.currentEntities={};const t={};this.previewFileMap=new Map,this.previewFileEntityMap=new Map,this.currentPlaylist&&this.currentPlaylist.shots&&this.currentPlaylist.shots.forEach(e=>{const a=this.convertEntityToPlaylistFormat(e);a&&(t[a.id]=a,this.previewFileEntityMap.set(e.preview_file_id,a),Object.values(a.preview_files).forEach(l=>{l.forEach(i=>{this.previewFileMap.set(i.id,i)})}))}),this.$nextTick(()=>{this.currentEntities=t})},onAnnotationsRefreshed(t){const e=this.previewFileEntityMap.get(t.id),a=this.previewFileMap.get(t.id);e&&(e.preview_file_annotations=t.annotations),a&&(a.annotations=t.annotations)},convertEntityToPlaylistFormat(t){let e;if(this.isAssetPlaylist?e=this.assetMap.get(t.id):this.isSequencePlaylist?(e=this.sequenceMap.get(t.id),this.currentEpisode&&(e.episode_name=this.currentEpisode.name)):e=this.shotMap.get(t.id),e){const a={id:t.id,name:e.name,parent_name:e.sequence_name||e.episode_name||e.asset_type_name,preview_files:t.preview_files,preview_file_id:t.preview_file_id||e.preview_file_id,preview_file_extension:t.preview_file_extension||e.preview_file_extension,preview_file_revision:t.preview_file_revision||e.preview_file_revision,preview_file_width:t.preview_file_width||e.preview_file_width,preview_file_height:t.preview_file_height||e.preview_file_height,preview_file_duration:t.preview_file_duration||e.preview_file_duration,preview_file_task_id:t.task_id||t.preview_file_task_id||e.preview_file_task_id,preview_file_annotations:t.preview_file_annotations||e.preview_file_annotations,preview_file_previews:t.preview_file_previews||e.preview_file_previews,preview_nb_frames:t.nb_frames||e.nb_frames||rt};return this.previewFileEntityMap.set(a.preview_file_id,a),(a.preview_file_previews||[]).forEach(l=>{this.previewFileMap.set(l.id,l)}),a}else return null},setCurrentPlaylist(t){const e=this.$route.params.playlist_id,a=this.playlistMap.get(e);a?(this.loading.playlist=!0,this.loadPlaylist(a).then(p=>{this.currentPlaylist=dt(p),this.rebuildCurrentEntities(),this.loading.playlist=!1,t&&t()})):(this.currentPlaylist={name:""},this.currentShots={})},addEntity(t,e=!0){return this.loadEntityPreviewFiles(t).then(a=>this.addToStorePlaylistAndSave(a,t)).then(a=>{this.addToPlayerPlaylist(a,e)}).catch(a=>console.error(a))},addToStorePlaylistAndSave(t,e){return this.pushEntityToPlaylist({playlist:this.currentPlaylist,previewFiles:t,entity:{...e}})},addToPlayerPlaylist(t,e=!0){const a=this.convertEntityToPlaylistFormat(t);this.currentEntities[a.id]=a,this.playlistPlayer.entityList.push(a),e&&this.$nextTick(()=>{this.playlistPlayer.scrollToRight()})},addEntityToPlaylist(t){this.currentEntities[t.id]||this.addEntity(t).then(this.playlistPlayer.scrollToRight())},onNewEntityDropped(t){let e=null;this.isAssetPlaylist?e=this.assetMap.get(t.after):this.isSequencePlaylist?e=this.sequenceMap.get(t.after):e=this.shotMap.get(t.after),e&&!this.currentEntities[e.id]&&this.addEntity(e,!1).then(()=>{this.playlistPlayer.onEntityDropped(t)})},removeEntity(t){this.removeEntityPreviewFromPlaylist({playlist:this.currentPlaylist,entity:t,callback:()=>{delete this.currentEntities[t.id]}})},clearCurrentPlaylist(){this.currentPlaylist={},this.currentShots={}},resetPlaylist(){this.clearCurrentPlaylist(),this.setCurrentPlaylist()},addCurrentSelection(){this.$options.silent=!0;const t=this.isAssetPlaylist?this.displayedAssets:this.displayedShots;this.addEntities([...t].reverse(),()=>{this.$options.silent=!1})},addSequence(t){if(t.length>0){const e=t[0].sequence_id,a=Array.from(this.shotMap.values()).filter(p=>p.sequence_id===e).sort(D("name")).reverse();this.$options.silent=!0,this.addEntities(a,()=>{this.$options.silent=!1})}},addAllPending(){this.$options.silent=!0,this.loading.addWeekly=!0,this.getPending(!1).then(t=>{this.addEntities(t.reverse(),()=>{this.loading.addWeekly=!1,this.$options.silent=!1})})},addDailyPending(){this.loading.addDaily=!0,this.$options.silent=!0,this.getPending(!0).then(t=>{this.addEntities(S(t).reverse(),()=>{this.loading.addDaily=!1,this.$options.silent=!1})})},addEpisodePending(){this.loading.addEpisode=!0,this.$options.silent=!0;let t=[].concat(...this.shotsByEpisode);t=S(t).reverse(),this.addEntities(t,()=>{this.loading.addEpisode=!1,this.$options.silent=!1})},addMovie(){this.loading.addMovie=!0,this.$options.silent=!0;const t=S(Array.from(this.shotMap.values()));this.addEntities(t.reverse(),()=>{this.loading.addMovie=!1,this.$options.silent=!1})},addEntities(t,e){if(t&&t.length>0){const a=t.pop();this.addEntity(a).then(()=>{this.addEntities(t,e)})}else e()},onPreviewChanged(t,e){this.changePlaylistPreview({playlist:this.currentPlaylist,entity:t,previewFileId:e})},onOrderChange(t){this.changePlaylistOrder({playlist:this.currentPlaylist,info:t})},onAnnotationChanged({preview:t,additions:e,deletions:a,updates:p}){const l=t.task_id;this.updatePreviewAnnotation({taskId:l,preview:t,additions:e,deletions:a,updates:p})},confirmBuildFilter(t){this.modals.isBuildFilterDisplayed=!1,this.$refs["search-field"].setValue(t),this.onSearchChange(t)},onSearchChange(t){t.length>1?this.isAssetPlaylist?(this.setAssetSearch(t),this.displayMoreAssets()):this.isSequencePlaylist?(this.setSequenceSearch(t),this.resetSequences()):(this.setShotSearch(t),this.displayMoreShots()):this.isAssetPlaylist?this.setAssetSearch(""):this.isSequencePlaylist?this.setSequenceSearch(""):this.setShotSearch("")},onForClientChanged(t){this.editPlaylist({data:{id:this.currentPlaylist.id,for_client:t}})},runAddPlaylist(t){const e={name:t.name,production_id:this.currentProduction.id,for_client:t.for_client,for_entity:t.for_entity,is_for_all:t.is_for_all,task_type_id:t.task_type_id};this.isTVShow&&this.currentEpisode&&(e.episode_id=this.currentEpisode.id),this.loading.editPlaylist=!0,this.errors.editPlaylist=!1,this.newPlaylist(e).then(a=>{this.$router.push(this.getPlaylistPath(a.id)),this.loading.editPlaylist=!1,this.modals.isEditDisplayed=!1}).catch(a=>{console.error(a),this.errors.editPlaylist=!0,this.loading.editPlaylist=!1})},confirmEditPlaylist(t){this.playlistToEdit.id?(t.id=this.currentPlaylist.id,this.runEditPlaylist(t)):this.runAddPlaylist(t)},runEditPlaylist(t){this.loading.editPlaylist=!0,this.errors.editPlaylist=!1,this.editPlaylist({data:{id:t.id,for_client:t.for_client,for_entity:t.for_entity,name:t.name,task_type_id:t.task_type_id},callback:(e,a)=>{e?this.errors.editPlaylist=!0:(this.modals.isEditDisplayed=!1,Object.assign(this.currentPlaylist,a)),this.loading.editPlaylist=!1}})},goFirstPlaylist(){this.playlists.length>0?this.$router.push({name:"playlist",params:{production_id:this.currentProduction.id,playlist_id:this.playlists[0].id}}):this.$router.push(this.playlistsPath)},onEntityDragStart(t,e){t.dataTransfer.setData("entityId",e.id)},toggleAddEntities(){this.isAddingEntity&&this.resetPlaylist(),this.isAddingEntity=!this.isAddingEntity},onTaskTypeChanged(t){this.changePlaylistType({playlist:this.currentPlaylist,taskTypeId:t,callback:()=>{this.rebuildCurrentEntities()}})},onBodyScroll(t){const e=t.target;this.$refs.entityListContent.scrollHeight-this.$refs.entityListContent.offsetHeight<e.scrollTop&&(this.isAssetPlaylist?this.displayMoreAssets():this.displayMoreShots())},resetSorting(){let t=1;["created_at","updated_at"].includes(this.currentSort)&&(t=-1),this.sortedPlaylists=[...this.playlists].sort(D(this.currentSort,t).thenBy("name"))},showAddModal(){this.playlistToEdit={name:`${k().format("YYYY-MM-DD HH:mm:ss")}`,for_client:!1},this.errors.editPlaylist=!1,this.modals.isEditDisplayed=!0},showEditModal(){this.playlistToEdit=this.currentPlaylist,this.errors.editPlaylist=!1,this.modals.isEditDisplayed=!0},hideEditModal(){this.playlistToEdit={name:`${k().format("YYYY-MM-DD HH:mm:ss")}`,for_client:!1},this.modals.isEditDisplayed=!1},async reloadAll(){this.loading.playlists||(this.loading.playlists=!0,await this.loadShotsData(),await this.loadAssetsData(),this.page=1,await this.loadPlaylistsData(),this.loading.playlists=!1,this.resetPlaylist(),setTimeout(()=>{this.loading.playlistsInit=!1},300))}},mounted(){this.$nextTick(()=>{this.reloadAll(),localStorage.getItem("playlist-sort")&&(this.currentSort=localStorage.getItem("playlist-sort")),this.resetSorting()})},watch:{$route(){this.setCurrentPlaylist()},currentPlaylist(){this.currentPlaylist.shots?(this.$options.silentMore=!1,this.isAddingEntity=Object.keys(this.currentPlaylist.shots).length===0):this.isAddingEntity=!0},currentProduction(){this.$store.commit("LOAD_PLAYLISTS_END",[]),this.reloadAll()},currentEpisode(){this.$store.commit("LOAD_PLAYLISTS_END",[]),this.currentEpisode&&this.reloadAll()},currentSort(){localStorage.setItem("playlist-sort",this.currentSort),this.loading.playlists=!0,this.page=1,this.loadPlaylistsData(!0).then(()=>{this.loading.playlists=!1})},isListToggled(){var t;(t=this.playlistPlayer)==null||t.onWindowResize()},taskTypeId(){this.loadPlaylistsData(!0)}},socket:{events:{"playlist:new"(t){this.playlistMap.get(t.playlist_id)||this.refreshPlaylist(t.playlist_id)},"playlist:update"(t){},"playlist:delete"(t){this.$store.commit("DELETE_PLAYLIST_END",{id:t.playlist_id})},"build-job:new"(t){t.playlist_id===this.currentPlaylist.id&&(this.currentPlaylist.build_jobs=[{id:t.build_job_id,created_at:t.created_at,status:"running",playlist_id:this.currentPlaylist.id}].concat(this.currentPlaylist.build_jobs))},"build-job:update"(t){t.playlist_id===this.currentPlaylist.id&&ot(this.currentPlaylist.build_jobs,{id:t.build_job_id,status:t.status})},"build-job:delete"(t){t.playlist_id===this.currentPlaylist.id&&(this.currentPlaylist.build_jobs=ht(this.currentPlaylist.build_jobs,{id:t.build_job_id}))}}},head(){return this.isTVShow?{title:this.tvShowPageTitle}:{title:this.shortPageTitle}}},_t={class:"playlists page fixed-page dark"},gt={class:"columns"},ft={class:"flexrow top-section"},Pt={key:1,class:"filler"},mt={class:"flexrow"},vt={key:1,class:"playlists"},wt={key:0,class:"flexrow"},Et={class:"flerxow-item ml05"},kt={class:"playlist-date"},St={key:1,class:"has-text-centered"},bt={key:0,class:"playlist-column no-selection"},Tt={key:0,class:"flexcolumn xyz-in",xyz:"fade stagger"},Ct={class:"has-text-centered"},At={class:"playlist-infos flexrow"},Mt={key:0},Dt={key:1},xt={key:1,class:"playlist-column no-selection has-text-centered"},Lt={key:0},Ft={class:"empty-explaination"},Bt={key:2,class:"playlist-column column"},qt={key:0},Vt={class:"addition-header"},jt={class:"flexrow"},Nt={class:"flexrow"},Rt=["disabled"],Ut=["disabled"],Yt=["disabled"],Ot=["disabled"],Ht={key:1,ref:"entityListContent"},It={key:0},Wt={key:0,class:"entity-group-title"},zt={class:"addition-entities"},Gt=["onDragstart","onClick"],Xt={class:"playlisted-shot-name"},Kt={key:1},Jt={class:"addition-entities"},Zt=["onDragstart","onClick"],Qt=["title"],$t={class:"playlisted-shot-name"},te={key:2},ee={key:0,class:"entity-group-title"},ie=["onClick"],se={class:"addition-entities"},le=["onDragstart","onClick"],ae=["title"],ne={class:"playlisted-shot-name"};function re(t,e,a,p,l,i){const F=u("combobox-task-type"),A=u("button-simple"),B=u("combobox"),q=u("plus-icon"),m=u("light-entity-thumbnail"),M=u("router-link"),E=u("spinner"),V=u("error-text"),j=u("task-type-name"),N=u("playlist-player"),R=u("page-subtitle"),U=u("x-icon"),Y=u("search-field"),O=u("edit-playlist-modal"),H=u("build-filter-modal");return n(),r("div",_t,[d("div",gt,[d("div",{ref:"playlistList",class:_({"playlist-list-column":!0,column:!0,toggled:l.isListToggled}),onScrollPassive:e[4]||(e[4]=(...s)=>i.onPlaylistListScroll&&i.onPlaylistListScroll(...s))},[d("div",ft,[l.isListToggled?y("",!0):(n(),g(F,{key:0,class:"flexrow-item selector mb1","task-type-list":i.taskTypeList,label:t.$t("playlists.filter_task_type"),thin:!0,modelValue:l.taskTypeId,"onUpdate:modelValue":e[0]||(e[0]=s=>l.taskTypeId=s)},null,8,["task-type-list","label","modelValue"])),l.isListToggled?y("",!0):(n(),r("span",Pt)),c(A,{class:"flexrow-item",style:{flex:"0"},icon:l.isListToggled?"right":"left","is-small":"",onClick:e[1]||(e[1]=s=>l.isListToggled=!l.isListToggled)},null,8,["icon"])]),d("div",mt,[l.isListToggled?y("",!0):(n(),g(B,{key:0,class:"flexrow-item mb2",label:t.$t("main.sorted_by"),options:l.sortOptions,"locale-key-prefix":"playlists.fields.",modelValue:l.currentSort,"onUpdate:modelValue":e[2]||(e[2]=s=>l.currentSort=s)},null,8,["label","options","modelValue"]))]),(t.isCurrentUserManager||t.isCurrentUserSupervisor)&&!l.isListToggled?(n(),r("button",{class:_({button:!0,"is-loading":l.loading.addPlaylist}),onClick:e[3]||(e[3]=(...s)=>i.showAddModal&&i.showAddModal(...s)),key:"new-playlist-button"},[c(q,{class:"icon is-small"}),b(" "+o(t.$t("playlists.new_playlist")),1)],2)):y("",!0),l.loading.playlists?(n(),g(E,{key:2,class:"mt2"})):(n(),r("div",vt,[(n(!0),r(f,null,P(t.playlists,s=>(n(),g(M,{key:s.id,to:i.getPlaylistPath(s.id),class:_({"playlist-item":!0,"for-client":s.for_client||!1,selected:s.id===l.currentPlaylist.id})},{default:x(()=>[d("div",{class:"playlist-item-content",style:T(i.playlistElementStyle(s))},[l.isListToggled?(n(),r("div",St,[s.first_preview_file_id?(n(),g(m,{key:0,"preview-file-id":s.first_preview_file_id,type:"previews",width:"38px",height:"30px","max-width":"38px","max-height":"30px","empty-width":"38px","empty-height":"30px",title:s.name},null,8,["preview-file-id","title"])):y("",!0)])):(n(),r("div",wt,[c(m,{class:"flerxow-item playlist-thumbnail","preview-file-id":s.first_preview_file_id,type:"previews",width:"38px",height:"30px","max-width":"38px","max-height":"30px","empty-width":"38px","empty-height":"30px",title:s.name},null,8,["preview-file-id","title"]),d("div",Et,[b(o(s.name)+" ",1),d("span",kt,o(t.$t("playlists.updated_at"))+" "+o(i.formatDate(s.updated_at)),1)])]))],4)]),_:2},1032,["to","class"]))),128))])),l.errors.playlistLoading?(n(),g(V,{key:3,text:t.$t("playlists.loading_error")},null,8,["text"])):y("",!0)],34),t.playlists.length>0&&!l.currentPlaylist.id&&!l.loading.playlist?(n(),r("div",bt,[!l.loading.playlists&&!l.loading.playlistsInit?(n(),r("div",Tt,[(n(!0),r(f,null,P(i.lastPlaylists,s=>(n(),g(M,{class:"recent-playlist flexrow-item flexrow",key:"recent-playlist-"+s.id,to:i.getPlaylistPath(s.id)},{default:x(()=>[d("div",Ct,[c(m,{class:"playlist-thumbnail","preview-file-id":s.first_preview_file_id,type:"previews",width:"auto",height:"auto","empty-height":"252px"},null,8,["preview-file-id"])]),d("div",At,[d("div",null,[d("h3",null,o(s.name),1),l.currentSort==="created_at"?(n(),r("span",Mt,o(t.$t("playlists.created_at"))+" "+o(i.formatDate(s.created_at)),1)):(n(),r("span",Dt,o(t.$t("playlists.updated_at"))+" "+o(i.formatDate(s.updated_at)),1))]),e[15]||(e[15]=d("span",{class:"filler"},null,-1)),d("div",null,[s.task_type_id?(n(),g(j,{key:0,"task-type":t.taskTypeMap.get(s.task_type_id)},null,8,["task-type"])):y("",!0)])])]),_:2},1032,["to"]))),128))])):(n(),g(E,{key:1,class:"mt2"}))])):t.playlists.length===0?(n(),r("div",xt,[!l.loading.playlists&&!l.loading.playlistsInit?(n(),r("div",Lt,[d("p",Ft,o(t.$t("playlists.no_playlist")),1),t.isCurrentUserManager||t.isCurrentUserSupervisor?(n(),r("button",{class:_({big:!0,button:!0,"is-loading":l.loading.addPlaylist}),onClick:e[5]||(e[5]=(...s)=>i.showAddModal&&i.showAddModal(...s)),key:"new-playlist-button"},o(t.$t("playlists.new_playlist")),3)):y("",!0)])):(n(),g(E,{key:1,class:"mt2"}))])):(n(),r("div",Bt,[c(N,{ref:"playlist-player",playlist:l.currentPlaylist,entities:l.currentEntities,"is-loading":l.loading.playlist,"is-adding-entity":l.isAddingEntity,"current-entity-type":i.currentEntityType,onEditClicked:i.showEditModal,onShowAddEntities:i.toggleAddEntities,onPreviewChanged:i.onPreviewChanged,onTaskTypeChanged:i.onTaskTypeChanged,onPlaylistDeleted:e[6]||(e[6]=s=>t.$router.push(t.playlistsPath)),onRemoveEntity:i.removeEntity,onOrderChange:i.onOrderChange,onAnnotationChanged:i.onAnnotationChanged,onForClientChanged:i.onForClientChanged,onAnnotationsRefreshed:i.onAnnotationsRefreshed,onNewEntityDropped:i.onNewEntityDropped},null,8,["playlist","entities","is-loading","is-adding-entity","current-entity-type","onEditClicked","onShowAddEntities","onPreviewChanged","onTaskTypeChanged","onRemoveEntity","onOrderChange","onAnnotationChanged","onForClientChanged","onAnnotationsRefreshed","onNewEntityDropped"]),(t.isCurrentUserManager||t.isCurrentUserSupervisor)&&l.isAddingEntity&&!l.loading.playlist?(n(),r("div",qt,[d("div",Vt,[d("div",jt,[c(R,{class:"flexrow-item",text:i.addEntitiesText},null,8,["text"]),e[16]||(e[16]=d("span",{class:"filler"},null,-1)),d("a",{class:"close-button",onClick:e[7]||(e[7]=(...s)=>i.toggleAddEntities&&i.toggleAddEntities(...s))},[c(U)])]),d("div",Nt,[c(Y,{class:"flexrow-item",ref:"search-field","can-save":!1,onChange:i.onSearchChange,placeholder:i.isAssetPlaylist?"chars mode=wfa":"ex: seq01 anim=wfa"},null,8,["onChange","placeholder"]),c(A,{class:"flexrow-item",title:t.$t("entities.build_filter.title"),icon:"filter",onClick:e[8]||(e[8]=s=>l.modals.isBuildFilterDisplayed=!0)},null,8,["title"]),i.isAddSearchVisible?(n(),r("button",{key:0,class:_({button:!0,"flexrow-item":!0,"add-sequence":!0}),disabled:i.isAdditionLoading,onClick:e[9]||(e[9]=(...s)=>i.addCurrentSelection&&i.addCurrentSelection(...s))},o(t.$t("playlists.add_selection")),9,Rt)):y("",!0),e[17]||(e[17]=d("span",{class:"filler"},null,-1)),i.isAssetPlaylist?y("",!0):(n(),r("button",{key:1,class:_({button:!0,"add-sequence":!0,"is-loading":l.loading.addDaily}),disabled:i.isAdditionLoading,onClick:e[10]||(e[10]=(...s)=>i.addDailyPending&&i.addDailyPending(...s))},o(t.$t("playlists.build_daily")),11,Ut)),t.isTVShow&&!i.isAssetPlaylist&&!i.isSequencePlaylist?(n(),r("button",{key:2,class:_({button:!0,"add-sequence":!0,"is-loading":l.loading.addEpisode}),disabled:i.isAdditionLoading,onClick:e[11]||(e[11]=(...s)=>i.addEpisodePending&&i.addEpisodePending(...s))},o(t.$t("playlists.add_episode")),11,Yt)):i.isAssetPlaylist?y("",!0):(n(),r("button",{key:3,class:_({button:!0,"add-sequence":!0,"is-loading":l.loading.addMovie}),disabled:i.isAdditionLoading,onClick:e[12]||(e[12]=(...s)=>i.addMovie&&i.addMovie(...s))},o(t.$t("playlists.add_movie")),11,Ot))])])])):y("",!0),(t.isCurrentUserManager||t.isCurrentUserSupervisor)&&l.isAddingEntity?(n(),r("div",{key:1,class:"addition-section",onScrollPassive:e[13]||(e[13]=(...s)=>i.onBodyScroll&&i.onBodyScroll(...s))},[t.isShotsLoading||t.isAssetsLoading?(n(),g(E,{class:"mt2",key:"entity-loader"})):(n(),r("div",Ht,[i.isAssetPlaylist?(n(),r("div",It,[(n(!0),r(f,null,P(t.displayedAssetsByType,(s,v)=>(n(),r("div",{key:"asset-type-"+v},[s.length>0?(n(),r("h2",Wt,o(s[0].asset_type_name),1)):y("",!0),d("div",zt,[(n(!0),r(f,null,P(s.filter(h=>!h.canceled),h=>(n(),r("div",{class:_({"addition-shot":!0,playlisted:l.currentEntities[h.id]!==void 0}),key:h.id,draggable:"true",onDragstart:w=>i.onEntityDragStart(w,h),onClick:C(w=>i.addEntityToPlaylist(h),["prevent"])},[c(m,{"preview-file-id":h.preview_file_id,width:"150px",height:"100px"},null,8,["preview-file-id"]),d("span",Xt,o(h.name),1)],42,Gt))),128))])]))),128))])):i.isSequencePlaylist?(n(),r("div",Kt,[d("div",Jt,[(n(!0),r(f,null,P(t.displayedSequences.filter(s=>!s.canceled),s=>(n(),r("div",{class:_({"addition-shot":!0,playlisted:l.currentEntities[s.id]!==void 0}),key:s.id,draggable:"true",onDragstart:v=>i.onEntityDragStart(v,s),onClick:C(v=>i.addEntityToPlaylist(s),["prevent"])},[c(m,{"preview-file-id":s.preview_file_id,width:"150px",height:"100px"},null,8,["preview-file-id"]),d("div",null,[l.currentPlaylist.task_type_id?(n(),r("span",{key:0,title:i.getTaskStatus(s).name,style:T({color:i.getTaskStatus(s).color})}," • ",12,Qt)):y("",!0),d("span",$t,o(s.name),1)])],42,Zt))),128))])])):(n(),r("div",te,[(n(!0),r(f,null,P(t.displayedShotsBySequence,(s,v)=>(n(),r("div",{key:"sequence-"+v},[s.length>0?(n(),r("h2",ee,[b(o(s[0].sequence_name)+" ",1),t.isCurrentUserManager||t.isCurrentUserSupervisor?(n(),r("button",{class:"button",onClick:h=>i.addSequence(s),key:"add-sequence-button-"+s[0].sequence_id},o(t.$t("playlists.add_sequence")),9,ie)):y("",!0)])):y("",!0),d("div",se,[(n(!0),r(f,null,P(s.filter(h=>!h.canceled),h=>(n(),r("div",{key:h.id},[d("div",{class:_({"addition-shot":!0,playlisted:l.currentEntities[h.id]!==void 0}),draggable:"true",onDragstart:w=>i.onEntityDragStart(w,h),onClick:C(w=>i.addEntityToPlaylist(h),["prevent"])},[c(m,{"preview-file-id":h.preview_file_id,width:"150px",height:"100px"},null,8,["preview-file-id"]),d("div",null,[l.currentPlaylist.task_type_id?(n(),r("span",{key:0,title:i.getTaskStatus(h).name,style:T({color:i.getTaskStatus(h).color})}," • ",12,ae)):y("",!0),d("span",ne,o(h.name),1)])],42,le)]))),128))])]))),128))]))],512))],32)):y("",!0)]))]),c(O,{ref:"edit-playlist-modal",active:l.modals.isEditDisplayed,"is-loading":l.loading.editPlaylist,"is-error":l.errors.editPlaylist,"playlist-to-edit":l.playlistToEdit,"task-type-id":l.taskTypeId,onCancel:i.hideEditModal,onConfirm:i.confirmEditPlaylist},null,8,["active","is-loading","is-error","playlist-to-edit","task-type-id","onCancel","onConfirm"]),c(H,{ref:"build-filter-modal",active:l.modals.isBuildFilterDisplayed,"entity-type":i.currentEntityType,onConfirm:i.confirmBuildFilter,onCancel:e[14]||(e[14]=s=>l.modals.isBuildFilterDisplayed=!1)},null,8,["active","entity-type","onConfirm"])])}const oe=L(ct,[["render",re],["__scopeId","data-v-c8dfbecc"]]);export{oe as default};
//# sourceMappingURL=Playlist-Bvcmfgru.js.map
