import{a as l,b as r,bB as c,bD as d,n,a3 as p,T as h,x as y,d as u,aL as _}from"./TaskInfo-3098402d.js";import{g as f,T as m,a2 as o,k as T}from"./index-b8a377c1.js";import{B as S}from"./ButtonLink-0329a982.js";import{S as C}from"./StatsCell-3af9beae.js";const v={name:"production-asset-type-list",mixins:[f],props:{displayMode:{type:String,default:"pie"},entries:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},assetTypeStats:{type:Object,default:()=>{}},showAll:{type:Boolean,default:!1},validationColumns:{type:Array,default:()=>[]}},data(){return{busy:!1,lastSelection:null}},components:{ButtonLink:S,StatsCell:C,TableInfo:m},computed:{...l(["assetTypeSearchText","currentEpisode","currentProduction","displayedAssetTypesLength","isCurrentUserClient","isTVShow","taskTypeMap"]),isEmptyList(){return this.entries&&this.entries.length===0&&!this.isLoading&&!this.isError&&(!this.assetTypeSearchText||this.assetTypeSearchText.length===0)},newAssetPath(){const e={name:"new-asset",params:{production_id:this.currentProduction.id}};return this.isTVShow&&this.currentEpisode&&(e.name="episode-new-asset",e.params.episode_id=this.currentEpisode.id),e}},methods:{...r([]),chartColors(e,t){return c(this.assetTypeStats,e,t)},chartData(e,t){return d(this.assetTypeStats,e,t)},isStats(e,t){return this.assetTypeStats[e]&&this.assetTypeStats[e][t]},onHeaderScroll(e,t){this.$refs.tableWrapper.scrollLeft=t.scrollLeft},onBodyScroll(e,t){this.$emit("scroll",t.scrollTop)},setScrollPosition(e){this.$refs.body&&(this.$refs.body.scrollTop=e)},taskTypePath(e){const t={name:"task-type",params:{production_id:this.currentProduction.id,task_type_id:e,type:"assets"}};return this.isTVShow&&this.currentEpisode&&(t.name="episode-task-type",t.params.episode_id=this.currentEpisode.id),t}}};var g=function(){var t=this,s=t._self._c;return s("div",{staticClass:"data-list"},[s("div",{directives:[{name:"scroll",rawName:"v-scroll",value:t.onBodyScroll,expression:"onBodyScroll"}],ref:"body",staticClass:"datatable-wrapper"},[s("table",{staticClass:"datatable"},[s("thead",{staticClass:"datatable-head"},[s("tr",[s("th",{staticClass:"name datatable-row-header",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("asset_types.fields.name"))+" ")]),s("th",{staticClass:"validation",attrs:{scope:"col"}},[t._v(t._s(t.$t("main.all")))]),t._l(t.validationColumns,function(a){return t.isLoading?t._e():s("th",{key:a,staticClass:"validation validation-cell",attrs:{scope:"col"}},[s("div",{staticClass:"flexrow validation-content",style:t.getValidationStyle(a)},[t.isCurrentUserClient?s("span",{staticClass:"flexrow-item"},[t._v(" "+t._s(t.taskTypeMap.get(a).name)+" ")]):s("router-link",{staticClass:"flexrow-item",attrs:{to:t.taskTypePath(a)}},[t._v(" "+t._s(t.taskTypeMap.get(a).name)+" ")])],1)])}),s("th",{staticClass:"actions",attrs:{scope:"col"}})],2)]),t.isLoading?t._e():s("tbody",{staticClass:"datatable-body"},[t.showAll&&!t.isEmptyList?s("tr",{staticClass:"all-line datatable-row"},[s("th",{staticClass:"name datatable-row-header",attrs:{scope:"row"}},[t._v(" "+t._s(t.$t("asset_types.all_asset_types"))+" ")]),s("stats-cell",{attrs:{colors:t.chartColors("all","all"),data:t.chartData("all","all"),displayMode:t.displayMode}}),t._l(t.validationColumns,function(a){return s("stats-cell",{key:"all-"+a,style:t.getValidationStyle(a),attrs:{colors:t.chartColors("all",a),data:t.chartData("all",a),displayMode:t.displayMode}})}),s("td",{staticClass:"actions"})],2):t._e(),t._l(t.entries,function(a){return s("tr",{key:a.id,staticClass:"datatable-row"},[s("td",{staticClass:"name datatable-row-header",attrs:{scope:"row"}},[t._v(" "+t._s(a.name)+" ")]),t.isStats(a.id,"all")?s("stats-cell",{attrs:{colors:t.chartColors(a.id,"all"),data:t.chartData(a.id,"all"),displayMode:t.displayMode}}):s("td"),t._l(t.validationColumns,function(i){return t.isStats(a.id,i)?s("stats-cell",{key:a.id+i,style:t.getValidationStyle(i),attrs:{colors:t.chartColors(a.id,i),data:t.chartData(a.id,i),displayMode:t.displayMode}}):s("td",{style:t.getValidationStyle(i)})}),s("td",{staticClass:"actions"})],2)})],2)])]),s("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}}),t.isEmptyList&&!t.isCurrentUserClient&&!t.isLoading?s("div",{staticClass:"has-text-centered"},[t._m(0),s("p",{staticClass:"info"},[t._v(t._s(t.$t("assets.empty_list")))]),s("button-link",{staticClass:"level-item big-button",attrs:{text:t.$t("assets.new_asset"),path:t.newAssetPath}})],1):t._e(),t.isEmptyList&&t.isCurrentUserClient&&!t.isLoading?s("div",{staticClass:"has-text-centered"},[t._m(1),s("p",{staticClass:"info"},[t._v(t._s(t.$t("assets.empty_list_client")))])]):t._e(),!t.isEmptyList&&!t.isLoading?s("p",{staticClass:"has-text-centered nb-asset-types"},[t._v(" "+t._s(t.displayedAssetTypesLength)+" "+t._s(t.$tc("asset_types.number",t.displayedAssetTypesLength))+" ")]):t._e()],1)},b=[function(){var e=this,t=e._self._c;return t("p",{staticClass:"info"},[t("img",{attrs:{src:o}})])},function(){var e=this,t=e._self._c;return t("p",{staticClass:"info"},[t("img",{attrs:{src:o}})])}],L=n(v,g,b,!1,null,"6717bc35",null,null);const x=L.exports;const w={name:"production-asset-types",components:{ButtonSimple:p,Combobox:h,ProductionAssetTypeList:x,SearchField:T},data(){return{initialLoading:!0,displayMode:"pie",displayModeOptions:[{label:"pie",value:"pie"},{label:"count",value:"count"}]}},computed:{...l(["assetTypeMap","assetTypeStats","assetTypeSearchText","assetTypeListScrollPosition","assetValidationColumns","currentEpisode","currentProduction","displayedAssetTypes","isAssetsLoading","isAssetsLoadingError","isTVShow","taskStatusMap","taskTypeMap"])},created(){},mounted(){this.setDefaultSearchText(),this.setDefaultListScrollPosition(),setTimeout(()=>{this.reset()},100)},methods:{...r(["computeAssetTypeStats","initAssetTypes","loadAssets","setAssetTypeSearch","setAssetTypeListScrollPosition","setLastProductionScreen"]),setDefaultSearchText(){this.assetTypeSearchText.length>0&&this.$refs["asset-type-search-field"].setValue(this.assetTypeSearchText)},setDefaultListScrollPosition(){this.$refs["asset-type-list"].setScrollPosition(this.assetTypeListScrollPosition)},navigateToList(){this.$router.push(this.assetTypesPath)},onSearchChange(e){const t=this.$refs["asset-type-search-field"].getValue();this.setAssetTypeSearch(t)},saveScrollPosition(e){this.setAssetTypeListScrollPosition(e)},exportStatisticsToCsv(){const e=[y().format("YYYYMMDD"),this.currentProduction.name,"asset_types","statistics"];this.currentEpisode&&e.splice(2,0,this.currentEpisode.name);const t=u.slugify(e.join("_"));_.generateStatReports(t,this.assetTypeStats,this.taskTypeMap,this.taskStatusMap,this.assetTypeMap,this.countMode)},reset(){this.initialLoading=!0,this.$refs["asset-type-search-field"].setValue(""),this.loadAssets().then(this.handleModalsDisplay).then(()=>{this.computeAssetTypeStats(),this.setAssetTypeListScrollPosition(0),this.initialLoading=!1})}},watch:{currentProduction(){this.isTVShow||this.reset()},currentEpisode(){this.isTVShow&&this.reset()}},metaInfo(){return{title:`${this.currentProduction.name} | ${this.$t("asset_types.production_title")} - Kitsu`}}};var A=function(){var t=this,s=t._self._c;return s("div",{staticClass:"asset-types page fixed-page"},[s("div",{staticClass:"asset-type-list-header page-header flexrow"},[s("search-field",{ref:"asset-type-search-field",staticClass:"flexrow-item mt1",attrs:{placeholder:"ex: chars, agent327"},on:{change:t.onSearchChange}}),s("combobox",{staticClass:"mb0 flexrow-item",attrs:{label:t.$t("statistics.display_mode"),"locale-key-prefix":"statistics.",options:t.displayModeOptions},model:{value:t.displayMode,callback:function(a){t.displayMode=a},expression:"displayMode"}}),s("span",{staticClass:"filler"}),s("button-simple",{staticClass:"flexrow-item",attrs:{icon:"refresh",title:t.$t("main.reload")},on:{click:t.reset}}),s("button-simple",{staticClass:"flexrow-item",attrs:{icon:"download"},on:{click:t.exportStatisticsToCsv}})],1),s("production-asset-type-list",{ref:"asset-type-list",attrs:{entries:t.displayedAssetTypes,"is-loading":t.isAssetsLoading||t.initialLoading,"is-error":t.isAssetsLoadingError,"validation-columns":t.assetValidationColumns,"asset-type-stats":t.assetTypeStats,"display-mode":t.displayMode,"show-all":t.assetTypeSearchText.length===0},on:{scroll:t.saveScrollPosition}})],1)},M=[],P=n(w,A,M,!1,null,"0e62db15",null,null);const V=P.exports;export{V as default};
//# sourceMappingURL=ProductionAssetTypes-538656de.js.map
