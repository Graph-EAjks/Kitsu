import{ao as v,T as w,m as k,bm as A,bo as M,_ as C,r as p,o as a,c as r,e as o,t as n,F as m,g as S,A as T,l as g,w as P,a3 as V,d as u,f as c,b_ as b,B as E,C as D,S as B,b as x,aB as U,ab as N,ac as Y}from"./index-T_fbcUWL.js";import{S as F}from"./StatsCell-C0v-6U3n.js";const O={name:"production-asset-type-list",mixins:[v],props:{displayMode:{type:String,default:"pie"},entries:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},assetTypeStats:{type:Object,default:()=>{}},showAll:{type:Boolean,default:!1},validationColumns:{type:Array,default:()=>[]}},components:{StatsCell:F,TableInfo:w},computed:{...k(["assetTypeSearchText","currentEpisode","currentProduction","displayedAssetTypesLength","isCurrentUserClient","isTVShow","taskTypeMap"]),isEmptyList(){return this.entries&&this.entries.length===0&&!this.isLoading&&!this.isError&&(!this.assetTypeSearchText||this.assetTypeSearchText.length===0)}},methods:{chartColors(s,t){return A(this.assetTypeStats,s,t)},chartData(s,t){return M(this.assetTypeStats,s,t)},isStats(s,t){return this.assetTypeStats[s]&&this.assetTypeStats[s][t]},onHeaderScroll(s,t){this.$refs.tableWrapper.scrollLeft=t.scrollLeft},taskTypePath(s){const t={name:"task-type",params:{production_id:this.currentProduction.id,task_type_id:s,type:"assets"}};return this.isTVShow&&this.currentEpisode&&(t.name="episode-task-type",t.params.episode_id=this.currentEpisode.id),t}}},j={class:"data-list"},H={class:"datatable"},z={class:"datatable-head"},G={scope:"col",class:"name datatable-row-header"},K={scope:"col",class:"validation"},Q={key:1,class:"flexrow-item"},R={key:0,class:"datatable-body"},W={key:0,class:"all-line datatable-row"},q={scope:"row",class:"name datatable-row-header"},J={scope:"row",class:"name datatable-row-header"},X={key:1},Z={key:0,class:"has-text-centered"},$={class:"info"},I={key:1,class:"has-text-centered"},ss={class:"info"},ts={key:2,class:"has-text-centered nb-asset-types"};function es(s,t,l,L,y,i){const _=p("router-link"),h=p("stats-cell"),f=p("table-info");return a(),r("div",j,[o("div",{class:"datatable-wrapper",ref:"body",onScrollPassive:t[0]||(t[0]=(...e)=>s.onBodyScroll&&s.onBodyScroll(...e))},[o("table",H,[o("thead",z,[o("tr",null,[o("th",G,n(s.$t("asset_types.fields.name")),1),o("th",K,n(s.$t("main.all")),1),l.isLoading?u("",!0):(a(!0),r(m,{key:0},S(l.validationColumns,e=>(a(),r("th",{scope:"col",class:"validation validation-cell",key:e},[o("div",{class:"flexrow validation-content",style:T(s.getValidationStyle(e))},[s.isCurrentUserClient?(a(),r("span",Q,n(s.taskTypeMap.get(e).name),1)):(a(),g(_,{key:0,class:"flexrow-item",title:s.taskTypeMap.get(e).name,to:i.taskTypePath(e)},{default:P(()=>[V(n(s.taskTypeMap.get(e).name),1)]),_:2},1032,["title","to"]))],4)]))),128)),t[1]||(t[1]=o("th",{scope:"col",class:"actions"},null,-1))])]),l.isLoading?u("",!0):(a(),r("tbody",R,[l.showAll&&!i.isEmptyList?(a(),r("tr",W,[o("th",q,n(s.$t("asset_types.all_asset_types")),1),c(h,{colors:i.chartColors("all","all"),data:i.chartData("all","all"),"display-mode":l.displayMode},null,8,["colors","data","display-mode"]),(a(!0),r(m,null,S(l.validationColumns,e=>(a(),g(h,{style:T(s.getValidationStyle(e)),key:"all-"+e,colors:i.chartColors("all",e),data:i.chartData("all",e),"display-mode":l.displayMode},null,8,["style","colors","data","display-mode"]))),128)),t[2]||(t[2]=o("td",{class:"actions"},null,-1))])):u("",!0),(a(!0),r(m,null,S(l.entries,e=>(a(),r("tr",{class:"datatable-row",key:e.id},[o("td",J,n(e.name),1),i.isStats(e.id,"all")?(a(),g(h,{key:0,colors:i.chartColors(e.id,"all"),data:i.chartData(e.id,"all"),"display-mode":l.displayMode},null,8,["colors","data","display-mode"])):(a(),r("td",X)),(a(!0),r(m,null,S(l.validationColumns,d=>(a(),r(m,{key:e.id+"-"+d},[i.isStats(e.id,d)?(a(),g(h,{key:e.id+d,style:T(s.getValidationStyle(d)),colors:i.chartColors(e.id,d),data:i.chartData(e.id,d),"display-mode":l.displayMode},null,8,["style","colors","data","display-mode"])):(a(),r("td",{key:1,style:T(s.getValidationStyle(d))},null,4))],64))),128)),t[3]||(t[3]=o("td",{class:"actions"},null,-1))]))),128))]))])],544),c(f,{"is-loading":l.isLoading,"is-error":l.isError},null,8,["is-loading","is-error"]),i.isEmptyList&&!s.isCurrentUserClient&&!l.isLoading?(a(),r("div",Z,[t[4]||(t[4]=o("p",{class:"info"},[o("img",{src:b})],-1)),o("p",$,n(s.$t("assets.empty_list")),1)])):u("",!0),i.isEmptyList&&s.isCurrentUserClient&&!l.isLoading?(a(),r("div",I,[t[5]||(t[5]=o("p",{class:"info"},[o("img",{src:b})],-1)),o("p",ss,n(s.$t("assets.empty_list_client")),1)])):u("",!0),!i.isEmptyList&&!l.isLoading?(a(),r("p",ts,n(s.displayedAssetTypesLength)+" "+n(s.$tc("asset_types.number",s.displayedAssetTypesLength)),1)):u("",!0)])}const as=C(O,[["render",es],["__scopeId","data-v-845cb4b7"]]),is={name:"production-asset-types",components:{ButtonSimple:E,Combobox:D,ProductionAssetTypeList:as,SearchField:B},data(){return{initialLoading:!0,displayMode:"pie",displayModeOptions:[{label:"pie",value:"pie"},{label:"count",value:"count"}]}},computed:{...k(["assetTypeMap","assetTypeStats","assetTypeSearchText","assetTypeListScrollPosition","assetValidationColumns","currentEpisode","currentProduction","displayedAssetTypes","isAssetsLoading","isAssetsLoadingError","isTVShow","taskStatusMap","taskTypeMap"])},mounted(){this.setDefaultSearchText(),this.setDefaultListScrollPosition(),setTimeout(()=>{this.reset()},100)},methods:{...x(["computeAssetTypeStats","initAssetTypes","loadAssets","setAssetTypeSearch","setAssetTypeListScrollPosition","setLastProductionScreen"]),setDefaultSearchText(){this.assetTypeSearchText.length>0&&this.$refs["asset-type-search-field"].setValue(this.assetTypeSearchText)},setDefaultListScrollPosition(){this.$refs["asset-type-list"].setScrollPosition(this.assetTypeListScrollPosition)},navigateToList(){this.$router.push(this.assetTypesPath)},onSearchChange(s){const t=this.$refs["asset-type-search-field"].getValue();this.setAssetTypeSearch(t)},saveScrollPosition(s){this.setAssetTypeListScrollPosition(s)},exportStatisticsToCsv(){const s=[U().format("YYYYMMDD"),this.currentProduction.name,"asset_types","statistics"];this.currentEpisode&&s.splice(2,0,this.currentEpisode.name);const t=N.slugify(s.join("_"));Y.generateStatReports(t,this.assetTypeStats,this.taskTypeMap,this.taskStatusMap,this.assetTypeMap,this.countMode,this.currentProduction)},reset(){this.initialLoading=!0,this.$refs["asset-type-search-field"].setValue(""),this.loadAssets().then(()=>{this.computeAssetTypeStats(),this.setAssetTypeListScrollPosition(0),this.initialLoading=!1})}},watch:{currentProduction(){this.isTVShow||this.reset()},currentEpisode(){this.isTVShow&&this.reset()}},head(){return{title:`${this.currentProduction.name} | ${this.$t("asset_types.production_title")} - Kitsu`}}},os={class:"asset-types page fixed-page"},ls={class:"asset-type-list-header page-header flexrow"};function rs(s,t,l,L,y,i){const _=p("search-field"),h=p("combobox"),f=p("button-simple"),e=p("production-asset-type-list");return a(),r("div",os,[o("div",ls,[c(_,{class:"flexrow-item mt1",ref:"asset-type-search-field",onChange:i.onSearchChange,placeholder:"ex: chars, agent327"},null,8,["onChange"]),c(h,{class:"mb0 flexrow-item",label:s.$t("statistics.display_mode"),"locale-key-prefix":"statistics.",options:y.displayModeOptions,modelValue:y.displayMode,"onUpdate:modelValue":t[0]||(t[0]=d=>y.displayMode=d)},null,8,["label","options","modelValue"]),t[1]||(t[1]=o("span",{class:"filler"},null,-1)),c(f,{class:"flexrow-item",icon:"refresh",title:s.$t("main.reload"),onClick:i.reset},null,8,["title","onClick"]),c(f,{class:"flexrow-item",icon:"download",onClick:i.exportStatisticsToCsv},null,8,["onClick"])]),c(e,{ref:"asset-type-list",entries:s.displayedAssetTypes,"is-loading":s.isAssetsLoading||y.initialLoading,"is-error":s.isAssetsLoadingError,"validation-columns":s.assetValidationColumns,"asset-type-stats":s.assetTypeStats,"display-mode":y.displayMode,"show-all":s.assetTypeSearchText.length===0,onScroll:i.saveScrollPosition},null,8,["entries","is-loading","is-error","validation-columns","asset-type-stats","display-mode","show-all","onScroll"])])}const cs=C(is,[["render",rs]]);export{cs as default};
//# sourceMappingURL=ProductionAssetTypes-DmouoUR0.js.map
