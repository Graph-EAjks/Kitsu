import{T as D,m as S,c0 as B,_ as T,r as p,o as n,c as i,e as h,t as u,F as M,g as k,d as g,f as m,bR as X,P as j,aF as C,A as c,c1 as Q,w as L,c2 as F,c3 as K,c4 as U,a4 as z,c5 as H,b as O,b3 as V,c6 as G,G as P,a5 as b,p as I,l as q,c7 as J,B as Z,C as $,I as ee,c8 as te,K as se,S as oe,aa as ae,ay as R,M as re,az as x,ad as ne,ae as ie}from"./index-CorrIg1D.js";import{R as ue}from"./RouteTabs-CkRWVczo.js";const le={name:"quota-shot-list",components:{TableInfo:D},props:{shots:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},isLoadingError:{type:Boolean,default:!1},countMode:{type:String,default:"frames"}},computed:{...S(["currentProduction"])},methods:{getQuota(e){return this.countMode==="seconds"?B(e.nb_frames,this.currentProduction,e):e.nb_frames}}},de={class:"data-list"},he={key:0,class:"details table"};function ce(e,o,t,l,s,a){const _=p("table-info");return n(),i("div",de,[t.isLoading?g("",!0):(n(),i("table",he,[h("thead",null,[h("tr",null,[h("th",null,u(e.$t("quota.details_name")),1),h("th",null,u(t.countMode==="seconds"?e.$t("quota.details_seconds"):e.$t("quota.details_frames")),1),h("th",null,u(e.$t("quota.weight")),1)])]),h("tbody",null,[(n(!0),i(M,null,k(t.shots,f=>(n(),i("tr",{key:`shot-quota-${f.id}`},[h("td",null,u(f.full_name),1),h("td",null,u(a.getQuota(f)),1),h("td",null,u(f.weight),1)]))),128))])])),m(_,{"is-loading":t.isLoading,"is-error":t.isLoadingError},null,8,["is-loading","is-error"])])}const me=T(le,[["render",ce],["__scopeId","data-v-b536c747"]]),pe={name:"people-quota-info",components:{XIcon:X,PageTitle:j,PeopleAvatar:C,QuotaShotList:me},props:{person:{type:Object,default:()=>{}},year:{type:Number,default:0},month:{type:Number,default:0},week:{type:Number,default:0},day:{type:Number,default:0},countMode:{type:String,default:"frames"},isLoading:{type:Boolean,default:!1},isLoadingError:{type:Boolean,default:!1},shots:{type:Array,default:()=>[]}},emits:["close"],computed:{...S(["currentEpisode","currentProduction"]),startDay(){return c().day("Monday").year(this.year).week(this.week).date()},endDay(){return c().day("Monday").year(this.year).week(this.week).add(6,"days").date()},weekMonth(){return c().day("Monday").year(this.year).week(this.week).format("MMM")},monthString(){return Q(this.month)},isMonthInfo(){return this.$route.path.indexOf("month")>0},isWeekInfo(){return this.$route.path.indexOf("week")>0},isDayInfo(){return this.$route.path.indexOf("day")>0},closeRoute(){if(!this.currentProduction)return{};let e={name:"quota",production_id:this.currentProduction.id};return this.isMonthInfo?e={name:"quota-month",params:{year:this.year}}:this.isWeekInfo?e={name:"quota-week",params:{year:this.year}}:this.isDayInfo&&(e={name:"quota-day",params:{year:this.year,month:this.month}}),this.currentEpisode&&(e.name=`episode-${e.name}`,e.params.episode_id=this.currentEpisode.id),e}},methods:{onCloseClicked(){this.$emit("close")}}},ye={class:"people-timesheet-info"},fe={class:"close"},ge={class:"flexrow"},_e={key:0,class:"info-date"},Me={key:1,class:"info-date"},ke={key:2,class:"info-date"};function be(e,o,t,l,s,a){const _=p("x-icon"),f=p("router-link"),w=p("people-avatar"),r=p("page-title"),d=p("quota-shot-list");return n(),i("div",ye,[h("div",fe,[m(f,{class:"close-button",to:a.closeRoute},{default:L(()=>[m(_)]),_:1},8,["to"])]),h("div",ge,[m(w,{class:"flexrow-item",person:t.person,"is-lazy":!1},null,8,["person"]),m(r,{class:"flexrow-item",text:t.person.full_name},null,8,["text"])]),a.isMonthInfo?(n(),i("div",_e,u(a.monthString)+" "+u(t.year),1)):a.isWeekInfo?(n(),i("div",Me,u(e.$t("main.week"))+" "+u(t.week)+", "+u(a.startDay)+" - "+u(a.endDay)+" "+u(a.weekMonth)+" "+u(t.year),1)):a.isDayInfo?(n(),i("div",ke,u(t.day)+" "+u(a.monthString)+" "+u(t.year),1)):g("",!0),m(d,{class:"time-spent-list","count-mode":t.countMode,shots:t.shots,"is-loading":t.isLoading,"is-error":t.isLoadingError},null,8,["count-mode","shots","is-loading","is-error"])])}const ve=T(pe,[["render",be],["__scopeId","data-v-5b4a5197"]]),qe={name:"quota",components:{PeopleAvatar:C,TableInfo:D},props:{taskTypeId:{type:String,required:!1},personId:{type:String,required:!1},detailLevel:{type:String,default:"day",required:!0},countMode:{type:String,required:!0},computeMode:{type:String,default:"weighted",required:!0},year:{type:Number,default:0},month:{type:Number,default:0},week:{type:Number,default:0},day:{type:Number,default:0},searchText:{type:String,default:""},maxQuota:{default:0}},data(){return{currentMonth:c().month()+1,currentYear:c().year(),currentWeek:c().week(),detailsTitle:"",detailsMap:{},isPanelShown:!1,isLoading:!0,isError:!1,personIds:[],quotaMap:{},quotaLength:0,selected:void 0,averageColumnX:"12rem"}},mounted(){this.shotMap.size<2?(this.isLoading=!0,setTimeout(()=>{this.loadShots(e=>{e||this.loadData()})},100)):(this.isShotsLoading||(this.isLoading=!1),this.loadData())},computed:{...S(["currentEpisode","currentProduction","isShotsLoading","personMap","shotMap","taskTypeMap"]),monthRange(){return F(this.year,this.currentYear,this.currentMonth)},dayRange(){return K(this.year,this.month,this.currentYear,this.currentMonth)},weekRange(){return U(this.year,this.currentYear,this.currentWeek)},entryIds(){return this.personId?z(Object.keys(this.quotaMap).filter(e=>e!=="total").map(e=>this.taskTypeMap.get(e)),this.currentProduction).map(e=>e.id).concat(["total"]):this.filteredPersonIds},filteredPersonIds(){let e=this.personIds;return this.searchText.length>0&&(e=H(this.personIndex,this.searchText.split(" ")).map(o=>o.id)),e}},methods:{...O(["loadShots","computeQuota","getPeriodDetails"]),episodifyRoute(e){return this.currentEpisode&&V(e,this.currentEpisode.id),e},isWeekend(e,o,t){let l=c(`${e}-${o}-${t}`,"YYYY-MM-DD");return t<10&&(l=c(`${e}-${o}-0${t}`,"YYYY-MM-DD")),[0,6].includes(l.day())},loadData(){(this.taskTypeId||this.personId)&&(this.isLoading=!0,this.computeQuota({taskTypeId:this.taskTypeId,personId:this.personId,detailLevel:this.detailLevel,countMode:this.countMode,computeMode:this.computeMode}).then(e=>{this.quotaMap=e,this.quotaLength=Object.keys(this.quotaMap).length,this.calcAverageColumnX(),this.$nextTick(()=>{this.isLoading=!1})}).catch(e=>{this.quotaMap={},this.quotaLength=0,this.calcAverageColumnX(),this.isLoading=!1,console.error(e)}))},loadDetails(e,o){this.loadShots(t=>{this.isLoading=!0,t?console.error(t):this.taskTypeId&&this.getPeriodDetails({taskTypeId:this.taskTypeId,detailLevel:this.detailLevel,personId:e,dateString:o}).then(l=>{this.detailsMap=l})})},monthToString:Q,dateDigit(e){return e.toString().padStart(2,"0")},getQuota(e,o={}){let t="-";if(!e)return t;if(o.day){const l=`${o.year}-${this.dateDigit(o.month)}-${this.dateDigit(o.day)}`;t=this.quotaMap[e].day[this.countMode][l]}else if(o.week){const l=`${o.year}-${o.week}`;t=this.quotaMap[e].week[this.countMode][l]}else{const l=`${o.year}-${this.dateDigit(o.month)}`;t=this.quotaMap[e].month[this.countMode][l]}return this.countMode==="seconds"?t?t.toFixed(2):"-":t||"-"},getQuotaAverage(e,o={}){if(!e)return"-";let t=0,l=0,s;if(this.detailLevel==="day"){const a=`${o.year}-${this.dateDigit(o.month)}`;l=this.quotaMap[e].month[this.countMode][a],s=this.quotaMap[e].day.entries[a]}else if(this.detailLevel==="week"){const a=o.year;l=this.quotaMap[e].year[this.countMode][a],s=this.quotaMap[e].week.entries[a]}else if(this.detailLevel==="month"){const a=o.year;l=this.quotaMap[e].year[this.countMode][a],s=this.quotaMap[e].month.entries[a]}return t=l/s,t?t.toFixed(2):"-"},isDaySelected(e,o,t,l){return this.$route.params.person_id&&this.$route.params.person_id===e&&""+this.$route.params.year==""+o&&""+this.$route.params.month==""+t&&""+this.$route.params.day==""+l},isWeekSelected(e,o,t){return this.$route.params.person_id&&this.$route.params.person_id===e&&""+this.$route.params.year==""+o&&""+this.$route.params.week==""+t},isMonthSelected(e,o,t){return this.$route.params.person_id&&this.$route.params.person_id===e&&""+this.$route.params.year==""+o&&""+this.$route.params.month==""+t},isDayQuotaLow(e,o,t,l){const s=this.getQuota(e,{year:o,month:t,day:l});return s!==null&&this.maxQuota>s},isWeekQuotaLow(e,o,t){return this.maxQuota>this.getQuota(e,{year:o,week:t})},isMonthQuotaLow(e,o,t){return this.maxQuota>this.getQuota(e,{year:o,month:t})},calcAverageColumnX(){this.quotaLength>0&&(this.averageColumnX=`${this.$refs.rowHeaderName.offsetWidth}px`)},resetPersonIds(){const e=Object.keys(this.quotaMap).filter(t=>t!=="total"),o=e.map(t=>this.personMap.get(t));this.personIndex=G(o),this.personIds=e.sort((t,l)=>{const s=this.personMap.get(t).full_name,a=this.personMap.get(l).full_name;return s.localeCompare(a)}).concat(["total"])}},watch:{$route(){document.getElementsByClassName("selected").length===0&&setTimeout(()=>{this.$refs.body.scrollLeft+=380},100)},computeMode(){(this.taskTypeId||this.personId)&&this.loadData()},quotaMap(){this.taskTypeId&&this.resetPersonIds()},taskTypeId(){this.taskTypeId&&this.loadData()},personId(){this.personId&&this.loadData()}}},we={class:"data-list"},Le={class:"datatable-wrapper",ref:"body"},Se={class:"datatable"},Te={class:"datatable-head"},Ie={key:0,class:"datatable-body"},xe={scope:"row",class:"name datatable-row-header"},Qe={key:0,class:"flexrow"},Pe={key:1,class:"flexrow"},Re={key:2,class:"flexrow"},De={key:3,class:"flexrow"},Ce={key:1},Oe={key:2},Ve={key:1},Ne={key:2},Ye={key:1},Ee={key:2},We={key:0,class:"has-text-centered empty-quota"},Ae={class:"info"};function Be(e,o,t,l,s,a){const _=p("people-avatar"),f=p("router-link"),w=p("table-info");return n(),i("div",we,[h("div",Le,[h("table",Se,[h("thead",Te,[h("tr",null,[h("th",{scope:"col",class:"name datatable-row-header",ref:"rowHeaderName"},u(e.$t("quota.name")),513),h("th",{scope:"col",class:"average datatable-row-header",style:P({left:s.averageColumnX})},u(e.$t("quota.average")),5),t.detailLevel==="month"?(n(!0),i(M,{key:0},k(a.monthRange,r=>(n(),i("th",{scope:"col",key:"month-"+r},u(a.monthToString(r)),1))),128)):t.detailLevel==="week"?(n(!0),i(M,{key:1},k(a.weekRange,r=>(n(),i("th",{scope:"col",key:"week-"+r},u(r),1))),128)):t.detailLevel==="day"?(n(!0),i(M,{key:2},k(a.dayRange,r=>(n(),i("th",{scope:"col",key:"day-"+r},u(r),1))),128)):g("",!0)])]),s.quotaLength>0&&!s.isLoading?(n(),i("tbody",Ie,[(n(!0),i(M,null,k(a.entryIds,r=>(n(),i("tr",{key:"name-"+r,class:"datatable-row"},[h("th",xe,[t.taskTypeId&&r!=="total"?(n(),i("div",Qe,[m(_,{size:30,person:e.personMap.get(r)},null,8,["person"]),b(" "+u(e.personMap.get(r).full_name),1)])):t.taskTypeId&&r==="total"?(n(),i("div",Pe,u(e.$t("main.total")),1)):t.personId&&r!=="total"?(n(),i("div",Re,u(e.taskTypeMap.get(r).name),1)):t.personId&&r==="total"?(n(),i("div",De,u(e.$t("main.total")),1)):g("",!0)]),h("td",{class:"average datatable-row-header",style:P({left:s.averageColumnX})},[t.detailLevel==="month"||t.detailLevel==="week"?(n(),i(M,{key:0},[b(u(a.getQuotaAverage(r,{year:t.year})),1)],64)):t.detailLevel==="day"?(n(),i(M,{key:1},[b(u(a.getQuotaAverage(r,{year:t.year,month:t.month})),1)],64)):g("",!0)],4),t.detailLevel==="month"?(n(!0),i(M,{key:0},k(a.monthRange,d=>(n(),i("td",{class:I({selected:a.isMonthSelected(r,t.year,d),"quota-low":a.isMonthQuotaLow(r,t.year,d)}),key:"month-"+d},[r!=="total"&&a.getQuota(r,{year:t.year,month:d})?(n(),q(f,{key:0,class:"quota-button",to:a.episodifyRoute({name:"quota-month-person",params:{person_id:r,year:t.year,month:d},query:e.$route.query})},{default:L(()=>[b(u(a.getQuota(r,{year:t.year,month:d})),1)]),_:2},1032,["to"])):r==="total"?(n(),i("span",Ce,u(a.getQuota(r,{year:t.year,month:d})),1)):(n(),i("span",Oe,"-"))],2))),128)):t.detailLevel==="week"?(n(!0),i(M,{key:1},k(a.weekRange,d=>(n(),i("td",{class:I({selected:a.isWeekSelected(r,t.year,d),"quota-low":a.isWeekQuotaLow(r,t.year,t.month)}),key:"week-"+d},[r!=="total"&&a.getQuota(r,{year:t.year,week:d})?(n(),q(f,{key:0,class:"quota-button",to:a.episodifyRoute({name:"quota-week-person",params:{person_id:r,year:t.year,week:d},query:e.$route.query})},{default:L(()=>[b(u(a.getQuota(r,{year:t.year,week:d})),1)]),_:2},1032,["to"])):r==="total"?(n(),i("span",Ve,u(a.getQuota(r,{year:t.year,week:d})),1)):(n(),i("span",Ne," - "))],2))),128)):t.detailLevel==="day"?(n(!0),i(M,{key:2},k(a.dayRange,d=>(n(),i("td",{class:I({weekend:a.isWeekend(t.year,t.month,d),selected:a.isDaySelected(r,t.year,t.month,d),"quota-low":a.isDayQuotaLow(r,t.year,t.month,d)}),key:"day-"+d},[r!=="total"&&a.getQuota(r,{year:t.year,month:t.month,day:d})?(n(),q(f,{key:0,class:"quota-button",to:a.episodifyRoute({name:"quota-day-person",params:{person_id:r,year:t.year,month:t.month,day:d},query:{countMode:t.countMode,computeMode:t.computeMode,taskTypeId:t.taskTypeId}})},{default:L(()=>[b(u(t.countMode==="seconds"?a.getQuota(r,{year:t.year,month:t.month,day:d}):a.getQuota(r,{year:t.year,month:t.month,day:d})),1)]),_:2},1032,["to"])):r==="total"?(n(),i("span",Ye,u(t.countMode==="seconds"?a.getQuota(r,{year:t.year,month:t.month,day:d}):a.getQuota(r,{year:t.year,month:t.month,day:d})),1)):(n(),i("span",Ee," - "))],2))),128)):g("",!0)]))),128))])):g("",!0)])],512),s.quotaLength===0&&!s.isLoading?(n(),i("div",We,[h("p",Ae,u(e.$t("quota.no_quota")),1)])):g("",!0),m(w,{"is-loading":s.isLoading,"is-error":s.isError},null,8,["is-loading","is-error"])])}const Xe=T(qe,[["render",Be],["__scopeId","data-v-c06ca326"]]),v=J.cache.personMap,je={name:"production-quota",components:{ButtonSimple:Z,Combobox:$,ComboboxTaskType:ee,InfoQuestionMark:te,PeopleField:se,PeopleQuotaInfo:ve,Quota:Xe,RouteTabs:ue,SearchField:oe,TextField:ae},data(){return{activeTab:"tasktypes",tabs:[{name:"tasktypes",label:this.$t("task_types.title")},{name:"persons",label:this.$t("main.people")}],countModeOptions:[{label:this.$t("quota.frames"),value:"frames"},{label:this.$t("quota.seconds"),value:"seconds"},{label:this.$t("quota.count"),value:"count"}],detailLevelOptions:[{label:this.$t("quota.day"),value:"day"},{label:this.$t("quota.week"),value:"week"},{label:this.$t("quota.month"),value:"month"}],computeModeOptions:[{label:this.$t("quota.weighted"),value:"weighted"},{label:this.$t("quota.feedback_date"),value:"feedback"},{label:this.$t("quota.weighted_done"),value:"weighteddone"},{label:this.$t("quota.done_date"),value:"done"}],currentYear:c().year(),currentMonth:c().month()+1,currentWeek:c().week(),currentDay:c().date(),currentPerson:this.getCurrentPerson(),currentMode:"frames",detailLevel:"day",isLoading:!1,isLoadingError:!1,isPersonShotsLoading:!1,maxQuota:0,detailLevelString:"day",monthString:`${c().month()+1}`,yearString:`${c().year()}`,params:{countMode:"frames",computeMode:"weighted",person:null,taskTypeId:""},personShots:[],silent:!1,searchText:"",showInfo:!1}},mounted(){this.setCountModeOptions();const e=`quota:${this.currentProduction.id}:params`,o=R.getObjectPreference(e)||{},t={countMode:this.countModeOptions[0].value,computeMode:this.computeModeOptions[0].value,taskTypeId:this.productionShotTaskTypes[0].id};this.activeTab=this.$route.query.tab||"tasktypes",this.params={countMode:this.$route.query.countMode||o.countMode||t.countMode,computeMode:this.$route.query.computeMode||o.computeMode||t.computeMode,taskTypeId:this.$route.query.taskTypeId,person:this.$route.query.personId?v.get(this.$route.query.personId):null},!this.params.taskTypeId&&!this.params.person&&(this.params.taskTypeId=o.taskTypeId||t.taskTypeId),this.resetRouteQuery(),this.loadRoute()},computed:{...S(["currentEpisode","currentProduction","isPaperProduction","productionShotTaskTypes","shotTaskTypes"]),taskTypeList(){return[...this.productionShotTaskTypes]},teamPersons(){return re(this.currentProduction.team.map(e=>v.get(e)))},yearOptions(){const o=c().year();return x(2018,o).map(t=>({label:t,value:`${t}`})).reverse()},monthOptions(){const e=`${c().year()}`,o=1,t=c().month()+1;let l=x(o,12);return e===this.yearString&&(l=x(o,t)),l.map(s=>({label:Q(s),value:`${s}`}))}},methods:{...O(["getPersonQuotaShots","loadShots"]),getCurrentPerson(){const e=this.$route.params.person_id;return e&&v?v.get(e):{}},loadRoute(){const{month:e,year:o,week:t,day:l}=this.$route.params,{countMode:s,taskTypeId:a,computeMode:_}=this.$route.query;this.$route.path.indexOf("week")>0&&(this.detailLevel="week"),this.$route.path.indexOf("month")>0&&(this.detailLevel="month"),this.$route.path.indexOf("day")>0&&(this.detailLevel="day"),this.currentPerson=this.getCurrentPerson(),this.detailLevelString=this.detailLevel,s&&(this.countMode=s,this.currentMode=this.countMode),a&&(this.params.taskTypeId=a),this.$route.query.personId&&(this.params.person=v.get(this.$route.query.personId)),_&&(this.params.computeMode=_),e&&(this.currentMonth=Number(e),this.monthString=`${e}`),o&&(this.currentYear=Number(o),this.yearString=`${o}`),t&&(this.currentWeek=Number(t),this.weekString=`${t}`),l&&(this.currentDay=Number(l)),this.$route.path.indexOf("person")>0?(this.isPersonShotsLoading=!0,this.getPersonQuotaShots({personId:this.currentPerson.id,detailLevel:this.detailLevel,taskTypeId:this.params.taskTypeId,year:o,month:e,week:t,day:l,computeMode:this.params.computeMode}).then(f=>{this.isPersonShotsLoading=!1,this.personShots=f,this.showSideInfo()})):this.hideSideInfo()},showSideInfo(){this.showInfo=!0},hideSideInfo(){this.showInfo=!1},episodifyRoute(e){return this.currentEpisode&&V(e,this.currentEpisode.id),e},exportQuotas(){const e=this.$refs["quota-list"].quotaMap,o=["quotas",this.detailLevel,this.currentYear];this.detailLevel==="day"&&o.push(this.currentMonth);const t=ne.slugify(o.join("_")),l=Object.keys(e).map(s=>v.get(s)).sort((s,a)=>s.full_name.localeCompare(a.full_name,void 0,{numeric:!0}));ie.generateQuotas(t,e,l,this.countMode,this.detailLevel,c().year(),c().month()+1,this.currentYear,this.currentMonth,this.currentWeek)},onSearchChange(e){this.searchText=e},setCountModeOptions(){this.isPaperProduction?(this.countModeOptions=[{label:this.$t("quota.drawings"),value:"drawings"},{label:this.$t("quota.count"),value:"count"}],this.countMode="drawings",this.currentMode=this.params.countMode):(this.countModeOptions=[{label:this.$t("quota.frames"),value:"frames"},{label:this.$t("quota.seconds"),value:"seconds"},{label:this.$t("quota.count"),value:"count"}],this.params.countMode="frames",this.currentMode=this.params.countMode)},resetRouteQuery(){const e=this.getQuery(),o=`quota:${this.currentProduction.id}:params`;R.setObjectPreference(o,this.params),this.$router.push({query:e})},getQuery(){var s;const e=this.activeTab==="tasktypes"?this.params.taskTypeId:void 0;let o=null;const t=this.activeTab==="persons"||this.$route.query.tab==="persons";return t&&this.params.person?o=this.params.person.indexOf:t&&(o=(s=this.teamPersons[0])==null?void 0:s.id),{countMode:this.params.countMode,computeMode:this.params.computeMode,tab:this.activeTab||"tasktypes",taskTypeId:e,personId:o||void 0}}},watch:{"params.person"(){this.silent||(this.silent=!0,this.resetRouteQuery(),setTimeout(()=>{this.silent=!1},100))},detailLevelString(){if(this.detailLevel!==this.detailLevelString){const e={name:`quota-${this.detailLevelString}`,params:{year:this.currentYear},query:this.getQuery()};this.detailLevelString==="day"&&(e.params.month=this.currentMonth),this.$router.push(this.episodifyRoute(e))}},yearString(){const e=Number(this.yearString),o=c().month()+1;if(this.currentYear!==e){const t={name:`quota-${this.detailLevelString}`,params:{year:e},query:this.getQuery()};this.detailLevelString==="day"&&(t.params.month=`${Math.min(Number(this.monthString),o)}`),this.$router.push(this.episodifyRoute(t))}},monthString(){if(this.currentMonth!==Number(this.monthString)){const e={name:"quota-day",params:{year:this.currentYear,month:this.monthString},query:this.getQuery()};this.$router.push(this.episodifyRoute(e))}},"params.countMode"(){this.resetRouteQuery(),this.currentMode=this.params.countMode},"params.computeMode"(){this.$route.query.computeMode!==this.params.computeMode&&(this.resetRouteQuery(),this.currentPerson=null)},"params.taskTypeId"(){!this.silent&&this.params.taskTypeId&&(this.silent=!0,this.resetRouteQuery(),setTimeout(()=>{this.silent=!1},100))},currentProduction(){this.setCountModeOptions(),this.isLoading=!0,this.loadShots(()=>{this.resetRouteQuery(),this.loadRoute(),this.isLoading=!1})},currentEpisode(){this.isLoading=!0,this.loadShots(()=>{this.resetRouteQuery(),this.loadRoute(),this.isLoading=!1})},$route(){this.activeTab=this.$route.query.tab||"tasktypes",this.resetRouteQuery(),this.loadRoute()}},head(){return{title:`${this.currentProduction.name} | ${this.$t("quota.title")} - Kitsu`}}},Fe={class:"columns fixed-page"},Ke={class:"column main-column"},Ue={class:"flexrow filters"},ze={key:0,class:"flexrow-item"},He={class:"flexrow-item"},Ge={class:"flexrow-item"},Je={class:"flexrow-item"},Ze={class:"flexrow-item"},$e={class:"flexrow mb2 mt0"},et={class:"label flexrow-item"},tt={key:0,class:"column side-column"};function st(e,o,t,l,s,a){const _=p("route-tabs"),f=p("combobox-task-type"),w=p("people-field"),r=p("combobox"),d=p("info-question-mark"),N=p("button-simple"),Y=p("search-field"),E=p("text-field"),W=p("quota"),A=p("people-quota-info");return n(),i("div",Fe,[h("div",Ke,[m(_,{"active-tab":s.activeTab,tabs:s.tabs},null,8,["active-tab","tabs"]),h("div",Ue,[s.activeTab==="tasktypes"?(n(),i("div",ze,[m(f,{class:"flexrow-item",label:e.$t("quota.type_label"),"task-type-list":a.taskTypeList,disabled:!s.params.person,modelValue:s.params.taskTypeId,"onUpdate:modelValue":o[0]||(o[0]=y=>s.params.taskTypeId=y)},null,8,["label","task-type-list","disabled","modelValue"])])):g("",!0),h("div",He,[s.activeTab==="persons"?(n(),q(w,{key:0,ref:"person-field",class:"person-field",label:e.$t("main.person"),people:a.teamPersons,modelValue:s.params.person,"onUpdate:modelValue":o[1]||(o[1]=y=>s.params.person=y)},null,8,["label","people","modelValue"])):g("",!0)]),h("div",Ge,[m(r,{class:"flexrow-item",label:e.$t("quota.detail_label"),options:s.detailLevelOptions,modelValue:s.detailLevelString,"onUpdate:modelValue":o[2]||(o[2]=y=>s.detailLevelString=y)},null,8,["label","options","modelValue"])]),s.detailLevelString==="day"?(n(),q(r,{key:1,class:"flexrow-item",label:e.$t("quota.month_label"),options:a.monthOptions,modelValue:s.monthString,"onUpdate:modelValue":o[3]||(o[3]=y=>s.monthString=y)},null,8,["label","options","modelValue"])):g("",!0),m(r,{class:"flexrow-item",label:e.$t("quota.year_label"),options:a.yearOptions,modelValue:s.yearString,"onUpdate:modelValue":o[4]||(o[4]=y=>s.yearString=y)},null,8,["label","options","modelValue"]),h("div",Je,[m(r,{class:"flexrow-item",label:e.$t("quota.count_label"),options:s.countModeOptions,modelValue:s.params.countMode,"onUpdate:modelValue":o[5]||(o[5]=y=>s.params.countMode=y)},null,8,["label","options","modelValue"])]),m(r,{class:"flexrow-item",label:e.$t("quota.compute_mode"),options:s.computeModeOptions,modelValue:s.params.computeMode,"onUpdate:modelValue":o[6]||(o[6]=y=>s.params.computeMode=y)},null,8,["label","options","modelValue"]),h("div",Ze,[m(d,{class:"mt2",text:e.$t("quota.explanation_"+s.params.computeMode)},null,8,["text"])]),o[8]||(o[8]=h("div",{class:"filler"},null,-1)),m(N,{class:"flexrow-item",title:e.$t("quota.export_quotas"),icon:"download",onClick:a.exportQuotas},null,8,["title","onClick"])]),h("div",$e,[s.activeTab==="tasktypes"?(n(),q(Y,{key:0,ref:"search-field",class:"search-field flexrow-item",onChange:a.onSearchChange},null,8,["onChange"])):g("",!0),h("span",et,u(e.$t("quota.highlight_quotas")),1),m(E,{class:"flexrow-item max-quota-input",type:"number",modelValue:s.maxQuota,"onUpdate:modelValue":o[7]||(o[7]=y=>s.maxQuota=y)},null,8,["modelValue"])]),m(W,{ref:"quota-list","task-type-id":s.activeTab==="tasktypes"?s.params.taskTypeId:null,"person-id":s.activeTab==="persons"&&s.params.person?s.params.person.id:null,"detail-level":s.detailLevelString,year:s.currentYear,month:s.currentMonth,week:s.currentWeek,day:s.currentDay,"current-person":s.currentPerson,"count-mode":s.params.countMode,"compute-mode":s.params.computeMode,"search-text":s.searchText,"max-quota":s.maxQuota},null,8,["task-type-id","person-id","detail-level","year","month","week","day","current-person","count-mode","compute-mode","search-text","max-quota"])]),s.showInfo&&s.currentPerson?(n(),i("div",tt,[m(A,{person:s.currentPerson,year:s.currentYear,month:s.currentMonth,week:s.currentWeek,day:s.currentDay,"is-loading":s.isPersonShotsLoading,"is-loading-error":!1,shots:s.personShots,"count-mode":s.params.countMode,onClose:a.hideSideInfo},null,8,["person","year","month","week","day","is-loading","shots","count-mode","onClose"])])):g("",!0)])}const rt=T(je,[["render",st],["__scopeId","data-v-2dd8f39e"]]);export{rt as default};
//# sourceMappingURL=ProductionQuota-CK911w1_.js.map
