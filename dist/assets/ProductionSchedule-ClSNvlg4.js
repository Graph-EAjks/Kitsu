import{ci as G,_ as K,m as W,a as X,bR as Z,ac as J,cd as $,u as ee,Q as te,aF as se,aE as ne,ak as ae,K as ie,Z as le,b as de,$ as oe,aG as re,b7 as ce,B as he,r as y,c as h,o as c,e as r,d as T,f as m,t as _,k as V,F as E,g as Y,ai as z,G as L,a7 as ue,bJ as p,bQ as Q,cj as O,ck as me,cl as B,A as C,a3 as pe,cm as F,cn as ge,M as fe,co as ye,bZ as q,cp as _e,a2 as N,aI as R,bP as De}from"./index-DKuAAOtP.js";/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=G("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=G("list-restart",[["path",{d:"M21 6H3",key:"1jwq7v"}],["path",{d:"M7 12H3",key:"13ou7f"}],["path",{d:"M7 18H3",key:"1sijw9"}],["path",{d:"M12 18a5 5 0 0 0 9-3 4.5 4.5 0 0 0-4.5-4.5c-1.33 0-2.54.54-3.41 1.41L11 14",key:"qth677"}],["path",{d:"M11 10v4h4",key:"172dkj"}]]),Se={name:"production-schedule",components:{ButtonSimple:he,Checkbox:ce,ChevronDownIcon:re,ChevronRightIcon:oe,Combobox:de,ComboboxNumber:le,ComboboxTaskType:ie,DateField:ae,GripVerticalIcon:ke,ListRestartIcon:be,PeopleAvatar:ne,PeopleName:se,Schedule:te,Spinner:ee,TrashIcon:$,TextField:J,XIcon:Z},data(){return{assignments:{assigned:!1,entityTypes:null,excludes:[],forcedDailyQuota:null,loading:!1,saving:!1,startDate:null,endDate:null,task:{},type:null,unassign:!1},availableTaskTypes:[],daysOffByPerson:[],draggedEntities:[],endDate:C().add(6,"months").endOf("day"),isSidePanelOpen:!1,scheduleItems:[],startDate:C().startOf("day"),selectedStartDate:null,selectedEndDate:null,selectedTaskType:null,zoomLevel:1,zoomOptions:[{label:this.$t("main.week"),value:0},{label:"1",value:1},{label:"2",value:2},{label:"3",value:3}],mode:"prev",modeOptions:[{label:this.$t("schedule.mode_prev"),value:"prev"},{label:this.$t("schedule.mode_real"),value:"real"}],loading:{schedule:!1},errors:{schedule:!1}}},mounted(){this.reset()},computed:{...X(["currentEpisode","currentProduction","isCurrentUserManager","isCurrentUserSupervisor","isTVShow","organisation","personMap","productionAssetTypes","user"]),estimatedDailyQuota(){const e=R(this.assignments.startDate),s=R(this.assignments.endDate),a=De(e,s),o=this.draggedEntities.reduce((n,d)=>n+(d.children?.length??0),0),t=this.availablePersons.length;return a&&t?o/a/t:0},assetMap(){return N.cache.assetMap},assets(){return N.cache.assets},assetTypeMap(){return _e.cache.assetTypeMap},availablePersons(){const e=this.taskTypeMap.get(this.selectedTaskType.task_type_id);return this.team.filter(s=>!this.assignments.excludes.includes(s.id)&&s.role!=="client"&&(["admin","manager"].includes(s.role)||!s.departments.length||s.departments.includes(e?.department_id)))},hasDraggedEntities(){return this.draggedEntities.some(e=>e.children.length)},isLockedSchedule(){return this.mode==="real"||!this.isCurrentUserManager},shotMap(){return q.cache.shotMap},shots(){return q.cache.shots},taskTypeMap(){return ye.cache.taskTypeMap},team(){return fe(this.currentProduction.team.map(e=>this.personMap.get(e)).filter(e=>e&&!e.is_bot))}},methods:{...W(["assignSelectedTasks","editProduction","loadAggregatedPersonDaysOff","loadAssets","loadAssetTypeScheduleItems","loadEpisodeScheduleItems","loadScheduleItems","loadSequenceScheduleItems","loadShots","loadTasks","saveScheduleItem","unassignPersonFromTask","unassignSelectedTasks","updateTask"]),loadData(){return this.loading.schedule=!0,this.availableTaskTypes=[],this.loadScheduleItems(this.currentProduction).then(e=>{const s=p(this.selectedStartDate),a=p(this.selectedEndDate);e=e.map(o=>{const t=this.taskTypeMap.get(o.task_type_id);let n,d;o.start_date?n=p(o.start_date):n=C(),n.isSameOrAfter(a)&&(n=a.clone().add(-1,"days")),n.isBefore(s)&&(n=s.clone()),o.end_date?d=p(o.end_date):d=n.clone().add(1,"days"),d.isSameOrAfter(a)&&(d=a.clone());const D=F(t.id,this.currentProduction.id,this.currentEpisode?this.currentEpisode.id:null,t.for_entity);return{...o,color:t.color,for_entity:t.for_entity,name:`${t.for_entity} / ${t.name}`,priority:t.priority,startDate:n,endDate:d,editable:this.isInDepartment(t)&&!this.isLockedSchedule,expanded:!1,loading:!1,route:t.for_entity==="Shot"&&this.isTVShow?null:D,children:[]}}),this.scheduleItems=ge(e,this.currentProduction,this.taskTypeMap),this.availableTaskTypes=this.scheduleItems.map(o=>({...this.taskTypeMap.get(o.task_type_id),name:o.name})),this.loading.schedule=!1}).catch(e=>{console.error(e),this.loading.schedule=!1})},reset(){this.closeSidePanel(),this.currentProduction.start_date&&(this.startDate=p(this.currentProduction.start_date)),this.currentProduction.end_date&&(this.endDate=p(this.currentProduction.end_date)),this.selectedStartDate=this.startDate.toDate(),this.selectedEndDate=this.endDate.toDate(),this.loadData()},convertScheduleItems(e,s){return s.map(a=>{let o;a.start_date?o=p(a.start_date):o=C(),o.isBefore(this.startDate)&&(o=this.startDate.clone()),o.isAfter(this.endDate)&&(o=this.endDate.clone());let t;a.end_date?t=p(a.end_date):t=o.clone().add(1,"days"),t.isBefore(o)&&(t=o.clone().add(1,"days")),t.isAfter(this.endDate)&&(t=this.endDate.clone());const n={...a,startDate:o,endDate:t,expanded:!1,loading:!1,editable:this.isInDepartment(this.taskTypeMap.get(a.task_type_id))&&!this.isLockedSchedule,children:[],parentElement:e};return this.isTVShow&&(n.route=F(a.task_type_id,this.currentProduction.id,a.object_id,e.for_entity)),n})},async expandTaskTypeElement(e,s=null,a=!1,o=!0){if(e.expanded=a||!e.expanded,e.expanded){try{e.loading=!0,this.selectedTaskType=this.isTVShow?null:e,this.assignments.loading=o,e.children=[],e.people={},e.entitiesByType={};const t=this.isTVShow?["Asset","Shot"].includes(e.for_entity)?this.loadEpisodeScheduleItems:this.loadSequenceScheduleItems:e.for_entity==="Shot"?this.loadSequenceScheduleItems:this.loadAssetTypeScheduleItems,n={production:this.currentProduction,taskType:this.taskTypeMap.get(e.task_type_id)},d=await t(n);let D=this.convertScheduleItems(e,d);const x=new Map(D.map(k=>[k.object_id,k]));if(this.isTVShow)e.children=D;else{e.for_entity==="Asset"&&await this.loadAssets({withShared:!1,withTasks:!1}),e.for_entity==="Shot"&&await this.loadShots();const k=await this.loadTasks({project_id:this.currentProduction.id,task_type_id:e.task_type_id,relations:"true"}),I=[...new Set(k.flatMap(l=>l.assignees))];await this.loadDaysOff(I);const b={},S={};k.forEach(l=>{l.start_date&&(e.for_entity==="Asset"?(l.entity=this.assetMap.get(l.entity_id),l.entity_type_id=l.entity.asset_type_id):e.for_entity==="Shot"?(l.entity=this.shotMap.get(l.entity_id),l.entity_type_id=l.entity.sequence_id):l.entity_type_id=e.for_entity,!l.entity?.canceled&&(b[l.entity_type_id]||(b[l.entity_type_id]={}),l.assignees.length||(l.assignees=["unassigned"]),l.assignees.forEach(u=>{const P=x.get(l.entity_type_id);let f;if(this.mode==="real"){if(!l.real_start_date)return;f=p(l.real_start_date)}else f=p(l.start_date);if(f.isAfter(this.endDate))return;f.isBefore(P.startDate)&&(P.startDate=f.clone()),l.startDate=f;let g;if(this.mode==="real"?g=l.done_date?p(l.done_date):C.tz():l.due_date?g=p(l.due_date):l.end_date?g=p(l.end_date):l.estimation&&(g=O(l.startDate,Math.ceil(B(this.organisation,l.estimation))-1,this.daysOffByPerson[u])),!g||g.isBefore(f)){const A=f.isoWeekday()===5?3:1;g=f.clone().add(A,"days")}if(!g.isSameOrAfter(f)){const A=f.isoWeekday()===5?3:1;g=f.clone().add(A,"days")}g.isBefore(this.startDate)||(g.isAfter(P.endDate)&&(P.endDate=g.clone()),l.endDate=g,b[l.entity_type_id][u]||(b[l.entity_type_id][u]=[],S[u]=u!=="unassigned"?{...this.personMap.get(u),daysOff:this.daysOffByPerson[u]}:{id:u,avatar:!1,color:"#888",full_name:this.$t("main.unassigned")}),l.editable=!this.isLockedSchedule,l.unresizable=!1,l.parentElement=P,b[l.entity_type_id][u].push(l))})))}),e.for_entity==="Asset"&&(D=D.filter(l=>{const u=this.assetTypeMap.get(l.object_id);return u&&(!u.task_types.length||u.task_types.includes(e.task_type_id))}));const w=([l],[u])=>l==="unassigned"?1:u==="unassigned"?-1:S[l].full_name.localeCompare(S[u].full_name),M=(l,u)=>l.entity?.name.localeCompare(u.entity?.name,void 0,{numeric:!0});D.forEach(l=>{const u=b[l.object_id]||{},P=new Map(Object.entries(u).sort(w).map(([f,g])=>[f,g.sort(M)]));l.children=P}),e.children=pe(D),e.people=S,e.entitiesByType=Object.fromEntries(Object.entries(b).map(([l,u])=>[l,Object.entries(u).flatMap(([P,f])=>P!=="unassigned"?f.map(g=>g.entity_id):void 0).filter(Boolean)]))}}catch(t){console.error(t),e.children=[],e.people=[]}finally{e.loading=!1}s&&s(e),this.selectTaskTypeElement(e,null,o)}},async loadDaysOff(e){this.daysOffByPerson=[];for(const s of e){const a=await this.loadAggregatedPersonDaysOff({personId:s}).catch(()=>[]);this.daysOffByPerson[s]=a}},filteredAssignments(e){return this.assignments.assigned?e:e.filter(s=>!s.assigned)},saveTaskChanged(e){return this.updateTask({taskId:e.id,data:{estimation:e.estimation,start_date:e.startDate.format("YYYY-MM-DD"),due_date:e.endDate.format("YYYY-MM-DD")}})},async onScheduleItemChanged(e){if(e.type==="Task"){const s=e.assignees.flatMap(a=>this.daysOffByPerson[a]).filter(Boolean);e.startDate=O(e.startDate,0,s),e.endDate=O(e.startDate,Math.ceil(B(this.organisation,e.estimation))-1,s),e.startDate.isBefore(e.parentElement.startDate)&&(e.parentElement.startDate=e.startDate.clone(),this.updateScheduleItem(e.parentElement),e.parentElement.startDate.isBefore(e.parentElement.parentElement.startDate)&&(e.parentElement.parentElement.startDate=e.parentElement.startDate.clone(),this.updateScheduleItem(e.parentElement.parentElement))),e.endDate.isAfter(e.parentElement.endDate)&&(e.parentElement.endDate=e.endDate.clone(),this.updateScheduleItem(e.parentElement),e.parentElement.endDate.isAfter(e.parentElement.parentElement.endDate)&&(e.parentElement.parentElement.endDate=e.parentElement.endDate.clone(),this.updateScheduleItem(e.parentElement.parentElement))),await this.saveTaskChanged(e);return}if(e.startDate&&e.endDate&&e.parentElement)e.parentElement.startDate=this.getMinDate(e.parentElement),e.parentElement.endDate=this.getMaxDate(e.parentElement),this.saveScheduleItem(e.parentElement);else if(!e.parentElement){const s=this.getMinDate(e),a=this.getMaxDate(e);e.startDate.isAfter(s)&&(e.startDate=s),e.endDate.isBefore(a)&&(e.endDate=a)}await this.updateScheduleItem(e)},updateScheduleItem(e){const s=this.scheduleItems.find(a=>a===e);s&&(s.startDate=e.startDate,s.start_date=e.startDate.format("YYYY-MM-DD"),s.endDate=e.endDate,s.end_date=e.endDate.format("YYYY-MM-DD")),this.saveScheduleItem(e)},getMinDate(e){let s=this.endDate.clone();return e.children.forEach(a=>{a.startDate&&a.startDate.isBefore(s)&&(s=a.startDate)}),s.clone()},getMaxDate(e){let s=this.startDate.clone();return e.children.forEach(a=>{a.endDate&&a.endDate.isAfter(s)&&(s=a.endDate)}),s.clone()},isInDepartment(e){return this.isCurrentUserManager?!0:this.isCurrentUserSupervisor?this.user.departments.length===0?!0:e.department_id&&this.user.departments.includes(e.department_id):!1},scrollScheduleToToday(){this.$refs.schedule?.scrollToToday()},resetSidePanel(){this.assignments={...this.assignments,entityTypes:null,excludes:[],forcedDailyQuota:null,loading:!1,saving:!1,startDate:null,endDate:null,task:{},type:null,unassign:!1}},toggleSidePanel(){this.isSidePanelOpen&&this.assignments.type==="task"&&(this.assignments.type=null,this.isSidePanelOpen=!1),this.isSidePanelOpen=!this.isSidePanelOpen,this.isSidePanelOpen&&this.assignments.type!=="task"&&!this.assignments.entityTypes&&this.selectTaskTypeElement(this.selectedTaskType)},selectParentElement(e){e.expanded?this.selectTaskTypeElement(e):this.expandTaskTypeElement(e,()=>{this.$refs.schedule?.refreshItemPositions(e)})},onSelectTaskType(e){this.selectedTaskType=this.scheduleItems.find(s=>s.task_type_id===e),this.expandTaskTypeElement(this.selectedTaskType,()=>{this.$refs.schedule?.refreshItemPositions(this.selectedTaskType)},!0,!1)},async selectTaskTypeElement(e,s=void 0,a=!0){if(this.isTVShow)return;this.selectedTaskType=e,a&&this.resetSidePanel(),this.assignments.loading=!0;const o=await this.loadTasks({project_id:this.currentProduction.id,task_type_id:this.selectedTaskType.task_type_id,relations:"true"});if(e.for_entity==="Asset")await this.loadAssets({withShared:!1,withTasks:!1}),this.assignments.entityTypes=this.productionAssetTypes.filter(t=>!t.task_types.length||t.task_types.includes(e.task_type_id)).map((t,n)=>({id:t.id,name:t.name,for_entity:e.for_entity,expanded:t.id===s?.object_id,entity_type_id:t.id,children:this.assets.filter(d=>d.asset_type_id===t.id&&!d.canceled&&!d.shared&&o.some(D=>D.entity_id===d.id)).map(d=>({...d,assigned:e.entitiesByType[t.id]?.includes(d.id)}))}));else if(e.for_entity==="Shot"){await this.loadShots();const t=this.shots.filter(n=>o.some(d=>d.entity_id===n.id)).reduce((n,d)=>(n[d.parent_id]||(n[d.parent_id]=[]),d.assigned=e.entitiesByType[d.parent_id]?.includes(d.id),n[d.parent_id].push(d),n),{});this.assignments.entityTypes=Object.keys(t).map(n=>{const d=t[n];return{id:n,name:d[0].sequence_name,for_entity:e.for_entity,expanded:n===s?.object_id,children:d}})}this.assignments.loading=!1},selectTaskElement(e,s,a,o){if(o.length!==1){this.closeSidePanel();return}this.resetSidePanel(),this.isSidePanelOpen=!0,this.selectedTaskType=e,this.draggedEntities=[{...s,children:[{...a.entity}]}],this.assignments.type="task";const t=event.start_date||e.start_date,n=p(t).isAfter(e.end_date)?t:e.end_date;this.assignments.startDate=t,this.assignments.endDate=n,this.assignments.task={...a,estimation:B(this.organisation,a.estimation),startDate:a.startDate.format("YYYY-MM-DD"),endDate:a.endDate.format("YYYY-MM-DD")},this.assignments.excludes=this.team.filter(d=>!a.assignees.includes(d.id)).map(d=>d.id),this.assignments.unassign=!0},closeSidePanel(){this.isSidePanelOpen=!1,this.resetSidePanel()},onAssignmentItemSelected(e){this.assignments.type="entity",this.assignments.startDate=e.start_date,this.assignments.endDate=e.end_date,e.children=this.filteredAssignments(e.children),this.draggedEntities=[e]},onAssignmentItemDragStart(e,s,a){e.stopPropagation(),e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData(`task-type-${a.task_type_id}`,!0),e.dataTransfer.setData("taskTypeId",a.task_type_id),e.dataTransfer.setData("entityId",s.id),s.children=this.filteredAssignments(s.children),this.draggedEntities=[s]},onScheduleItemDropped(e,s){this.assignments.type="entity";const a=e.start_date||s.start_date,o=p(a).isAfter(s.end_date)?a:s.end_date;this.assignments.startDate=a,this.assignments.endDate=o},removeFromAssignments(e){this.assignments.excludes.push(e.id)},submitAssignments(e){this.assignments.type==="entity"?this.saveAssignments():this.assignments.type==="task"&&this.saveTask()},async saveAssignments(){this.assignments.saving=!0;const e=await this.loadTasks({project_id:this.currentProduction.id,task_type_id:this.selectedTaskType.task_type_id,relations:"true"}),a=1/(this.assignments.forcedDailyQuota??this.estimatedDailyQuota);for(const o of this.draggedEntities){const t=p(this.assignments.startDate),n=p(this.assignments.endDate);let d=0,D=0,x=t.clone();for(const k of o.children){const I=e.find(M=>M.entity_id===k.id);if(!I)continue;this.assignments.unassign&&await this.unassignSelectedTasks({taskIds:[I.id]}),d++;let b=x,S=null,w=null;for(;D<this.availablePersons.length;){w=this.availablePersons[D],b=O(b,0,this.daysOffByPerson[w.id]);const{due_date:M}=me(this.organisation,t,S,d*a,this.daysOffByPerson[w.id]);if(S=p(M),S.isAfter(n))D++,d=1,b=t.clone(),S=null;else{await Promise.all([this.assignSelectedTasks({personId:w.id,taskIds:[I.id]}),this.updateTask({taskId:I.id,data:{estimation:Q(this.organisation,a),start_date:b.format("YYYY-MM-DD"),due_date:S.format("YYYY-MM-DD")}})]),d*a%1!==0?x=S.clone():x=S.clone().add(1,"days");break}}}this.expandTaskTypeElement(this.selectedTaskType,()=>{this.$refs.schedule?.refreshItemPositions(this.selectedTaskType)},!0,!1)}this.assignments.saving=!1},async saveTask(){this.assignments.saving=!0;try{const e={...this.assignments.task,startDate:p(this.assignments.task.startDate),endDate:p(this.assignments.task.endDate),estimation:Q(this.organisation,this.assignments.task.estimation),assignees:this.availablePersons.map(s=>s.id)};await this.onScheduleItemChanged(e),await this.unassignSelectedTasks({taskIds:[e.id]}),await Promise.all(e.assignees.map(s=>this.assignSelectedTasks({personId:s,taskIds:[e.id]}))),this.assignments.task.startDate=e.startDate.format("YYYY-MM-DD"),this.assignments.task.endDate=e.endDate.format("YYYY-MM-DD"),this.expandTaskTypeElement(this.selectedTaskType,()=>{this.$refs.schedule?.refreshItemPositions(this.selectedTaskType)},!0,!1)}catch(e){console.error(e)}finally{this.assignments.saving=!1}},async onScheduleItemAssigned(e,s){e.assignees.push(s),e.parentElement.children.get(s).push(e),await this.assignSelectedTasks({personId:s,taskIds:[e.id]})},async onScheduleItemUnassigned(e,s){e.assignees=e.assignees.filter(o=>o!==s);const a=e.parentElement.children.get(s);a.splice(a.indexOf(e),1),await this.unassignPersonFromTask({person:{id:s},task:e})},onModeChanged(e){this.scheduleItems.forEach(s=>{s.expanded&&this.expandTaskTypeElement(s,()=>{this.$refs.schedule?.refreshItemPositions(s)},!0,!1)})}},watch:{selectedStartDate(){this.startDate=p(this.selectedStartDate);const e=this.startDate.format("YYYY-MM-DD");this.currentProduction.start_date&&this.currentProduction.start_date!==e&&this.editProduction({...this.currentProduction,start_date:e})},selectedEndDate(){this.endDate=p(this.selectedEndDate);const e=this.endDate.format("YYYY-MM-DD");this.currentProduction.end_date&&this.currentProduction.end_date!==e&&this.editProduction({...this.currentProduction,end_date:e})},currentProduction(){this.reset()}},head(){return{title:`${this.currentProduction.name} | ${this.$t("schedule.title")} - Kitsu`}}},Te={class:"columns fixed-page"},ve={class:"column main-column"},Pe={class:"flexrow project-dates"},Ie={class:"flexrow-item"},we={class:"label"},Me={class:"flexrow-item"},xe={class:"label"},Ee={class:"flexrow"},Ae={key:0,class:"column side-column"},Ve={class:"side"},Ye={class:"mt1"},Ce={class:"details"},Oe={key:0,class:"mt2"},Be={key:1,class:"assignments parent mt1"},Ue=["onDragstart","onClick"],je={class:"name"},ze=["onClick"],Le={key:0,class:"assignments children"},Qe=["onDragstart","onClick"],Fe={class:"name"},qe={key:2,class:"assignments mt1"},Ne={class:"flexrow"},Re={class:"flexrow-item"},Ge={class:"flexrow-item"},He={key:0},Ke={key:1,class:"dragged-items"},We={class:"assignees"},Xe=["title"],Ze={key:0},Je={class:"has-text-centered"},$e={key:1},et={class:"assignee"},tt={class:"person"},st={key:1,class:"flexrow mt2"},nt={class:"mr05"},at={key:2,class:"mt2"},it={key:3,class:"flexrow mt2"},lt={class:"flexrow-item"},dt={class:"flexrow-item"},ot={key:4,class:"flexrow mt2"},rt={class:"mt2 has-text-right"},ct=["disabled","text"];function ht(e,s,a,o,t,n){const d=y("date-field"),D=y("combobox-number"),x=y("combobox"),k=y("button-simple"),I=y("schedule"),b=y("x-icon"),S=y("combobox-task-type"),w=y("spinner"),M=y("grip-vertical-icon"),l=y("chevron-right-icon"),u=y("chevron-down-icon"),P=y("list-restart-icon"),f=y("people-avatar"),g=y("people-name"),A=y("checkbox"),U=y("text-field"),H=y("trash-icon");return c(),h("div",Te,[r("div",ve,[r("div",Pe,[r("div",Ie,[r("label",we,_(e.$t("main.start_date")),1),m(d,{"can-delete":!1,utc:"",modelValue:t.selectedStartDate,"onUpdate:modelValue":s[0]||(s[0]=i=>t.selectedStartDate=i)},null,8,["modelValue"])]),r("div",Me,[r("label",xe,_(e.$t("main.end_date")),1),m(d,{"can-delete":!1,utc:"",modelValue:t.selectedEndDate,"onUpdate:modelValue":s[1]||(s[1]=i=>t.selectedEndDate=i)},null,8,["modelValue"])]),m(D,{class:"flexrow-item zoom-level nowrap",label:e.$t("schedule.zoom_level"),options:t.zoomOptions,modelValue:t.zoomLevel,"onUpdate:modelValue":s[2]||(s[2]=i=>t.zoomLevel=i)},null,8,["label","options","modelValue"]),m(x,{class:"flexrow-item ml1",label:e.$t("schedule.mode"),modelValue:t.mode,"onUpdate:modelValue":[s[3]||(s[3]=i=>t.mode=i),n.onModeChanged],options:t.modeOptions},null,8,["label","modelValue","options","onUpdate:modelValue"]),s[18]||(s[18]=r("div",{class:"filler"},null,-1)),r("div",Ee,[m(k,{class:"flexrow-item",icon:"clock",text:e.$t("schedule.today"),onClick:n.scrollScheduleToToday},null,8,["text","onClick"]),!n.isLockedSchedule&&!e.isTVShow?(c(),V(k,{key:0,active:t.isSidePanelOpen&&t.assignments.type!=="task",class:"flexrow-item",icon:"list",text:e.$t("menu.assign_tasks"),onClick:n.toggleSidePanel},null,8,["active","text","onClick"])):T("",!0)])]),m(I,{ref:"schedule","start-date":t.startDate,"end-date":t.endDate,hierarchy:t.scheduleItems,"zoom-level":t.zoomLevel,"is-loading":t.loading.schedule,"is-error":t.errors.schedule,"is-estimation-linked":"","hide-man-days":"",multiline:e.isTVShow,reassignable:!n.isLockedSchedule,subchildren:!e.isTVShow,type:t.mode,onItemAssign:n.onScheduleItemAssigned,onItemChanged:n.onScheduleItemChanged,onItemDrop:n.onScheduleItemDropped,onItemSelected:n.selectTaskTypeElement,onItemUnassign:n.onScheduleItemUnassigned,onRootElementExpanded:n.expandTaskTypeElement,onRootElementSelected:n.selectParentElement,onTaskSelected:n.selectTaskElement},null,8,["start-date","end-date","hierarchy","zoom-level","is-loading","is-error","multiline","reassignable","subchildren","type","onItemAssign","onItemChanged","onItemDrop","onItemSelected","onItemUnassign","onRootElementExpanded","onRootElementSelected","onTaskSelected"])]),t.isSidePanelOpen&&!n.isLockedSchedule&&!e.isTVShow?(c(),h("div",Ae,[r("div",Ve,[r("a",{class:"close-button",onClick:s[4]||(s[4]=(...i)=>n.toggleSidePanel&&n.toggleSidePanel(...i))},[m(b,{class:"align-middle",size:16})]),r("h2",Ye,_(t.assignments.type==="task"?e.$t("schedule.edit_task"):e.$t("menu.assign_tasks")),1),r("div",Ce,[m(S,{class:"mb05","add-placeholder":"",placeholder:e.$t("schedule.select_task_type"),label:e.$t("news.task_type"),"task-type-list":t.availableTaskTypes,"model-value":t.selectedTaskType?.task_type_id,"onUpdate:modelValue":n.onSelectTaskType},null,8,["placeholder","label","task-type-list","model-value","onUpdate:modelValue"]),!t.assignments.loading&&t.assignments.entityTypes?.length&&!t.assignments.type?(c(),V(k,{key:0,class:"mt2 mb05",icon:"user-check","is-on":t.assignments.assigned,title:e.$t("schedule.show_assigned"),onClick:s[5]||(s[5]=i=>t.assignments.assigned=!t.assignments.assigned)},null,8,["is-on","title"])):T("",!0)]),t.assignments.loading?(c(),h("div",Oe,[m(w,{class:"mauto",size:20})])):t.assignments.type?(c(),h("div",qe,[r("form",{class:"mt1",onSubmit:s[17]||(s[17]=z(i=>n.submitAssignments(),["prevent"]))},[r("div",Ne,[r("div",Re,[m(d,{"can-delete":!1,disabled:t.assignments.type!=="entity",label:e.$t("main.start_date"),utc:"",modelValue:t.assignments.startDate,"onUpdate:modelValue":s[6]||(s[6]=i=>t.assignments.startDate=i)},null,8,["disabled","label","modelValue"])]),r("div",Ge,[m(d,{"can-delete":!1,disabled:t.assignments.type!=="entity",label:e.$t("main.end_date"),utc:"",modelValue:t.assignments.endDate,"onUpdate:modelValue":s[7]||(s[7]=i=>t.assignments.endDate=i)},null,8,["disabled","label","modelValue"])])]),(c(!0),h(E,null,Y(t.draggedEntities,i=>(c(),h("div",{key:i.id},[r("div",{class:"dragged-type",style:L({background:t.selectedTaskType.color})},_(i.name),5),i.children.length?(c(),h("ul",Ke,[(c(!0),h(E,null,Y(i.children,v=>(c(),h("li",{class:"dragged-item",key:v.id,style:L({background:`color-mix(in srgb, ${t.selectedTaskType.color} 40%, transparent)`,"border-left":`4px solid ${t.selectedTaskType.color}`})},_(i.name)+" / "+_(v.name),5))),128))])):(c(),h("div",He,_(e.$t("schedule.no_entity")),1)),s[19]||(s[19]=r("hr",null,null,-1))]))),128)),r("table",We,[r("thead",null,[r("tr",null,[r("td",null,[ue(_(e.$t("schedule.assign"))+" ",1),t.assignments.excludes.length?(c(),h("a",{key:0,class:"reset-assignees",title:e.$t("schedule.reset_list"),onClick:s[8]||(s[8]=i=>t.assignments.excludes=[])},[m(P,{class:"align-middle",size:18,"stroke-width":1.5})],8,Xe)):T("",!0)])])]),n.availablePersons.length?(c(),h("tbody",$e,[(c(!0),h(E,null,Y(n.availablePersons,i=>(c(),h("tr",{key:i.id},[r("td",et,[r("div",tt,[m(f,{"is-link":!1,"font-size":14,person:i,size:28},null,8,["person"]),m(g,{person:i},null,8,["person"])]),m(k,{class:"is-small",icon:"minus",title:e.$t("main.avatar.unassign",{personName:i.name}),type:"button",onClick:v=>n.removeFromAssignments(i)},null,8,["title","onClick"])])]))),128))])):(c(),h("tbody",Ze,[r("tr",null,[r("td",Je,_(e.$t("schedule.no_assignee")),1)])]))]),t.assignments.type==="entity"?(c(),V(A,{key:0,class:"pa05",disabled:!n.availablePersons.length,label:e.$t("schedule.force_unassign"),toggle:!0,modelValue:t.assignments.unassign,"onUpdate:modelValue":s[9]||(s[9]=i=>t.assignments.unassign=i)},null,8,["disabled","label","modelValue"])):T("",!0),t.assignments.type==="entity"?(c(),h("div",st,[r("label",nt,_(e.$t("schedule.forced_daily_quotas")),1),m(U,{class:"mb0 daily-quotas","input-class":" is-small",step:.01,type:"number",modelValue:t.assignments.forcedDailyQuota,"onUpdate:modelValue":s[10]||(s[10]=i=>t.assignments.forcedDailyQuota=i)},null,8,["modelValue"]),t.assignments.forcedDailyQuota?(c(),h("a",{key:0,class:"reset-quotas ml05",onClick:s[11]||(s[11]=i=>t.assignments.forcedDailyQuota=null)},[m(H,{class:"align-middle",size:14})])):T("",!0)])):T("",!0),t.assignments.type==="entity"?(c(),h("div",at,_(e.$t("schedule.estimated_daily_quotas"))+" "+_(n.estimatedDailyQuota.toFixed(2)),1)):T("",!0),t.assignments.type==="task"?(c(),h("div",it,[r("div",lt,[m(d,{"can-delete":!1,label:e.$t("main.start_date"),utc:"","with-margin":!1,modelValue:t.assignments.task.startDate,"onUpdate:modelValue":s[12]||(s[12]=i=>t.assignments.task.startDate=i)},null,8,["label","modelValue"])]),r("div",dt,[m(d,{"can-delete":!1,disabled:"",label:e.$t("main.end_date"),utc:"","with-margin":!1,modelValue:t.assignments.task.endDate,"onUpdate:modelValue":s[13]||(s[13]=i=>t.assignments.task.endDate=i)},null,8,["label","modelValue"])])])):T("",!0),t.assignments.type==="task"?(c(),h("div",ot,[m(U,{class:"mb0 estimation mr05","input-class":" thin",label:e.$t("main.estimation"),step:.01,placeholder:"0.00",type:"number","unit-label":e.$t("schedule.md"),modelValue:t.assignments.task.estimation,"onUpdate:modelValue":s[14]||(s[14]=i=>t.assignments.task.estimation=i)},null,8,["label","unit-label","modelValue"])])):T("",!0),r("div",rt,[t.assignments.type==="entity"?(c(),h(E,{key:0},[m(k,{disabled:!n.hasDraggedEntities||!n.availablePersons.length,"is-loading":t.assignments.saving,"is-primary":"",text:e.$t("main.apply"),type:"submit"},null,8,["disabled","is-loading","text"]),r("button",{class:"button is-link ml05",disabled:t.assignments.saving,text:e.$t("main.back"),type:"button",onClick:s[15]||(s[15]=i=>t.assignments.type=null)},_(e.$t("main.back")),9,ct)],64)):T("",!0),t.assignments.type==="task"?(c(),h(E,{key:1},[m(k,{disabled:!t.assignments.task.estimation,"is-loading":t.assignments.saving,"is-primary":"",text:e.$t("main.apply"),type:"submit"},null,8,["disabled","is-loading","text"]),r("button",{class:"button is-link ml05",onClick:s[16]||(s[16]=(...i)=>n.closeSidePanel&&n.closeSidePanel(...i))},_(e.$t("main.cancel")),1)],64)):T("",!0)])],32)])):(c(),h("ul",Be,[(c(!0),h(E,null,Y(t.assignments.entityTypes,i=>(c(),h("li",{key:i.id},[r("div",{class:"assignment-item",draggable:"true",onDragstart:v=>n.onAssignmentItemDragStart(v,i,t.selectedTaskType),onClick:v=>n.onAssignmentItemSelected(i)},[m(M,{class:"icon"}),r("span",je,_(i.name)+" ("+_(n.filteredAssignments(i.children).length)+") ",1),r("span",{class:"expand",onClick:z(v=>i.expanded=!i.expanded,["stop"])},[i.expanded?(c(),V(u,{key:1})):(c(),V(l,{key:0}))],8,ze)],40,Ue),i.expanded?(c(),h("ul",Le,[(c(!0),h(E,null,Y(n.filteredAssignments(i.children),v=>(c(),h("li",{key:v.id},[r("div",{class:"assignment-item",draggable:"true",onDragstart:j=>n.onAssignmentItemDragStart(j,{...i,children:[v]},t.selectedTaskType),onClick:j=>n.onAssignmentItemSelected({...i,children:[v]})},[m(M,{class:"icon"}),r("span",Fe,_(v.name),1)],40,Qe)]))),128))])):T("",!0)]))),128))]))])])):T("",!0)])}const mt=K(Se,[["render",ht],["__scopeId","data-v-81137a4d"]]);export{mt as default};
//# sourceMappingURL=ProductionSchedule-ClSNvlg4.js.map
