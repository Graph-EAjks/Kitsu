import{ch as N,_ as R,m as G,a as H,bQ as W,a6 as X,O as K,cc as Z,u as J,Q as $,aD as ee,aC as te,ai as se,Z as ne,aE as ae,aF as ie,b6 as le,B as de,r as y,c as h,o as c,e as o,d as w,f as m,t as D,k as C,F as A,g as B,ab as oe,G as O,a5 as re,bI as p,ci as V,cj as ce,bP as ue,ck as j,a1 as he,A as Y,cl as z,cm as me,M as fe,cn as pe,bY as U,co as _e,a0 as Q,aH as F,bO as ge}from"./index-CvjDftx2.js";/**
 * @license lucide-vue-next v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=N("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-vue-next v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=N("list-restart",[["path",{d:"M21 6H3",key:"1jwq7v"}],["path",{d:"M7 12H3",key:"13ou7f"}],["path",{d:"M7 18H3",key:"1sijw9"}],["path",{d:"M12 18a5 5 0 0 0 9-3 4.5 4.5 0 0 0-4.5-4.5c-1.33 0-2.54.54-3.41 1.41L11 14",key:"qth677"}],["path",{d:"M11 10v4h4",key:"172dkj"}]]),Se={name:"production-schedule",components:{ButtonSimple:de,Checkbox:le,ChevronDownIcon:ie,ChevronRightIcon:ae,ComboboxNumber:ne,DateField:se,GripVerticalIcon:ye,ListRestartIcon:De,PeopleAvatar:te,PeopleName:ee,Schedule:$,Spinner:J,TrashIcon:Z,TaskTypeName:K,TextField:X,XIcon:W},data(){return{assignments:{assigned:!1,entityTypes:null,excludes:[],forcedDailyQuota:null,item:null,loading:!1,saving:!1,startDate:null,endDate:null,unassign:!1},daysOffByPerson:[],draggedEntities:[],endDate:Y().add(6,"months").endOf("day"),scheduleItems:[],startDate:Y().startOf("day"),selectedStartDate:null,selectedEndDate:null,selectedTaskType:null,zoomLevel:1,zoomOptions:[{label:this.$t("main.week"),value:0},{label:"1",value:1},{label:"2",value:2},{label:"3",value:3}],loading:{schedule:!1},errors:{schedule:!1}}},mounted(){this.reset()},computed:{...H(["currentEpisode","currentProduction","isCurrentUserManager","isCurrentUserSupervisor","isTVShow","organisation","personMap","productionAssetTypes","user"]),estimatedDailyQuota(){const e=F(this.assignments.startDate),t=F(this.assignments.endDate),n=ge(e,t),r=this.draggedEntities.reduce((a,d)=>a+(d.children?.length??0),0),s=this.availablePersons.length;return n&&s?r/n/s:0},assetMap(){return Q.cache.assetMap},assets(){return Q.cache.assets},assetTypeMap(){return _e.cache.assetTypeMap},availablePersons(){const e=this.taskTypeMap.get(this.selectedTaskType.task_type_id);return this.team.filter(t=>!this.assignments.excludes.includes(t.id)&&t.role!=="client"&&(!t.departments.length||t.departments.includes(e?.department_id)))},hasDraggedEntities(){return this.draggedEntities.some(e=>e.children.length)},shotMap(){return U.cache.shotMap},shots(){return U.cache.shots},taskTypeMap(){return pe.cache.taskTypeMap},team(){return fe(this.currentProduction.team.map(e=>this.personMap.get(e)).filter(e=>e&&!e.is_bot))}},methods:{...G(["assignSelectedTasks","editProduction","loadAggregatedPersonDaysOff","loadAssets","loadAssetTypeScheduleItems","loadEpisodeScheduleItems","loadScheduleItems","loadSequenceScheduleItems","loadShots","loadTasks","saveScheduleItem","unassignPersonFromTask","unassignSelectedTasks","updateTask"]),loadData(){this.loading.schedule=!0,this.loadScheduleItems(this.currentProduction).then(e=>{const t=p(this.selectedStartDate),n=p(this.selectedEndDate);e=e.map(r=>{const s=this.taskTypeMap.get(r.task_type_id);let a,d;r.start_date?a=p(r.start_date):a=Y(),a.isSameOrAfter(n)&&(a=n.clone().add(-1,"days")),a.isBefore(t)&&(a=t.clone()),r.end_date?d=p(r.end_date):d=a.clone().add(1,"days"),d.isSameOrAfter(n)&&(d=n.clone());const _=z(s.id,this.currentProduction.id,this.currentEpisode?this.currentEpisode.id:null,s.for_entity);return{...r,color:s.color,for_entity:s.for_entity,name:`${s.for_entity} / ${s.name}`,priority:s.priority,startDate:a,endDate:d,editable:this.isInDepartment(s),expanded:!1,loading:!1,route:s.for_entity==="Shot"&&this.isTVShow?null:_,children:[]}}),this.scheduleItems=me(e,this.currentProduction,this.taskTypeMap),this.loading.schedule=!1}).catch(e=>{console.error(e),this.loading.schedule=!1})},reset(){this.closeSidePanel(),this.currentProduction.start_date&&(this.startDate=p(this.currentProduction.start_date)),this.currentProduction.end_date&&(this.endDate=p(this.currentProduction.end_date)),this.selectedStartDate=this.startDate.toDate(),this.selectedEndDate=this.endDate.toDate(),this.loadData()},convertScheduleItems(e,t){return t.map(n=>{let r;n.start_date?r=p(n.start_date):r=Y(),r.isBefore(this.startDate)&&(r=this.startDate.clone()),r.isAfter(this.endDate)&&(r=this.endDate.clone());let s;n.end_date?s=p(n.end_date):s=r.clone().add(1,"days"),s.isBefore(r)&&(s=r.clone().add(1,"days")),s.isAfter(this.endDate)&&(s=this.endDate.clone());const a={...n,startDate:r,endDate:s,expanded:!1,loading:!1,editable:this.isInDepartment(this.taskTypeMap.get(n.task_type_id)),children:[],parentElement:e};return this.isTVShow&&(a.route=z(n.task_type_id,this.currentProduction.id,n.object_id,e.for_entity)),a})},async expandTaskTypeElement(e,t=null,n=!1,r=!0){if(e.expanded=n||!e.expanded,e.expanded){try{e.loading=!0,this.selectedTaskType=this.isTVShow?null:e,this.assignments.loading=r,e.children=[],e.people={},e.entitiesByType={};const s=this.isTVShow?["Asset","Shot"].includes(e.for_entity)?this.loadEpisodeScheduleItems:this.loadSequenceScheduleItems:e.for_entity==="Shot"?this.loadSequenceScheduleItems:this.loadAssetTypeScheduleItems,a={production:this.currentProduction,taskType:this.taskTypeMap.get(e.task_type_id)},d=await s(a);let _=this.convertScheduleItems(e,d);const v=new Map(_.map(P=>[P.object_id,P]));if(this.isTVShow)e.children=_;else{e.for_entity==="Asset"&&await this.loadAssets({withShared:!1,withTasks:!1}),e.for_entity==="Shot"&&await this.loadShots();const P=await this.loadTasks({project_id:this.currentProduction.id,task_type_id:e.task_type_id,relations:"true"}),M=[...new Set(P.flatMap(i=>i.assignees))];await this.loadDaysOff(M);const S={},b={};P.forEach(i=>{i.start_date&&(e.for_entity==="Asset"?(i.entity=this.assetMap.get(i.entity_id),i.entity_type_id=i.entity.asset_type_id):e.for_entity==="Shot"?(i.entity=this.shotMap.get(i.entity_id),i.entity_type_id=i.entity.sequence_id):i.entity_type_id=e.for_entity,!i.entity?.canceled&&(S[i.entity_type_id]||(S[i.entity_type_id]={}),i.assignees.length||(i.assignees=["unassigned"]),i.assignees.forEach(u=>{const k=v.get(i.entity_type_id),g=p(i.start_date);if(g.isAfter(this.endDate))return;g.isBefore(k.startDate)&&(k.startDate=g.clone()),i.startDate=g;let f;if(i.due_date?f=p(i.due_date):i.end_date?f=p(i.end_date):i.estimation&&(f=V(i.startDate,Math.ceil(j(this.organisation,i.estimation))-1,this.daysOffByPerson[u])),!f||f.isBefore(g)){const E=g.isoWeekday()===5?3:1;f=g.clone().add(E,"days")}if(!f.isSameOrAfter(g)){const E=g.isoWeekday()===5?3:1;f=g.clone().add(E,"days")}f.isBefore(this.startDate)||(f.isAfter(k.endDate)&&(k.endDate=f.clone()),i.endDate=f,S[i.entity_type_id][u]||(S[i.entity_type_id][u]=[],b[u]=u!=="unassigned"?{...this.personMap.get(u),daysOff:this.daysOffByPerson[u]}:{id:u,avatar:!1,color:"#888",full_name:this.$t("main.unassigned")}),i.editable=!0,i.unresizable=!1,i.parentElement=k,S[i.entity_type_id][u].push(i))})))}),e.for_entity==="Asset"&&(_=_.filter(i=>{const u=this.assetTypeMap.get(i.object_id);return u&&(!u.task_types.length||u.task_types.includes(e.task_type_id))}));const I=([i],[u])=>i==="unassigned"?1:u==="unassigned"?-1:b[i].full_name.localeCompare(b[u].full_name),x=(i,u)=>i.entity?.name.localeCompare(u.entity?.name,void 0,{numeric:!0});_.forEach(i=>{const u=S[i.object_id]||{},k=new Map(Object.entries(u).sort(I).map(([g,f])=>[g,f.sort(x)]));i.children=k}),e.children=he(_),e.people=b,e.entitiesByType=Object.fromEntries(Object.entries(S).map(([i,u])=>[i,Object.entries(u).flatMap(([k,g])=>k!=="unassigned"?g.map(f=>f.entity_id):void 0).filter(Boolean)]))}}catch(s){console.error(s),e.children=[],e.people=[]}finally{e.loading=!1}t&&t(e),this.selectTaskTypeElement(e,null,r)}},async loadDaysOff(e){this.daysOffByPerson=[];for(const t of e){const n=await this.loadAggregatedPersonDaysOff({personId:t}).catch(()=>[]);this.daysOffByPerson[t]=n}},filteredAssignments(e){return this.assignments.assigned?e:e.filter(t=>!t.assigned)},saveTaskChanged(e){return this.updateTask({taskId:e.id,data:{estimation:e.estimation,start_date:e.startDate.format("YYYY-MM-DD"),due_date:e.endDate.format("YYYY-MM-DD")}})},onScheduleItemChanged(e){if(e.type==="Task"){const t=e.assignees.flatMap(n=>this.daysOffByPerson[n]).filter(Boolean);e.startDate=V(e.startDate,0,t),e.endDate=V(e.startDate,Math.ceil(j(this.organisation,e.estimation))-1,t),e.startDate.isBefore(e.parentElement.startDate)&&(e.parentElement.startDate=e.startDate.clone(),this.updateScheduleItem(e.parentElement),e.parentElement.startDate.isBefore(e.parentElement.parentElement.startDate)&&(e.parentElement.parentElement.startDate=e.parentElement.startDate.clone(),this.updateScheduleItem(e.parentElement.parentElement))),e.endDate.isAfter(e.parentElement.endDate)&&(e.parentElement.endDate=e.endDate.clone(),this.updateScheduleItem(e.parentElement),e.parentElement.endDate.isAfter(e.parentElement.parentElement.endDate)&&(e.parentElement.parentElement.endDate=e.parentElement.endDate.clone(),this.updateScheduleItem(e.parentElement.parentElement))),this.saveTaskChanged(e);return}if(e.startDate&&e.endDate&&e.parentElement)e.parentElement.startDate=this.getMinDate(e.parentElement),e.parentElement.endDate=this.getMaxDate(e.parentElement),this.saveScheduleItem(e.parentElement);else if(!e.parentElement){const t=this.getMinDate(e),n=this.getMaxDate(e);e.startDate.isAfter(t)&&(e.startDate=t),e.endDate.isBefore(n)&&(e.endDate=n)}this.updateScheduleItem(e)},updateScheduleItem(e){const t=this.scheduleItems.find(n=>n===e);t&&(t.startDate=e.startDate,t.start_date=e.startDate.format("YYYY-MM-DD"),t.endDate=e.endDate,t.end_date=e.endDate.format("YYYY-MM-DD")),this.saveScheduleItem(e)},getMinDate(e){let t=this.endDate.clone();return e.children.forEach(n=>{n.startDate&&n.startDate.isBefore(t)&&(t=n.startDate)}),t.clone()},getMaxDate(e){let t=this.startDate.clone();return e.children.forEach(n=>{n.endDate&&n.endDate.isAfter(t)&&(t=n.endDate)}),t.clone()},isInDepartment(e){return this.isCurrentUserManager?!0:this.isCurrentUserSupervisor?this.user.departments.length===0?!0:e.department_id&&this.user.departments.includes(e.department_id):!1},scrollScheduleToToday(){this.$refs.schedule?.scrollToToday()},resetSidePanel(){this.assignments={...this.assignments,entityTypes:null,excludes:[],forcedDailyQuota:null,item:null,loading:!1,saving:!1,startDate:null,endDate:null,unassign:!1}},selectParentElement(e){e.expanded?this.selectTaskTypeElement(e):this.expandTaskTypeElement(e,()=>{this.$refs.schedule?.refreshItemPositions(e)})},async selectTaskTypeElement(e,t=void 0,n=!0){if(this.isTVShow)return;this.selectedTaskType=e,n&&this.resetSidePanel(),this.assignments.loading=!0;const r=await this.loadTasks({project_id:this.currentProduction.id,task_type_id:this.selectedTaskType.task_type_id,relations:"true"});if(e.for_entity==="Asset")await this.loadAssets({withShared:!1,withTasks:!1}),this.assignments.entityTypes=this.productionAssetTypes.filter(s=>!s.task_types.length||s.task_types.includes(e.task_type_id)).map((s,a)=>({id:s.id,name:s.name,for_entity:e.for_entity,expanded:s.id===t?.object_id,entity_type_id:s.id,children:this.assets.filter(d=>d.asset_type_id===s.id&&!d.canceled&&!d.shared&&r.some(_=>_.entity_id===d.id)).map(d=>({...d,assigned:e.entitiesByType[s.id]?.includes(d.id)}))}));else if(e.for_entity==="Shot"){await this.loadShots();const s=this.shots.filter(a=>r.some(d=>d.entity_id===a.id)).reduce((a,d)=>(a[d.parent_id]||(a[d.parent_id]=[]),d.assigned=e.entitiesByType[d.parent_id]?.includes(d.id),a[d.parent_id].push(d),a),{});this.assignments.entityTypes=Object.keys(s).map(a=>{const d=s[a];return{id:a,name:d[0].sequence_name,for_entity:e.for_entity,expanded:a===t?.object_id,children:d}})}this.assignments.loading=!1},closeSidePanel(){this.selectedTaskType=null,this.resetSidePanel()},onAssignmentItemDragStart(e,t,n){e.stopPropagation(),e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData(`task-type-${n.task_type_id}`,!0),e.dataTransfer.setData("taskTypeId",n.task_type_id),e.dataTransfer.setData("entityId",t.id),t.children=this.filteredAssignments(t.children),this.draggedEntities=[t]},onScheduleItemDropped(e,t){this.assignments.item=t;const n=e.start_date||t.start_date,r=p(n).isAfter(t.end_date)?n:t.end_date;this.assignments.startDate=n,this.assignments.endDate=r},removeFromAssignments(e){this.assignments.excludes.push(e.id)},async saveAssignments(){this.assignments.saving=!0;const e=await this.loadTasks({project_id:this.currentProduction.id,task_type_id:this.selectedTaskType.task_type_id,relations:"true"}),n=1/(this.assignments.forcedDailyQuota??this.estimatedDailyQuota);for(const r of this.draggedEntities){const s=p(this.assignments.startDate),a=p(this.assignments.endDate);let d=0,_=0,v=s.clone();for(const P of r.children){const M=e.find(x=>x.entity_id===P.id);if(!M)continue;this.assignments.unassign&&await this.unassignSelectedTasks({taskIds:[M.id]}),d++;let S=v,b=null,I=null;for(;_<this.availablePersons.length;){I=this.availablePersons[_],S=V(S,0,this.daysOffByPerson[I.id]);const{due_date:x}=ce(this.organisation,s,b,d*n,this.daysOffByPerson[I.id]);if(b=p(x),b.isAfter(a))_++,d=1,S=s.clone(),b=null;else{await Promise.all([this.assignSelectedTasks({personId:I.id,taskIds:[M.id]}),this.updateTask({taskId:M.id,data:{estimation:ue(this.organisation,n),start_date:S.format("YYYY-MM-DD"),due_date:b.format("YYYY-MM-DD")}})]),d*n%1!==0?v=b.clone():v=b.clone().add(1,"days");break}}}this.expandTaskTypeElement(this.selectedTaskType,()=>{this.$refs.schedule?.refreshItemPositions(this.selectedTaskType)},!0,!1)}this.assignments.saving=!1},async onScheduleItemAssigned(e,t){e.assignees.push(t),e.parentElement.children.get(t).push(e),await this.assignSelectedTasks({personId:t,taskIds:[e.id]})},async onScheduleItemUnassigned(e,t){e.assignees=e.assignees.filter(r=>r!==t);const n=e.parentElement.children.get(t);n.splice(n.indexOf(e),1),await this.unassignPersonFromTask({person:{id:t},task:e})}},watch:{selectedStartDate(){this.startDate=p(this.selectedStartDate);const e=this.startDate.format("YYYY-MM-DD");this.currentProduction.start_date&&this.currentProduction.start_date!==e&&this.editProduction({...this.currentProduction,start_date:e})},selectedEndDate(){this.endDate=p(this.selectedEndDate);const e=this.endDate.format("YYYY-MM-DD");this.currentProduction.end_date&&this.currentProduction.end_date!==e&&this.editProduction({...this.currentProduction,end_date:e})},currentProduction(){this.reset()}},head(){return{title:`${this.currentProduction.name} | ${this.$t("schedule.title")} - Kitsu`}}},be={class:"columns fixed-page"},ve={class:"column main-column"},ke={class:"flexrow project-dates"},Te={class:"flexrow-item"},Pe={class:"label"},Ie={class:"flexrow-item"},Me={class:"label"},xe={class:"flexrow"},Ee={key:0,class:"column side-column"},we={class:"side"},Ae={class:"mt1"},Be={class:"details"},Ve={key:0,class:"mt2"},Ye={key:1,class:"assignments mt1"},Ce=["onDragstart"],Oe={class:"name"},je=["onClick"],ze={key:0,class:"assignments"},Ue=["onDragstart"],Qe={class:"name"},Fe={key:2,class:"assignments mt1"},Ne={class:"flexrow"},qe={class:"flexrow-item"},Le={class:"flexrow-item"},Re={key:0},Ge={key:1,class:"dragged-items"},He={class:"assignees"},We=["title"],Xe={key:0},Ke={class:"has-text-centered"},Ze={key:1},Je={class:"assignee"},$e={class:"person"},et={class:"flexrow mt2"},tt={class:"mr05"},st={class:"mt2"},nt={class:"mt2 has-text-right"};function at(e,t,n,r,s,a){const d=y("date-field"),_=y("combobox-number"),v=y("button-simple"),P=y("schedule"),M=y("x-icon"),S=y("task-type-name"),b=y("spinner"),I=y("grip-vertical-icon"),x=y("chevron-right-icon"),i=y("chevron-down-icon"),u=y("list-restart-icon"),k=y("people-avatar"),g=y("people-name"),f=y("checkbox"),E=y("text-field"),q=y("trash-icon");return c(),h("div",be,[o("div",ve,[o("div",ke,[o("div",Te,[o("label",Pe,D(e.$t("main.start_date")),1),m(d,{"can-delete":!1,utc:"",modelValue:s.selectedStartDate,"onUpdate:modelValue":t[0]||(t[0]=l=>s.selectedStartDate=l)},null,8,["modelValue"])]),o("div",Ie,[o("label",Me,D(e.$t("main.end_date")),1),m(d,{"can-delete":!1,utc:"",modelValue:s.selectedEndDate,"onUpdate:modelValue":t[1]||(t[1]=l=>s.selectedEndDate=l)},null,8,["modelValue"])]),m(_,{class:"flexrow-item zoom-level",label:e.$t("schedule.zoom_level"),options:s.zoomOptions,modelValue:s.zoomLevel,"onUpdate:modelValue":t[2]||(t[2]=l=>s.zoomLevel=l)},null,8,["label","options","modelValue"]),t[13]||(t[13]=o("div",{class:"filler"},null,-1)),o("div",xe,[m(v,{class:"flexrow-item",icon:"clock",text:e.$t("schedule.today"),onClick:a.scrollScheduleToToday},null,8,["text","onClick"])])]),m(P,{ref:"schedule","start-date":s.startDate,"end-date":s.endDate,hierarchy:s.scheduleItems,"zoom-level":s.zoomLevel,"is-loading":s.loading.schedule,"is-error":s.errors.schedule,"is-estimation-linked":"","hide-man-days":"",multiline:e.isTVShow,reassignable:!0,subchildren:!e.isTVShow,onItemAssign:a.onScheduleItemAssigned,onItemChanged:a.onScheduleItemChanged,onItemDrop:a.onScheduleItemDropped,onItemSelected:a.selectTaskTypeElement,onItemUnassign:a.onScheduleItemUnassigned,onRootElementExpanded:a.expandTaskTypeElement,onRootElementSelected:a.selectParentElement},null,8,["start-date","end-date","hierarchy","zoom-level","is-loading","is-error","multiline","subchildren","onItemAssign","onItemChanged","onItemDrop","onItemSelected","onItemUnassign","onRootElementExpanded","onRootElementSelected"])]),s.selectedTaskType?(c(),h("div",Ee,[o("div",we,[o("a",{class:"close-button",onClick:t[3]||(t[3]=(...l)=>a.closeSidePanel&&a.closeSidePanel(...l))},[m(M,{class:"align-middle",size:16})]),o("h2",Ae,D(e.$t("menu.assign_tasks")),1),o("div",Be,[m(S,{class:"task-type","production-id":e.currentProduction.id,"task-type":s.selectedTaskType},null,8,["production-id","task-type"]),s.assignments.item?w("",!0):(c(),C(v,{key:0,icon:"user-check","is-on":s.assignments.assigned,title:e.$t("schedule.show_assigned"),onClick:t[4]||(t[4]=l=>s.assignments.assigned=!s.assignments.assigned)},null,8,["is-on","title"]))]),s.assignments.loading?(c(),h("div",Ve,[m(b,{class:"mauto",size:20})])):s.assignments.item?(c(),h("div",Fe,[o("form",{class:"mt1",onSubmit:t[12]||(t[12]=oe(l=>a.saveAssignments(),["prevent"]))},[o("div",Ne,[o("div",qe,[m(d,{"can-delete":!1,label:e.$t("main.start_date"),utc:"",modelValue:s.assignments.startDate,"onUpdate:modelValue":t[5]||(t[5]=l=>s.assignments.startDate=l)},null,8,["label","modelValue"])]),o("div",Le,[m(d,{"can-delete":!1,label:e.$t("main.end_date"),utc:"",modelValue:s.assignments.endDate,"onUpdate:modelValue":t[6]||(t[6]=l=>s.assignments.endDate=l)},null,8,["label","modelValue"])])]),(c(!0),h(A,null,B(s.draggedEntities,l=>(c(),h("div",{key:l.id},[o("div",{class:"dragged-type",style:O({background:s.selectedTaskType.color})},D(l.name),5),l.children.length?(c(),h("ul",Ge,[(c(!0),h(A,null,B(l.children,T=>(c(),h("li",{class:"dragged-item",key:T.id,style:O({background:`color-mix(in srgb, ${s.selectedTaskType.color} 40%, transparent)`,"border-left":`4px solid ${s.selectedTaskType.color}`})},D(l.name)+" / "+D(T.name),5))),128))])):(c(),h("div",Re,D(e.$t("schedule.no_entity")),1)),t[14]||(t[14]=o("hr",null,null,-1))]))),128)),o("table",He,[o("thead",null,[o("tr",null,[o("td",null,[re(D(e.$t("schedule.assign"))+" ",1),s.assignments.excludes.length?(c(),h("a",{key:0,class:"reset-assignees",title:e.$t("schedule.reset_list"),onClick:t[7]||(t[7]=l=>s.assignments.excludes=[])},[m(u,{class:"align-middle",size:18,"stroke-width":1.5})],8,We)):w("",!0)])])]),a.availablePersons.length?(c(),h("tbody",Ze,[(c(!0),h(A,null,B(a.availablePersons,l=>(c(),h("tr",{key:l.id},[o("td",Je,[o("div",$e,[m(k,{"is-link":!1,"font-size":14,person:l,size:28},null,8,["person"]),m(g,{person:l},null,8,["person"])]),m(v,{class:"is-small",icon:"minus",title:e.$t("main.avatar.unassign",{personName:l.name}),type:"button",onClick:T=>a.removeFromAssignments(l)},null,8,["title","onClick"])])]))),128))])):(c(),h("tbody",Xe,[o("tr",null,[o("td",Ke,D(e.$t("schedule.no_assignee")),1)])]))]),m(f,{class:"pa05",disabled:!a.availablePersons.length,label:e.$t("schedule.force_unassign"),toggle:!0,modelValue:s.assignments.unassign,"onUpdate:modelValue":t[8]||(t[8]=l=>s.assignments.unassign=l)},null,8,["disabled","label","modelValue"]),o("div",et,[o("label",tt,D(e.$t("schedule.forced_daily_quotas")),1),m(E,{class:"mb0 daily-quotas","input-class":" is-small",step:.01,type:"number",modelValue:s.assignments.forcedDailyQuota,"onUpdate:modelValue":t[9]||(t[9]=l=>s.assignments.forcedDailyQuota=l)},null,8,["modelValue"]),s.assignments.forcedDailyQuota?(c(),h("a",{key:0,class:"reset-quotas ml05",onClick:t[10]||(t[10]=l=>s.assignments.forcedDailyQuota=null)},[m(q,{class:"align-middle",size:14})])):w("",!0)]),o("div",st,D(e.$t("schedule.estimated_daily_quotas"))+" "+D(a.estimatedDailyQuota.toFixed(2)),1),o("div",nt,[m(v,{class:"mr1",disabled:s.assignments.saving,text:e.$t("main.cancel"),type:"button",onClick:t[11]||(t[11]=l=>s.assignments.item=null)},null,8,["disabled","text"]),m(v,{disabled:!a.hasDraggedEntities||!a.availablePersons.length,icon:"user-check","is-loading":s.assignments.saving,text:e.$t("main.apply"),type:"submit"},null,8,["disabled","is-loading","text"])])],32)])):(c(),h("ul",Ye,[(c(!0),h(A,null,B(s.assignments.entityTypes,l=>(c(),h("li",{key:l.id},[o("div",{class:"assignment-item",draggable:"true",onDragstart:T=>a.onAssignmentItemDragStart(T,l,s.selectedTaskType)},[m(I,{class:"icon"}),o("span",Oe,D(l.name)+" ("+D(a.filteredAssignments(l.children).length)+") ",1),o("span",{class:"expand",onClick:T=>l.expanded=!l.expanded},[l.expanded?(c(),C(i,{key:1})):(c(),C(x,{key:0}))],8,je)],40,Ce),l.expanded?(c(),h("ul",ze,[(c(!0),h(A,null,B(a.filteredAssignments(l.children),T=>(c(),h("li",{key:T.id},[o("div",{class:"assignment-item",draggable:"true",onDragstart:L=>a.onAssignmentItemDragStart(L,{...l,children:[T]},s.selectedTaskType)},[m(I,{class:"icon"}),o("span",Qe,D(T.name),1)],40,Ue)]))),128))])):w("",!0)]))),128))]))])])):w("",!0)])}const lt=R(Se,[["render",at],["__scopeId","data-v-991ff585"]]);export{lt as default};
//# sourceMappingURL=ProductionSchedule-DjZMbJl2.js.map
