{"version":3,"file":"ProductionSchedule-Dyh6KPel.js","sources":["../../node_modules/lucide-vue-next/dist/esm/icons/grip-vertical.js","../../node_modules/lucide-vue-next/dist/esm/icons/list-restart.js","../../src/components/pages/ProductionSchedule.vue"],"sourcesContent":["/**\n * @license lucide-vue-next v0.507.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst GripVertical = createLucideIcon(\"grip-vertical\", [\n  [\"circle\", { cx: \"9\", cy: \"12\", r: \"1\", key: \"1vctgf\" }],\n  [\"circle\", { cx: \"9\", cy: \"5\", r: \"1\", key: \"hp0tcf\" }],\n  [\"circle\", { cx: \"9\", cy: \"19\", r: \"1\", key: \"fkjjf6\" }],\n  [\"circle\", { cx: \"15\", cy: \"12\", r: \"1\", key: \"1tmaij\" }],\n  [\"circle\", { cx: \"15\", cy: \"5\", r: \"1\", key: \"19l28e\" }],\n  [\"circle\", { cx: \"15\", cy: \"19\", r: \"1\", key: \"f4zoj3\" }]\n]);\n\nexport { GripVertical as default };\n//# sourceMappingURL=grip-vertical.js.map\n","/**\n * @license lucide-vue-next v0.507.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ListRestart = createLucideIcon(\"list-restart\", [\n  [\"path\", { d: \"M21 6H3\", key: \"1jwq7v\" }],\n  [\"path\", { d: \"M7 12H3\", key: \"13ou7f\" }],\n  [\"path\", { d: \"M7 18H3\", key: \"1sijw9\" }],\n  [\n    \"path\",\n    {\n      d: \"M12 18a5 5 0 0 0 9-3 4.5 4.5 0 0 0-4.5-4.5c-1.33 0-2.54.54-3.41 1.41L11 14\",\n      key: \"qth677\"\n    }\n  ],\n  [\"path\", { d: \"M11 10v4h4\", key: \"172dkj\" }]\n]);\n\nexport { ListRestart as default };\n//# sourceMappingURL=list-restart.js.map\n","<template>\n  <div class=\"columns fixed-page\">\n    <div class=\"column main-column\">\n      <div class=\"flexrow project-dates\">\n        <div class=\"flexrow-item\">\n          <label class=\"label\">\n            {{ $t('main.start_date') }}\n          </label>\n          <date-field :can-delete=\"false\" utc v-model=\"selectedStartDate\" />\n        </div>\n        <div class=\"flexrow-item\">\n          <label class=\"label\">\n            {{ $t('main.end_date') }}\n          </label>\n          <date-field :can-delete=\"false\" utc v-model=\"selectedEndDate\" />\n        </div>\n        <combobox-number\n          class=\"flexrow-item zoom-level\"\n          :label=\"$t('schedule.zoom_level')\"\n          :options=\"zoomOptions\"\n          v-model=\"zoomLevel\"\n        />\n        <div class=\"filler\"></div>\n        <div class=\"flexrow\">\n          <button-simple\n            class=\"flexrow-item\"\n            icon=\"clock\"\n            :text=\"$t('schedule.today')\"\n            @click=\"scrollScheduleToToday\"\n          />\n        </div>\n      </div>\n\n      <schedule\n        ref=\"schedule\"\n        :start-date=\"startDate\"\n        :end-date=\"endDate\"\n        :hierarchy=\"scheduleItems\"\n        :zoom-level=\"zoomLevel\"\n        :is-loading=\"loading.schedule\"\n        :is-error=\"errors.schedule\"\n        is-estimation-linked\n        hide-man-days\n        :multiline=\"isTVShow\"\n        :subchildren=\"!isTVShow\"\n        @item-changed=\"onScheduleItemChanged\"\n        @item-drop=\"onScheduleItemDropped\"\n        @item-selected=\"selectTaskTypeElement\"\n        @root-element-expanded=\"expandTaskTypeElement\"\n        @root-element-selected=\"selectParentElement\"\n      />\n    </div>\n\n    <div class=\"column side-column\" v-if=\"selectedTaskType\">\n      <div class=\"side\">\n        <a class=\"close-button\" @click=\"closeSidePanel\">\n          <x-icon class=\"align-middle\" :size=\"16\" />\n        </a>\n        <h2 class=\"mt1\">{{ $t('menu.assign_tasks') }}</h2>\n        <div class=\"details\">\n          <task-type-name\n            class=\"task-type\"\n            :production-id=\"currentProduction.id\"\n            :task-type=\"selectedTaskType\"\n          />\n          <button-simple\n            icon=\"user-check\"\n            :is-on=\"assignments.assigned\"\n            :title=\"$t('schedule.show_assigned')\"\n            @click=\"assignments.assigned = !assignments.assigned\"\n            v-if=\"!assignments.item\"\n          />\n        </div>\n        <div class=\"mt2\" v-if=\"assignments.loading\">\n          <spinner class=\"mauto\" :size=\"20\" />\n        </div>\n        <ul class=\"assignments mt1\" v-else-if=\"!assignments.item\">\n          <li\n            :key=\"entityType.id\"\n            v-for=\"entityType in assignments.entityTypes\"\n          >\n            <div\n              class=\"assignment-item\"\n              draggable=\"true\"\n              @dragstart=\"\n                onAssignmentItemDragStart($event, entityType, selectedTaskType)\n              \"\n            >\n              <grip-vertical-icon class=\"icon\" />\n              <span class=\"name\">\n                {{ entityType.name }}\n                ({{ filteredAssignments(entityType.children).length }})\n              </span>\n              <span\n                class=\"expand\"\n                @click=\"entityType.expanded = !entityType.expanded\"\n              >\n                <chevron-right-icon v-if=\"!entityType.expanded\" />\n                <chevron-down-icon v-else />\n              </span>\n            </div>\n            <ul class=\"assignments\" v-if=\"entityType.expanded\">\n              <li\n                :key=\"child.id\"\n                v-for=\"child in filteredAssignments(entityType.children)\"\n              >\n                <div\n                  class=\"assignment-item\"\n                  draggable=\"true\"\n                  @dragstart=\"\n                    onAssignmentItemDragStart(\n                      $event,\n                      { ...entityType, children: [child] },\n                      selectedTaskType\n                    )\n                  \"\n                >\n                  <grip-vertical-icon class=\"icon\" />\n                  <span class=\"name\">{{ child.name }}</span>\n                </div>\n              </li>\n            </ul>\n          </li>\n        </ul>\n        <div class=\"assignments mt1\" v-else>\n          <form class=\"mt1\" @submit.prevent=\"saveAssignments()\">\n            <div class=\"flexrow\">\n              <div class=\"flexrow-item\">\n                <date-field\n                  :can-delete=\"false\"\n                  :label=\"$t('main.start_date')\"\n                  utc\n                  v-model=\"assignments.startDate\"\n                />\n              </div>\n              <div class=\"flexrow-item\">\n                <date-field\n                  :can-delete=\"false\"\n                  :label=\"$t('main.end_date')\"\n                  utc\n                  v-model=\"assignments.endDate\"\n                />\n              </div>\n            </div>\n            <div :key=\"item.id\" v-for=\"item in draggedEntities\">\n              <div\n                class=\"dragged-type\"\n                :style=\"{\n                  background: selectedTaskType.color\n                }\"\n              >\n                {{ item.name }}\n              </div>\n              <div v-if=\"!item.children.length\">\n                {{ $t('schedule.no_entity') }}\n              </div>\n              <ul class=\"dragged-items\" v-else>\n                <li\n                  class=\"dragged-item\"\n                  :key=\"child.id\"\n                  :style=\"{\n                    background: `color-mix(in srgb, ${selectedTaskType.color} 40%, transparent)`,\n                    'border-left': `4px solid ${selectedTaskType.color}`\n                  }\"\n                  v-for=\"child in item.children\"\n                >\n                  {{ item.name }} / {{ child.name }}\n                </li>\n              </ul>\n              <hr />\n            </div>\n            <table class=\"assignees\">\n              <thead>\n                <tr>\n                  <td>\n                    {{ $t('schedule.assign') }}\n                    <a\n                      class=\"reset-assignees\"\n                      :title=\"$t('schedule.reset_list')\"\n                      @click=\"assignments.excludes = []\"\n                      v-if=\"assignments.excludes.length\"\n                    >\n                      <list-restart-icon\n                        class=\"align-middle\"\n                        :size=\"18\"\n                        :stroke-width=\"1.5\"\n                      />\n                    </a>\n                  </td>\n                </tr>\n              </thead>\n              <tbody v-if=\"!availablePersons.length\">\n                <tr>\n                  <td class=\"has-text-centered\">\n                    {{ $t('schedule.no_assignee') }}\n                  </td>\n                </tr>\n              </tbody>\n              <tbody v-else>\n                <tr :key=\"person.id\" v-for=\"person in availablePersons\">\n                  <td class=\"assignee\">\n                    <div class=\"person\">\n                      <people-avatar\n                        :is-link=\"false\"\n                        :font-size=\"14\"\n                        :person=\"person\"\n                        :size=\"28\"\n                      />\n                      <people-name :person=\"person\" />\n                    </div>\n                    <button-simple\n                      class=\"is-small\"\n                      icon=\"minus\"\n                      :title=\"\n                        $t('main.avatar.unassign', {\n                          personName: person.name\n                        })\n                      \"\n                      type=\"button\"\n                      @click=\"removeFromAssignments(person)\"\n                    />\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n            <checkbox\n              class=\"pa05\"\n              :disabled=\"!availablePersons.length\"\n              :label=\"$t('schedule.force_unassign')\"\n              :toggle=\"true\"\n              v-model=\"assignments.unassign\"\n            />\n            <div class=\"flexrow mt2\">\n              <label class=\"mr05\">\n                {{ $t('schedule.forced_daily_quotas') }}\n              </label>\n              <text-field\n                class=\"mb0 daily-quotas\"\n                input-class=\" is-small\"\n                :step=\"0.01\"\n                type=\"number\"\n                v-model=\"assignments.forcedDailyQuota\"\n              />\n              <a\n                class=\"reset-quotas ml05\"\n                @click=\"assignments.forcedDailyQuota = null\"\n                v-if=\"assignments.forcedDailyQuota\"\n              >\n                <trash-icon class=\"align-middle\" :size=\"14\" />\n              </a>\n            </div>\n            <div class=\"mt2\">\n              {{ $t('schedule.estimated_daily_quotas') }}\n              {{ estimatedDailyQuota.toFixed(2) }}\n            </div>\n            <div class=\"mt2 has-text-right\">\n              <button-simple\n                class=\"mr1\"\n                :disabled=\"assignments.saving\"\n                :text=\"$t('main.cancel')\"\n                type=\"button\"\n                @click=\"assignments.item = null\"\n              />\n              <button-simple\n                :disabled=\"!hasDraggedEntities || !availablePersons.length\"\n                icon=\"user-check\"\n                :is-loading=\"assignments.saving\"\n                :text=\"$t('main.apply')\"\n                type=\"submit\"\n              />\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n/*\n * Page to manage the schedule of the big steps of the production. It allows\n * to set milestones too.\n */\n\nimport {\n  ChevronDownIcon,\n  ChevronRightIcon,\n  GripVerticalIcon,\n  ListRestartIcon,\n  TrashIcon,\n  XIcon\n} from 'lucide-vue-next'\nimport moment from 'moment-timezone'\nimport { mapGetters, mapActions } from 'vuex'\n\nimport { getTaskTypeSchedulePath } from '@/lib/path'\nimport {\n  sortByName,\n  sortPeople,\n  sortTaskTypeScheduleItems\n} from '@/lib/sorting'\nimport {\n  addBusinessDays,\n  daysToMinutes,\n  getBusinessDays,\n  getDatesFromStartDate,\n  minutesToDays,\n  parseDate,\n  parseSimpleDate\n} from '@/lib/time'\n\nimport ButtonSimple from '@/components/widgets/ButtonSimple.vue'\nimport Checkbox from '@/components/widgets/Checkbox.vue'\nimport ComboboxNumber from '@/components/widgets/ComboboxNumber.vue'\nimport DateField from '@/components/widgets/DateField.vue'\nimport PeopleAvatar from '@/components/widgets/PeopleAvatar.vue'\nimport PeopleName from '@/components/widgets/PeopleName.vue'\nimport Schedule from '@/components/widgets/Schedule.vue'\nimport Spinner from '@/components/widgets/Spinner.vue'\nimport TaskTypeName from '@/components/widgets/TaskTypeName.vue'\nimport TextField from '@/components/widgets/TextField.vue'\n\nimport assetStore from '@/store/modules/assets'\nimport assetTypeStore from '@/store/modules/assettypes'\nimport shotStore from '@/store/modules/shots'\nimport taskTypeStore from '@/store/modules/tasktypes'\n\nexport default {\n  name: 'production-schedule',\n\n  components: {\n    ButtonSimple,\n    Checkbox,\n    ChevronDownIcon,\n    ChevronRightIcon,\n    ComboboxNumber,\n    DateField,\n    GripVerticalIcon,\n    ListRestartIcon,\n    PeopleAvatar,\n    PeopleName,\n    Schedule,\n    Spinner,\n    TrashIcon,\n    TaskTypeName,\n    TextField,\n    XIcon\n  },\n\n  data() {\n    return {\n      assignments: {\n        assigned: false,\n        entityTypes: null,\n        excludes: [],\n        forcedDailyQuota: null,\n        item: null,\n        loading: false,\n        saving: false,\n        startDate: null,\n        endDate: null,\n        unassign: false\n      },\n      daysOffByPerson: [],\n      draggedEntities: [],\n      endDate: moment().add(6, 'months').endOf('day'),\n      scheduleItems: [],\n      startDate: moment().startOf('day'),\n      selectedStartDate: null,\n      selectedEndDate: null,\n      selectedTaskType: null,\n      zoomLevel: 1,\n      zoomOptions: [\n        { label: this.$t('main.week'), value: 0 },\n        { label: '1', value: 1 },\n        { label: '2', value: 2 },\n        { label: '3', value: 3 }\n      ],\n      loading: {\n        schedule: false\n      },\n      errors: {\n        schedule: false\n      }\n    }\n  },\n\n  mounted() {\n    this.reset()\n  },\n\n  computed: {\n    ...mapGetters([\n      'currentEpisode',\n      'currentProduction',\n      'isCurrentUserManager',\n      'isCurrentUserSupervisor',\n      'isTVShow',\n      'organisation',\n      'personMap',\n      'productionAssetTypes',\n      'user'\n    ]),\n\n    estimatedDailyQuota() {\n      const startDate = parseSimpleDate(this.assignments.startDate)\n      const endDate = parseSimpleDate(this.assignments.endDate)\n      const nbDays = getBusinessDays(startDate, endDate)\n      const nbEntities = this.draggedEntities.reduce(\n        (sum, entity) => sum + (entity.children?.length ?? 0),\n        0\n      )\n      const nbAssignees = this.availablePersons.length\n\n      return nbDays && nbAssignees ? nbEntities / nbDays / nbAssignees : 0\n    },\n\n    assetMap() {\n      return assetStore.cache.assetMap\n    },\n\n    assets() {\n      return assetStore.cache.assets\n    },\n\n    assetTypeMap() {\n      return assetTypeStore.cache.assetTypeMap\n    },\n\n    availablePersons() {\n      const taskType = this.taskTypeMap.get(this.selectedTaskType.task_type_id)\n      return this.team.filter(\n        person =>\n          !this.assignments.excludes.includes(person.id) &&\n          person.role !== 'client' &&\n          (!person.departments.length ||\n            person.departments.includes(taskType?.department_id))\n      )\n    },\n\n    hasDraggedEntities() {\n      return this.draggedEntities.some(entity => entity.children.length)\n    },\n\n    shotMap() {\n      return shotStore.cache.shotMap\n    },\n\n    shots() {\n      return shotStore.cache.shots\n    },\n\n    taskTypeMap() {\n      return taskTypeStore.cache.taskTypeMap\n    },\n\n    team() {\n      return sortPeople(\n        this.currentProduction.team\n          .map(personId => this.personMap.get(personId))\n          .filter(person => person && !person.is_bot)\n      )\n    }\n  },\n\n  methods: {\n    ...mapActions([\n      'assignSelectedTasks',\n      'editProduction',\n      'loadAggregatedPersonDaysOff',\n      'loadAssets',\n      'loadAssetTypeScheduleItems',\n      'loadEpisodeScheduleItems',\n      'loadScheduleItems',\n      'loadSequenceScheduleItems',\n      'loadShots',\n      'loadTasks',\n      'saveScheduleItem',\n      'unassignSelectedTasks',\n      'updateTask'\n    ]),\n\n    loadData() {\n      this.loading.schedule = true\n      this.loadScheduleItems(this.currentProduction)\n        .then(scheduleItems => {\n          const scheduleStartDate = parseDate(this.selectedStartDate)\n          const scheduleEndDate = parseDate(this.selectedEndDate)\n          scheduleItems = scheduleItems.map(item => {\n            const taskType = this.taskTypeMap.get(item.task_type_id)\n            let startDate, endDate\n            if (item.start_date) {\n              startDate = parseDate(item.start_date)\n            } else {\n              startDate = moment()\n            }\n            if (startDate.isSameOrAfter(scheduleEndDate)) {\n              startDate = scheduleEndDate.clone().add(-1, 'days')\n            }\n\n            if (startDate.isBefore(scheduleStartDate)) {\n              startDate = scheduleStartDate.clone()\n            }\n\n            if (item.end_date) {\n              endDate = parseDate(item.end_date)\n            } else {\n              endDate = startDate.clone().add(1, 'days')\n            }\n            if (endDate.isSameOrAfter(scheduleEndDate)) {\n              endDate = scheduleEndDate.clone()\n            }\n\n            const path = getTaskTypeSchedulePath(\n              taskType.id,\n              this.currentProduction.id,\n              this.currentEpisode ? this.currentEpisode.id : null,\n              taskType.for_entity\n            )\n\n            return {\n              ...item,\n              color: taskType.color,\n              for_entity: taskType.for_entity,\n              name: `${taskType.for_entity} / ${taskType.name}`,\n              priority: taskType.priority,\n              startDate,\n              endDate,\n              editable: this.isInDepartment(taskType),\n              expanded: false,\n              loading: false,\n              route:\n                taskType.for_entity === 'Shot' && this.isTVShow ? null : path,\n              children: []\n            }\n          })\n          this.scheduleItems = sortTaskTypeScheduleItems(\n            scheduleItems,\n            this.currentProduction,\n            this.taskTypeMap\n          )\n          this.loading.schedule = false\n        })\n        .catch(err => {\n          console.error(err)\n          this.loading.schedule = false\n        })\n    },\n\n    reset() {\n      this.closeSidePanel()\n\n      if (this.currentProduction.start_date) {\n        this.startDate = parseDate(this.currentProduction.start_date)\n      }\n      if (this.currentProduction.end_date) {\n        this.endDate = parseDate(this.currentProduction.end_date)\n      }\n      this.selectedStartDate = this.startDate.toDate()\n      this.selectedEndDate = this.endDate.toDate()\n      this.loadData()\n    },\n\n    convertScheduleItems(taskTypeElement, scheduleItems) {\n      return scheduleItems.map(item => {\n        let startDate\n        if (item.start_date) {\n          startDate = parseDate(item.start_date)\n        } else {\n          startDate = moment()\n        }\n        if (startDate.isBefore(this.startDate)) {\n          startDate = this.startDate.clone()\n        }\n        if (startDate.isAfter(this.endDate)) {\n          startDate = this.endDate.clone()\n        }\n        let endDate\n        if (item.end_date) {\n          endDate = parseDate(item.end_date)\n        } else {\n          endDate = startDate.clone().add(1, 'days')\n        }\n        if (endDate.isBefore(startDate)) {\n          endDate = startDate.clone().add(1, 'days')\n        }\n        if (endDate.isAfter(this.endDate)) {\n          endDate = this.endDate.clone()\n        }\n        const scheduleItem = {\n          ...item,\n          startDate,\n          endDate,\n          expanded: false,\n          loading: false,\n          editable: this.isInDepartment(\n            this.taskTypeMap.get(item.task_type_id)\n          ),\n          children: [],\n          parentElement: taskTypeElement\n        }\n        if (this.isTVShow) {\n          scheduleItem.route = getTaskTypeSchedulePath(\n            item.task_type_id,\n            this.currentProduction.id,\n            item.object_id,\n            taskTypeElement.for_entity\n          )\n        }\n        return scheduleItem\n      })\n    },\n\n    async expandTaskTypeElement(\n      taskTypeElement,\n      refreshScheduleCallBack = null,\n      expanded = false,\n      resetAssignments = true\n    ) {\n      taskTypeElement.expanded = expanded || !taskTypeElement.expanded\n\n      if (taskTypeElement.expanded) {\n        try {\n          taskTypeElement.loading = true\n\n          this.selectedTaskType = taskTypeElement\n          this.assignments.loading = resetAssignments\n\n          taskTypeElement.children = []\n          taskTypeElement.people = {}\n          taskTypeElement.entitiesByType = {}\n\n          const loadScheduleItems = this.isTVShow\n            ? ['Asset', 'Shot'].includes(taskTypeElement.for_entity)\n              ? this.loadEpisodeScheduleItems\n              : this.loadSequenceScheduleItems\n            : taskTypeElement.for_entity === 'Shot'\n              ? this.loadSequenceScheduleItems\n              : this.loadAssetTypeScheduleItems\n          const parameters = {\n            production: this.currentProduction,\n            taskType: this.taskTypeMap.get(taskTypeElement.task_type_id)\n          }\n          const scheduleItems = await loadScheduleItems(parameters)\n\n          let children = this.convertScheduleItems(\n            taskTypeElement,\n            scheduleItems\n          )\n          const childrenById = new Map(\n            children.map(child => [child.object_id, child])\n          )\n\n          if (this.isTVShow) {\n            taskTypeElement.children = children\n          } else {\n            // load entities\n            if (taskTypeElement.for_entity === 'Asset') {\n              await this.loadAssets({ withShared: false, withTasks: false })\n            }\n            if (taskTypeElement.for_entity === 'Shot') {\n              await this.loadShots()\n            }\n\n            const tasks = await this.loadTasks({\n              project_id: this.currentProduction.id,\n              task_type_id: taskTypeElement.task_type_id,\n              relations: 'true'\n            })\n\n            // load days off of assignees\n            const personIds = [\n              ...new Set(tasks.flatMap(task => task.assignees))\n            ]\n            await this.loadDaysOff(personIds)\n\n            // group tasks by entity type and assignee\n            const tasksByType = {}\n            const people = {}\n            tasks.forEach(task => {\n              if (!task.start_date) {\n                return\n              }\n\n              // link entity to task\n              if (taskTypeElement.for_entity === 'Asset') {\n                task.entity = this.assetMap.get(task.entity_id)\n                task.entity_type_id = task.entity.asset_type_id\n              } else if (taskTypeElement.for_entity === 'Shot') {\n                task.entity = this.shotMap.get(task.entity_id)\n                task.entity_type_id = task.entity.sequence_id\n              } else {\n                task.entity_type_id = taskTypeElement.for_entity\n              }\n              if (task.entity?.canceled) {\n                return\n              }\n\n              if (!tasksByType[task.entity_type_id]) {\n                tasksByType[task.entity_type_id] = {}\n              }\n\n              if (!task.assignees.length) {\n                task.assignees = ['unassigned']\n              }\n\n              task.assignees.forEach(assigneeId => {\n                const entityTypeItem = childrenById.get(task.entity_type_id)\n\n                // populate task with start and end dates\n                const startDate = parseDate(task.start_date)\n                if (startDate.isAfter(this.endDate)) {\n                  return\n                }\n                if (startDate.isBefore(entityTypeItem.startDate)) {\n                  entityTypeItem.startDate = startDate.clone()\n                }\n                task.startDate = startDate\n\n                let endDate\n                if (task.due_date) {\n                  endDate = parseDate(task.due_date)\n                } else if (task.end_date) {\n                  endDate = parseDate(task.end_date)\n                } else if (task.estimation) {\n                  endDate = addBusinessDays(\n                    task.startDate,\n                    Math.ceil(\n                      minutesToDays(this.organisation, task.estimation)\n                    ) - 1,\n                    this.daysOffByPerson[assigneeId]\n                  )\n                }\n                if (!endDate || endDate.isBefore(startDate)) {\n                  const nbDays = startDate.isoWeekday() === 5 ? 3 : 1\n                  endDate = startDate.clone().add(nbDays, 'days')\n                }\n                if (!endDate.isSameOrAfter(startDate)) {\n                  const nbDays = startDate.isoWeekday() === 5 ? 3 : 1\n                  endDate = startDate.clone().add(nbDays, 'days')\n                }\n                if (endDate.isBefore(this.startDate)) {\n                  return\n                }\n                if (endDate.isAfter(entityTypeItem.endDate)) {\n                  entityTypeItem.endDate = endDate.clone()\n                }\n                task.endDate = endDate\n\n                if (!tasksByType[task.entity_type_id][assigneeId]) {\n                  tasksByType[task.entity_type_id][assigneeId] = []\n                  people[assigneeId] =\n                    assigneeId !== 'unassigned'\n                      ? {\n                          ...this.personMap.get(assigneeId),\n                          daysOff: this.daysOffByPerson[assigneeId]\n                        }\n                      : {\n                          id: assigneeId,\n                          avatar: false,\n                          color: '#888',\n                          full_name: this.$t('main.unassigned')\n                        }\n                }\n\n                task.editable = true\n                task.unresizable = false\n                task.parentElement = entityTypeItem\n\n                tasksByType[task.entity_type_id][assigneeId].push(task)\n              })\n            })\n\n            if (taskTypeElement.for_entity === 'Asset') {\n              // filtering following custom asset types workflow\n              children = children.filter(item => {\n                const assetType = this.assetTypeMap.get(item.object_id)\n                return (\n                  assetType &&\n                  (!assetType.task_types.length ||\n                    assetType.task_types.includes(taskTypeElement.task_type_id))\n                )\n              })\n            }\n\n            // sort grouped tasks\n            const sortEntitiesByUserName = ([keyA], [keyB]) => {\n              if (keyA === 'unassigned') return 1\n              if (keyB === 'unassigned') return -1\n              return people[keyA].full_name.localeCompare(\n                people[keyB].full_name\n              )\n            }\n            const sortTasksByEntityName = (a, b) =>\n              a.entity?.name.localeCompare(b.entity?.name, undefined, {\n                numeric: true\n              })\n            children.forEach(child => {\n              const items = tasksByType[child.object_id] || {}\n              const sortedChildren = new Map(\n                Object.entries(items)\n                  .sort(sortEntitiesByUserName)\n                  .map(([key, tasks]) => [\n                    key,\n                    tasks.sort(sortTasksByEntityName)\n                  ])\n              )\n\n              child.children = sortedChildren\n            })\n\n            taskTypeElement.children = sortByName(children)\n            taskTypeElement.people = people\n\n            // group all assigned entities by type\n            taskTypeElement.entitiesByType = Object.fromEntries(\n              Object.entries(tasksByType).map(([entityTypeId, byAssignee]) => [\n                entityTypeId,\n                Object.entries(byAssignee)\n                  .flatMap(([assignee, items]) =>\n                    assignee !== 'unassigned'\n                      ? items.map(item => item.entity_id)\n                      : undefined\n                  )\n                  .filter(Boolean)\n              ])\n            )\n          }\n        } catch (err) {\n          console.error(err)\n          taskTypeElement.children = []\n          taskTypeElement.people = []\n        } finally {\n          taskTypeElement.loading = false\n        }\n\n        if (refreshScheduleCallBack) {\n          refreshScheduleCallBack(taskTypeElement)\n        }\n\n        this.selectTaskTypeElement(taskTypeElement, null, resetAssignments)\n      }\n    },\n\n    async loadDaysOff(personIds) {\n      this.daysOffByPerson = []\n      for (const personId of personIds) {\n        // load sequentially to avoid too many requests\n        const daysOff = await this.loadAggregatedPersonDaysOff({\n          personId\n        }).catch(\n          () => [] // fallback if not allowed to fetch days off\n        )\n        this.daysOffByPerson[personId] = daysOff\n      }\n    },\n\n    filteredAssignments(items) {\n      return this.assignments.assigned\n        ? items\n        : items.filter(item => !item.assigned)\n    },\n\n    saveTaskChanged(task) {\n      return this.updateTask({\n        taskId: task.id,\n        data: {\n          estimation: task.estimation,\n          start_date: task.startDate.format('YYYY-MM-DD'),\n          due_date: task.endDate.format('YYYY-MM-DD')\n        }\n      })\n    },\n\n    onScheduleItemChanged(item) {\n      if (item.type === 'Task') {\n        // update dates with weekends and days off\n        const daysOff = item.assignees\n          .flatMap(assigneeId => this.daysOffByPerson[assigneeId])\n          .filter(Boolean)\n        item.startDate = addBusinessDays(item.startDate, 0, daysOff)\n        item.endDate = addBusinessDays(\n          item.startDate,\n          Math.ceil(minutesToDays(this.organisation, item.estimation)) - 1,\n          daysOff\n        )\n        // update parents\n        if (item.startDate.isBefore(item.parentElement.startDate)) {\n          item.parentElement.startDate = item.startDate.clone()\n          this.updateScheduleItem(item.parentElement)\n          if (\n            item.parentElement.startDate.isBefore(\n              item.parentElement.parentElement.startDate\n            )\n          ) {\n            item.parentElement.parentElement.startDate =\n              item.parentElement.startDate.clone()\n            this.updateScheduleItem(item.parentElement.parentElement)\n          }\n        }\n        if (item.endDate.isAfter(item.parentElement.endDate)) {\n          item.parentElement.endDate = item.endDate.clone()\n          this.updateScheduleItem(item.parentElement)\n          if (\n            item.parentElement.endDate.isAfter(\n              item.parentElement.parentElement.endDate\n            )\n          ) {\n            item.parentElement.parentElement.endDate =\n              item.parentElement.endDate.clone()\n            this.updateScheduleItem(item.parentElement.parentElement)\n          }\n        }\n        this.saveTaskChanged(item)\n        return\n      }\n\n      if (item.startDate && item.endDate && item.parentElement) {\n        item.parentElement.startDate = this.getMinDate(item.parentElement)\n        item.parentElement.endDate = this.getMaxDate(item.parentElement)\n        this.saveScheduleItem(item.parentElement)\n      } else if (!item.parentElement) {\n        const minDate = this.getMinDate(item)\n        const maxDate = this.getMaxDate(item)\n        if (item.startDate.isAfter(minDate)) {\n          item.startDate = minDate\n        }\n        if (item.endDate.isBefore(maxDate)) {\n          item.endDate = maxDate\n        }\n      }\n\n      this.updateScheduleItem(item)\n    },\n\n    updateScheduleItem(item) {\n      const scheduleItem = this.scheduleItems.find(\n        scheduleItem => scheduleItem === item\n      )\n      if (scheduleItem) {\n        scheduleItem.startDate = item.startDate\n        scheduleItem.start_date = item.startDate.format('YYYY-MM-DD')\n        scheduleItem.endDate = item.endDate\n        scheduleItem.end_date = item.endDate.format('YYYY-MM-DD')\n      }\n      this.saveScheduleItem(item)\n    },\n\n    getMinDate(parentElement) {\n      let minDate = this.endDate.clone()\n      parentElement.children.forEach(item => {\n        if (item.startDate && item.startDate.isBefore(minDate)) {\n          minDate = item.startDate\n        }\n      })\n      return minDate.clone()\n    },\n\n    getMaxDate(parentElement) {\n      let maxDate = this.startDate.clone()\n      parentElement.children.forEach(item => {\n        if (item.endDate && item.endDate.isAfter(maxDate)) {\n          maxDate = item.endDate\n        }\n      })\n      return maxDate.clone()\n    },\n\n    isInDepartment(taskType) {\n      if (this.isCurrentUserManager) {\n        return true\n      } else if (this.isCurrentUserSupervisor) {\n        if (this.user.departments.length === 0) {\n          return true\n        } else {\n          return (\n            taskType.department_id &&\n            this.user.departments.includes(taskType.department_id)\n          )\n        }\n      } else {\n        return false\n      }\n    },\n\n    scrollScheduleToToday() {\n      this.$refs.schedule?.scrollToToday()\n    },\n\n    resetSidePanel() {\n      this.assignments = {\n        ...this.assignments,\n        entityTypes: null,\n        excludes: [],\n        forcedDailyQuota: null,\n        item: null,\n        loading: false,\n        saving: false,\n        startDate: null,\n        endDate: null,\n        unassign: false\n      }\n    },\n\n    selectParentElement(element) {\n      if (!element.expanded) {\n        this.expandTaskTypeElement(element, () => {\n          this.$refs.schedule?.refreshItemPositions(element)\n        })\n      } else {\n        this.selectTaskTypeElement(element)\n      }\n    },\n\n    async selectTaskTypeElement(\n      taskType,\n      selectedEntityType = undefined,\n      resetAssignments = true\n    ) {\n      this.selectedTaskType = taskType\n\n      if (resetAssignments) {\n        this.resetSidePanel()\n      }\n\n      this.assignments.loading = true\n\n      // load tasks\n      const tasks = await this.loadTasks({\n        project_id: this.currentProduction.id,\n        task_type_id: this.selectedTaskType.task_type_id,\n        relations: 'true'\n      })\n\n      // load entity types\n      if (taskType.for_entity === 'Asset') {\n        await this.loadAssets({ withShared: false, withTasks: false })\n\n        this.assignments.entityTypes = this.productionAssetTypes\n          .filter(assetType => {\n            // filtering following custom asset types workflow\n            return (\n              !assetType.task_types.length ||\n              assetType.task_types.includes(taskType.task_type_id)\n            )\n          })\n          .map((assetType, index) => {\n            return {\n              id: assetType.id,\n              name: assetType.name,\n              for_entity: taskType.for_entity,\n              expanded: assetType.id === selectedEntityType?.object_id,\n              entity_type_id: assetType.id,\n              children: this.assets\n                .filter(\n                  asset =>\n                    asset.asset_type_id === assetType.id &&\n                    !asset.canceled &&\n                    !asset.shared &&\n                    tasks.some(task => task.entity_id === asset.id)\n                )\n                .map(asset => ({\n                  ...asset,\n                  assigned: taskType.entitiesByType[assetType.id]?.includes(\n                    asset.id\n                  )\n                }))\n            }\n          })\n      } else if (taskType.for_entity === 'Shot') {\n        await this.loadShots()\n\n        const shotsBySequence = this.shots\n          .filter(shot => tasks.some(task => task.entity_id === shot.id))\n          .reduce((acc, shot) => {\n            if (!acc[shot.parent_id]) {\n              acc[shot.parent_id] = []\n            }\n            shot.assigned = taskType.entitiesByType[shot.parent_id]?.includes(\n              shot.id\n            )\n            acc[shot.parent_id].push(shot)\n            return acc\n          }, {})\n\n        this.assignments.entityTypes = Object.keys(shotsBySequence).map(\n          sequenceId => {\n            const shots = shotsBySequence[sequenceId]\n            return {\n              id: sequenceId,\n              name: shots[0].sequence_name,\n              for_entity: taskType.for_entity,\n              expanded: sequenceId === selectedEntityType?.object_id,\n              children: shots\n            }\n          }\n        )\n      }\n      this.assignments.loading = false\n    },\n\n    closeSidePanel() {\n      this.selectedTaskType = undefined\n      this.resetSidePanel()\n    },\n\n    onAssignmentItemDragStart(event, item, type) {\n      event.stopPropagation()\n      event.dataTransfer.dropEffect = 'move'\n      event.dataTransfer.effectAllowed = 'move'\n      event.dataTransfer.setData(`task-type-${type.task_type_id}`, true) // use for hack on drag over (must be lowercase)\n      event.dataTransfer.setData('taskTypeId', type.task_type_id)\n      event.dataTransfer.setData('entityId', item.id)\n\n      item.children = this.filteredAssignments(item.children)\n      this.draggedEntities = [item]\n    },\n\n    onScheduleItemDropped(event, item) {\n      this.assignments.item = item\n      const start_date = event.start_date || item.start_date\n      const end_date = parseDate(start_date).isAfter(item.end_date)\n        ? start_date\n        : item.end_date\n      this.assignments.startDate = start_date\n      this.assignments.endDate = end_date\n    },\n\n    removeFromAssignments(person) {\n      this.assignments.excludes.push(person.id)\n    },\n\n    async saveAssignments() {\n      this.assignments.saving = true\n\n      // load tasks\n      const tasks = await this.loadTasks({\n        project_id: this.currentProduction.id,\n        task_type_id: this.selectedTaskType.task_type_id,\n        relations: 'true'\n      })\n\n      const dailyQuota =\n        this.assignments.forcedDailyQuota ?? this.estimatedDailyQuota\n      const taskEstimation = 1 / dailyQuota\n\n      // assign each selected entity to each selected assignee\n      for (const taskType of this.draggedEntities) {\n        const startDate = parseDate(this.assignments.startDate)\n        const endDate = parseDate(this.assignments.endDate)\n\n        let cumulatedTasks = 0\n        let nextAssigneeIndex = 0\n        let nextStartDate = startDate.clone()\n\n        // distribute the task assignments according to the daily quotas, the task type duration and people's availability.\n        for (const entity of taskType.children) {\n          const task = tasks.find(task => task.entity_id === entity.id)\n          if (!task) {\n            continue // no task found for this entity\n          }\n\n          if (this.assignments.unassign) {\n            await this.unassignSelectedTasks({ taskIds: [task.id] })\n          }\n\n          cumulatedTasks++\n\n          let taskStartDate = nextStartDate\n          let taskEndDate = null\n          let taskAssignee = null\n          while (nextAssigneeIndex < this.availablePersons.length) {\n            taskAssignee = this.availablePersons[nextAssigneeIndex]\n\n            taskStartDate = addBusinessDays(\n              taskStartDate,\n              0,\n              this.daysOffByPerson[taskAssignee.id]\n            )\n\n            const { due_date } = getDatesFromStartDate(\n              this.organisation,\n              startDate,\n              taskEndDate,\n              cumulatedTasks * taskEstimation,\n              this.daysOffByPerson[taskAssignee.id]\n            )\n            taskEndDate = parseDate(due_date)\n\n            if (taskEndDate.isAfter(endDate)) {\n              // try to assign the task to the next available person\n              nextAssigneeIndex++\n              cumulatedTasks = 1\n              taskStartDate = startDate.clone()\n              taskEndDate = null\n            } else {\n              await Promise.all([\n                // assign task to the current assignee\n                this.assignSelectedTasks({\n                  personId: taskAssignee.id,\n                  taskIds: [task.id]\n                }),\n                // save task dates & estimation\n                this.updateTask({\n                  taskId: task.id,\n                  data: {\n                    estimation: daysToMinutes(\n                      this.organisation,\n                      taskEstimation\n                    ),\n                    start_date: taskStartDate.format('YYYY-MM-DD'),\n                    due_date: taskEndDate.format('YYYY-MM-DD')\n                  }\n                })\n              ])\n              // set next start date\n              if ((cumulatedTasks * taskEstimation) % 1 !== 0) {\n                nextStartDate = taskEndDate.clone()\n              } else {\n                nextStartDate = taskEndDate.clone().add(1, 'days')\n              }\n              break // jump to next task\n            }\n          }\n        }\n\n        // refresh schedule\n        this.expandTaskTypeElement(\n          this.selectedTaskType,\n          () => {\n            this.$refs.schedule?.refreshItemPositions(this.selectedTaskType)\n          },\n          true,\n          false\n        )\n      }\n\n      this.assignments.saving = false\n    }\n  },\n\n  watch: {\n    selectedStartDate() {\n      this.startDate = parseDate(this.selectedStartDate)\n      const start_date = this.startDate.format('YYYY-MM-DD')\n      if (\n        this.currentProduction.start_date &&\n        this.currentProduction.start_date !== start_date\n      ) {\n        this.editProduction({\n          ...this.currentProduction,\n          start_date\n        })\n      }\n    },\n\n    selectedEndDate() {\n      this.endDate = parseDate(this.selectedEndDate)\n      const end_date = this.endDate.format('YYYY-MM-DD')\n      if (\n        this.currentProduction.end_date &&\n        this.currentProduction.end_date !== end_date\n      ) {\n        this.editProduction({\n          ...this.currentProduction,\n          end_date\n        })\n      }\n    },\n\n    currentProduction() {\n      this.reset()\n    }\n  },\n\n  head() {\n    return {\n      title:\n        `${this.currentProduction.name} ` +\n        `| ${this.$t('schedule.title')} - Kitsu`\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dark {\n  .project-dates {\n    color: $white-grey;\n    border-bottom: 1px solid $grey;\n  }\n}\n\n.project-dates {\n  border-bottom: 1px solid #eee;\n  padding-bottom: 1em;\n\n  .field {\n    padding-bottom: 0;\n    margin-bottom: 0;\n  }\n}\n\n.fixed-page {\n  padding: 1em;\n  padding-top: 90px;\n  padding-left: 2em;\n}\n\n.main-column {\n  display: flex;\n  border: 0;\n  overflow: hidden;\n  flex-direction: column;\n}\n\n.zoom-level {\n  margin-top: -10px;\n}\n\n.ml2 {\n  margin-left: 2em;\n}\n\n.side-column {\n  position: relative;\n  top: -30px;\n  right: -14px;\n  height: calc(100% + 44px);\n  margin-top: 0;\n  padding: 0 1em 1em 1em;\n  background: var(--background-alt);\n  min-height: 100%;\n\n  .close-button {\n    position: absolute;\n    right: 1em;\n  }\n\n  .details {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n  }\n}\n\n.assignments {\n  list-style-type: none;\n  margin-left: 0;\n\n  .assignments {\n    margin-left: 2em;\n  }\n\n  .assignment-item {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: var(--background-selectable);\n    border: 1px solid $grey;\n    margin-top: -1px;\n    padding: 1em 1em 1em 0.5em;\n    cursor: grab;\n\n    .icon {\n      color: $grey;\n      margin-right: 0.5em;\n    }\n\n    .name {\n      flex: 1;\n    }\n\n    .expand {\n      cursor: pointer;\n      opacity: 0.5;\n      height: 24px;\n\n      &:hover {\n        opacity: 1;\n      }\n    }\n  }\n\n  li:nth-child(even) .assignment-item {\n    background: color-mix(in srgb, var(--background-selectable) 70%, white 30%);\n  }\n\n  .dragged-type {\n    font-size: 12px;\n    font-weight: 600;\n    padding: 5px;\n    margin-bottom: 1em;\n    border-radius: 0.2em;\n    text-align: center;\n  }\n\n  .dragged-items {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.5em;\n    list-style: none;\n    margin: 0;\n  }\n\n  .dragged-item {\n    padding: 0 0.7em;\n    border-radius: 0.2em;\n  }\n\n  .assignees {\n    .reset-assignees {\n      position: absolute;\n      right: 1.5em;\n      opacity: 0.5;\n\n      &:hover {\n        opacity: 1;\n      }\n    }\n    td {\n      padding: 0.5em;\n    }\n    tbody {\n      background: var(--background);\n\n      tr {\n        border: 1px solid var(--border);\n      }\n    }\n    .assignee {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n    .person {\n      display: flex;\n      align-items: center;\n      gap: 10px;\n    }\n  }\n\n  .daily-quotas {\n    width: 50px;\n  }\n  .reset-quotas {\n    opacity: 0.5;\n\n    &:hover {\n      opacity: 1;\n    }\n  }\n}\n</style>\n"],"names":["GripVertical","createLucideIcon","ListRestart","_sfc_main","ButtonSimple","Checkbox","ChevronDownIcon","ChevronRightIcon","ComboboxNumber","DateField","GripVerticalIcon","ListRestartIcon","PeopleAvatar","PeopleName","Schedule","Spinner","TrashIcon","TaskTypeName","TextField","XIcon","moment","mapGetters","startDate","parseSimpleDate","endDate","nbDays","getBusinessDays","nbEntities","sum","entity","_a","nbAssignees","assetStore","assetTypeStore","taskType","person","shotStore","taskTypeStore","sortPeople","personId","mapActions","scheduleItems","scheduleStartDate","parseDate","scheduleEndDate","item","path","getTaskTypeSchedulePath","sortTaskTypeScheduleItems","err","taskTypeElement","scheduleItem","refreshScheduleCallBack","expanded","resetAssignments","loadScheduleItems","parameters","children","childrenById","child","tasks","personIds","task","tasksByType","people","assigneeId","entityTypeItem","addBusinessDays","minutesToDays","assetType","sortEntitiesByUserName","keyA","keyB","sortTasksByEntityName","b","_b","items","sortedChildren","key","sortByName","entityTypeId","byAssignee","assignee","daysOff","minDate","maxDate","parentElement","element","selectedEntityType","index","asset","shotsBySequence","shot","acc","sequenceId","shots","event","type","start_date","end_date","taskEstimation","cumulatedTasks","nextAssigneeIndex","nextStartDate","taskStartDate","taskEndDate","taskAssignee","due_date","getDatesFromStartDate","daysToMinutes","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_19","_hoisted_20","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_27","_hoisted_28","_hoisted_30","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_openBlock","_createElementBlock","_createElementVNode","_toDisplayString","_ctx","_createVNode","_component_date_field","$data","_cache","$event","_component_combobox_number","_component_button_simple","$options","_component_schedule","_hoisted_9","args","_component_x_icon","_component_task_type_name","_createCommentVNode","_createBlock","_hoisted_13","_component_spinner","_hoisted_21","_withModifiers","_Fragment","_renderList","_normalizeStyle","_hoisted_26","_hoisted_25","_createTextVNode","_component_list_restart_icon","_hoisted_31","_component_people_avatar","_component_people_name","_hoisted_29","_component_checkbox","_component_text_field","_component_trash_icon","_hoisted_14","entityType","_component_grip_vertical_icon","_component_chevron_down_icon","_component_chevron_right_icon","_hoisted_18"],"mappings":"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","x_google_ignoreList":[0,1]}