import{o as T,m as r,a as d,n,aa as k,bk as b,B as m,aK as w,O as $,p as P,H as x,w as S,F as A,q as I,bM as D,bN as p,bO as _,bP as h,i as y,bQ as F,aL as B,bR as E,b6 as L,T as R,bc as u,_ as l,ap as O,b8 as M,bS as g,R as N,s as f,k as q,bT as v,bU as U,u as V,c as z}from"./index-CvQwDNfS.js";import{B as G}from"./BooleanCell-DJ9b5Mmj.js";import{B as C}from"./BooleanField-9ouqyP95.js";import{T as j}from"./TaskStatusCell-f6U2gXlj.js";import{S as H}from"./StatusAutomationList-CuAmAL12.js";const K={name:"production-backgrounds",components:{BooleanField:C,Combobox:T},data(){return{selectedBackgroundId:null}},computed:{...r(["backgrounds","currentProduction","productionBackgrounds"]),remainingBackgrounds(){return this.backgrounds.filter(({id:s})=>!this.currentProduction.preview_background_files.includes(s))},remainingBackgroundsOptions(){return this.remainingBackgrounds.map(s=>({label:s.name,value:s.id}))}},methods:{...d(["addBackgroundToProduction","removeBackgroundFromProduction","setDefaultBackgroundToProduction"]),addBackground(){this.addBackgroundToProduction(this.selectedBackgroundId)},removeBackground(s){this.removeBackgroundFromProduction(s)},resetSelection(){var s;this.selectedBackgroundId=((s=this.remainingBackgrounds[0])==null?void 0:s.id)||""},isGlobalDefaultBackground(s){return s.is_default&&this.isCurrentDefaultBackground(s)},isCurrentDefaultBackground(s){const t=this.currentProduction.default_preview_background_file_id;return t?s.id===t:s.is_default},setDefaultBackground(s,t){this.setDefaultBackgroundToProduction(t?s.id:null)}},watch:{remainingBackgrounds:{immediate:!0,handler(){this.resetSelection()}}}};var Q=function(){var a,o;var t=this,e=t._self._c;return e("div",{staticClass:"production-backgrounds"},[(a=t.remainingBackgrounds)!=null&&a.length?e("div",{staticClass:"flexrow mt1 mb1"},[e("combobox",{staticClass:"flexrow-item mb0",attrs:{options:t.remainingBackgroundsOptions},model:{value:t.selectedBackgroundId,callback:function(i){t.selectedBackgroundId=i},expression:"selectedBackgroundId"}}),e("button",{staticClass:"button flexrow-item",on:{click:t.addBackground}},[t._v(" "+t._s(t.$t("main.add"))+" ")])],1):t._e(),(o=t.currentProduction.preview_background_files)!=null&&o.length?e("table",{staticClass:"datatable"},[e("thead",{staticClass:"datatable-head"},[e("tr",[e("th",{staticClass:"name"},[t._v(t._s(t.$t("backgrounds.fields.name")))]),e("th",{staticClass:"is-default"},[t._v(" "+t._s(t.$t("backgrounds.fields.is_default"))+" ")]),e("th",{staticClass:"actions"})])]),e("tbody",{staticClass:"datatable-body"},t._l(t.productionBackgrounds,function(i){return e("tr",{key:i.id,staticClass:"datatable-row"},[e("td",{staticClass:"name"},[e("span",{staticClass:"flexrow"},[e("a",{staticClass:"thumbnail-wrapper thumbnail-picture entity-thumbnail flexrow-item",attrs:{href:i.url,target:"_blank"}},[e("img",{attrs:{src:i.thumbnail,alt:i.name,width:"100",height:"67"}})]),t._v(" "+t._s(i.name)+" ")])]),e("td",{staticClass:"is-default"},[e("boolean-field",{staticClass:"ml05 mb0",attrs:{disabled:t.isGlobalDefaultBackground(i),label:t.$t("backgrounds.fields.is_default"),value:String(t.isCurrentDefaultBackground(i))},on:{click:function(c){return t.setDefaultBackground(i,c==="true")}}})],1),e("td",[e("button",{staticClass:"button",on:{click:function(c){return t.removeBackground(i.id)}}},[t._v(" "+t._s(t.$t("main.remove"))+" ")])])])}),0)]):e("div",{staticClass:"box"},[t._v(" "+t._s(t.$t("settings.production.empty_list"))+" ")])])},Y=[],J=n(K,Q,Y,!1,null,"26d2c20c",null,null);const W=J.exports,X={name:"production-board",components:{BooleanField:C,ValidationTag:k},data(){return{availableRoles:["user","vendor","supervisor","manager","admin"]}},computed:{...r(["currentProduction","productionTaskStatuses"]),sortedProductionTaskStatuses(){return b([...this.productionTaskStatuses],this.currentProduction)}},methods:{...d(["editTaskStatusLink","loadContext"]),getActiveRoles(s){var t;return((t=this.currentProduction.task_statuses_link[s.id])==null?void 0:t.roles_for_board)||[]},isActiveRole(s,t){return this.getActiveRoles(s).includes(t)},async updateRolesForBoard(s,t,e=!0){const a=[...this.getActiveRoles(s)];t.forEach(i=>{e&&!this.isActiveRole(s,i)?a.push(i):!e&&this.isActiveRole(s,i)&&a.splice(a.indexOf(i),1)});const o={...this.currentProduction.task_statuses_link[s.id],roles_for_board:a,project_id:this.currentProduction.id,task_status_id:s.id};await this.editTaskStatusLink(o),await this.loadContext()}}};var Z=function(){var a;var t=this,e=t._self._c;return e("div",{staticClass:"production-board"},[(a=t.currentProduction.task_statuses)!=null&&a.length?e("table",{staticClass:"datatable"},[e("thead",[e("tr",[e("th",{staticClass:"th-name"},[t._v(t._s(t.$t("task_status.fields.name")))]),e("th",{staticClass:"th-short-name"},[t._v(" "+t._s(t.$t("task_status.fields.short_name"))+" ")]),e("th",{staticClass:"th-roles"},[t._v(" "+t._s(t.$t("board.settings.visible"))+" ")])])]),e("tbody",{staticClass:"datatable-body"},[t._l(t.sortedProductionTaskStatuses,function(o){return[o?e("tr",{key:o.id,staticClass:"datatable-row task-status"},[e("td",[t._v(t._s(o.name))]),e("td",{staticClass:"name"},[e("validation-tag",{attrs:{"is-static":!0,task:{task_status_id:o.id}}})],1),e("td",{staticClass:"roles"},[t._l(t.availableRoles,function(i){return e("boolean-field",{key:`${o.id}-${i}`,staticClass:"role-field",attrs:{label:t.$t(`people.role.${i}`),value:String(t.isActiveRole(o,i))},on:{click:c=>t.updateRolesForBoard(o,[i],c==="true")}})}),t.getActiveRoles(o).length<t.availableRoles.length?e("button",{staticClass:"button",on:{click:function(i){return t.updateRolesForBoard(o,t.availableRoles)}}},[t._v(" "+t._s(t.$t("board.settings.select_all"))+" ")]):e("button",{staticClass:"button",on:{click:function(i){return t.updateRolesForBoard(o,t.availableRoles,!1)}}},[t._v(" "+t._s(t.$t("board.settings.unselect_all"))+" ")])],2)]):t._e()]})],2)]):e("div",{staticClass:"box"},[t._v(" "+t._s(t.$t("settings.production.empty_list"))+" ")])])},tt=[],et=n(X,Z,tt,!1,null,"1b4c1d60",null,null);const st=et.exports,at={name:"production-brief",components:{ButtonSimple:m,TextareaField:w},data(){return{brief:"",isEditing:!1,isLoading:!1,errors:{editBrief:!1}}},computed:{...r(["currentProduction"]),textarea(){return this.$refs.textarea}},mounted(){this.currentProduction&&(this.brief=this.currentProduction.description)},methods:{...d(["editProduction","setProduction"]),isEmpty(s){return!s||s.length===0},openEditing(){this.isEditing=!0,this.$nextTick(()=>{this.textarea.focus()})},async editBrief(){this.isLoading=!0;try{await this.editProduction({id:this.currentProduction.id,description:this.brief})}catch{this.errors.editBrief=!0,this.isLoading=!1;return}this.isEditing=!1,this.isLoading=!1},compileMarkdown(s){return $(s)}}};var it=function(){var t=this,e=t._self._c;return e("div",{staticClass:"brief"},[t.isEditing?e("div",{staticClass:"box has-text-right"},[e("textarea-field",{ref:"textarea",staticClass:"editor",attrs:{"input-class":"textarea"},on:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")||!a.ctrlKey?null:t.editBrief.apply(null,arguments)}},model:{value:t.brief,callback:function(a){t.brief=a},expression:"brief"}}),t.errors.editBrief?e("p",{staticClass:"error mt1 has-text-right"},[t._v(" "+t._s(t.$t("productions.brief.edit.errorText"))+" ")]):t._e(),e("p",[e("button-simple",{attrs:{"is-primary":!0,"is-loading":t.isLoading,disabled:t.isLoading,text:t.$t("main.save")},on:{click:t.editBrief}})],1)],1):e("div",{staticClass:"box",on:{dblclick:t.openEditing}},[t.isEmpty(t.currentProduction.description)?e("div",[e("p",[t._v(t._s(t.$t("productions.brief.empty")))])]):e("div",{staticClass:"content",domProps:{innerHTML:t._s(t.compileMarkdown(t.currentProduction.description))}})])])},ot=[],rt=n(at,it,ot,!1,null,"4ce95d6f",null,null);const nt=rt.exports,dt={name:"production-parameters",components:{ComboboxBoolean:P,ComboboxStyled:x,DateField:S,FileUpload:A,TextField:I,ButtonSimple:m},data(){return{formData:null,isLoading:!1,isError:!1,isLocalTVShow:!1,productionTypeOptions:D,homepageOptions:p,form:{name:"",start_date:new Date,end_date:new Date,nb_episodes:0,episode_span:0,fps:"",max_retakes:0,is_clients_isolated:"false",is_preview_download_allowed:"false",is_set_preview_automated:"false",ratio:"",resolution:"",production_type:"short"}}},computed:{...r(["currentProduction","productionAvatarFormData","productionStatus","isTVShow"])},mounted(){this.resetForm()},watch:{currentProduction:{handler(){this.resetForm(),this.updateTvShowRelatedDatas(this.isTVShow)},deep:!0},"form.production_type"(s){this.updateTvShowRelatedDatas(s==="tvshow")}},methods:{...d(["editProduction","storeProductionPicture","uploadProductionAvatar"]),onFileSelected(s){this.formData=s,this.storeProductionPicture(s)},isEmpty(s){return!s||s.length===0},runConfirmation(){this.$emit("confirm",this.form)},updateTvShowRelatedDatas(s){this.isLocalTVShow=s,s&&this.currentProduction?(this.form.nb_episodes=this.currentProduction.nb_episodes,this.form.episode_span=this.currentProduction.episode_span):(this.form.nb_episodes=0,this.form.episode_span=0)},resetForm(){this.currentProduction?this.form={name:this.currentProduction.name,start_date:_(this.currentProduction.start_date).toDate(),end_date:_(this.currentProduction.end_date).toDate(),production_type:this.currentProduction.production_type||"short",episode_span:this.currentProduction.episode_span,fps:this.currentProduction.fps,max_retakes:this.currentProduction.max_retakes,nb_episodes:this.currentProduction.nb_episodes,is_clients_isolated:this.currentProduction.is_clients_isolated?"true":"false",is_preview_download_allowed:this.currentProduction.is_preview_download_allowed?"true":"false",is_set_preview_automated:this.currentProduction.is_set_preview_automated?"true":"false",ratio:this.currentProduction.ratio,resolution:this.currentProduction.resolution,homepage:this.currentProduction.homepage}:this.form={name:"",start_date:new Date,end_date:new Date,production_type:"short",nb_episodes:0,episode_span:0,max_retakes:0,is_clients_isolated:"false",is_preview_download_allowed:"false",is_set_preview_automated:"false",fps:"",ratio:"",resolution:"",homepage:p[0].value}},async editParameters(){this.isLoading=!0;try{await this.editProduction({id:this.currentProduction.id,...this.form,start_date:h(this.form.start_date),end_date:h(this.form.end_date)}),this.productionAvatarFormData&&await this.uploadProductionAvatar(this.currentProduction.id)}catch{this.isLoading=!1,this.isError=!0;return}this.isLoading=!1}}};var lt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"columns"},[e("div",{staticClass:"column is-one-third box"},[e("form",{staticClass:"form",on:{submit:function(a){a.preventDefault()}}},[e("text-field",{directives:[{name:"focus",rawName:"v-focus"}],ref:"nameField",attrs:{label:t.$t("productions.fields.name")},on:{enter:t.runConfirmation},model:{value:t.form.name,callback:function(a){t.$set(t.form,"name",a)},expression:"form.name"}}),e("div",{staticClass:"columns"},[e("div",{staticClass:"mr1"},[e("date-field",{ref:"startDateField",staticClass:"mb0",attrs:{label:t.$t("productions.fields.start_date"),"short-date":!0},model:{value:t.form.start_date,callback:function(a){t.$set(t.form,"start_date",a)},expression:"form.start_date"}})],1),e("div",[e("date-field",{ref:"endDateField",staticClass:"mb0",attrs:{label:t.$t("productions.fields.end_date"),"short-date":!0},model:{value:t.form.end_date,callback:function(a){t.$set(t.form,"end_date",a)},expression:"form.end_date"}})],1)]),e("combobox-styled",{ref:"productionTypeField",staticClass:"mb2",attrs:{"locale-key-prefix":"productions.type.",label:t.$t("productions.fields.type"),options:t.productionTypeOptions},on:{enter:t.runConfirmation},model:{value:t.form.production_type,callback:function(a){t.$set(t.form,"production_type",a)},expression:"form.production_type"}}),t.currentProduction&&t.currentProduction.id?e("combobox-styled",{ref:"homepage",staticClass:"mb2",attrs:{"locale-key-prefix":"productions.homepage.",label:t.$t("productions.fields.homepage"),options:t.homepageOptions},on:{enter:t.runConfirmation},model:{value:t.form.homepage,callback:function(a){t.$set(t.form,"homepage",a)},expression:"form.homepage"}}):t._e(),t.currentProduction&&t.currentProduction.id?e("text-field",{ref:"fpsField",attrs:{type:"number",max:60,step:.001,label:t.$t("productions.fields.fps")},on:{enter:t.runConfirmation},model:{value:t.form.fps,callback:function(a){t.$set(t.form,"fps",a)},expression:"form.fps"}}):t._e(),t.currentProduction&&t.currentProduction.id?e("text-field",{ref:"ratioField",attrs:{label:t.$t("productions.fields.ratio")},on:{enter:t.runConfirmation},model:{value:t.form.ratio,callback:function(a){t.$set(t.form,"ratio",a)},expression:"form.ratio"}}):t._e(),t.currentProduction&&t.currentProduction.id?e("text-field",{ref:"resolutionField",attrs:{label:t.$t("productions.fields.resolution")},on:{enter:t.runConfirmation},model:{value:t.form.resolution,callback:function(a){t.$set(t.form,"resolution",a)},expression:"form.resolution"}}):t._e(),t.currentProduction&&t.currentProduction.id?e("combobox-boolean",{ref:"isClientsIsolatedField",attrs:{label:t.$t("productions.fields.is_clients_isolated")},on:{enter:t.runConfirmation},model:{value:t.form.is_clients_isolated,callback:function(a){t.$set(t.form,"is_clients_isolated",a)},expression:"form.is_clients_isolated"}}):t._e(),t.currentProduction&&t.currentProduction.id?e("combobox-boolean",{ref:"isPreviewDownloadAllowed",attrs:{label:t.$t("productions.fields.is_preview_download_allowed")},on:{enter:t.runConfirmation},model:{value:t.form.is_preview_download_allowed,callback:function(a){t.$set(t.form,"is_preview_download_allowed",a)},expression:"form.is_preview_download_allowed"}}):t._e(),t.currentProduction&&t.currentProduction.id?e("combobox-boolean",{ref:"isSetPreviewAutomated",attrs:{label:t.$t("productions.fields.is_set_preview_automated")},on:{enter:t.runConfirmation},model:{value:t.form.is_set_preview_automated,callback:function(a){t.$set(t.form,"is_set_preview_automated",a)},expression:"form.is_set_preview_automated"}}):t._e(),t.currentProduction&&t.currentProduction.id?e("text-field",{ref:"maxRetakesField",attrs:{type:"number",step:1,label:t.$t("productions.fields.max_retakes")},on:{enter:t.runConfirmation},model:{value:t.form.max_retakes,callback:function(a){t.$set(t.form,"max_retakes",a)},expression:"form.max_retakes"}}):t._e(),t.currentProduction&&t.currentProduction.id?e("div",[e("label",{staticClass:"label"},[t._v(t._s(t.$t("productions.picture")))]),e("file-upload",{ref:"fileField",attrs:{"is-primary":!1,label:t.$t("main.csv.upload_file"),accept:".png,.jpg,.jpeg"},on:{fileselected:t.onFileSelected}})],1):t._e(),t.isError?e("p",{staticClass:"error mt1"},[t._v(" "+t._s(t.$t("productions.edit_error"))+" ")]):t._e(),e("div",{staticClass:"has-text-right mt2"},[e("button-simple",{class:{"is-loading":t.isLoading},attrs:{"is-primary":!0,disabled:t.isLoading,text:t.$t("main.save")},on:{click:t.editParameters}})],1)],1)])])},ut=[],ct=n(dt,lt,ut,!1,null,"1225637b",null,null);const mt=ct.exports,pt={name:"status-automation-item",components:{TaskStatusCell:j,TaskTypeName:y},props:{statusAutomation:{type:Object,default:null},productionId:{type:String,default:null},deletable:{type:Boolean,default:!1}},computed:{...r(["isCurrentUserClient","getTaskStatus","getTaskType"]),statusAutomationPath(){const s={name:"status-automation",params:{production_id:this.productionId,status_automation_id:this.statusAutomation.id,type:F(this.statusAutomation.for_entity)}};return(this.statusAutomation.episode_id||this.$route.params.episode_id)&&(s.name="episode-status-automation",s.params.episode_id=this.statusAutomation.episode_id||this.$route.params.episode_id),s}},methods:{...d([])}};var _t=function(){var t=this,e=t._self._c;return e("div",{staticClass:"status-automation flexrow"},[e("span",{staticClass:"flexrow-item entity-type"},[t._v(" "+t._s(t.statusAutomation.entity_type)+" ")]),e("span",{staticClass:"in-task-type flexrow-item"},[e("task-type-name",{staticClass:"in-task-type flexrow-item",attrs:{"task-type":t.getTaskType(t.statusAutomation.in_task_type_id)}})],1),e("span",{staticClass:"in-task-status flexrow-item"},[t.statusAutomation.in_field_type!=="ready_for"?e("task-status-cell",{attrs:{entry:t.getTaskStatus(t.statusAutomation.in_task_status_id)}}):t._e()],1),e("span",{staticClass:"flexrow-item trigger-type"},[t._v(" changes "+t._s(t.statusAutomation.out_field_type==="ready_for"?"ready for to":"task status for")+" ")]),e("span",{staticClass:"out-task-type flexrow-item"},[e("task-type-name",{attrs:{"task-type":t.getTaskType(t.statusAutomation.out_task_type_id)}})],1),t.statusAutomation.out_field_type==="status"?e("span",{staticClass:"flexrow-item"},[t._v(" to ")]):t._e(),e("span",{staticClass:"out-task-status flexrow-item"},[t.statusAutomation.out_field_type==="status"?e("task-status-cell",{attrs:{entry:t.getTaskStatus(t.statusAutomation.out_task_status_id)}}):t._e()],1)])},ht=[],ft=n(pt,_t,ht,!1,null,"79c39393",null,null);const vt=ft.exports,Tt={name:"combobox-status-automation",components:{ChevronDownIcon:B,ComboboxMask:E,StatusAutomationItem:vt},data(){return{showStatusAutomationsList:!1}},props:{label:{default:"",type:String},statusAutomationsList:{default:()=>[],type:Array},value:{default:"",type:String},narrow:{default:!1,type:Boolean},withMargin:{default:!0,type:Boolean},addPlaceholder:{default:!1,type:Boolean}},mounted(){this.selectedStatusAutomation=this.statusAutomation},computed:{...r(["isDarkTheme","statusAutomationMap","getTaskStatus","getTaskType"]),currentStatusAutomation(){return this.value?this.statusAutomationMap.get(this.value):this.addPlaceholder?{short_name:"+ status",color:"#999"}:this.statusAutomationsList[0]}},methods:{selectStatusAutomation(s){this.$emit("input",s.id),this.showStatusAutomationsList=!1},backgroundColor(s){return(!s||s.is_default)&&!this.isDarkTheme?"#ECECEC":(!s||s.is_default)&&this.isDarkTheme?"#5F626A":this.isDarkTheme?L.darkenColor(s.color):s.color},color(s){return!s||!s.is_default||this.isDarkTheme?"white":"#333"},toggleStatusAutomationsList(){this.showStatusAutomationsList=!this.showStatusAutomationsList}}};var kt=function(){var t=this,e=t._self._c;return e("div",{class:{field:t.withMargin,"field--narrow":t.narrow}},[t.label.length>0?e("label",{staticClass:"label"},[t._v(" "+t._s(t.label)+" ")]):t._e(),e("div",{staticClass:"status-automation-combo"},[e("div",{staticClass:"flexrow",on:{click:t.toggleStatusAutomationsList}},[e("div",{staticClass:"selected-status-automation-line flexrow-item"},[t.currentStatusAutomation?e("status-automation-item",{attrs:{"status-automation":t.currentStatusAutomation}}):t._e()],1),e("chevron-down-icon",{staticClass:"down-icon flexrow-item"})],1),t.showStatusAutomationsList?e("div",{ref:"select",staticClass:"select-input"},t._l(t.statusAutomationsList,function(a){return e("div",{key:a.id,staticClass:"status-automation-line",on:{click:function(o){return t.selectStatusAutomation(a)}}},[a?e("status-automation-item",{attrs:{"status-automation":a}}):t._e()],1)}),0):t._e()]),e("combobox-mask",{attrs:{displayed:t.showStatusAutomationsList},on:{click:t.toggleStatusAutomationsList}})],1)},bt=[],yt=n(Tt,kt,bt,!1,null,"abc19517",null,null);const gt=yt.exports,Ct={name:"production-status-automations",components:{ComboboxStatusAutomation:gt,StatusAutomationList:H},data(){return{statusAutomations:[],statusAutomationId:""}},mounted(){this.remainingStatusAutomations.length>0&&(this.statusAutomationId=this.remainingStatusAutomations[0].id)},computed:{...r(["currentProduction","productionStatusAutomations","statusAutomationMap","remainingStatusAutomations"])},methods:{...d(["addStatusAutomationToProduction"]),isEmpty(s){return!s||s.length===0},addStatusAutomation(){this.addStatusAutomationToProduction(this.statusAutomationId),this.remainingStatusAutomations.length>0?this.statusAutomationId=this.remainingStatusAutomations[0].id:this.statusAutomationId=""}},watch:{}};var wt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[t.remainingStatusAutomations.length>0?[t.remainingStatusAutomations?e("div",{staticClass:"flexrow mt1 mb1 add-status-automation"},[e("combobox-status-automation",{staticClass:"flexrow-item selector",attrs:{"status-automations-list":t.remainingStatusAutomations},model:{value:t.statusAutomationId,callback:function(a){t.statusAutomationId=a},expression:"statusAutomationId"}}),e("button",{staticClass:"button flexrow-item",on:{click:t.addStatusAutomation}},[t._v(" "+t._s(t.$t("main.add"))+" ")])],1):t._e()]:t._e(),t.isEmpty(t.productionStatusAutomations)?e("div",{staticClass:"box"},[t._v(" "+t._s(t.$t("settings.production.empty_automation_list"))+" ")]):t._e(),t.isEmpty(t.productionStatusAutomations)?t._e():e("status-automation-list",{attrs:{entries:t.productionStatusAutomations}})],2)])},$t=[],Pt=n(Ct,wt,$t,!1,null,"490cd373",null,null);const xt=Pt.exports,St={name:"production-task-type",components:{TaskTypeCell:R},props:{taskType:{required:!0,type:Object},scheduleItem:{required:!0,type:Object}},data(){return{startDate:null,endDate:null,silent:!0}},computed:{...r(["currentProduction","getTaskTypePriority"]),productionTimeRange(){return{to:u(this.currentProduction.start_date).toDate(),from:u(this.currentProduction.end_date).toDate()}},endDateTimeRange(){return{to:this.startDate,from:u(this.currentProduction.end_date).toDate()}}},mounted(){this.startDate=u(this.scheduleItem.start_date).toDate(),this.endDate=u(this.scheduleItem.end_date).toDate(),this.$nextTick(()=>{this.silent=!1})},methods:{...d([])},watch:{startDate(){if(this.silent)return;const s=l(this.startDate);let t=l(this.endDate);this.silent=!0,t.isBefore(s)&&(t=s.clone().add(1,"days"),this.endDate=t.toDate());const e={...this.scheduleItem};e.startDate=s,e.endDate=t,this.$emit("date-changed",e),this.$nextTick(()=>{this.silent=!1})},endDate(){if(this.silent)return;let s=l(this.startDate);const t=l(this.endDate);this.silent=!0,t.isBefore(s)&&(s=t.clone().add(-1,"days"),this.startDate=s.toDate());const e={...this.scheduleItem};e.startDate=s,e.endDate=t,this.$emit("date-changed",e),this.$nextTick(()=>{this.silent=!1})},scheduleItem(){this.silent=!0,this.startDate=u(this.scheduleItem.start_date).toDate(),this.endDate=u(this.scheduleItem.end_date).toDate(),this.$nextTick(()=>{this.silent=!1})}}};var At=function(){var t=this,e=t._self._c;return e("tr",{key:t.taskType.id,staticClass:"datatable-row"},[e("task-type-cell",{attrs:{"task-type":t.taskType}}),e("td",{staticClass:"remove"},[e("button",{staticClass:"button",on:{click:function(a){return t.$emit("remove",{scheduleItem:t.scheduleItem,taskType:t.taskType})}}},[t._v(" "+t._s(t.$t("main.remove"))+" ")])])],1)},It=[],Dt=n(St,At,It,!1,null,"12371d2f",null,null);const Ft=Dt.exports,Bt={name:"setting-importer",components:{ButtonSimple:m,ComboboxProduction:O},data(){return{importProductionId:null}},props:{items:{type:Array,default:()=>[]},loadingImport:{type:Boolean,default:!0}},mounted(){this.availableProductions.length>0&&(this.importProductionId=this.availableProductions[0].id)},computed:{...r(["currentProduction","openProductions"]),availableProductions(){return this.openProductions.filter(s=>s.id!==this.currentProduction.id)},sizeStyle(){return{width:this.size?this.size+"px":"auto"}}}};var Et=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"project-import flexcolumn"},[e("combobox-production",{staticClass:"flexrow-item",attrs:{label:t.$t("settings.import_from_production"),"production-list":t.availableProductions,"with-margin":!1},model:{value:t.importProductionId,callback:function(a){t.importProductionId=a},expression:"importProductionId"}}),e("button-simple",{staticClass:"flexrow-item mt05",attrs:{disabled:!t.importProductionId,"is-loading":t.loadingImport,text:t.$t("main.import")},on:{click:function(a){return t.$emit("import-from-production",t.importProductionId)}}})],1),e("div",[e("p",{staticClass:"label mt2"},[t._v(" "+t._s(t.$t("settings.available_items"))+" ")]),t.items.length>0?e("div",{staticClass:"import-list"},t._l(t.items,function(a){return e("div",{key:`unlisted-item-${a.id}`,staticClass:"flexrow item-to-add mb05",on:{click:function(o){return t.$emit("import-item",a)}}},[t._t("item-line",null,{item:a})],2)}),0):t._e(),e("p",{staticClass:"infos mt05"},[t._v(" "+t._s(t.$t("settings.no_more_available_items"))+" ")])])])},Lt=[],Rt=n(Bt,Et,Lt,!1,null,"b9c2c386",null,null);const Ot=Rt.exports,Mt={name:"production-task-types",components:{ComboboxTaskType:M,draggable:g,ProductionTaskType:Ft,RouteSectionTabs:N,SettingImporter:Ot,TaskTypeName:y},data(){return{activeTab:"assets",assetTaskTypes:{list:[]},editTaskTypes:{list:[]},episode_span:0,episodeTaskTypes:{list:[]},sequenceTaskTypes:{list:[]},shotTaskTypes:{list:[]},taskTypeId:"",loading:{import:!1,episode_span:!1,scheduleTimeUpdate:!1,scheduleTimeDelete:!1},errors:{episode_span:!1,scheduleTimeUpdate:!1,delete:!1}}},mounted(){this.remainingTaskTypesForEntity.length>0?this.taskTypeId=this.remainingTaskTypesForEntity[0].id:this.taskTypeId=null,this.$route.query.section?this.activeTab=this.$route.query.section:this.isShotsOnly?this.activeTab="shots":this.activeTab="assets",this.resetDisplayedTaskTypes(),this.currentProduction&&(this.episode_span=this.currentProduction.episode_span,this.loadAllScheduleItems(this.currentProduction).then(()=>{this.resetDisplayedTaskTypes()}).catch(s=>{console.error(s)}))},computed:{...r(["currentProduction","currentScheduleItems","getProductionTaskTypes","productionTaskTypes","productionAssetTaskTypes","productionShotTaskTypes","productionEditTaskTypes","productionSequenceTaskTypes","productionEpisodeTaskTypes","taskStatusMap","taskTypeMap","taskTypes","isTVShow"]),remainingTaskTypes(){return f(this.taskTypes.filter(s=>!this.currentProduction.task_types.includes(s.id)))},remainingTaskTypesForEntity(){return f(this.remainingTaskTypes.filter(s=>`${s.for_entity.toLowerCase()}s`===this.activeTab))},isAssetsOnly(){return this.currentProduction.production_type==="assets"},isShotsOnly(){return this.currentProduction.production_type==="shots"},taskTypeGroups(){let s=[];return this.isShotsOnly||s.push(this.assetTaskTypes),this.isAssetsOnly||(s=s.concat([this.shotTaskTypes,this.editTaskTypes,this.sequenceTaskTypes,this.episodeTaskTypes])),s},taskTypeTabs(){return[{label:this.$t("assets.title"),name:"assets"},{label:this.$t("shots.title"),name:"shots"},{label:this.$t("sequences.title"),name:"sequences"},{label:this.$t("episodes.title"),name:"episodes"},{label:this.$t("edits.title"),name:"edits"}]}},methods:{...d(["addTaskTypeToProduction","createScheduleItem","deleteScheduleItem","editProduction","editTaskTypeLink","loadAllScheduleItems","loadContext","removeTaskTypeFromProduction","saveScheduleItem"]),isEmpty(s){return!s||s.length===0},resetDisplayedTaskTypes(){["Asset","Shot","Sequence","Episode","Edit"].forEach(s=>{const t=this[`production${s}TaskTypes`];let e=q([...t],this.currentProduction);e=e.map(a=>({taskType:a,scheduleItem:this.getScheduleItemForTaskType(a)})),this[`${s.toLowerCase()}TaskTypes`]={entity:`${s.toLowerCase()}s`,title:this.$t(`${s.toLowerCase()}s.title`),list:e}})},getScheduleItemForTaskType(s){return this.currentScheduleItems.find(e=>e.task_type_id===s.id)||{start_date:v(l()),end_date:v(l())}},async addTaskType(s){const t=s&&s.id?s.id:this.taskTypeId;await this.addTaskTypeToProduction({taskTypeId:t,priority:this.assetTaskTypes.length});try{await this.createScheduleItem({startDate:l(),endDate:l(),project_id:this.currentProduction.id,task_type_id:t})}catch(e){console.error(e)}this.remainingTaskTypesForEntity.length>0?this.taskTypeId=this.remainingTaskTypesForEntity[0].id:this.taskTypeId=null,this.resetDisplayedTaskTypes()},async removeTaskType({taskType:s,scheduleItem:t}){this.errors.delete=!1;try{await this.removeTaskTypeFromProduction(s.id),t!==null&&(this.loading.scheduleTimeDelete=!0,await this.deleteScheduleItem(t),this.loading.scheduleTimeDelete=!1)}catch{this.errors.delete=!0,this.loading.scheduleTimeDelete=!1;return}await this.$nextTick(),this.remainingTaskTypesForEntity.length>0?this.taskTypeId=this.remainingTaskTypesForEntity[0].id:this.taskTypeId=null,this.resetDisplayedTaskTypes()},async editEpisodeSpan(){this.loading.episode_span=!0,this.errors.episode_span=!1;try{await this.editProduction({id:this.currentProduction.id,episode_span:this.episode_span})}catch(s){this.errors.episode_span=!0,console.error(s)}this.loading.episode_span=!1},async onDateChanged(s){this.errors.scheduleTimeUpdate=!1;try{await this.saveScheduleItem(s)}catch(t){console.error(t),this.errors.scheduleTimeUpdate=!0}},async savePriorities(s){const t=new Date().getTime();this.lastCall=this.lastCall||0,t-this.lastCall>1e3&&!this.isSaving?(this.lastCall=t,this.isSaving=!0,await U.runPromiseAsSeries(s.map(async e=>await this.editTaskTypeLink(e))),this.isSaving=!1,this.newSaveCall&&await this.savePriorities(s),setTimeout(()=>{this.$store.commit("SORT_VALIDATION_COLUMNS",this.taskTypeMap)},100)):this.newSaveCall=!0},async updatePriorities(s){const t=[];s.forEach((e,a)=>{a+=1;const o={projectId:this.currentProduction.id,taskTypeId:e.taskType.id,priority:a};t.push(o)}),await this.savePriorities(t),await this.loadContext()},async importTaskTypesFromProduction(s){this.loading.import=!0;const t=this.getProductionTaskTypes(s.id).filter(a=>`${a.for_entity.toLowerCase()}s`===this.activeTab),e=V.capitalize(this.activeTab).slice(0,-1);await this[`production${e}TaskTypes`].forEach(async a=>{const o=this.getScheduleItemForTaskType(t[0]);await this.removeTaskType({taskType:a,scheduleItem:o})}),setTimeout(async()=>{await t.forEach(async a=>{await this.addTaskType(a)}),this.loading.import=!1},500)}},watch:{currentProduction:{handler(){this.episode_span=this.currentProduction.episode_span,this.loadAllScheduleItems(this.currentProduction),this.resetDisplayedTaskTypes()},deep:!0},$route(){this.$route.query.section&&(this.activeTab=this.$route.query.section,this.$nextTick(()=>{this.remainingTaskTypesForEntity.length>0?this.taskTypeId=this.remainingTaskTypesForEntity[0].id:this.taskTypeId=null}))}}};var Nt=function(){var t=this,e=t._self._c;return e("div",[e("div",[e("route-section-tabs",{staticClass:"section-tabs",attrs:{activeTab:t.activeTab,route:t.$route,tabs:t.taskTypeTabs}}),e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[t.remainingTaskTypes.length>0?[e("div",{staticClass:"flexrow mt1 mb1 add-task-type"},[e("combobox-task-type",{staticClass:"flexrow-item selector",attrs:{"task-type-list":t.remainingTaskTypesForEntity},model:{value:t.taskTypeId,callback:function(a){t.taskTypeId=a},expression:"taskTypeId"}}),e("button",{staticClass:"button flexrow-item",attrs:{disabled:t.loading.scheduleTimeDelete},on:{click:t.addTaskType}},[t._v(" "+t._s(t.$t("main.add"))+" ")])],1)]:t._e(),t.errors.delete||t.errors.scheduleTimeUpdate?e("p",{staticClass:"error mt1 mb1"},[t._v(" "+t._s(t.$t("productions.edit_error"))+" ")]):t._e(),t.isEmpty(t.currentProduction.task_types)?e("div",{staticClass:"box"},[t._v(" "+t._s(t.$t("settings.production.empty_list"))+" ")]):t._l(t.taskTypeGroups,function(a,o){return e("div",{key:o},[a.list.length>0&&a.entity===t.activeTab?e("table",{staticClass:"datatable list"},[e("draggable",{staticClass:"datatable-body",attrs:{draggable:".task-type",tag:"tbody"},on:{end:function(i){return t.updatePriorities(a.list)}},model:{value:a.list,callback:function(i){t.$set(a,"list",i)},expression:"taskListObject.list"}},t._l(a.list,function(i){return e("production-task-type",{key:i.taskType.id,staticClass:"task-type",attrs:{"task-type":i.taskType,"schedule-item":i.scheduleItem},on:{"date-changed":t.onDateChanged,remove:t.removeTaskType}})}),1)],1):t._e(),a.list.length===0&&a.entity===t.activeTab?e("p",{staticClass:"empty"},[t._v(" "+t._s(t.$t("task_types.no_task_types"))+" ")]):t._e()])})],2),e("div",{staticClass:"column"},[e("setting-importer",{attrs:{"is-import-loading":t.loading.import,items:t.remainingTaskTypesForEntity,"loading-import":t.loading.import},on:{"import-from-production":t.importTaskTypesFromProduction,"import-item":t.addTaskType},scopedSlots:t._u([{key:"item-line",fn:function({item:a}){return[e("task-type-name",{staticClass:"pointer",attrs:{"task-type":a}})]}}])})],1)])],1)])},qt=[],Ut=n(Mt,Nt,qt,!1,null,"dcaf5db9",null,null);const Vt=Ut.exports,zt={name:"production-settings",components:{BooleanCell:G,Combobox:T,ComboboxStatus:z,draggable:g,ProductionBackgrounds:W,ProductionBoard:st,ProductionBrief:nt,ProductionParameters:mt,ProductionStatusAutomations:xt,ProductionTaskTypes:Vt,ValidationTag:k},data(){return{activeTab:"parameters",assetTypeId:"",taskStatusId:""}},mounted(){this.remainingAssetTypes.length>0&&(this.assetTypeId=this.remainingAssetTypes[0].value),this.remainingTaskStatuses.length>0&&(this.taskStatusId=this.remainingTaskStatuses[0].id),this.$route.query.tab&&(this.activeTab=this.$route.query.tab)},computed:{...r(["assetTypeMap","currentProduction","assetTypes","productionAssetTypes","productionTaskTypes","productionTaskStatuses","productionStatusAutomations","taskStatus","taskStatusMap","taskTypeMap","taskTypes","isTVShow"]),remainingAssetTypes(){return this.assetTypes.filter(s=>!this.currentProduction.asset_types.includes(s.id)).map(s=>({label:s.name,value:s.id}))},remainingTaskStatuses(){return this.taskStatus.filter(s=>!this.currentProduction.task_statuses.includes(s.id)&&!s.for_concept)},sortedProductionTaskStatuses(){return b(this.productionTaskStatuses,this.currentProduction)}},methods:{...d(["addAssetTypeToProduction","addTaskStatusToProduction","editTaskStatusLink","loadContext","removeAssetTypeFromProduction","removeTaskStatusFromProduction"]),isEmpty(s){return!s||s.length===0},isActiveTab(s){return this.activeTab===s},addAssetType(){this.addAssetTypeToProduction(this.assetTypeId),this.remainingAssetTypes.length>0&&(this.assetTypeId=this.remainingAssetTypes[0].value)},removeAssetType(s){this.removeAssetTypeFromProduction(s)},async addTaskStatus(){var s;await this.addTaskStatusToProduction(this.taskStatusId),await this.loadContext(),this.taskStatusId=(s=this.remainingTaskStatuses[0])==null?void 0:s.id},async removeTaskStatus(s){var t;await this.removeTaskStatusFromProduction(s),await this.loadContext(),this.taskStatusId=(t=this.remainingTaskStatuses[0])==null?void 0:t.id},async updateTaskStatusPriority(s,t){const e=[...this.productionTaskStatuses],a=e[s];e.splice(s,1),e.splice(t,0,a),await this.updateTaskStatusPriorities(e)},async updateTaskStatusPriorities(s){const t=s.map((e,a)=>({...this.currentProduction.task_statuses_link[e.id],priority:a+1,project_id:this.currentProduction.id,task_status_id:e.id}));for(const e of t)await this.editTaskStatusLink(e);await this.loadContext()}},watch:{activeTab(){this.$route.query.tab!==this.activeTab&&this.$router.push({query:{tab:this.activeTab}})}},metaInfo(){return{title:`${this.currentProduction.name} | ${this.$t("settings.title")} - Kitsu`}}};var Gt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"production-settings fixed-page"},[e("div",{staticClass:"wrapper"},[e("div",{staticClass:"tabs"},[e("ul",[e("li",{class:{"is-active":t.isActiveTab("parameters")}},[e("a",{on:{click:function(a){t.activeTab="parameters"}}},[t._v(" "+t._s(t.$t("productions.parameters.title"))+" ")])]),e("li",{class:{"is-active":t.isActiveTab("brief")}},[e("a",{on:{click:function(a){t.activeTab="brief"}}},[t._v(" "+t._s(t.$t("productions.brief.title"))+" ")])]),e("li",{class:{"is-active":t.isActiveTab("taskStatus")}},[e("a",{on:{click:function(a){t.activeTab="taskStatus"}}},[t._v(" "+t._s(t.$t("task_status.title"))+" ")])]),e("li",{class:{"is-active":t.isActiveTab("board")}},[e("a",{on:{click:function(a){t.activeTab="board"}}},[t._v(" "+t._s(t.$t("board.settings.title"))+" ")])]),e("li",{class:{"is-active":t.isActiveTab("taskTypes")}},[e("a",{on:{click:function(a){t.activeTab="taskTypes"}}},[t._v(" "+t._s(t.$t("task_types.title"))+" ")])]),e("li",{class:{"is-active":t.isActiveTab("assetTypes")}},[e("a",{on:{click:function(a){t.activeTab="assetTypes"}}},[t._v(" "+t._s(t.$t("asset_types.title"))+" ")])]),e("li",{class:{"is-active":t.isActiveTab("statusAutomations")}},[e("a",{on:{click:function(a){t.activeTab="statusAutomations"}}},[t._v(" "+t._s(t.$t("status_automations.title"))+" ")])]),e("li",{class:{"is-active":t.isActiveTab("backgrounds")}},[e("a",{on:{click:function(a){t.activeTab="backgrounds"}}},[t._v(" "+t._s(t.$t("backgrounds.title"))+" ")])])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("parameters"),expression:"isActiveTab('parameters')"}],staticClass:"tab"},[e("production-parameters")],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("brief"),expression:"isActiveTab('brief')"}],staticClass:"tab"},[e("production-brief")],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("assetTypes"),expression:"isActiveTab('assetTypes')"}],staticClass:"tab"},[e("div",{staticClass:"flexrow mt1 mb1 add-asset-type"},[e("combobox",{staticClass:"flexrow-item",attrs:{options:t.remainingAssetTypes},model:{value:t.assetTypeId,callback:function(a){t.assetTypeId=a},expression:"assetTypeId"}}),e("button",{staticClass:"button flexrow-item",on:{click:t.addAssetType}},[t._v(" "+t._s(t.$t("main.add"))+" ")])],1),t.isEmpty(t.currentProduction.asset_types)?e("div",{staticClass:"box"},[t._v(" "+t._s(t.$t("settings.production.empty_list"))+" ")]):e("table",{staticClass:"datatable list"},[e("tbody",{staticClass:"datatable-body"},t._l(t.productionAssetTypes,function(a){return e("tr",{key:a.id,staticClass:"datatable-row"},[e("td",{staticClass:"name"},[t._v(t._s(a.name))]),e("td",[e("button",{staticClass:"button",on:{click:function(o){return t.removeAssetType(a.id)}}},[t._v(" "+t._s(t.$t("main.remove"))+" ")])])])}),0)])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("taskTypes"),expression:"isActiveTab('taskTypes')"}],staticClass:"tab"},[e("production-task-types")],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("taskStatus"),expression:"isActiveTab('taskStatus')"}],staticClass:"tab"},[t.isEmpty(t.remainingTaskStatuses)?t._e():e("div",{staticClass:"flexrow mt1 mb1 add-task-status"},[e("combobox-status",{staticClass:"flexrow-item selector",attrs:{"task-status-list":t.remainingTaskStatuses},model:{value:t.taskStatusId,callback:function(a){t.taskStatusId=a},expression:"taskStatusId"}}),e("button",{staticClass:"button flexrow-item",on:{click:t.addTaskStatus}},[t._v(" "+t._s(t.$t("main.add"))+" ")])],1),t.isEmpty(t.currentProduction.task_statuses)?e("div",{staticClass:"box"},[t._v(" "+t._s(t.$t("settings.production.empty_list"))+" ")]):e("table",{staticClass:"datatable"},[e("thead",[e("tr",[e("th",{staticClass:"th-name"},[t._v(t._s(t.$t("task_status.fields.name")))]),e("th",{staticClass:"th-short-name"},[t._v(" "+t._s(t.$t("task_status.fields.short_name"))+" ")]),e("th",{staticClass:"th-bool"},[t._v(t._s(t.$t("task_status.fields.is_done")))]),e("th",{staticClass:"th-bool"},[t._v(t._s(t.$t("task_status.fields.is_retake")))]),e("th",{staticClass:"th-bool"},[t._v(" "+t._s(t.$t("task_status.fields.is_artist_allowed"))+" ")]),e("th",{staticClass:"th-bool"},[t._v(" "+t._s(t.$t("task_status.fields.is_client_allowed"))+" ")])])]),e("draggable",{staticClass:"datatable-body",attrs:{draggable:".task-status",tag:"tbody",value:t.sortedProductionTaskStatuses},on:{end:function(a){return t.updateTaskStatusPriority(a.oldIndex,a.newIndex)}}},[t._l(t.sortedProductionTaskStatuses,function(a){return[a?e("tr",{key:a.id,staticClass:"datatable-row task-status"},[e("td",[t._v(" "+t._s(a.name)+" ")]),e("td",{staticClass:"name"},[e("validation-tag",{attrs:{"is-static":!0,task:{task_status_id:a.id}}})],1),e("boolean-cell",{attrs:{value:a.is_done}}),e("boolean-cell",{attrs:{value:a.is_retake}}),e("boolean-cell",{attrs:{value:a.is_artist_allowed}}),e("boolean-cell",{attrs:{value:a.is_client_allowed}}),e("td",[e("button",{staticClass:"button",on:{click:function(o){return t.removeTaskStatus(a.id)}}},[t._v(" "+t._s(t.$t("main.remove"))+" ")])])],1):t._e()]})],2)],1)]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("board"),expression:"isActiveTab('board')"}],staticClass:"tab"},[e("production-board")],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("statusAutomations"),expression:"isActiveTab('statusAutomations')"}],staticClass:"tab"},[e("production-status-automations")],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("backgrounds"),expression:"isActiveTab('backgrounds')"}],staticClass:"tab"},[e("production-backgrounds")],1)])])},jt=[],Ht=n(zt,Gt,jt,!1,null,"b16d7c35",null,null);const Xt=Ht.exports;export{Xt as default};
//# sourceMappingURL=ProductionSettings-Bg_QDEYc.js.map
