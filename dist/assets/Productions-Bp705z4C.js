import{n as i,ao as l,bF as d,bp as c,bG as u,bH as p,bI as _,f,v as m,m as r,a as h,x as y,T as v,c as n,bJ as k,B as C,Z as g,bK as $,j as w}from"./index-DTmpp2AN.js";const x={name:"button-link",components:{DownloadIcon:l,EditIcon:d,PlusIcon:c,RotateCcwIcon:u,TrashIcon:p,UploadIcon:_},props:{text:{default:"",type:String},title:{default:"",type:String},path:{default:""},icon:{default:"",type:String},isResponsive:{default:!1,type:Boolean}},computed:{isText(){return this.text&&this.text.length>0}}};var b=function(){var t=this,s=t._self._c;return s("router-link",{staticClass:"button",attrs:{title:t.title,to:t.path}},[t.icon.length>0&&t.icon.startsWith("fa")?s("span",{staticClass:"icon is-small"},[s("i",{class:"fa "+t.icon})]):t._e(),t.icon==="plus"?s("plus-icon",{class:{icon:!0,"is-small":!0,"only-icon":!t.isText}}):t._e(),t.icon==="download"?s("download-icon",{class:{icon:!0,"is-small":!0,"only-icon":!t.isText}}):t._e(),t.icon==="upload"?s("upload-icon",{class:{icon:!0,"is-small":!0,"only-icon":!t.isText}}):t._e(),t.icon==="edit"?s("edit-icon",{class:{icon:!0,"is-small":!0,"only-icon":!t.isText}}):t._e(),t.icon==="delete"?s("trash-icon",{class:{icon:!0,"is-small":!0,"only-icon":!t.isText}}):t._e(),t.icon==="restore"?s("rotate-ccw-icon",{class:{icon:!0,"is-small":!0,"only-icon":!t.isText}}):t._e(),t.isText?s("span",{class:{text:!0,"is-hidden-touch":t.isResponsive}},[t._v(" "+t._s(t.text)+" ")]):t._e()],1)},P=[],S=i(x,b,P,!1,null,"0f99564c",null,null);const D=S.exports,M={name:"production-stats",mixins:[f],components:{TaskTypeName:m},props:{stats:{type:Object,default:()=>{}}},data(){return{expanded:!1}},computed:{...r(["taskStatusMap","taskTypeMap"]),expandable(){var e;return((e=this.stats.task_types)==null?void 0:e.length)>0},statusIds(){return Object.keys(this.statsByStatus).sort((e,t)=>this.taskStatusMap.get(e).priority<this.taskStatusMap.get(t).priority)},taskTypes(){const e={Asset:1,Shot:2,Sequence:3,Episode:4,Edit:5,Concept:6};return Object.keys(this.taskTypeStatsMap).map(t=>this.taskTypeMap.get(t)).sort((t,s)=>t.for_entity!==s.for_entity?e[t.for_entity]>e[s.for_entity]:t.priority>s.priority)},taskTypeStatsMap(){var t;const e={};return(t=this.stats.task_types)==null||t.forEach(s=>{e[s.task_type_id]||(e[s.task_type_id]={task_type_id:s.task_type_id,amount:0,amount_done:0,total_duration:0,total_estimation:0,task_statuses:[]}),e[s.task_type_id].amount+=s.amount,e[s.task_type_id].amount_done+=s.amount_done,e[s.task_type_id].total_duration+=s.total_duration,e[s.task_type_id].total_estimation+=s.total_estimation,e[s.task_type_id].task_statuses.push(s)}),e},statsByStatus(){var t;const e={};return(t=this.stats.task_types)==null||t.forEach(s=>{e[s.task_status_id]||(e[s.task_status_id]=0),e[s.task_status_id]+=s.amount}),e}},methods:{expandStats(){this.expandable&&(this.expanded=!this.expanded)},sortStatuses(e){return e.sort((t,s)=>this.taskStatusMap.get(t.task_status_id).priority<this.taskStatusMap.get(s.task_status_id).priority)}}};var E=function(){var t=this,s=t._self._c;return s("div",{staticClass:"project-stats",class:{expandable:t.expandable},on:{click:t.expandStats}},[s("div",{staticClass:"nb-tasks"},[s("span",{staticClass:"tag"},[t._v(" "+t._s(t.stats.amount_done||0)+" "+t._s(t.$t("tasks.done"))+" / "+t._s(t.stats.amount||0)+" "+t._s(t.$t("tasks.tasks"))+" ")]),s("span",{staticClass:"tag"},[t._v(" "+t._s(t.formatDuration(t.stats.total_duration))+" "+t._s(t.$tc("main.days_spent",t.formatDuration(t.stats.total_duration)))+" / "+t._s(t.formatDuration(t.stats.total_estimation))+" "+t._s(t.$tc("main.days_estimated",t.formatDuration(t.stats.total_estimation)))+" ")])]),s("div",{staticClass:"color-wrapper"},t._l(t.statusIds,function(a){return s("div",{key:a,staticClass:"stat",style:{backgroundColor:t.taskStatusMap.get(a).color,width:`${t.statsByStatus[a]/t.stats.amount*100}%`},attrs:{title:`${t.taskStatusMap.get(a).name} - ${t.statsByStatus[a]} tasks`}})}),0),t.expanded?s("div",{staticClass:"task-type-stats"},t._l(t.taskTypes,function(a){return s("div",{key:a.id,staticClass:"flexrow task-type-stat"},[s("div",{staticClass:"task-type-wrapper flexrow-item"},[s("task-type-name",{staticClass:"flexrow-item task-type-name",attrs:{"task-type":a}})],1),s("div",{staticClass:"task-type-wrapper flexrow-item"},[t._v(" "+t._s(t.taskTypeStatsMap[a.id].amount_done)+" / "+t._s(t.taskTypeStatsMap[a.id].amount)+" "+t._s(t.$t("tasks.tasks"))+" ")]),s("div",{staticClass:"task-type-wrapper flexrow-item"},[t._v(" "+t._s(t.formatDuration(t.taskTypeStatsMap[a.id].total_duration))+" / "+t._s(t.formatDuration(t.taskTypeStatsMap[a.id].total_estimation))+" "+t._s(t.$tc("main.days"))+" ")]),s("div",{staticClass:"color-wrapper flexrow-item"},t._l(t.sortStatuses(t.taskTypeStatsMap[a.id].task_statuses),function(o){return s("div",{key:a.id+o.task_status_id,staticClass:"stat",style:{backgroundColor:t.taskStatusMap.get(o.task_status_id).color,width:`${t.statsByStatus[o.task_status_id]/t.taskTypeStatsMap[a.id].amount*100}%`},attrs:{title:`${t.taskStatusMap.get(o.task_status_id).name} - ${o.amount} tasks`}})}),0)])}),0):t._e()])},T=[],L=i(M,E,T,!1,null,"7e84f3f1",null,null);const B=L.exports,N={name:"production-list",props:{entries:{type:Array,default:()=>[]},productionStats:{type:Object,default:()=>{}},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},data(){return{}},components:{ProductionNameCell:h,ProductionStats:B,RowActionsCell:y,TableInfo:v},computed:{...r(["openProductions","lastProductionScreen"]),closedProductions(){return this.entries.filter(e=>e.project_status_name==="Closed")},productionStatsMap(){return this.productionStats}},methods:{...n([]),getStatusLocale(e){return{Active:"productions.status.open",Open:"productions.status.open",Closed:"productions.status.closed"}[e]},getProductionStyleLabel(e){var t;return(t=k.find(s=>s.value===e))==null?void 0:t.label}}};var O=function(){var t=this,s=t._self._c;return s("div",{staticClass:"data-list"},[s("div",{staticClass:"datatable-wrapper"},[s("table",{staticClass:"datatable multi-section"},[s("thead",{staticClass:"datatable-head"},[s("tr",[s("th",{staticClass:"name datatable-row-header",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.name"))+" ")]),s("th",{staticClass:"type",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.type"))+" ")]),s("th",{staticClass:"style",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.style"))+" ")]),s("th",{staticClass:"fps",attrs:{scope:"col"}},[t._v(t._s(t.$t("productions.fields.fps")))]),s("th",{staticClass:"ratio",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.ratio"))+" ")]),s("th",{staticClass:"resolution",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.resolution"))+" ")]),s("th",{staticClass:"actions",attrs:{scope:"col"}})])]),s("tbody",{staticClass:"datatable-body"},[s("tr",{staticClass:"datatable-type-header"},[s("th",{attrs:{scope:"rowgroup",colspan:"6"}},[s("span",{staticClass:"datatable-row-header"},[t._v(" "+t._s(t.$t("productions.status.open"))+" ")])])]),t._l(t.openProductions,function(a){return[s("tr",{key:a.id,staticClass:"datatable-row"},[s("th",{staticClass:"name datatable-row-header",attrs:{scope:"row"}},[s("production-name-cell",{attrs:{"with-avatar":!0,entry:a,"last-production-screen":t.lastProductionScreen}})],1),s("td",{staticClass:"type"},[t._v(" "+t._s(t.$t(`productions.type.${a.production_type||"short"}`))+" ")]),s("td",{staticClass:"style"},[t._v(" "+t._s(t.$t(`productions.style.${t.getProductionStyleLabel(a.production_style)||"2d3d"}`))+" ")]),s("td",{staticClass:"fps"},[t._v(" "+t._s(a.fps)+" ")]),s("td",{staticClass:"ratio"},[t._v(" "+t._s(a.ratio)+" ")]),s("td",{staticClass:"resolution"},[t._v(" "+t._s(a.resolution)+" ")]),s("row-actions-cell",{attrs:{"entry-id":a.id,"hide-delete":!0},on:{"edit-clicked":function(o){return t.$emit("edit-clicked",a)}}})],1),Object.keys(t.productionStats).length>0?s("tr",{key:a.id+"-stats",staticClass:"datatable-row"},[s("td",{staticClass:"datatable-row-stats",attrs:{colspan:7}},[s("production-stats",{attrs:{stats:t.productionStatsMap[a.id]||{}}})],1)]):t._e()]})],2),t.closedProductions.length>0?s("tbody",[s("tr",{staticClass:"datatable-type-header"},[s("th",{attrs:{scope:"rowgroup",colspan:"6"}},[s("span",{staticClass:"datatable-row-header"},[t._v(" "+t._s(t.$t("productions.status.closed"))+" ")])])]),t._l(t.closedProductions,function(a){return s("tr",{key:a.id,staticClass:"datatable-row"},[s("th",{staticClass:"name datatable-row-header",attrs:{scope:"row"}},[s("production-name-cell",{attrs:{"with-avatar":!0,entry:a,"last-production-screen":t.lastProductionScreen,"is-link":!1}})],1),s("td",{staticClass:"type"},[t._v(" "+t._s(t.$t(`productions.type.${a.production_type||"short"}`))+" ")]),s("td",{staticClass:"style"},[t._v(" "+t._s(t.$t(`productions.style.${t.getProductionStyleLabel(a.production_style)||"2d3d"}`))+" ")]),s("td",{staticClass:"fps"},[t._v(" "+t._s(a.fps)+" ")]),s("td",{staticClass:"ratio"},[t._v(" "+t._s(a.ratio)+" ")]),s("td",{staticClass:"resolution"},[t._v(" "+t._s(a.resolution)+" ")]),s("row-actions-cell",{attrs:{"entry-id":a.id},on:{"edit-clicked":function(o){return t.$emit("edit-clicked",a)},"delete-clicked":function(o){return t.$emit("delete-clicked",a)}}})],1)})],2):t._e()])]),s("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}}),s("p",{staticClass:"has-text-centered nb-productions"},[t._v(" "+t._s(t.entries.length)+" "+t._s(t.$tc("productions.number",t.entries.length))+" ")])],1)},A=[],I=i(N,O,A,!1,null,"d102e335",null,null);const R=I.exports,j={name:"productions",components:{ButtonLink:D,ButtonSimple:C,HardDeleteModal:g,EditProductionModal:$,PageTitle:w,ProductionList:R},data(){return{errors:{del:!1,edit:!1},loading:{del:!1,edit:!1,stats:!1},modals:{isNewDisplayed:!1,isDeleteDisplayed:!1},productionStats:{},productionToDelete:null,productionToEdit:null,choices:[]}},computed:{...r(["isProductionsLoading","isProductionsLoadingError","productionAvatarFormData","productions"]),currentLockText(){var e;return((e=this.productionToDelete)==null?void 0:e.name)||""}},async created(){await this.loadProductions()},methods:{...n(["deleteProduction","loadProductions","loadProductionStats","storeProductionPicture","uploadProductionAvatar"]),confirmEditProduction(e){let t="newProduction";const s=this.productionToEdit&&this.productionToEdit.id;s&&(t="editProduction",e.id=this.productionToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(t,e).then(()=>s&&this.productionAvatarFormData?this.uploadProductionAvatar(e.id):Promise.resolve()).then(()=>{this.modals.isNewDisplayed=!1,this.loading.edit=!1}).catch(a=>{console.error(a),this.loading.edit=!1,this.errors.edit=!0})},confirmDeleteProduction(){this.loading.del=!0,this.errors.del=!1,this.deleteProduction(this.productionToDelete).then(()=>{this.modals.isDeleteDisplayed=!1,this.loading.del=!1}).catch(e=>{console.error(e),this.errors.del=!0,this.loading.del=!1})},deleteText(){const e=this.productionToDelete;return e?this.$t("productions.delete_text",{name:e.name}):""},onEditClicked(e){this.productionToEdit=e,this.modals.isNewDisplayed=!0},onDeleteClicked(e){this.productionToDelete=e,this.modals.isDeleteDisplayed=!0},onNewClicked(e){this.productionToEdit={},this.modals.isNewDisplayed=!0},onProductionPictureSelected(e){this.storeProductionPicture(e)},async reloadStats(){this.loading.stats=!0,this.productionStats=await this.loadProductionStats(),this.loading.stats=!1}},watch:{},metaInfo(){return{title:`${this.$t("productions.title")} - Kitsu`}}};var F=function(){var t=this,s=t._self._c;return s("div",{staticClass:"productions page fixed-page"},[s("div",{staticClass:"flexrow page-header"},[s("page-title",{attrs:{text:t.$t("productions.title")}}),s("div",{staticClass:"filler"}),s("button-simple",{staticClass:"flexrow-item",attrs:{text:t.$t("productions.load_stats"),"is-loading":t.loading.stats},on:{click:t.reloadStats}}),s("button-link",{staticClass:"flexrow-item",attrs:{text:t.$t("productions.new_production"),icon:"plus",path:{name:"new-production"}}})],1),s("production-list",{attrs:{entries:t.productions,"production-stats":t.productionStats,"is-loading":t.isProductionsLoading,"is-error":t.isProductionsLoadingError},on:{"delete-clicked":t.onDeleteClicked,"edit-clicked":t.onEditClicked}}),s("edit-production-modal",{attrs:{active:t.modals.isNewDisplayed,"is-loading":t.loading.edit,"is-error":t.errors.edit,"production-to-edit":t.productionToEdit},on:{cancel:function(a){t.modals.isNewDisplayed=!1},fileselected:t.onProductionPictureSelected,confirm:t.confirmEditProduction}}),s("hard-delete-modal",{attrs:{active:t.modals.isDeleteDisplayed,"is-loading":t.loading.del,"is-error":t.errors.del,text:t.deleteText(),"error-text":t.$t("productions.delete_error"),"lock-text":t.currentLockText},on:{cancel:function(a){t.modals.isDeleteDisplayed=!1},confirm:t.confirmDeleteProduction}})],1)},G=[],H=i(j,F,G,!1,null,"4d2b5a46",null,null);const U=H.exports;export{U as default};
//# sourceMappingURL=Productions-Bp705z4C.js.map
