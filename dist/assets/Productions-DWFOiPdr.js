import{n as i,au as d,bI as l,bs as c,bJ as u,bK as p,K as _,a2 as f,Y as m,M as h,O as v,bL as n,bM as y,m as r,g as C,F as $,i as k,I as b,T as x,B as g,a3 as P,P as w,b as S}from"./index-CyeclmpI.js";import{U as D}from"./upload-C1-iZGbU.js";const E={name:"button-link",components:{DownloadIcon:d,EditIcon:l,PlusIcon:c,RotateCcwIcon:u,TrashIcon:p,UploadIcon:D},props:{text:{default:"",type:String},title:{default:"",type:String},path:{default:"",type:[String,Object]},icon:{default:"",type:String},isResponsive:{default:!1,type:Boolean}}};var T=function(){var o;var t=this,s=t._self._c;return s("router-link",{staticClass:"button",attrs:{title:t.title,to:t.path}},[(o=t.icon)!=null&&o.startsWith("fa")?s("span",{staticClass:"icon is-small"},[s("i",{class:`fa ${t.icon}`})]):t.icon==="plus"?s("plus-icon",{staticClass:"icon is-small"}):t.icon==="download"?s("download-icon",{staticClass:"icon is-small"}):t.icon==="upload"?s("upload-icon",{staticClass:"icon is-small"}):t.icon==="edit"?s("edit-icon",{staticClass:"icon is-small"}):t.icon==="delete"?s("trash-icon",{staticClass:"icon is-small"}):t.icon==="restore"?s("rotate-ccw-icon",{staticClass:"icon is-small"}):t._e(),t.text?s("span",{staticClass:"text",class:{"is-hidden-touch":t.isResponsive}},[t._v(" "+t._s(t.text)+" ")]):t._e()],1)},M=[],O=i(E,T,M,!1,null,null);const L=O.exports,j={name:"edit-production-modal",mixins:[_],components:{ComboboxStyled:f,FileUpload:m,ModalFooter:h,TextField:v},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},productionToEdit:{type:Object,required:!0}},data(){return{form:{},formData:null,productionStyleOptions:n,productionTypeOptions:y}},computed:{...r(["productionStatusOptions"])},methods:{runConfirmation(){this.$emit("confirm",this.form)},onFileSelected(e){this.formData=e,this.$emit("fileselected",e)},resetForm(){this.form={name:this.productionToEdit.name,code:this.productionToEdit.code,project_status_id:this.productionToEdit.project_status_id,production_type:this.productionToEdit.production_type||"short",production_style:this.productionToEdit.production_style||"2d3d",fps:this.productionToEdit.fps,ratio:this.productionToEdit.ratio,resolution:this.productionToEdit.resolution}}},watch:{productionToEdit:{immediate:!0,handler(){this.resetForm()}}}};var B=function(){var t=this,s=t._self._c;return s("div",{staticClass:"modal",class:{"is-active":t.active}},[s("div",{staticClass:"modal-background",on:{click:function(o){return t.$emit("cancel")}}}),s("div",{staticClass:"modal-content"},[s("div",{staticClass:"box"},[s("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("productions.edit_title"))+" "+t._s(t.productionToEdit.name)+" ")]),s("form",{on:{submit:function(o){o.preventDefault()}}},[s("text-field",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{label:t.$t("productions.fields.name")},on:{enter:t.runConfirmation},model:{value:t.form.name,callback:function(o){t.$set(t.form,"name",o)},expression:"form.name"}}),s("text-field",{attrs:{label:t.$t("productions.fields.code")},on:{enter:t.runConfirmation},model:{value:t.form.code,callback:function(o){t.$set(t.form,"code",o)},expression:"form.code"}}),s("combobox-styled",{staticClass:"field",attrs:{label:t.$t("productions.fields.status"),"locale-key-prefix":"productions.status.",options:t.productionStatusOptions},model:{value:t.form.project_status_id,callback:function(o){t.$set(t.form,"project_status_id",o)},expression:"form.project_status_id"}}),s("combobox-styled",{staticClass:"field",attrs:{label:t.$t("productions.fields.type"),"locale-key-prefix":"productions.type.",options:t.productionTypeOptions},model:{value:t.form.production_type,callback:function(o){t.$set(t.form,"production_type",o)},expression:"form.production_type"}}),s("combobox-styled",{staticClass:"field",attrs:{label:t.$t("productions.fields.style"),"locale-key-prefix":"productions.style.",options:t.productionStyleOptions},model:{value:t.form.production_style,callback:function(o){t.$set(t.form,"production_style",o)},expression:"form.production_style"}}),s("text-field",{attrs:{label:t.$t("productions.fields.fps"),type:"number",max:60,step:.001},on:{enter:t.runConfirmation},model:{value:t.form.fps,callback:function(o){t.$set(t.form,"fps",o)},expression:"form.fps"}}),s("text-field",{attrs:{label:t.$t("productions.fields.ratio")},on:{enter:t.runConfirmation},model:{value:t.form.ratio,callback:function(o){t.$set(t.form,"ratio",o)},expression:"form.ratio"}}),s("text-field",{attrs:{label:t.$t("productions.fields.resolution")},on:{enter:t.runConfirmation},model:{value:t.form.resolution,callback:function(o){t.$set(t.form,"resolution",o)},expression:"form.resolution"}}),s("div",[s("label",{staticClass:"label"},[t._v(t._s(t.$t("productions.picture")))]),s("file-upload",{attrs:{label:t.$t("main.csv.upload_file"),accept:".png,.jpg,.jpeg"},on:{fileselected:t.onFileSelected}})],1)],1),s("modal-footer",{attrs:{"error-text":t.$t("productions.edit_error"),"is-error":t.isError,"is-loading":t.isLoading},on:{confirm:t.runConfirmation,cancel:function(o){return t.$emit("cancel")}}})],1)])])},F=[],I=i(j,B,F,!1,null,"458ceb4f");const R=I.exports,A={name:"production-stats",mixins:[C],components:{TaskTypeName:$},props:{stats:{type:Object,default:()=>{}}},data(){return{expanded:!1}},computed:{...r(["taskStatusMap","taskTypeMap"]),expandable(){var e;return((e=this.stats.task_types)==null?void 0:e.length)>0},statusIds(){return Object.keys(this.statsByStatus).sort((e,t)=>this.taskStatusMap.get(e).priority<this.taskStatusMap.get(t).priority)},taskTypes(){const e={Asset:1,Shot:2,Sequence:3,Episode:4,Edit:5,Concept:6};return Object.keys(this.taskTypeStatsMap).map(t=>this.taskTypeMap.get(t)).sort((t,s)=>t.for_entity!==s.for_entity?e[t.for_entity]>e[s.for_entity]:t.priority>s.priority)},taskTypeStatsMap(){var t;const e={};return(t=this.stats.task_types)==null||t.forEach(s=>{e[s.task_type_id]||(e[s.task_type_id]={task_type_id:s.task_type_id,amount:0,amount_done:0,total_duration:0,total_estimation:0,task_statuses:[]}),e[s.task_type_id].amount+=s.amount,e[s.task_type_id].amount_done+=s.amount_done,e[s.task_type_id].total_duration+=s.total_duration,e[s.task_type_id].total_estimation+=s.total_estimation,e[s.task_type_id].task_statuses.push(s)}),e},statsByStatus(){var t;const e={};return(t=this.stats.task_types)==null||t.forEach(s=>{e[s.task_status_id]||(e[s.task_status_id]=0),e[s.task_status_id]+=s.amount}),e}},methods:{expandStats(){this.expandable&&(this.expanded=!this.expanded)},sortStatuses(e){return e.sort((t,s)=>this.taskStatusMap.get(t.task_status_id).priority<this.taskStatusMap.get(s.task_status_id).priority)}}};var N=function(){var t=this,s=t._self._c;return s("div",{staticClass:"project-stats",class:{expandable:t.expandable},on:{click:t.expandStats}},[s("div",{staticClass:"nb-tasks"},[s("span",{staticClass:"tag"},[t._v(" "+t._s(t.stats.amount_done||0)+" "+t._s(t.$t("tasks.done"))+" / "+t._s(t.stats.amount||0)+" "+t._s(t.$t("tasks.tasks"))+" ")]),s("span",{staticClass:"tag"},[t._v(" "+t._s(t.formatDuration(t.stats.total_duration))+" "+t._s(t.isDurationInHours()?t.$tc("main.hours_spent",t.formatDuration(t.stats.total_duration)):t.$tc("main.days_spent",t.formatDuration(t.stats.total_duration)))+" / "+t._s(t.formatDuration(t.stats.total_estimation))+" "+t._s(t.isDurationInHours()?t.$tc("main.hours_estimated",t.formatDuration(t.stats.total_estimation)):t.$tc("main.days_estimated",t.formatDuration(t.stats.total_estimation)))+" ")])]),s("div",{staticClass:"color-wrapper"},t._l(t.statusIds,function(o){return s("div",{key:o,staticClass:"stat",style:{backgroundColor:t.taskStatusMap.get(o).color,width:`${t.statsByStatus[o]/t.stats.amount*100}%`},attrs:{title:`${t.taskStatusMap.get(o).name} - ${t.statsByStatus[o]} tasks`}})}),0),t.expanded?s("div",{staticClass:"task-type-stats"},t._l(t.taskTypes,function(o){return s("div",{key:o.id,staticClass:"flexrow task-type-stat"},[s("div",{staticClass:"task-type-wrapper flexrow-item"},[s("task-type-name",{staticClass:"flexrow-item task-type-name",attrs:{"task-type":o}})],1),s("div",{staticClass:"task-type-wrapper flexrow-item"},[t._v(" "+t._s(t.taskTypeStatsMap[o.id].amount_done)+" / "+t._s(t.taskTypeStatsMap[o.id].amount)+" "+t._s(t.$t("tasks.tasks"))+" ")]),s("div",{staticClass:"task-type-wrapper flexrow-item"},[t._v(" "+t._s(t.formatDuration(t.taskTypeStatsMap[o.id].total_duration))+" / "+t._s(t.formatDuration(t.taskTypeStatsMap[o.id].total_estimation))+" "+t._s(t.$tc("main.days"))+" ")]),s("div",{staticClass:"color-wrapper flexrow-item"},t._l(t.sortStatuses(t.taskTypeStatsMap[o.id].task_statuses),function(a){return s("div",{key:o.id+a.task_status_id,staticClass:"stat",style:{backgroundColor:t.taskStatusMap.get(a.task_status_id).color,width:`${t.statsByStatus[a.task_status_id]/t.taskTypeStatsMap[o.id].amount*100}%`},attrs:{title:`${t.taskStatusMap.get(a.task_status_id).name} - ${a.amount} tasks`}})}),0)])}),0):t._e()])},U=[],q=i(A,N,U,!1,null,"548d64df");const H=q.exports,K={name:"production-list",props:{entries:{type:Array,default:()=>[]},productionStats:{type:Object,default:()=>{}},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},components:{ProductionNameCell:k,ProductionStats:H,RowActionsCell:b,TableInfo:x},computed:{...r(["openProductions","lastProductionScreen"]),closedProductions(){return this.entries.filter(e=>e.project_status_name==="Closed")},productionStatsMap(){return this.productionStats}},methods:{getStatusLocale(e){return{Active:"productions.status.open",Open:"productions.status.open",Closed:"productions.status.closed"}[e]},getProductionStyleLabel(e){var t;return(t=n.find(s=>s.value===e))==null?void 0:t.label}}};var Y=function(){var t=this,s=t._self._c;return s("div",{staticClass:"data-list"},[s("div",{staticClass:"datatable-wrapper"},[s("table",{staticClass:"datatable multi-section"},[s("thead",{staticClass:"datatable-head"},[s("tr",[s("th",{staticClass:"name datatable-row-header",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.name"))+" ")]),s("th",{staticClass:"code",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.code"))+" ")]),s("th",{staticClass:"type",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.type"))+" ")]),s("th",{staticClass:"style",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.style"))+" ")]),s("th",{staticClass:"fps",attrs:{scope:"col"}},[t._v(t._s(t.$t("productions.fields.fps")))]),s("th",{staticClass:"ratio",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.ratio"))+" ")]),s("th",{staticClass:"resolution",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.resolution"))+" ")]),s("th",{staticClass:"actions",attrs:{scope:"col"}})])]),s("tbody",{staticClass:"datatable-body"},[s("tr",{staticClass:"datatable-type-header"},[s("th",{attrs:{scope:"rowgroup",colspan:"6"}},[s("span",{staticClass:"datatable-row-header"},[t._v(" "+t._s(t.$t("productions.status.open"))+" ")])])]),t._l(t.openProductions,function(o){return[s("tr",{key:o.id,staticClass:"datatable-row"},[s("th",{staticClass:"name datatable-row-header",attrs:{scope:"row"}},[s("production-name-cell",{attrs:{"with-avatar":!0,entry:o,"last-production-screen":t.lastProductionScreen}})],1),s("td",{staticClass:"code"},[t._v(" "+t._s(o.code)+" ")]),s("td",{staticClass:"type"},[t._v(" "+t._s(t.$t(`productions.type.${o.production_type||"short"}`))+" ")]),s("td",{staticClass:"style"},[t._v(" "+t._s(t.$t(`productions.style.${t.getProductionStyleLabel(o.production_style)||"2d3d"}`))+" ")]),s("td",{staticClass:"fps"},[t._v(" "+t._s(o.fps)+" ")]),s("td",{staticClass:"ratio"},[t._v(" "+t._s(o.ratio)+" ")]),s("td",{staticClass:"resolution"},[t._v(" "+t._s(o.resolution)+" ")]),s("row-actions-cell",{attrs:{"entry-id":o.id,"hide-delete":!0},on:{"edit-clicked":function(a){return t.$emit("edit-clicked",o)}}})],1),Object.keys(t.productionStats).length>0?s("tr",{key:o.id+"-stats",staticClass:"datatable-row"},[s("td",{staticClass:"datatable-row-stats",attrs:{colspan:7}},[s("production-stats",{attrs:{stats:t.productionStatsMap[o.id]||{}}})],1)]):t._e()]})],2),t.closedProductions.length>0?s("tbody",[s("tr",{staticClass:"datatable-type-header"},[s("th",{attrs:{scope:"rowgroup",colspan:"6"}},[s("span",{staticClass:"datatable-row-header"},[t._v(" "+t._s(t.$t("productions.status.closed"))+" ")])])]),t._l(t.closedProductions,function(o){return s("tr",{key:o.id,staticClass:"datatable-row"},[s("th",{staticClass:"name datatable-row-header",attrs:{scope:"row"}},[s("production-name-cell",{attrs:{"with-avatar":!0,entry:o,"last-production-screen":t.lastProductionScreen,"is-link":!1}})],1),s("td",{staticClass:"code"},[t._v(" "+t._s(o.code)+" ")]),s("td",{staticClass:"type"},[t._v(" "+t._s(t.$t(`productions.type.${o.production_type||"short"}`))+" ")]),s("td",{staticClass:"style"},[t._v(" "+t._s(t.$t(`productions.style.${t.getProductionStyleLabel(o.production_style)||"2d3d"}`))+" ")]),s("td",{staticClass:"fps"},[t._v(" "+t._s(o.fps)+" ")]),s("td",{staticClass:"ratio"},[t._v(" "+t._s(o.ratio)+" ")]),s("td",{staticClass:"resolution"},[t._v(" "+t._s(o.resolution)+" ")]),s("row-actions-cell",{attrs:{"entry-id":o.id},on:{"edit-clicked":function(a){return t.$emit("edit-clicked",o)},"delete-clicked":function(a){return t.$emit("delete-clicked",o)}}})],1)})],2):t._e()])]),s("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}}),s("p",{staticClass:"has-text-centered nb-productions"},[t._v(" "+t._s(t.entries.length)+" "+t._s(t.$tc("productions.number",t.entries.length))+" ")])],1)},z=[],G=i(K,Y,z,!1,null,"7e75c0e1");const J=G.exports,W={name:"productions",components:{ButtonLink:L,ButtonSimple:g,HardDeleteModal:P,EditProductionModal:R,PageTitle:w,ProductionList:J},data(){return{errors:{del:!1,edit:!1},loading:{del:!1,edit:!1,stats:!1},modals:{isEditDisplayed:!1,isDeleteDisplayed:!1},productionStats:{},productionToDelete:null,productionToEdit:null}},computed:{...r(["isProductionsLoading","isProductionsLoadingError","productionAvatarFormData","productions"]),currentLockText(){var e;return((e=this.productionToDelete)==null?void 0:e.name)||""}},async created(){await this.loadProductions()},methods:{...S(["deleteProduction","loadProductions","loadProductionStats","storeProductionPicture","uploadProductionAvatar"]),confirmEditProduction(e){let t="newProduction";const s=this.productionToEdit&&this.productionToEdit.id;s&&(t="editProduction",e.id=this.productionToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(t,e).then(()=>s&&this.productionAvatarFormData?this.uploadProductionAvatar(e.id):Promise.resolve()).then(()=>{this.modals.isEditDisplayed=!1,this.loading.edit=!1}).catch(o=>{console.error(o),this.loading.edit=!1,this.errors.edit=!0})},confirmDeleteProduction(){this.loading.del=!0,this.errors.del=!1,this.deleteProduction(this.productionToDelete).then(()=>{this.modals.isDeleteDisplayed=!1,this.loading.del=!1}).catch(e=>{console.error(e),this.errors.del=!0,this.loading.del=!1})},deleteText(){const e=this.productionToDelete;return e?this.$t("productions.delete_text",{name:e.name}):""},onEditClicked(e){this.productionToEdit=e,this.modals.isEditDisplayed=!0},onDeleteClicked(e){this.productionToDelete=e,this.modals.isDeleteDisplayed=!0},onProductionPictureSelected(e){this.storeProductionPicture(e)},async reloadStats(){this.loading.stats=!0,this.productionStats=await this.loadProductionStats(),this.loading.stats=!1}},metaInfo(){return{title:`${this.$t("productions.title")} - Kitsu`}}};var Q=function(){var t=this,s=t._self._c;return s("div",{staticClass:"productions page fixed-page"},[s("div",{staticClass:"flexrow page-header"},[s("page-title",{staticClass:"filler",attrs:{text:t.$t("productions.title")}}),s("button-simple",{staticClass:"flexrow-item",attrs:{text:t.$t("productions.load_stats"),"is-loading":t.loading.stats},on:{click:t.reloadStats}}),s("button-link",{staticClass:"flexrow-item",attrs:{text:t.$t("productions.new_production"),icon:"plus",path:{name:"new-production"}}})],1),s("production-list",{attrs:{entries:t.productions,"production-stats":t.productionStats,"is-loading":t.isProductionsLoading,"is-error":t.isProductionsLoadingError},on:{"delete-clicked":t.onDeleteClicked,"edit-clicked":t.onEditClicked}}),t.modals.isEditDisplayed?s("edit-production-modal",{attrs:{active:"","is-loading":t.loading.edit,"is-error":t.errors.edit,"production-to-edit":t.productionToEdit},on:{cancel:function(o){t.modals.isEditDisplayed=!1},fileselected:t.onProductionPictureSelected,confirm:t.confirmEditProduction}}):t._e(),s("hard-delete-modal",{attrs:{active:t.modals.isDeleteDisplayed,"is-loading":t.loading.del,"is-error":t.errors.del,text:t.deleteText(),"error-text":t.$t("productions.delete_error"),"lock-text":t.currentLockText},on:{cancel:function(o){t.modals.isDeleteDisplayed=!1},confirm:t.confirmDeleteProduction}})],1)},V=[],X=i(W,Q,V,!1,null,null);const st=X.exports;export{st as default};
//# sourceMappingURL=Productions-DWFOiPdr.js.map
