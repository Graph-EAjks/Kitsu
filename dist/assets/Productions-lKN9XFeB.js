import{n as a,as as c,bG as u,bq as p,bH as _,bI as f,bJ as m,z as h,_ as v,O as y,M as $,I as C,bK as d,m as r,c as n,bL as l,f as k,v as b,a as x,x as g,T,B as E,$ as w,j as S}from"./index-D4bhLR-r.js";const P={name:"button-link",components:{DownloadIcon:c,EditIcon:u,PlusIcon:p,RotateCcwIcon:_,TrashIcon:f,UploadIcon:m},props:{text:{default:"",type:String},title:{default:"",type:String},path:{default:""},icon:{default:"",type:String},isResponsive:{default:!1,type:Boolean}},computed:{isText(){return this.text&&this.text.length>0}}};var D=function(){var t=this,s=t._self._c;return s("router-link",{staticClass:"button",attrs:{title:t.title,to:t.path}},[t.icon.length>0&&t.icon.startsWith("fa")?s("span",{staticClass:"icon is-small"},[s("i",{class:"fa "+t.icon})]):t._e(),t.icon==="plus"?s("plus-icon",{class:{icon:!0,"is-small":!0,"only-icon":!t.isText}}):t._e(),t.icon==="download"?s("download-icon",{class:{icon:!0,"is-small":!0,"only-icon":!t.isText}}):t._e(),t.icon==="upload"?s("upload-icon",{class:{icon:!0,"is-small":!0,"only-icon":!t.isText}}):t._e(),t.icon==="edit"?s("edit-icon",{class:{icon:!0,"is-small":!0,"only-icon":!t.isText}}):t._e(),t.icon==="delete"?s("trash-icon",{class:{icon:!0,"is-small":!0,"only-icon":!t.isText}}):t._e(),t.icon==="restore"?s("rotate-ccw-icon",{class:{icon:!0,"is-small":!0,"only-icon":!t.isText}}):t._e(),t.isText?s("span",{class:{text:!0,"is-hidden-touch":t.isResponsive}},[t._v(" "+t._s(t.text)+" ")]):t._e()],1)},M=[],j=a(P,D,M,!1,null,"0f99564c",null,null);const F=j.exports,O={name:"edit-production-modal",mixins:[h],components:{ComboboxStyled:v,FileUpload:y,ModalFooter:$,TextField:C},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},productionToEdit:{type:Object,default:()=>{}}},data(){const e={formData:null,productionStyleOptions:l,productionTypeOptions:d};return this.productionToEdit&&this.productionToEdit.id?e.form={name:this.productionToEdit.name,code:this.productionToEdit.code,project_status_id:this.productionToEdit.project_status_id,fps:this.productionToEdit.fps,ratio:this.productionToEdit.ratio,resolution:this.productionToEdit.resolution,production_type:this.productionToEdit.production_type||"short",production_style:this.productionToEdit.production_style||"2d3d"}:e.form={name:"",code:"",project_status_id:this.productionStatus?this.productionStatus[0].id:null,fps:"",ratio:"",resolution:"",production_type:"short",production_style:"2d3d"},e},created(){this.resetForm(),this.productionTypeOptions=d},mounted(){this.productionStatus.length>0&&(this.form.project_status_id=this.productionStatus[0].id)},computed:{...r(["productions","productionStatus","productionStatusOptions"])},methods:{...n([]),runConfirmation(){this.$emit("confirm",this.form)},onFileSelected(e){this.formData=e,this.$emit("fileselected",e)},resetForm(){this.productionToEdit&&this.productionToEdit.id?(this.form={name:this.productionToEdit.name,code:this.productionToEdit.code,project_status_id:this.productionToEdit.project_status_id,fps:this.productionToEdit.fps,ratio:this.productionToEdit.ratio,resolution:this.productionToEdit.resolution,production_type:this.productionToEdit.production_type||"short"},this.form.project_status_id=null,this.$nextTick(()=>{this.form.project_status_id=this.productionToEdit.project_status_id})):this.form={name:"",project_status_id:this.productionStatusOptions[0].value,fps:"",ratio:"",resolution:"",production_type:"short"}}},watch:{productionToEdit(){this.resetForm()},active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus(),this.formData=null,this.$refs.fileField&&this.$refs.fileField.reset()},100)}}};var L=function(){var t=this,s=t._self._c;return s("div",{class:{modal:!0,"is-active":t.active}},[s("div",{staticClass:"modal-background",on:{click:function(o){return t.$emit("cancel")}}}),s("div",{staticClass:"modal-content"},[s("div",{staticClass:"box"},[t.productionToEdit&&t.productionToEdit.id?s("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("productions.edit_title"))+" "+t._s(t.productionToEdit.name)+" ")]):s("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("productions.new_production"))+" ")]),s("form",{on:{submit:function(o){o.preventDefault()}}},[s("text-field",{directives:[{name:"focus",rawName:"v-focus"}],ref:"nameField",attrs:{label:t.$t("productions.fields.name")},on:{enter:t.runConfirmation},model:{value:t.form.name,callback:function(o){t.$set(t.form,"name",o)},expression:"form.name"}}),s("text-field",{ref:"codeField",attrs:{label:t.$t("productions.fields.code")},on:{enter:t.runConfirmation},model:{value:t.form.code,callback:function(o){t.$set(t.form,"code",o)},expression:"form.code"}}),t.productionToEdit&&t.productionToEdit.id?s("combobox-styled",{staticClass:"field",attrs:{label:t.$t("productions.fields.status"),options:t.productionStatusOptions,"locale-key-prefix":"productions.status."},on:{enter:t.runConfirmation},model:{value:t.form.project_status_id,callback:function(o){t.$set(t.form,"project_status_id",o)},expression:"form.project_status_id"}}):t._e(),s("combobox-styled",{staticClass:"field",attrs:{label:t.$t("productions.fields.style"),options:t.productionStyleOptions,"locale-key-prefix":"productions.style."},model:{value:t.form.production_style,callback:function(o){t.$set(t.form,"production_style",o)},expression:"form.production_style"}}),t.productionToEdit&&t.productionToEdit.id?s("text-field",{ref:"fpsField",attrs:{label:t.$t("productions.fields.fps"),type:"number",max:60,step:.001},on:{enter:t.runConfirmation},model:{value:t.form.fps,callback:function(o){t.$set(t.form,"fps",o)},expression:"form.fps"}}):t._e(),t.productionToEdit&&t.productionToEdit.id?s("text-field",{ref:"ratioField",attrs:{label:t.$t("productions.fields.ratio")},on:{enter:t.runConfirmation},model:{value:t.form.ratio,callback:function(o){t.$set(t.form,"ratio",o)},expression:"form.ratio"}}):t._e(),t.productionToEdit&&t.productionToEdit.id?s("text-field",{ref:"resolutionField",attrs:{label:t.$t("productions.fields.resolution")},on:{enter:t.runConfirmation},model:{value:t.form.resolution,callback:function(o){t.$set(t.form,"resolution",o)},expression:"form.resolution"}}):t._e(),t.productionToEdit&&t.productionToEdit.id?s("div",[s("label",{staticClass:"label"},[t._v(t._s(t.$t("productions.picture")))]),s("file-upload",{ref:"fileField",attrs:{label:t.$t("main.csv.upload_file"),accept:".png,.jpg,.jpeg"},on:{fileselected:t.onFileSelected}})],1):t._e()],1),s("modal-footer",{attrs:{"error-text":t.$t("productions.edit_error"),"is-error":t.isError,"is-loading":t.isLoading},on:{confirm:t.runConfirmation,cancel:function(o){return t.$emit("cancel")}}})],1)])])},B=[],N=a(O,L,B,!1,null,"49bfb57b",null,null);const I=N.exports,R={name:"production-stats",mixins:[k],components:{TaskTypeName:b},props:{stats:{type:Object,default:()=>{}}},data(){return{expanded:!1}},computed:{...r(["taskStatusMap","taskTypeMap"]),expandable(){var e;return((e=this.stats.task_types)==null?void 0:e.length)>0},statusIds(){return Object.keys(this.statsByStatus).sort((e,t)=>this.taskStatusMap.get(e).priority<this.taskStatusMap.get(t).priority)},taskTypes(){const e={Asset:1,Shot:2,Sequence:3,Episode:4,Edit:5,Concept:6};return Object.keys(this.taskTypeStatsMap).map(t=>this.taskTypeMap.get(t)).sort((t,s)=>t.for_entity!==s.for_entity?e[t.for_entity]>e[s.for_entity]:t.priority>s.priority)},taskTypeStatsMap(){var t;const e={};return(t=this.stats.task_types)==null||t.forEach(s=>{e[s.task_type_id]||(e[s.task_type_id]={task_type_id:s.task_type_id,amount:0,amount_done:0,total_duration:0,total_estimation:0,task_statuses:[]}),e[s.task_type_id].amount+=s.amount,e[s.task_type_id].amount_done+=s.amount_done,e[s.task_type_id].total_duration+=s.total_duration,e[s.task_type_id].total_estimation+=s.total_estimation,e[s.task_type_id].task_statuses.push(s)}),e},statsByStatus(){var t;const e={};return(t=this.stats.task_types)==null||t.forEach(s=>{e[s.task_status_id]||(e[s.task_status_id]=0),e[s.task_status_id]+=s.amount}),e}},methods:{expandStats(){this.expandable&&(this.expanded=!this.expanded)},sortStatuses(e){return e.sort((t,s)=>this.taskStatusMap.get(t.task_status_id).priority<this.taskStatusMap.get(s.task_status_id).priority)}}};var A=function(){var t=this,s=t._self._c;return s("div",{staticClass:"project-stats",class:{expandable:t.expandable},on:{click:t.expandStats}},[s("div",{staticClass:"nb-tasks"},[s("span",{staticClass:"tag"},[t._v(" "+t._s(t.stats.amount_done||0)+" "+t._s(t.$t("tasks.done"))+" / "+t._s(t.stats.amount||0)+" "+t._s(t.$t("tasks.tasks"))+" ")]),s("span",{staticClass:"tag"},[t._v(" "+t._s(t.formatDuration(t.stats.total_duration))+" "+t._s(t.$tc("main.days_spent",t.formatDuration(t.stats.total_duration)))+" / "+t._s(t.formatDuration(t.stats.total_estimation))+" "+t._s(t.$tc("main.days_estimated",t.formatDuration(t.stats.total_estimation)))+" ")])]),s("div",{staticClass:"color-wrapper"},t._l(t.statusIds,function(o){return s("div",{key:o,staticClass:"stat",style:{backgroundColor:t.taskStatusMap.get(o).color,width:`${t.statsByStatus[o]/t.stats.amount*100}%`},attrs:{title:`${t.taskStatusMap.get(o).name} - ${t.statsByStatus[o]} tasks`}})}),0),t.expanded?s("div",{staticClass:"task-type-stats"},t._l(t.taskTypes,function(o){return s("div",{key:o.id,staticClass:"flexrow task-type-stat"},[s("div",{staticClass:"task-type-wrapper flexrow-item"},[s("task-type-name",{staticClass:"flexrow-item task-type-name",attrs:{"task-type":o}})],1),s("div",{staticClass:"task-type-wrapper flexrow-item"},[t._v(" "+t._s(t.taskTypeStatsMap[o.id].amount_done)+" / "+t._s(t.taskTypeStatsMap[o.id].amount)+" "+t._s(t.$t("tasks.tasks"))+" ")]),s("div",{staticClass:"task-type-wrapper flexrow-item"},[t._v(" "+t._s(t.formatDuration(t.taskTypeStatsMap[o.id].total_duration))+" / "+t._s(t.formatDuration(t.taskTypeStatsMap[o.id].total_estimation))+" "+t._s(t.$tc("main.days"))+" ")]),s("div",{staticClass:"color-wrapper flexrow-item"},t._l(t.sortStatuses(t.taskTypeStatsMap[o.id].task_statuses),function(i){return s("div",{key:o.id+i.task_status_id,staticClass:"stat",style:{backgroundColor:t.taskStatusMap.get(i.task_status_id).color,width:`${t.statsByStatus[i.task_status_id]/t.taskTypeStatsMap[o.id].amount*100}%`},attrs:{title:`${t.taskStatusMap.get(i.task_status_id).name} - ${i.amount} tasks`}})}),0)])}),0):t._e()])},U=[],q=a(R,A,U,!1,null,"7e84f3f1",null,null);const z=q.exports,G={name:"production-list",props:{entries:{type:Array,default:()=>[]},productionStats:{type:Object,default:()=>{}},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},data(){return{}},components:{ProductionNameCell:x,ProductionStats:z,RowActionsCell:g,TableInfo:T},computed:{...r(["openProductions","lastProductionScreen"]),closedProductions(){return this.entries.filter(e=>e.project_status_name==="Closed")},productionStatsMap(){return this.productionStats}},methods:{...n([]),getStatusLocale(e){return{Active:"productions.status.open",Open:"productions.status.open",Closed:"productions.status.closed"}[e]},getProductionStyleLabel(e){var t;return(t=l.find(s=>s.value===e))==null?void 0:t.label}}};var H=function(){var t=this,s=t._self._c;return s("div",{staticClass:"data-list"},[s("div",{staticClass:"datatable-wrapper"},[s("table",{staticClass:"datatable multi-section"},[s("thead",{staticClass:"datatable-head"},[s("tr",[s("th",{staticClass:"name datatable-row-header",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.name"))+" ")]),s("th",{staticClass:"code",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.code"))+" ")]),s("th",{staticClass:"type",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.type"))+" ")]),s("th",{staticClass:"style",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.style"))+" ")]),s("th",{staticClass:"fps",attrs:{scope:"col"}},[t._v(t._s(t.$t("productions.fields.fps")))]),s("th",{staticClass:"ratio",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.ratio"))+" ")]),s("th",{staticClass:"resolution",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("productions.fields.resolution"))+" ")]),s("th",{staticClass:"actions",attrs:{scope:"col"}})])]),s("tbody",{staticClass:"datatable-body"},[s("tr",{staticClass:"datatable-type-header"},[s("th",{attrs:{scope:"rowgroup",colspan:"6"}},[s("span",{staticClass:"datatable-row-header"},[t._v(" "+t._s(t.$t("productions.status.open"))+" ")])])]),t._l(t.openProductions,function(o){return[s("tr",{key:o.id,staticClass:"datatable-row"},[s("th",{staticClass:"name datatable-row-header",attrs:{scope:"row"}},[s("production-name-cell",{attrs:{"with-avatar":!0,entry:o,"last-production-screen":t.lastProductionScreen}})],1),s("td",{staticClass:"code"},[t._v(" "+t._s(o.code)+" ")]),s("td",{staticClass:"type"},[t._v(" "+t._s(t.$t(`productions.type.${o.production_type||"short"}`))+" ")]),s("td",{staticClass:"style"},[t._v(" "+t._s(t.$t(`productions.style.${t.getProductionStyleLabel(o.production_style)||"2d3d"}`))+" ")]),s("td",{staticClass:"fps"},[t._v(" "+t._s(o.fps)+" ")]),s("td",{staticClass:"ratio"},[t._v(" "+t._s(o.ratio)+" ")]),s("td",{staticClass:"resolution"},[t._v(" "+t._s(o.resolution)+" ")]),s("row-actions-cell",{attrs:{"entry-id":o.id,"hide-delete":!0},on:{"edit-clicked":function(i){return t.$emit("edit-clicked",o)}}})],1),Object.keys(t.productionStats).length>0?s("tr",{key:o.id+"-stats",staticClass:"datatable-row"},[s("td",{staticClass:"datatable-row-stats",attrs:{colspan:7}},[s("production-stats",{attrs:{stats:t.productionStatsMap[o.id]||{}}})],1)]):t._e()]})],2),t.closedProductions.length>0?s("tbody",[s("tr",{staticClass:"datatable-type-header"},[s("th",{attrs:{scope:"rowgroup",colspan:"6"}},[s("span",{staticClass:"datatable-row-header"},[t._v(" "+t._s(t.$t("productions.status.closed"))+" ")])])]),t._l(t.closedProductions,function(o){return s("tr",{key:o.id,staticClass:"datatable-row"},[s("th",{staticClass:"name datatable-row-header",attrs:{scope:"row"}},[s("production-name-cell",{attrs:{"with-avatar":!0,entry:o,"last-production-screen":t.lastProductionScreen,"is-link":!1}})],1),s("td",{staticClass:"code"},[t._v(" "+t._s(o.code)+" ")]),s("td",{staticClass:"type"},[t._v(" "+t._s(t.$t(`productions.type.${o.production_type||"short"}`))+" ")]),s("td",{staticClass:"style"},[t._v(" "+t._s(t.$t(`productions.style.${t.getProductionStyleLabel(o.production_style)||"2d3d"}`))+" ")]),s("td",{staticClass:"fps"},[t._v(" "+t._s(o.fps)+" ")]),s("td",{staticClass:"ratio"},[t._v(" "+t._s(o.ratio)+" ")]),s("td",{staticClass:"resolution"},[t._v(" "+t._s(o.resolution)+" ")]),s("row-actions-cell",{attrs:{"entry-id":o.id},on:{"edit-clicked":function(i){return t.$emit("edit-clicked",o)},"delete-clicked":function(i){return t.$emit("delete-clicked",o)}}})],1)})],2):t._e()])]),s("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}}),s("p",{staticClass:"has-text-centered nb-productions"},[t._v(" "+t._s(t.entries.length)+" "+t._s(t.$tc("productions.number",t.entries.length))+" ")])],1)},K=[],Y=a(G,H,K,!1,null,"aea5bb62",null,null);const J=Y.exports,W={name:"productions",components:{ButtonLink:F,ButtonSimple:E,HardDeleteModal:w,EditProductionModal:I,PageTitle:S,ProductionList:J},data(){return{errors:{del:!1,edit:!1},loading:{del:!1,edit:!1,stats:!1},modals:{isNewDisplayed:!1,isDeleteDisplayed:!1},productionStats:{},productionToDelete:null,productionToEdit:null,choices:[]}},computed:{...r(["isProductionsLoading","isProductionsLoadingError","productionAvatarFormData","productions"]),currentLockText(){var e;return((e=this.productionToDelete)==null?void 0:e.name)||""}},async created(){await this.loadProductions()},methods:{...n(["deleteProduction","loadProductions","loadProductionStats","storeProductionPicture","uploadProductionAvatar"]),confirmEditProduction(e){let t="newProduction";const s=this.productionToEdit&&this.productionToEdit.id;s&&(t="editProduction",e.id=this.productionToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(t,e).then(()=>s&&this.productionAvatarFormData?this.uploadProductionAvatar(e.id):Promise.resolve()).then(()=>{this.modals.isNewDisplayed=!1,this.loading.edit=!1}).catch(o=>{console.error(o),this.loading.edit=!1,this.errors.edit=!0})},confirmDeleteProduction(){this.loading.del=!0,this.errors.del=!1,this.deleteProduction(this.productionToDelete).then(()=>{this.modals.isDeleteDisplayed=!1,this.loading.del=!1}).catch(e=>{console.error(e),this.errors.del=!0,this.loading.del=!1})},deleteText(){const e=this.productionToDelete;return e?this.$t("productions.delete_text",{name:e.name}):""},onEditClicked(e){this.productionToEdit=e,this.modals.isNewDisplayed=!0},onDeleteClicked(e){this.productionToDelete=e,this.modals.isDeleteDisplayed=!0},onNewClicked(e){this.productionToEdit={},this.modals.isNewDisplayed=!0},onProductionPictureSelected(e){this.storeProductionPicture(e)},async reloadStats(){this.loading.stats=!0,this.productionStats=await this.loadProductionStats(),this.loading.stats=!1}},watch:{},metaInfo(){return{title:`${this.$t("productions.title")} - Kitsu`}}};var Q=function(){var t=this,s=t._self._c;return s("div",{staticClass:"productions page fixed-page"},[s("div",{staticClass:"flexrow page-header"},[s("page-title",{attrs:{text:t.$t("productions.title")}}),s("div",{staticClass:"filler"}),s("button-simple",{staticClass:"flexrow-item",attrs:{text:t.$t("productions.load_stats"),"is-loading":t.loading.stats},on:{click:t.reloadStats}}),s("button-link",{staticClass:"flexrow-item",attrs:{text:t.$t("productions.new_production"),icon:"plus",path:{name:"new-production"}}})],1),s("production-list",{attrs:{entries:t.productions,"production-stats":t.productionStats,"is-loading":t.isProductionsLoading,"is-error":t.isProductionsLoadingError},on:{"delete-clicked":t.onDeleteClicked,"edit-clicked":t.onEditClicked}}),s("edit-production-modal",{attrs:{active:t.modals.isNewDisplayed,"is-loading":t.loading.edit,"is-error":t.errors.edit,"production-to-edit":t.productionToEdit},on:{cancel:function(o){t.modals.isNewDisplayed=!1},fileselected:t.onProductionPictureSelected,confirm:t.confirmEditProduction}}),s("hard-delete-modal",{attrs:{active:t.modals.isDeleteDisplayed,"is-loading":t.loading.del,"is-error":t.errors.del,text:t.deleteText(),"error-text":t.$t("productions.delete_error"),"lock-text":t.currentLockText},on:{cancel:function(o){t.modals.isDeleteDisplayed=!1},confirm:t.confirmDeleteProduction}})],1)},V=[],X=a(W,Q,V,!1,null,"4d2b5a46",null,null);const tt=X.exports;export{tt as default};
//# sourceMappingURL=Productions-lKN9XFeB.js.map
