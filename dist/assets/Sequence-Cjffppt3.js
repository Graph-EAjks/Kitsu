import{_ as U,m as F,a as O,O as W,H as j,T as G,R as H,Q as K,h as Q,U as X,E as Y,X as Z,Y as J,Z as $,B as ee,z as te,r,c as l,o as i,e as s,l as d,f as c,w as g,k as _,d as p,$ as h,t as u,F as S,g as q,n as se,a5 as ne,b8 as ie,b_ as re,b4 as oe}from"./index-HPQhSyHW.js";import{E as ce,a as le,b as ue,c as ae,e as de}from"./EntityTaskList-C1yFBvS-.js";import{E as he}from"./EditSequenceModal-CzbhyaWG.js";import{E as me}from"./EntityChat-CmUbrNe-.js";import"./PeopleNameCell-DKLnx6Xc.js";const _e={name:"sequence",mixins:[de,te],components:{ButtonSimple:ee,ComboboxNumber:$,CornerLeftUpIcon:J,DescriptionCell:Z,EditSequenceModal:he,EntityChat:me,EntityNews:ae,EntityPreviewFiles:ue,EntityTaskList:le,EntityTimeLogs:ce,EntityThumbnail:Y,PageSubtitle:X,PageTitle:Q,Schedule:K,RouteSectionTabs:H,TableInfo:G,TaskInfo:j,TaskTypeName:W},data(){return{type:"sequence",currentSequence:null,currentTask:null,currentSection:"infos",casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...O(["currentEpisode","currentProduction","getTaskTypePriority","isCurrentUserManager","isTVShow","sequenceMap","sequenceMetadataDescriptors","sequenceSearchText","route","taskMap","taskTypeMap"]),title(){return this.currentSequence?this.currentEpisode?`${this.currentEpisode.name} / ${this.currentSequence.name}`:`${this.currentSequence.name}`:"Loading..."},currentEntity(){return this.currentSequence},getSequencesRoute(){const e=this.currentProduction.id,n=this.currentEpisode?.id,m=oe(e,"sequences",n);return m.query={search:this.sequenceSearchText},m},nbAssets(){let e=0;return this.currentSequence&&this.currentSection==="casting"&&this.currentSequence.castingAssetsByType&&this.currentSequence.castingAssetsByType.forEach(n=>{e+=n.length}),e}},methods:{...F(["clearSelectedTasks","editSequence","setCurrentSequence","loadEpisodes","loadSequencesWithTasks","loadSequenceCasting"]),init(){this.loadCurrentSequence().then(e=>{this.currentSequence=e,this.currentSection=this.route.query.section||"infos",this.casting.isLoading=!0,this.casting.isError=!1,this.currentSequence?this.loadSequenceCasting(this.currentSequence).then(()=>{this.casting.isLoading=!1}).catch(n=>{this.casting.isLoading=!1,this.casting.isError=!0,console.error(n)}):this.resetData()}).catch(console.error)},loadCurrentSequence(){return new Promise((e,n)=>{const m=this.route.params.sequence_id,f=this.sequenceMap.get(m)||null;return!f||!f.validations?this.loadEpisodes().then(()=>this.loadSequencesWithTasks()).then(()=>{const t=re.cache.sequenceMap.get(m)||null;return e(t)}):e(f)})},confirmEditSequence(e){e.id=this.currentSequence.id,this.loading.edit=!0,this.errors.edit=!1,this.editSequence(e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(n=>{console.error(n),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(e){const n=this.isTVShow?this.currentEpisode?.id||"main":null,m={name:"asset",params:{production_id:this.currentProduction.id,asset_id:e.asset_id}};return ie(m,n)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.loadCurrentSequence().then(e=>(this.currentSequence=e,this.loadSequenceCasting(this.currentSequence))).then(()=>{this.casting.isLoading=!1}).catch(e=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(e)})})}},head(){return{title:`${this.title} - Kitsu`}}},pe={class:"columns fixed-page sequence xyz-in",xyz:"fade"},ye={class:"column main-column"},fe={class:"page-header flexrow"},ge={class:"flexrow-item ml2"},Se={class:"flexrow-item"},qe={class:"sequence-data block"},ke={class:"flexrow infos"},be={class:"flexrow-item flexcolumn entity-infos"},ve={class:"flexrow"},we={class:"flexrow-item has-text-right"},Te={class:"table-body"},Ee={key:0,class:"datatable no-header"},Ce={class:"table-body"},Le={class:"datatable-row"},Me={class:"field-label"},ze={class:"field-label"},Ie={class:"flexrow"},xe={class:"sequence-casting"},Be={class:"casting-data mt1"},Pe={key:0},De={key:0},Ve={class:"asset-type"},Ae={class:"asset-list"},Ne={class:"break-word"},Re={key:0},Ue={class:"ready-for flexrow"},Fe={key:1,class:"mt1"},Oe={key:0,class:"schedule mt1"},We={class:"wrapper"},je={class:"column side-column"};function Ge(e,n,m,f,t,y){const w=r("corner-left-up-icon"),k=r("router-link"),b=r("entity-thumbnail"),T=r("page-title"),E=r("route-section-tabs"),v=r("page-subtitle"),C=r("entity-task-list"),L=r("button-simple"),M=r("description-cell"),z=r("combobox-number"),I=r("task-type-name"),x=r("table-info"),B=r("schedule"),P=r("entity-chat"),D=r("entity-preview-files"),V=r("entity-time-logs"),A=r("entity-news"),N=r("task-info"),R=r("edit-sequence-modal");return i(),l("div",pe,[s("div",ye,[s("div",fe,[c(k,{class:"flexrow-item has-text-centered back-link",to:y.getSequencesRoute},{default:g(()=>[c(w)]),_:1},8,["to"]),s("span",ge,[t.currentSequence?(i(),_(b,{key:0,class:"entity-thumbnail",entity:t.currentSequence,"empty-width":120,"empty-height":50,width:120},null,8,["entity"])):p("",!0)]),s("div",Se,[c(T,{text:y.title,class:"entity-title"},null,8,["text"])])]),s("div",qe,[c(E,{class:"section-tabs","active-tab":t.currentSection,route:e.$route,tabs:e.entityNavOptions},null,8,["active-tab","route","tabs"]),d(s("div",ke,[s("div",be,[c(v,{text:e.$t("main.tasks")},null,8,["text"]),c(C,{class:"task-list",entries:e.currentTasks,"is-loading":!t.currentSequence,"is-error":!1,onTaskSelected:e.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",ve,[c(v,{text:e.$t("main.info")},null,8,["text"]),n[3]||(n[3]=s("div",{class:"filler"},null,-1)),s("div",we,[e.isCurrentUserManager?(i(),_(L,{key:0,icon:"edit",title:e.$t("sequences.edit_title"),onClick:n[0]||(n[0]=o=>t.modals.edit=!0)},null,8,["title"])):p("",!0)])]),s("div",Te,[t.currentSequence?(i(),l("table",Ee,[s("tbody",Ce,[s("tr",Le,[s("td",Me,u(e.$t("shots.fields.description")),1),c(M,{entry:t.currentSequence,full:!0},null,8,["entry"])]),(i(!0),l(S,null,q(e.sequenceMetadataDescriptors,o=>(i(),l("tr",{key:o.id,class:"datatable-row"},[s("td",ze,u(o.name),1),s("td",null,u(t.currentSequence.data?t.currentSequence.data[o.field_name]:""),1)]))),128))])])):p("",!0)])])],512),[[h,t.currentSection==="infos"]]),s("div",Ie,[n[4]||(n[4]=s("div",{class:"filler"},null,-1)),d(s("span",{class:"flexrow-item mt05"},u(e.$t("schedule.zoom_level"))+": ",513),[[h,t.currentSection==="schedule"&&e.scheduleItems[0].children.length>0]]),d(c(z,{class:"zoom-level flexrow-item",options:e.zoomOptions,"is-simple":"",modelValue:e.zoomLevel,"onUpdate:modelValue":n[1]||(n[1]=o=>e.zoomLevel=o)},null,8,["options","modelValue"]),[[h,t.currentSection==="schedule"&&e.scheduleItems[0].children.length>0]])]),d(s("div",xe,[s("div",Be,[d(s("span",null,u(y.nbAssets)+" "+u(e.$tc("assets.number",y.nbAssets)),513),[[h,t.currentSection==="casting"&&y.nbAssets>0]]),d(s("span",{class:"tag tag-standby"},u(e.$t("breakdown.fields.standby")),513),[[h,t.currentSection==="casting"&&t.currentSequence&&t.currentSequence.is_casting_standby]])]),t.currentSequence?(i(),l("div",Pe,[t.currentSequence&&t.currentSequence.castingAssetsByType&&t.currentSequence.castingAssetsByType[0].length>0?(i(),l("div",De,[(i(!0),l(S,null,q(t.currentSequence.castingAssetsByType,o=>(i(),l("div",{class:"type-assets",key:o.length>0?o[0].asset_type_name:""},[s("div",Ve,u(o.length>0?o[0].asset_type_name:"")+" ("+u(o.length)+") ",1),s("div",Ae,[(i(!0),l(S,null,q(o,a=>(i(),_(k,{class:"asset-link",key:a.id,to:y.buildAssetRoute(a)},{default:g(()=>[c(b,{class:se(["entity-thumbnail",{shared:a.shared}]),entity:a,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["class","entity"]),s("div",Ne,[ne(u(a.asset_name)+" ",1),a.nb_occurences>1?(i(),l("span",Re," ("+u(a.nb_occurences)+") ",1)):p("",!0)]),s("div",Ue,[a.ready_for?(i(),_(I,{key:0,class:"flexrow-item","task-type":e.taskTypeMap.get(a.ready_for),"current-production-id":e.currentProduction.id,title:"Ready for: "+e.taskTypeMap.get(a.ready_for).name},null,8,["task-type","current-production-id","title"])):p("",!0)])]),_:2},1032,["to"]))),128))])]))),128))])):(i(),l("div",Fe,u(e.$t("sequences.no_casting")),1))])):(i(),_(x,{key:1,"is-loading":t.casting.isLoading,"is-error":t.casting.isError},null,8,["is-loading","is-error"]))],512),[[h,t.currentSection==="casting"]]),e.scheduleItems[0].children.length>0?d((i(),l("div",Oe,[s("div",We,[c(B,{ref:"schedule-widget","start-date":e.tasksStartDate,"end-date":e.tasksEndDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1},null,8,["start-date","end-date","hierarchy","zoom-level"])])],512)),[[h,t.currentSection==="schedule"]]):d((i(),l("div",{key:1,class:"mt1"},u(e.$t("main.empty_schedule")),513)),[[h,t.currentSection==="schedule"]]),t.currentSection==="chat"?(i(),_(P,{key:2,entity:t.currentSequence,name:t.currentSequence?.full_name},null,8,["entity","name"])):p("",!0),t.currentSequence&&t.currentSection==="preview-files"?(i(),_(D,{key:3,entity:t.currentSequence},null,8,["entity"])):p("",!0),t.currentSequence&&t.currentSection==="time-logs"?(i(),_(V,{key:4,entity:t.currentSequence},null,8,["entity"])):p("",!0)])]),d(s("div",je,[c(N,{task:t.currentTask,"entity-type":"Sequence","with-actions":""},{default:g(()=>[c(A,{class:"news-column",entity:t.currentSequence},null,8,["entity"])]),_:1},8,["task"])],512),[[h,t.currentSection==="infos"]]),c(R,{ref:"edit-sequence-modal",active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"sequence-to-edit":t.currentSequence,onCancel:n[2]||(n[2]=o=>t.modals.edit=!1),onConfirm:y.confirmEditSequence},null,8,["active","is-loading","is-error","sequence-to-edit","onConfirm"])])}const Ze=U(_e,[["render",Ge],["__scopeId","data-v-b53ee9b7"]]);export{Ze as default};
//# sourceMappingURL=Sequence-Cjffppt3.js.map
