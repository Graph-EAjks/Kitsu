import{_ as F,s as O,B as W,M as X,N as j,O as G,E as J,R as K,P as H,W as Q,U as Y,T as Z,J as $,X as ee,m as te,aX as se,b as ne,bV as ie,b3 as re,r,o as i,c as l,e as s,f as c,w as g,l as p,d as y,n as h,$ as m,t as u,F as S,g as q,p as oe,a3 as ce}from"./index-D1nSJh8R.js";import{e as le,E as ue,a as ae,b as de,c as he}from"./EntityTaskList-DHezf_HD.js";import{E as me}from"./EditSequenceModal-Uxn_vXL2.js";import{E as _e}from"./EntityChat-C4LanBuh.js";import"./PeopleNameCell-CUAMMz42.js";const pe={name:"sequence",mixins:[le,O],components:{ButtonSimple:W,ComboboxNumber:X,CornerLeftUpIcon:j,DescriptionCell:G,EditSequenceModal:me,EntityChat:_e,EntityNews:ue,EntityPreviewFiles:ae,EntityTaskList:de,EntityTimeLogs:he,EntityThumbnail:J,PageSubtitle:K,PageTitle:H,Schedule:Q,RouteSectionTabs:Y,TableInfo:Z,TaskInfo:$,TaskTypeName:ee},data(){return{type:"sequence",currentSequence:null,currentTask:null,currentSection:"infos",casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1,preview:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...te(["currentEpisode","currentProduction","getTaskTypePriority","isCurrentUserManager","isTVShow","sequenceMap","sequenceMetadataDescriptors","sequenceSearchText","route","taskMap","taskTypeMap"]),title(){return this.currentSequence?this.currentEpisode?`${this.currentEpisode.name} / ${this.currentSequence.name}`:`${this.currentSequence.name}`:"Loading..."},currentEntity(){return this.currentSequence},getSequencesRoute(){var a;const e=this.currentProduction.id,n=(a=this.currentEpisode)==null?void 0:a.id,_=se(e,"sequences",n);return _.query={search:this.sequenceSearchText},_},nbAssets(){let e=0;return this.currentSequence&&this.currentSection==="casting"&&this.currentSequence.castingAssetsByType&&this.currentSequence.castingAssetsByType.forEach(n=>{e+=n.length}),e}},methods:{...ne(["clearSelectedTasks","editSequence","setCurrentSequence","loadEpisodes","loadSequencesWithTasks","loadSequenceCasting"]),init(){this.loadCurrentSequence().then(e=>{this.currentSequence=e,this.currentSection=this.route.query.section||"infos",this.casting.isLoading=!0,this.casting.isError=!1,this.currentSequence?this.loadSequenceCasting(this.currentSequence).then(()=>{this.casting.isLoading=!1}).catch(n=>{this.casting.isLoading=!1,this.casting.isError=!0,console.error(n)}):this.resetData()}).catch(console.error)},loadCurrentSequence(){return new Promise((e,n)=>{const _=this.route.params.sequence_id,a=this.sequenceMap.get(_)||null;return!a||!a.validations?this.loadEpisodes().then(()=>this.loadSequencesWithTasks()).then(()=>{const t=ie.cache.sequenceMap.get(_)||null;return e(t)}):e(a)})},confirmEditSequence(e){e.id=this.currentSequence.id,this.loading.edit=!0,this.errors.edit=!1,this.editSequence(e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(n=>{console.error(n),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(e){var a;const n=this.isTVShow?((a=this.currentEpisode)==null?void 0:a.id)||"main":null,_={name:"asset",params:{production_id:this.currentProduction.id,asset_id:e.asset_id}};return re(_,n)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.loadCurrentSequence().then(e=>(this.currentSequence=e,this.loadSequenceCasting(this.currentSequence))).then(()=>{this.casting.isLoading=!1}).catch(e=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(e)})})}},head(){return{title:`${this.title} - Kitsu`}}},ye={class:"columns fixed-page sequence xyz-in",xyz:"fade"},fe={class:"column main-column"},ge={class:"page-header flexrow"},Se={class:"flexrow-item ml2"},qe={class:"flexrow-item"},be={class:"sequence-data block"},ke={class:"flexrow infos"},ve={class:"flexrow-item flexcolumn entity-infos"},we={class:"flexrow"},Te={class:"flexrow-item has-text-right"},Ee={class:"table-body"},Ce={key:0,class:"datatable no-header"},Le={class:"table-body"},Me={class:"datatable-row"},xe={class:"field-label"},Ie={class:"field-label"},ze={class:"flexrow"},Be={class:"sequence-casting"},Pe={class:"casting-data mt1"},Ve={key:0},De={key:0},Ne={class:"asset-type"},Ae={class:"asset-list"},Re={class:"break-word"},Ue={key:0},Fe={class:"ready-for flexrow"},Oe={key:1,class:"mt1"},We={key:0,class:"schedule mt1"},Xe={class:"wrapper"},je={class:"column side-column"};function Ge(e,n,_,a,t,f){var w;const T=r("corner-left-up-icon"),b=r("router-link"),k=r("entity-thumbnail"),E=r("page-title"),C=r("route-section-tabs"),v=r("page-subtitle"),L=r("entity-task-list"),M=r("button-simple"),x=r("description-cell"),I=r("combobox-number"),z=r("task-type-name"),B=r("table-info"),P=r("schedule"),V=r("entity-chat"),D=r("entity-preview-files"),N=r("entity-time-logs"),A=r("entity-news"),R=r("task-info"),U=r("edit-sequence-modal");return i(),l("div",ye,[s("div",fe,[s("div",ge,[c(b,{class:"flexrow-item has-text-centered back-link",to:f.getSequencesRoute},{default:g(()=>[c(T)]),_:1},8,["to"]),s("span",Se,[t.currentSequence?(i(),p(k,{key:0,class:"entity-thumbnail",entity:t.currentSequence,"empty-width":120,"empty-height":50,width:120},null,8,["entity"])):y("",!0)]),s("div",qe,[c(E,{text:f.title,class:"entity-title"},null,8,["text"])])]),s("div",be,[c(C,{class:"section-tabs","active-tab":t.currentSection,route:e.$route,tabs:e.entityNavOptions},null,8,["active-tab","route","tabs"]),h(s("div",ke,[s("div",ve,[c(v,{text:e.$t("main.tasks")},null,8,["text"]),c(L,{class:"task-list",entries:e.currentTasks,"is-loading":!t.currentSequence,"is-error":!1,onTaskSelected:e.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",we,[c(v,{text:e.$t("main.info")},null,8,["text"]),n[3]||(n[3]=s("div",{class:"filler"},null,-1)),s("div",Te,[e.isCurrentUserManager?(i(),p(M,{key:0,icon:"edit",onClick:n[0]||(n[0]=o=>t.modals.edit=!0)})):y("",!0)])]),s("div",Ee,[t.currentSequence?(i(),l("table",Ce,[s("tbody",Le,[s("tr",Me,[s("td",xe,u(e.$t("shots.fields.description")),1),c(x,{entry:t.currentSequence,full:!0},null,8,["entry"])]),(i(!0),l(S,null,q(e.sequenceMetadataDescriptors,o=>(i(),l("tr",{key:o.id,class:"datatable-row"},[s("td",Ie,u(o.name),1),s("td",null,u(t.currentSequence.data?t.currentSequence.data[o.field_name]:""),1)]))),128))])])):y("",!0)])])],512),[[m,t.currentSection==="infos"]]),s("div",ze,[n[4]||(n[4]=s("div",{class:"filler"},null,-1)),h(s("span",{class:"flexrow-item mt05"},u(e.$t("schedule.zoom_level"))+": ",513),[[m,t.currentSection==="schedule"&&e.scheduleItems[0].children.length>0]]),h(c(I,{class:"zoom-level flexrow-item",options:e.zoomOptions,"is-simple":"",modelValue:e.zoomLevel,"onUpdate:modelValue":n[1]||(n[1]=o=>e.zoomLevel=o)},null,8,["options","modelValue"]),[[m,t.currentSection==="schedule"&&e.scheduleItems[0].children.length>0]])]),h(s("div",Be,[s("div",Pe,[h(s("span",null,u(f.nbAssets)+" "+u(e.$tc("assets.number",f.nbAssets)),513),[[m,t.currentSection==="casting"&&f.nbAssets>0]]),h(s("span",{class:"tag tag-standby"},u(e.$t("breakdown.fields.standby")),513),[[m,t.currentSection==="casting"&&t.currentSequence&&t.currentSequence.is_casting_standby]])]),t.currentSequence?(i(),l("div",Ve,[t.currentSequence&&t.currentSequence.castingAssetsByType&&t.currentSequence.castingAssetsByType[0].length>0?(i(),l("div",De,[(i(!0),l(S,null,q(t.currentSequence.castingAssetsByType,o=>(i(),l("div",{class:"type-assets",key:o.length>0?o[0].asset_type_name:""},[s("div",Ne,u(o.length>0?o[0].asset_type_name:"")+" ("+u(o.length)+") ",1),s("div",Ae,[(i(!0),l(S,null,q(o,d=>(i(),p(b,{class:"asset-link",key:d.id,to:f.buildAssetRoute(d)},{default:g(()=>[c(k,{class:oe(["entity-thumbnail",{shared:d.shared}]),entity:d,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["class","entity"]),s("div",Re,[ce(u(d.asset_name)+" ",1),d.nb_occurences>1?(i(),l("span",Ue," ("+u(d.nb_occurences)+") ",1)):y("",!0)]),s("div",Fe,[d.ready_for?(i(),p(z,{key:0,class:"flexrow-item","task-type":e.taskTypeMap.get(d.ready_for),"current-production-id":e.currentProduction.id,title:"Ready for: "+e.taskTypeMap.get(d.ready_for).name},null,8,["task-type","current-production-id","title"])):y("",!0)])]),_:2},1032,["to"]))),128))])]))),128))])):(i(),l("div",Oe,u(e.$t("sequences.no_casting")),1))])):(i(),p(B,{key:1,"is-loading":t.casting.isLoading,"is-error":t.casting.isError},null,8,["is-loading","is-error"]))],512),[[m,t.currentSection==="casting"]]),e.scheduleItems[0].children.length>0?h((i(),l("div",We,[s("div",Xe,[c(P,{ref:"schedule-widget","start-date":e.tasksStartDate,"end-date":e.tasksEndDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1},null,8,["start-date","end-date","hierarchy","zoom-level"])])],512)),[[m,t.currentSection==="schedule"]]):h((i(),l("div",{key:1,class:"mt1"},u(e.$t("main.empty_schedule")),513)),[[m,t.currentSection==="schedule"]]),t.currentSection==="chat"?(i(),p(V,{key:2,entity:t.currentSequence,name:(w=t.currentSequence)==null?void 0:w.full_name},null,8,["entity","name"])):y("",!0),t.currentSequence&&t.currentSection==="preview-files"?(i(),p(D,{key:3,entity:t.currentSequence},null,8,["entity"])):y("",!0),t.currentSequence&&t.currentSection==="time-logs"?(i(),p(N,{key:4,entity:t.currentSequence},null,8,["entity"])):y("",!0)])]),h(s("div",je,[c(R,{task:t.currentTask,"entity-type":"Sequence","with-actions":""},{default:g(()=>[c(A,{class:"news-column",entity:t.currentSequence},null,8,["entity"])]),_:1},8,["task"])],512),[[m,t.currentSection==="infos"]]),c(U,{ref:"edit-sequence-modal",active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"sequence-to-edit":t.currentSequence,onCancel:n[2]||(n[2]=o=>t.modals.edit=!1),onConfirm:f.confirmEditSequence},null,8,["active","is-loading","is-error","sequence-to-edit","onConfirm"])])}const Ze=F(pe,[["render",Ge],["__scopeId","data-v-8ba3cebc"]]);export{Ze as default};
//# sourceMappingURL=Sequence-Cp6EkSJi.js.map
