import{_ as O,m as W,a as j,O as G,H,T as K,R as Q,Q as X,h as Y,U as Z,E as J,X as $,Y as ee,Z as te,$ as ne,a0 as se,B as ie,z as oe,r as o,c as l,o as i,e as n,l as m,f as r,k as d,d as h,w as f,a1 as _,t as a,F as q,g as k,n as re,a7 as ce,b9 as le,b$ as ae,b5 as ue}from"./index-C9qIA9Tk.js";import{E as de,a as he,b as me,c as _e,e as pe}from"./EntityTaskList-D8a0L-vR.js";import{E as ye}from"./EditSequenceModal-DQJXmyGV.js";import{E as fe}from"./EntityChat-DpeRurRg.js";import"./PeopleNameCell-Clj1_dYc.js";const ge={name:"sequence",mixins:[pe,oe],components:{ButtonSimple:ie,ChevronLeftIcon:se,ChevronRightIcon:ne,ComboboxNumber:te,CornerLeftUpIcon:ee,DescriptionCell:$,EditSequenceModal:ye,EntityChat:fe,EntityNews:_e,EntityPreviewFiles:me,EntityTaskList:he,EntityTimeLogs:de,EntityThumbnail:J,PageSubtitle:Z,PageTitle:Y,Schedule:X,RouteSectionTabs:Q,TableInfo:K,TaskInfo:H,TaskTypeName:G},data(){return{type:"sequence",currentSequence:null,currentTask:null,currentSection:"infos",casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...j(["currentEpisode","currentProduction","getTaskTypePriority","isCurrentUserManager","isTVShow","sequenceMap","sequenceMetadataDescriptors","sequenceSearchText","route","taskMap","taskTypeMap"]),title(){return this.currentSequence?this.currentEpisode?`${this.currentEpisode.name} / ${this.currentSequence.name}`:`${this.currentSequence.name}`:"Loading..."},currentEntity(){return this.currentSequence},getSequencesRoute(){const e=this.currentProduction.id,s=this.currentEpisode?.id,p=ue(e,"sequences",s);return p.query={search:this.sequenceSearchText},p},nbAssets(){let e=0;return this.currentSequence&&this.currentSection==="casting"&&this.currentSequence.castingAssetsByType&&this.currentSequence.castingAssetsByType.forEach(s=>{e+=s.length}),e}},methods:{...W(["clearSelectedTasks","editSequence","setCurrentSequence","loadEpisodes","loadSequencesWithTasks","loadSequenceCasting"]),init(){this.loadCurrentSequence().then(e=>{this.currentSequence=e,this.currentSection=this.route.query.section||"infos",this.casting.isLoading=!0,this.casting.isError=!1,this.currentSequence?this.loadSequenceCasting(this.currentSequence).then(()=>{this.casting.isLoading=!1}).catch(s=>{this.casting.isLoading=!1,this.casting.isError=!0,console.error(s)}):this.resetData()}).catch(console.error)},loadCurrentSequence(){return new Promise((e,s)=>{const p=this.route.params.sequence_id,g=this.sequenceMap.get(p)||null;return!g||!g.validations?this.loadEpisodes().then(()=>this.loadSequencesWithTasks()).then(()=>{const t=ae.cache.sequenceMap.get(p)||null;return e(t)}):e(g)})},confirmEditSequence(e){e.id=this.currentSequence.id,this.loading.edit=!0,this.errors.edit=!1,this.editSequence(e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(s=>{console.error(s),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(e){const s=this.isTVShow?this.currentEpisode?.id||"main":null,p={name:"asset",params:{production_id:this.currentProduction.id,asset_id:e.asset_id}};return le(p,s)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.loadCurrentSequence().then(e=>(this.currentSequence=e,this.loadSequenceCasting(this.currentSequence))).then(()=>{this.casting.isLoading=!1}).catch(e=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(e)})})}},head(){return{title:`${this.title} - Kitsu`}}},Se={class:"columns fixed-page sequence xyz-in",xyz:"fade"},qe={class:"column main-column"},ke={class:"page-header flexrow"},be={class:"flexrow-item ml2"},ve={class:"flexrow-item"},we={class:"sequence-data block"},Te={class:"flexrow infos"},Ee={class:"flexrow-item flexcolumn entity-infos"},Ce={class:"flexrow"},Le={class:"flexrow-item has-text-right"},Ie={class:"table-body"},Me={key:0,class:"datatable no-header"},Pe={class:"table-body"},ze={class:"datatable-row"},xe={class:"field-label"},Be={class:"field-label"},Re={class:"flexrow"},De={class:"sequence-casting"},Ve={class:"casting-data mt1"},Ae={key:0},Ne={key:0},Ue={class:"asset-type"},Fe={class:"asset-list"},Oe={class:"break-word"},We={key:0},je={class:"ready-for flexrow"},Ge={key:1,class:"mt1"},He={key:0,class:"schedule mt1"},Ke={class:"wrapper"},Qe={class:"column side-column"};function Xe(e,s,p,g,t,y){const w=o("corner-left-up-icon"),S=o("router-link"),b=o("entity-thumbnail"),T=o("page-title"),E=o("chevron-left-icon"),C=o("chevron-right-icon"),L=o("route-section-tabs"),v=o("page-subtitle"),I=o("entity-task-list"),M=o("button-simple"),P=o("description-cell"),z=o("combobox-number"),x=o("task-type-name"),B=o("table-info"),R=o("schedule"),D=o("entity-chat"),V=o("entity-preview-files"),A=o("entity-time-logs"),N=o("entity-news"),U=o("task-info"),F=o("edit-sequence-modal");return i(),l("div",Se,[n("div",qe,[n("div",ke,[r(S,{class:"flexrow-item has-text-centered back-link",to:y.getSequencesRoute},{default:f(()=>[r(w)]),_:1},8,["to"]),n("span",be,[t.currentSequence?(i(),d(b,{key:0,class:"entity-thumbnail",entity:t.currentSequence,"empty-width":120,"empty-height":50,width:120},null,8,["entity"])):h("",!0)]),n("div",ve,[r(T,{text:y.title,class:"entity-title"},null,8,["text"])]),s[3]||(s[3]=n("div",{class:"filler"},null,-1)),e.previousEntityPath&&e.entityList.length>1?(i(),d(S,{key:0,class:"flexrow-item has-text-centered back-link ml1",to:e.previousEntityPath},{default:f(()=>[r(E)]),_:1},8,["to"])):h("",!0),e.nextEntityPath&&e.entityList.length>1?(i(),d(S,{key:1,class:"flexrow-item has-text-centered back-link",to:e.nextEntityPath},{default:f(()=>[r(C)]),_:1},8,["to"])):h("",!0)]),n("div",we,[r(L,{class:"section-tabs","active-tab":t.currentSection,route:e.$route,tabs:e.entityNavOptions},null,8,["active-tab","route","tabs"]),m(n("div",Te,[n("div",Ee,[r(v,{text:e.$t("main.tasks")},null,8,["text"]),r(I,{class:"task-list",entries:e.currentTasks,"is-loading":!t.currentSequence,"is-error":!1,onTaskSelected:e.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),n("div",Ce,[r(v,{text:e.$t("main.info")},null,8,["text"]),s[4]||(s[4]=n("div",{class:"filler"},null,-1)),n("div",Le,[e.isCurrentUserManager?(i(),d(M,{key:0,icon:"edit",title:e.$t("sequences.edit_title"),onClick:s[0]||(s[0]=c=>t.modals.edit=!0)},null,8,["title"])):h("",!0)])]),n("div",Ie,[t.currentSequence?(i(),l("table",Me,[n("tbody",Pe,[n("tr",ze,[n("td",xe,a(e.$t("shots.fields.description")),1),r(P,{entry:t.currentSequence,full:!0},null,8,["entry"])]),(i(!0),l(q,null,k(e.sequenceMetadataDescriptors,c=>(i(),l("tr",{key:c.id,class:"datatable-row"},[n("td",Be,a(c.name),1),n("td",null,a(t.currentSequence.data?t.currentSequence.data[c.field_name]:""),1)]))),128))])])):h("",!0)])])],512),[[_,t.currentSection==="infos"]]),n("div",Re,[s[5]||(s[5]=n("div",{class:"filler"},null,-1)),m(n("span",{class:"flexrow-item mt05"},a(e.$t("schedule.zoom_level"))+": ",513),[[_,t.currentSection==="schedule"&&e.scheduleItems[0].children.length>0]]),m(r(z,{class:"zoom-level flexrow-item",options:e.zoomOptions,"is-simple":"",modelValue:e.zoomLevel,"onUpdate:modelValue":s[1]||(s[1]=c=>e.zoomLevel=c)},null,8,["options","modelValue"]),[[_,t.currentSection==="schedule"&&e.scheduleItems[0].children.length>0]])]),m(n("div",De,[n("div",Ve,[m(n("span",null,a(y.nbAssets)+" "+a(e.$tc("assets.number",y.nbAssets)),513),[[_,t.currentSection==="casting"&&y.nbAssets>0]]),m(n("span",{class:"tag tag-standby"},a(e.$t("breakdown.fields.standby")),513),[[_,t.currentSection==="casting"&&t.currentSequence&&t.currentSequence.is_casting_standby]])]),t.currentSequence?(i(),l("div",Ae,[t.currentSequence&&t.currentSequence.castingAssetsByType&&t.currentSequence.castingAssetsByType[0].length>0?(i(),l("div",Ne,[(i(!0),l(q,null,k(t.currentSequence.castingAssetsByType,c=>(i(),l("div",{class:"type-assets",key:c.length>0?c[0].asset_type_name:""},[n("div",Ue,a(c.length>0?c[0].asset_type_name:"")+" ("+a(c.length)+") ",1),n("div",Fe,[(i(!0),l(q,null,k(c,u=>(i(),d(S,{class:"asset-link",key:u.id,to:y.buildAssetRoute(u)},{default:f(()=>[r(b,{class:re(["entity-thumbnail",{shared:u.shared}]),entity:u,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["class","entity"]),n("div",Oe,[ce(a(u.asset_name)+" ",1),u.nb_occurences>1?(i(),l("span",We," ("+a(u.nb_occurences)+") ",1)):h("",!0)]),n("div",je,[u.ready_for?(i(),d(x,{key:0,class:"flexrow-item","task-type":e.taskTypeMap.get(u.ready_for),"current-production-id":e.currentProduction.id,title:"Ready for: "+e.taskTypeMap.get(u.ready_for).name},null,8,["task-type","current-production-id","title"])):h("",!0)])]),_:2},1032,["to"]))),128))])]))),128))])):(i(),l("div",Ge,a(e.$t("sequences.no_casting")),1))])):(i(),d(B,{key:1,"is-loading":t.casting.isLoading,"is-error":t.casting.isError},null,8,["is-loading","is-error"]))],512),[[_,t.currentSection==="casting"]]),e.scheduleItems[0].children.length>0?m((i(),l("div",He,[n("div",Ke,[r(R,{ref:"schedule-widget","start-date":e.tasksStartDate,"end-date":e.tasksEndDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1},null,8,["start-date","end-date","hierarchy","zoom-level"])])],512)),[[_,t.currentSection==="schedule"]]):m((i(),l("div",{key:1,class:"mt1"},a(e.$t("main.empty_schedule")),513)),[[_,t.currentSection==="schedule"]]),t.currentSection==="chat"?(i(),d(D,{key:2,entity:t.currentSequence,name:t.currentSequence?.full_name},null,8,["entity","name"])):h("",!0),t.currentSequence&&t.currentSection==="preview-files"?(i(),d(V,{key:3,entity:t.currentSequence},null,8,["entity"])):h("",!0),t.currentSequence&&t.currentSection==="time-logs"?(i(),d(A,{key:4,entity:t.currentSequence},null,8,["entity"])):h("",!0)])]),m(n("div",Qe,[r(U,{task:t.currentTask,"entity-type":"Sequence","with-actions":""},{default:f(()=>[r(N,{class:"news-column",entity:t.currentSequence},null,8,["entity"])]),_:1},8,["task"])],512),[[_,t.currentSection==="infos"]]),r(F,{ref:"edit-sequence-modal",active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"sequence-to-edit":t.currentSequence,onCancel:s[2]||(s[2]=c=>t.modals.edit=!1),onConfirm:y.confirmEditSequence},null,8,["active","is-loading","is-error","sequence-to-edit","onConfirm"])])}const tt=O(ge,[["render",Xe],["__scopeId","data-v-71380cca"]]);export{tt as default};
//# sourceMappingURL=Sequence-x8m8m5ND.js.map
