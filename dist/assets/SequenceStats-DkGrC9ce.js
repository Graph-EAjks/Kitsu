import{ao as M,T as L,m as k,bm as P,bo as T,_ as w,r as h,o,c as l,e as n,t as d,F as p,g as q,G as g,l as v,w as E,a5 as V,d as S,f as u,ba as b,s as D,B as O,C as B,S as F,av as U,b as Q,aB as x,ad as A,ae as N}from"./index-CorrIg1D.js";import{S as R}from"./StatsCell-DcDtA38V.js";const Y={name:"sequence-stats-list",mixins:[M],components:{StatsCell:R,TableInfo:L},props:{countMode:{type:String,default:"count"},displayMode:{type:String,default:"pie"},entries:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},sequenceStats:{type:Object,default:()=>{}},showAll:{type:Boolean,default:!1},validationColumns:{type:Array,default:()=>[]}},computed:{...k(["currentProduction","currentEpisode","displayedSequencesLength","isCurrentUserClient","isTVShow","sequenceSearchText","taskTypeMap"]),entryStats(){return this.entries.filter(e=>this.isEntryStats(e.id))},isEmptyList(){return this.entries&&this.entries.length===0&&!this.isLoading&&!this.isError&&(!this.sequenceSearchText||this.sequenceSearchText.length===0)}},methods:{chartColors(e,t){return P(this.sequenceStats,e,t)},chartData(e,t,s="count"){return T(this.sequenceStats,e,t,s)},isStats(e,t){return this.sequenceStats[e]&&this.sequenceStats[e][t]},isEntryStats(e){if(!this.sequenceStats[e]&&this.sequenceSearchText)return!1;if(!this.sequenceStats[e])return!0;let t=!1;return Object.keys(this.sequenceStats[e]).forEach(s=>{t=t||this.sequenceStats[e][s]}),t},editPath(e){return this.getPath("edit-sequence",e)},deletePath(e){return this.getPath("delete-sequence",e)},taskTypePath(e){const t={name:"task-type",params:{production_id:this.currentProduction.id,task_type_id:e,type:"shots"}};return this.isTVShow&&this.currentEpisode&&(t.name="episode-task-type",t.params.episode_id=this.currentEpisode.id),t},getPath(e,t){const s={name:e,params:{production_id:this.currentProduction.id}};return this.isTVShow&&this.currentEpisode&&(s.name=`episode-${e}`,s.params.episode_id=this.currentEpisode.id),t&&(s.params.sequence_id=t),s}}},j={class:"data-list"},G={class:"datatable"},K={class:"datatable-head"},z={scope:"col",class:"validation"},H={key:1,class:"flexrow-item"},J={key:0,class:"datatable-body"},W={key:0,class:"all-line datatable-row"},X={scope:"row",class:"name datatable-row-header"},Z={scope:"row",class:"name datatable-row-header"},I={key:1},$={key:0,class:"has-text-centered"},ee={class:"info"},te={key:1,class:"has-text-centered"},se={class:"info"},ae={key:2,class:"has-text-centered nb-sequences"};function ie(e,t,s,f,r,a){const _=h("router-link"),m=h("stats-cell"),y=h("table-info");return o(),l("div",j,[n("div",{class:"datatable-wrapper",ref:"body",onScrollPassive:t[0]||(t[0]=(...i)=>e.onBodyScroll&&e.onBodyScroll(...i))},[n("table",G,[n("thead",K,[n("tr",null,[n("th",{scope:"col",class:"name datatable-row-header",ref:"th-sequence"},d(e.$t("shots.fields.sequence")),513),n("th",z,d(e.$t("main.all")),1),s.isLoading?S("",!0):(o(!0),l(p,{key:0},q(s.validationColumns,i=>(o(),l("th",{scope:"col",class:"validation validation-cell",key:i},[n("div",{class:"flexrow validation-content",style:g(e.getValidationStyle(i))},[e.isCurrentUserClient?(o(),l("span",H,d(e.taskTypeMap.get(i).name),1)):(o(),v(_,{key:0,class:"flexrow-item",title:e.taskTypeMap.get(i).name,to:a.taskTypePath(i)},{default:E(()=>[V(d(e.taskTypeMap.get(i).name),1)]),_:2},1032,["title","to"]))],4)]))),128)),t[1]||(t[1]=n("th",{scope:"col",class:"actions"},null,-1))])]),s.isLoading?S("",!0):(o(),l("tbody",J,[s.showAll&&!a.isEmptyList?(o(),l("tr",W,[n("th",X,d(e.$t("sequences.all_sequences")),1),u(m,{class:"all-validation",colors:a.chartColors("all","all"),data:a.chartData("all","all"),"frames-data":a.chartData("all","all","frames"),"drawings-data":a.chartData("all","all","drawings"),"count-mode":s.countMode,"display-mode":s.displayMode},null,8,["colors","data","frames-data","drawings-data","count-mode","display-mode"]),(o(!0),l(p,null,q(s.validationColumns,i=>(o(),v(m,{style:g(e.getValidationStyle(i)),key:"all-"+i,colors:a.chartColors("all",i),data:a.chartData("all",i),"frames-data":a.chartData("all",i,"frames"),"drawings-data":a.chartData("all",i,"drawings"),"count-mode":s.countMode,"display-mode":s.displayMode},null,8,["style","colors","data","frames-data","drawings-data","count-mode","display-mode"]))),128)),t[2]||(t[2]=n("td",{class:"actions"},null,-1))])):S("",!0),(o(!0),l(p,null,q(a.entryStats,i=>(o(),l("tr",{class:"datatable-row",key:i.id},[n("td",Z,d(i.name),1),a.isStats(i.id,"all")?(o(),v(m,{key:0,colors:a.chartColors(i.id,"all"),data:a.chartData(i.id,"all"),"frames-data":a.chartData(i.id,"all","frames"),"count-mode":s.countMode,"display-mode":s.displayMode},null,8,["colors","data","frames-data","count-mode","display-mode"])):(o(),l("td",I)),(o(!0),l(p,null,q(s.validationColumns,c=>(o(),l(p,{key:i.id+"-"+c},[a.isStats(i.id,c)?(o(),v(m,{key:i.id+c,style:g(e.getValidationStyle(c)),colors:a.chartColors(i.id,c),data:a.chartData(i.id,c),"frames-data":a.chartData(i.id,c,"frames"),"count-mode":s.countMode,"display-mode":s.displayMode},null,8,["style","colors","data","frames-data","count-mode","display-mode"])):(o(),l("td",{key:1,style:g(e.getValidationStyle(c))},null,4))],64))),128)),t[3]||(t[3]=n("td",{class:"actions"},null,-1))]))),128))]))])],544),u(y,{"is-loading":s.isLoading,"is-error":s.isError},null,8,["is-loading","is-error"]),a.isEmptyList&&!e.isCurrentUserClient&&!s.isLoading?(o(),l("div",$,[t[4]||(t[4]=n("p",{class:"info"},[n("img",{src:b})],-1)),n("p",ee,d(e.$t("sequences.empty_list")),1)])):S("",!0),a.isEmptyList&&e.isCurrentUserClient&&!s.isLoading?(o(),l("div",te,[t[5]||(t[5]=n("p",{class:"info"},[n("img",{src:b})],-1)),n("p",se,d(e.$t("sequences.empty_list_client")),1)])):S("",!0),!a.isEmptyList&&!s.isLoading?(o(),l("p",ae,d(e.displayedSequencesLength)+" "+d(e.$tc("sequences.number",e.displayedSequencesLength)),1)):S("",!0)])}const oe=w(Y,[["render",ie],["__scopeId","data-v-26465289"]]),ne={name:"sequence-stats",mixins:[D],components:{ButtonSimple:O,Combobox:B,SearchField:F,SearchQueryList:U,SequenceStatsList:oe},data(){return{countMode:"count",displayMode:"pie",initialLoading:!0,countModeOptions:[{label:"shots",value:"count"},{label:"frames",value:"frames"}],displayModeOptions:[{label:"pie",value:"pie"},{label:"count",value:"count"}],loading:{savingSearch:!1}}},mounted(){this.setCountOptions(),this.loadShots(()=>{this.initSequences().then(()=>{this.initialLoading=!1,setTimeout(()=>{this.setSearchFromUrl(),this.onSearchChange()},100)}).catch(e=>console.error(e))})},computed:{...k(["currentEpisode","currentProduction","displayedSequences","isCurrentUserManager","isPaperProduction","isShotsLoading","isShotsLoadingError","isTVShow","searchSequenceFilters","sequences","sequenceMap","sequencesPath","sequenceStats","sequenceSearchText","sequenceSearchQueries","sequenceListScrollPosition","shotValidationColumns","taskTypeMap","taskStatusMap"]),searchField(){return this.$refs["sequence-search-field"]}},methods:{...Q(["computeSequenceStats","hideAssignations","initSequences","loadShots","removeSequenceSearch","saveSequenceSearch","setLastProductionScreen","setSequenceStatsSearch","setSequenceListScrollPosition","showAssignations"]),reloadData(){this.initialLoading=!0,this.loadShots(()=>{this.initialLoading=!1,this.computeSequenceStats()})},setDefaultListScrollPosition(){this.$refs["sequence-list"]&&this.$refs["sequence-list"].setScrollPosition(this.sequenceListScrollPosition)},navigateToList(){this.$router.push(this.sequencesPath)},onSearchChange(){const e=this.$refs["sequence-search-field"].getValue();this.setSearchInUrl(),this.setSequenceStatsSearch(e)},saveSearchQuery(e){this.loading.savingSearch||(this.loading.savingSearch=!0,this.saveSequenceSearch(e).catch(console.error).finally(()=>{this.loading.savingSearch=!1}))},removeSearchQuery(e){this.removeSequenceSearch(e).catch(console.error)},saveScrollPosition(e){this.setSequenceListScrollPosition(e)},exportStatisticsToCsv(){const e=[x().format("YYYYMMDD"),this.currentProduction.name,"sequences","statistics"];this.currentEpisode&&e.splice(2,0,this.currentEpisode.name);const t=A.slugify(e.join("_"));N.generateStatReports(t,this.sequenceStats,this.taskTypeMap,this.taskStatusMap,this.sequenceMap,this.countMode,this.currentProduction)},onFieldChanged({entry:e,fieldName:t,value:s}){const f={id:e.id};f[t]=s,this.editSequence(f)},setCountOptions(){this.isPaperProduction?this.countModeOptions=[{label:"shots",value:"count"},{label:"drawings",value:"drawings"}]:this.countModeOptions=[{label:"shots",value:"count"},{label:"frames",value:"frames"}],this.countMode=this.countModeOptions[0].value}},watch:{currentProduction(){this.$refs["sequence-search-field"].setValue(""),this.$store.commit("SET_SEQUENCE_LIST_SCROLL_POSITION",0),this.setCountOptions(),this.isTVShow||this.loadShots(()=>{this.initSequences().catch(e=>console.error(e))})},currentEpisode(){this.isTVShow&&this.currentEpisode&&this.loadShots(()=>{this.initSequences().then(()=>{this.initialLoading=!1}).catch(e=>console.error(e))})},searchSequenceFilters:{deep:!0,handler(){this.computeSequenceStats()}},"$route.query.search"(){this.setSearchFromUrl(),this.onSearchChange()}},head(){return this.isTVShow?{title:`${this.currentProduction?this.currentProduction.name:""} - ${this.currentEpisode?this.currentEpisode.name:""} | ${this.$t("sequences.title")} - Kitsu`}:{title:`${this.currentProduction?this.currentProduction.name:""} | ${this.$t("sequences.title")} - Kitsu`}}},le={class:"sequences page fixed-page"},re={class:"sequence-list-header page-header flexrow"},ce={class:"query-list mt1"};function de(e,t,s,f,r,a){const _=h("search-field"),m=h("combobox"),y=h("button-simple"),i=h("search-query-list"),c=h("sequence-stats-list");return o(),l("div",le,[n("div",re,[u(_,{class:"flexrow-item mt1",ref:"sequence-search-field","can-save":!0,onChange:a.onSearchChange,onSave:a.saveSearchQuery,placeholder:"ex: e01 s01 anim=wip"},null,8,["onChange","onSave"]),u(m,{class:"mb0 flexrow-item",label:e.$t("statistics.display_mode"),"locale-key-prefix":"statistics.",options:r.displayModeOptions,modelValue:r.displayMode,"onUpdate:modelValue":t[0]||(t[0]=C=>r.displayMode=C)},null,8,["label","options","modelValue"]),u(m,{class:"mb0 flexrow-item",label:e.$t("statistics.count_mode"),"locale-key-prefix":"statistics.",options:r.countModeOptions,modelValue:r.countMode,"onUpdate:modelValue":t[1]||(t[1]=C=>r.countMode=C)},null,8,["label","options","modelValue"]),t[2]||(t[2]=n("span",{class:"filler"},null,-1)),u(y,{class:"flexrow-item",icon:"refresh",title:e.$t("main.reload"),onClick:a.reloadData},null,8,["title","onClick"]),u(y,{class:"flexrow-item",icon:"download",title:e.$t("main.csv.export_file"),onClick:a.exportStatisticsToCsv},null,8,["title","onClick"])]),n("div",ce,[u(i,{queries:e.sequenceSearchQueries,type:"sequenceStat",onRemoveSearch:a.removeSearchQuery},null,8,["queries","onRemoveSearch"])]),u(c,{ref:"sequence-list","count-mode":r.countMode,"display-mode":r.displayMode,entries:e.displayedSequences,"is-loading":e.isShotsLoading||r.initialLoading,"is-error":e.isShotsLoadingError,"validation-columns":e.shotValidationColumns,"sequence-stats":e.sequenceStats,"show-all":e.sequenceSearchText.length===0,onFieldChanged:a.onFieldChanged,onScroll:a.saveScrollPosition},null,8,["count-mode","display-mode","entries","is-loading","is-error","validation-columns","sequence-stats","show-all","onFieldChanged","onScroll"])])}const me=w(ne,[["render",de],["__scopeId","data-v-de1c5926"]]);export{me as default};
//# sourceMappingURL=SequenceStats-DkGrC9ce.js.map
