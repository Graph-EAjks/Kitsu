import{_ as F,m as O,a as Z,O as j,H as G,T as H,Q as K,R as Q,U as X,E as Y,cS as J,X as W,Y as x,Z as $,B as tt,z as et,r,c as l,o as n,e as s,l as d,f as c,w as g,k as _,d as h,t as o,$ as m,F as p,g as b,n as st,a5 as T,b8 as nt,bZ as ot}from"./index-CKHz3hAB.js";import{E as it,a as rt,b as lt,c as at,e as ct}from"./EntityTaskList-BVJDM4Gz.js";import{E as ht}from"./EntityChat-Bb-n7bLr.js";import"./PeopleNameCell-B8YcW3Z8.js";const ut={name:"shot",mixins:[ct,et],components:{ButtonSimple:tt,ComboboxNumber:$,CornerLeftUpIcon:x,DescriptionCell:W,EditShotModal:J,EntityChat:ht,EntityNews:at,EntityPreviewFiles:lt,EntityTaskList:rt,EntityTimeLogs:it,EntityThumbnail:Y,PageSubtitle:X,RouteSectionTabs:Q,Schedule:K,TableInfo:H,TaskInfo:G,TaskTypeName:j},data(){return{type:"shot",currentShot:null,currentTask:null,casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...Z(["currentEpisode","currentProduction","getTaskTypePriority","isCurrentUserManager","isTVShow","route","shotMap","shotMetadataDescriptors","shotSearchText","shotsPath","taskMap","taskTypeMap"]),title(){return this.currentShot?this.currentShot.episode_name?`${this.currentShot.episode_name} / ${this.currentShot.sequence_name} / ${this.currentShot.name}`:`${this.currentShot.sequence_name} / ${this.currentShot.name}`:"Loading..."},shotThumbnailPath(){return`/api/pictures/originals/preview-files/${this.currentShot.preview_file_id}.png`},isPreview(){return this.currentShot&&this.currentShot.preview_file_id&&this.currentShot.preview_file_id.length>0},getShotsRoute(){const t={name:"shots",params:{production_id:this.currentProduction.id},query:{search:this.shotSearchText}};return this.currentEpisode&&(t.name="episode-shots",t.params.episode_id=this.currentEpisode.id),t},nbAssets(){let t=0;return this.currentShot&&this.currentSection==="casting"&&this.currentShot.castingAssetsByType&&this.currentShot.castingAssetsByType.forEach(i=>{t+=i.length}),t}},methods:{...O(["clearSelectedTasks","editShot","loadShot","loadShotCasting"]),changeTab(t){this.selectedTab=t},getCurrentShot(){return new Promise((t,i)=>{const f=this.route.params.shot_id,y=ot.cache.shotMap.get(f)||null;return y?t(y):this.loadShot(f).then(t)})},onEditClicked(){this.modals.edit=!0},confirmEditShot(t){t.id=this.currentShot.id,t.data.resolution=t.resolution,t.data.max_retakes=t.max_retakes,t.data.frame_in=t.frameIn,t.data.frame_out=t.frameOut,t.data.fps=t.fps,this.loading.edit=!0,this.errors.edit=!1,this.editShot(t).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(i=>{console.error(i),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(t){let i=t.episode_id;this.isTVShow&&!i&&(i="main");const f={name:"asset",params:{production_id:this.currentProduction.id,asset_id:t.asset_id}};return nt(f,i)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.getCurrentShot().then(t=>(this.currentShot=t,this.loadShotCasting(this.currentShot))).then(()=>{this.casting.isLoading=!1}).catch(t=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(t)})})},init(){this.getCurrentShot().then(t=>{this.currentShot=t,this.currentSection=this.route.query.section||"infos",this.casting.isLoading=!0,this.casting.isError=!1,this.currentShot?this.loadShotCasting(this.currentShot).then(()=>{this.casting.isLoading=!1,setTimeout(this.initSchedule,100)}).catch(i=>{this.casting.isLoading=!1,this.casting.isError=!0,console.error(i)}):(this.resetData(),setTimeout(this.initSchedule,100))}).catch(console.error)},initSchedule(){this.$refs["schedule-widget"]?.scrollToDate(this.scheduleItems[0].startDate)}},watch:{$route(){const t=this.route.params.shot_id;this.currentAsset&&this.currentShot.id!==t&&this.init(),this.currentSection=this.route.query.section||"infos"}},head(){return{title:`${this.title} - Kitsu`}}},dt={class:"columns fixed-page shot xyz-in",xyz:"fade"},mt={class:"column main-column"},_t={class:"page-header flexrow"},St={class:"flexrow-item ml2"},ft={class:"entity-title flexrow-item"},pt={class:"entity-data block"},yt={class:"flexrow mt1"},gt={class:"flexcolumn infos"},bt={class:"flexrow"},kt={class:"flexrow-item has-text-right"},vt={class:"table-body"},wt={key:0,class:"datatable no-header"},Tt={class:"datatable-body"},Ct={class:"datatable-row"},Et={class:"field-label"},Lt={class:"datatable-row"},It={class:"field-label"},Mt={key:0,class:"datatable-row"},zt={class:"field-label"},Bt={key:1,class:"datatable-row"},Dt={class:"field-label"},Pt={key:2,class:"datatable-row"},Vt={class:"field-label"},At={key:3,class:"datatable-row"},Rt={class:"field-label"},Nt={key:4,class:"datatable-row"},qt={class:"field-label"},Ut={class:"field-label"},Ft={class:"shot-casting"},Ot={key:0},Zt={key:0},jt={class:"asset-type"},Gt={class:"asset-list"},Ht={class:"break-word"},Kt={key:0,class:"ready-for flexrow"},Qt={key:1,class:"mt1"},Xt={key:1,class:"schedule mt1"},Yt={class:"wrapper"},Jt={class:"column side-column"};function Wt(t,i,f,y,e,S){const C=r("corner-left-up-icon"),k=r("router-link"),v=r("entity-thumbnail"),E=r("route-section-tabs"),L=r("combobox-number"),w=r("page-subtitle"),I=r("entity-task-list"),M=r("button-simple"),z=r("description-cell"),B=r("entity-chat"),D=r("task-type-name"),P=r("table-info"),V=r("schedule"),A=r("entity-preview-files"),R=r("entity-time-logs"),N=r("entity-news"),q=r("task-info"),U=r("edit-shot-modal");return n(),l("div",dt,[s("div",mt,[s("div",_t,[c(k,{class:"flexrow-item has-text-centered back-link",to:S.getShotsRoute},{default:g(()=>[c(C)]),_:1},8,["to"]),s("span",St,[e.currentShot?(n(),_(v,{key:0,class:"entity-thumbnail",entity:e.currentShot,"empty-width":100,"empty-height":60,width:100},null,8,["entity"])):h("",!0)]),s("div",ft,o(S.title),1)]),s("div",pt,[c(E,{class:"section-tabs","active-tab":t.currentSection,route:t.$route,tabs:t.entityTabs},null,8,["active-tab","route","tabs"]),s("div",yt,[d(s("span",null,o(S.nbAssets)+" "+o(t.$tc("assets.number",S.nbAssets)),513),[[m,t.currentSection==="casting"]]),d(s("span",{class:"tag tag-standby"},o(t.$t("breakdown.fields.standby")),513),[[m,t.currentSection==="casting"&&e.currentShot&&e.currentShot.is_casting_standby]]),i[4]||(i[4]=s("div",{class:"filler"},null,-1)),d(s("span",{class:"flexrow-item mt05"},o(t.$t("schedule.zoom_level"))+": ",513),[[m,t.currentSection==="schedule"]]),d(c(L,{class:"zoom-level flexrow-item",options:t.zoomOptions,"is-simple":"",modelValue:t.zoomLevel,"onUpdate:modelValue":i[0]||(i[0]=a=>t.zoomLevel=a)},null,8,["options","modelValue"]),[[m,t.currentSection==="schedule"]])]),d(s("div",gt,[c(w,{text:t.$t("shots.tasks")},null,8,["text"]),c(I,{class:"task-list",entries:t.currentTasks,"is-loading":!e.currentShot,"is-error":!1,onTaskSelected:t.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",bt,[c(w,{text:t.$t("main.info")},null,8,["text"]),i[5]||(i[5]=s("div",{class:"filler"},null,-1)),s("div",kt,[t.isCurrentUserManager?(n(),_(M,{key:0,icon:"edit",title:t.$t("shots.edit_title"),onClick:i[1]||(i[1]=a=>e.modals.edit=!0)},null,8,["title"])):h("",!0)])]),s("div",vt,[e.currentShot?(n(),l("table",wt,[s("tbody",Tt,[s("tr",Ct,[s("td",Et,o(t.$t("shots.fields.description")),1),c(z,{entry:e.currentShot,full:!0},null,8,["entry"])]),s("tr",Lt,[s("td",It,o(t.$t("shots.fields.nb_frames")),1),s("td",null,o(e.currentShot?e.currentShot.nb_frames:""),1)]),e.currentShot&&e.currentShot.data&&e.currentShot.data.frame_in!=null?(n(),l("tr",Mt,[s("td",zt,o(t.$t("shots.fields.frame_in")),1),s("td",null,o(e.currentShot?e.currentShot.data.frame_in:""),1)])):h("",!0),e.currentShot&&e.currentShot.data&&e.currentShot.data.frame_out?(n(),l("tr",Bt,[s("td",Dt,o(t.$t("shots.fields.frame_out")),1),s("td",null,o(e.currentShot?e.currentShot.data.frame_out:""),1)])):h("",!0),e.currentShot&&e.currentShot.data&&e.currentShot.data.fps?(n(),l("tr",Pt,[s("td",Vt,o(t.$t("shots.fields.fps")),1),s("td",null,o(e.currentShot?e.currentShot.data.fps:""),1)])):h("",!0),e.currentShot&&e.currentShot.data&&e.currentShot.data.resolution?(n(),l("tr",At,[s("td",Rt,o(t.$t("shots.fields.resolution")),1),s("td",null,o(e.currentShot?e.currentShot.data.resolution:""),1)])):h("",!0),e.currentShot&&e.currentShot.data&&e.currentShot.data.max_retakes?(n(),l("tr",Nt,[s("td",qt,o(t.$t("shots.fields.max_retakes")),1),s("td",null,o(e.currentShot?e.currentShot.data.max_retakes:""),1)])):h("",!0),(n(!0),l(p,null,b(t.shotMetadataDescriptors,a=>(n(),l("tr",{key:a.id,class:"datatable-row"},[s("td",Ut,o(a.name),1),s("td",null,o(e.currentShot&&e.currentShot.data?e.currentShot.data[a.field_name]:""),1)]))),128))])])):h("",!0)])],512),[[m,t.currentSection==="infos"]]),t.currentSection==="chat"?(n(),_(B,{key:0,entity:e.currentShot,name:e.currentShot?e.currentShot.full_name:""},null,8,["entity","name"])):h("",!0),d(s("div",Ft,[e.currentShot?(n(),l("div",Ot,[e.currentShot&&e.currentShot.castingAssetsByType&&e.currentShot.castingAssetsByType[0].length>0?(n(),l("div",Zt,[(n(!0),l(p,null,b(e.currentShot.castingAssetsByType,a=>(n(),l("div",{class:"type-assets",key:a.length>0?a[0].asset_type_name:""},[s("div",jt,o(a.length>0?a[0].asset_type_name:"")+" ("+o(a.length)+") ",1),s("div",Gt,[(n(!0),l(p,null,b(a,u=>(n(),_(k,{class:"asset-link",key:u.id,to:S.buildAssetRoute(u)},{default:g(()=>[c(v,{class:st(["entity-thumbnail",{shared:u.shared}]),entity:u,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["class","entity"]),s("div",Ht,[T(o(u.asset_name)+" ",1),u.nb_occurences>1?(n(),l(p,{key:0},[T(" ("+o(u.nb_occurences)+") ",1)],64)):h("",!0)]),!u.shared&&u.ready_for?(n(),l("div",Kt,[c(D,{class:"flexrow-item","task-type":t.taskTypeMap.get(u.ready_for),"current-production-id":t.currentProduction.id,title:"Ready for: "+t.taskTypeMap.get(u.ready_for).name},null,8,["task-type","current-production-id","title"])])):h("",!0)]),_:2},1032,["to"]))),128))])]))),128))])):(n(),l("div",Qt,o(t.$t("shots.no_casting")),1))])):(n(),_(P,{key:1,"is-loading":e.casting.isLoading,"is-error":e.casting.isError},null,8,["is-loading","is-error"]))],512),[[m,t.currentSection==="casting"]]),t.scheduleItems[0].children.length>0?d((n(),l("div",Xt,[s("div",Yt,[c(V,{ref:"schedule-widget","start-date":t.tasksStartDate,"end-date":t.tasksEndDate,hierarchy:t.scheduleItems,"zoom-level":t.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1,onItemChanged:t.saveTaskScheduleItem,onEstimationChanged:i[2]||(i[2]=a=>t.saveTaskScheduleItem(a.item))},null,8,["start-date","end-date","hierarchy","zoom-level","onItemChanged"])])],512)),[[m,t.currentSection==="schedule"]]):h("",!0),t.currentSection==="preview-files"?(n(),_(A,{key:2,entity:e.currentShot},null,8,["entity"])):h("",!0),t.currentSection==="time-logs"?(n(),_(R,{key:3,entity:e.currentShot},null,8,["entity"])):h("",!0)])]),d(s("div",Jt,[c(q,{task:e.currentTask,"entity-type":"Shot","with-actions":""},{default:g(()=>[c(N,{class:"news-column",entity:e.currentShot},null,8,["entity"])]),_:1},8,["task"])],512),[[m,t.currentSection==="infos"]]),c(U,{ref:"edit-shot-modal",active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"shot-to-edit":e.currentShot,onCancel:i[3]||(i[3]=a=>e.modals.edit=!1),onConfirm:S.confirmEditShot},null,8,["active","is-loading","is-error","shot-to-edit","onConfirm"])])}const se=F(ut,[["render",Wt],["__scopeId","data-v-d7684353"]]);export{se as default};
//# sourceMappingURL=Shot-B4Jeosqj.js.map
