import{g as r,B as n,v as o,w as c,x as l,cb as h,E as d,z as u,R as m,A as S,T as _,s as f,F as p,m as v,b as g,aF as w,n as b}from"./index-DL-mrsNf.js";import{e as y,E as C,a as k,b as x,c as T}from"./EntityTaskList-C6TVTqy3.js";import{E as $}from"./EntityChat-D9_QFdp_.js";import"./PeopleNameCell-DJBl3qtu.js";const E={name:"shot",mixins:[y,r],components:{ButtonSimple:n,ComboboxNumber:o,CornerLeftUpIcon:c,DescriptionCell:l,EditShotModal:h,EntityChat:$,EntityNews:C,EntityPreviewFiles:k,EntityTaskList:x,EntityTimeLogs:T,EntityThumbnail:d,PageSubtitle:u,RouteSectionTabs:m,Schedule:S,TableInfo:_,TaskInfo:f,TaskTypeName:p},data(){return{type:"shot",currentShot:null,currentTask:null,casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1,preview:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...v(["currentEpisode","currentProduction","getTaskTypePriority","isCurrentUserManager","isTVShow","route","shotMap","shotMetadataDescriptors","shotSearchText","shotsPath","taskMap","taskTypeMap"]),title(){return this.currentShot?this.currentShot.episode_name?`${this.currentShot.episode_name} / ${this.currentShot.sequence_name} / ${this.currentShot.name}`:`${this.currentShot.sequence_name} / ${this.currentShot.name}`:"Loading..."},shotThumbnailPath(){return`/api/pictures/originals/preview-files/${this.currentShot.preview_file_id}.png`},isPreview(){return this.currentShot&&this.currentShot.preview_file_id&&this.currentShot.preview_file_id.length>0},getShotsRoute(){const s={name:"shots",params:{production_id:this.currentProduction.id},query:{search:this.shotSearchText}};return this.currentEpisode&&(s.name="episode-shots",s.params.episode_id=this.currentEpisode.id),s},nbAssets(){let s=0;return this.currentShot&&this.currentSection==="casting"&&this.currentShot.castingAssetsByType&&this.currentShot.castingAssetsByType.forEach(t=>{s+=t.length}),s}},methods:{...g(["clearSelectedTasks","editShot","loadShot","loadShotCasting"]),changeTab(s){this.selectedTab=s},getCurrentShot(){return new Promise((s,t)=>{const e=this.route.params.shot_id,a=this.shotMap.get(e)||null;return a?s(a):this.loadShot(e).then(s)})},onEditClicked(){this.modals.edit=!0},confirmEditShot(s){s.id=this.currentShot.id,s.data.resolution=s.resolution,s.data.max_retakes=s.max_retakes,s.data.frame_in=s.frameIn,s.data.frame_out=s.frameOut,s.data.fps=s.fps,this.loading.edit=!0,this.errors.edit=!1,this.editShot(s).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(t=>{console.error(t),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(s){let t=s.episode_id;this.isTVShow&&!t&&(t="main");const e={name:"asset",params:{production_id:this.currentProduction.id,asset_id:s.asset_id}};return w(e,t)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.getCurrentShot().then(s=>(this.currentShot=s,this.loadShotCasting(this.currentShot))).then(()=>{this.casting.isLoading=!1}).catch(s=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(s)})})},init(){this.getCurrentShot().then(s=>{this.currentShot=s,this.currentSection=this.route.query.section||"infos",this.casting.isLoading=!0,this.casting.isError=!1,this.currentShot?this.loadShotCasting(this.currentShot).then(()=>{this.casting.isLoading=!1,setTimeout(this.initSchedule,100)}).catch(t=>{this.casting.isLoading=!1,this.casting.isError=!0,console.error(t)}):(this.resetData(),setTimeout(this.initSchedule,100))}).catch(console.error)},initSchedule(){var s;(s=this.$refs["schedule-widget"])==null||s.scrollToDate(this.scheduleItems[0].startDate)}},watch:{$route(){const s=this.route.params.shot_id;this.currentAsset&&this.currentShot.id!==s&&this.init(),this.currentSection=this.route.query.section||"infos"}},metaInfo(){return{title:`${this.title} - Kitsu`}}};var L=function(){var t=this,e=t._self._c;return e("div",{staticClass:"columns fixed-page shot xyz-in",attrs:{xyz:"fade"}},[e("div",{staticClass:"column main-column"},[e("div",{staticClass:"page-header flexrow"},[e("router-link",{staticClass:"flexrow-item has-text-centered back-link",attrs:{to:t.getShotsRoute}},[e("corner-left-up-icon")],1),e("span",{staticClass:"flexrow-item ml2"},[t.currentShot?e("entity-thumbnail",{staticClass:"entity-thumbnail",attrs:{entity:t.currentShot,"empty-width":100,"empty-height":60,width:100}}):t._e()],1),e("div",{staticClass:"entity-title flexrow-item"},[t._v(" "+t._s(t.title)+" ")])],1),e("div",{staticClass:"entity-data block"},[e("route-section-tabs",{staticClass:"section-tabs",attrs:{"active-tab":t.currentSection,route:t.$route,tabs:t.entityTabs}}),e("div",{staticClass:"flexrow mt1"},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="casting",expression:"currentSection === 'casting'"}]},[t._v(" "+t._s(t.nbAssets)+" "+t._s(t.$tc("assets.number",t.nbAssets))+" ")]),e("span",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="casting"&&t.currentShot&&t.currentShot.is_casting_standby,expression:`
            currentSection === 'casting' &&
            currentShot &&
            currentShot.is_casting_standby
          `}],staticClass:"tag tag-standby"},[t._v(" "+t._s(t.$t("breakdown.fields.standby"))+" ")]),e("div",{staticClass:"filler"}),e("span",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="schedule",expression:"currentSection === 'schedule'"}],staticClass:"flexrow-item mt05"},[t._v(" "+t._s(t.$t("schedule.zoom_level"))+": ")]),e("combobox-number",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="schedule",expression:"currentSection === 'schedule'"}],staticClass:"zoom-level flexrow-item",attrs:{options:t.zoomOptions,"is-simple":""},model:{value:t.zoomLevel,callback:function(a){t.zoomLevel=a},expression:"zoomLevel"}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="infos",expression:"currentSection === 'infos'"}],staticClass:"flexcolumn infos"},[e("page-subtitle",{attrs:{text:t.$t("shots.tasks")}}),e("entity-task-list",{staticClass:"task-list",attrs:{entries:t.currentTasks,"is-loading":!t.currentShot,"is-error":!1},on:{"task-selected":t.onTaskSelected}}),e("div",{staticClass:"flexrow"},[e("page-subtitle",{attrs:{text:t.$t("main.info")}}),e("div",{staticClass:"filler"}),e("div",{staticClass:"flexrow-item has-text-right"},[t.isCurrentUserManager?e("button-simple",{attrs:{icon:"edit"},on:{click:function(a){t.modals.edit=!0}}}):t._e()],1)],1),e("div",{staticClass:"table-body"},[t.currentShot?e("table",{staticClass:"datatable no-header"},[e("tbody",{staticClass:"datatable-body"},[e("tr",{staticClass:"datatable-row"},[e("td",{staticClass:"field-label"},[t._v(" "+t._s(t.$t("shots.fields.description"))+" ")]),e("description-cell",{attrs:{entry:t.currentShot,full:!0}})],1),e("tr",{staticClass:"datatable-row"},[e("td",{staticClass:"field-label"},[t._v(" "+t._s(t.$t("shots.fields.nb_frames"))+" ")]),e("td",[t._v(" "+t._s(t.currentShot?t.currentShot.nb_frames:"")+" ")])]),t.currentShot&&t.currentShot.data&&t.currentShot.data.frame_in!=null?e("tr",{staticClass:"datatable-row"},[e("td",{staticClass:"field-label"},[t._v(" "+t._s(t.$t("shots.fields.frame_in"))+" ")]),e("td",[t._v(" "+t._s(t.currentShot?t.currentShot.data.frame_in:"")+" ")])]):t._e(),t.currentShot&&t.currentShot.data&&t.currentShot.data.frame_out?e("tr",{staticClass:"datatable-row"},[e("td",{staticClass:"field-label"},[t._v(" "+t._s(t.$t("shots.fields.frame_out"))+" ")]),e("td",[t._v(" "+t._s(t.currentShot?t.currentShot.data.frame_out:"")+" ")])]):t._e(),t.currentShot&&t.currentShot.data&&t.currentShot.data.fps?e("tr",{staticClass:"datatable-row"},[e("td",{staticClass:"field-label"},[t._v(t._s(t.$t("shots.fields.fps")))]),e("td",[t._v(" "+t._s(t.currentShot?t.currentShot.data.fps:"")+" ")])]):t._e(),t.currentShot&&t.currentShot.data&&t.currentShot.data.resolution?e("tr",{staticClass:"datatable-row"},[e("td",{staticClass:"field-label"},[t._v(" "+t._s(t.$t("shots.fields.resolution"))+" ")]),e("td",[t._v(" "+t._s(t.currentShot?t.currentShot.data.resolution:"")+" ")])]):t._e(),t.currentShot&&t.currentShot.data&&t.currentShot.data.max_retakes?e("tr",{staticClass:"datatable-row"},[e("td",{staticClass:"field-label"},[t._v(" "+t._s(t.$t("shots.fields.max_retakes"))+" ")]),e("td",[t._v(" "+t._s(t.currentShot?t.currentShot.data.max_retakes:"")+" ")])]):t._e(),t._l(t.shotMetadataDescriptors,function(a){return e("tr",{key:a.id,staticClass:"datatable-row"},[e("td",{staticClass:"field-label"},[t._v(t._s(a.name))]),e("td",[t._v(" "+t._s(t.currentShot&&t.currentShot.data?t.currentShot.data[a.field_name]:"")+" ")])])})],2)]):t._e()])],1),t.currentSection==="chat"?e("entity-chat",{attrs:{entity:t.currentShot,name:t.currentShot?t.currentShot.full_name:""}}):t._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="casting",expression:"currentSection === 'casting'"}],staticClass:"shot-casting"},[t.currentShot?e("div",[t.currentShot&&t.currentShot.castingAssetsByType&&t.currentShot.castingAssetsByType[0].length>0?e("div",t._l(t.currentShot.castingAssetsByType,function(a){return e("div",{key:a.length>0?a[0].asset_type_name:"",staticClass:"type-assets"},[e("div",{staticClass:"asset-type"},[t._v(" "+t._s(a.length>0?a[0].asset_type_name:"")+" ("+t._s(a.length)+") ")]),e("div",{staticClass:"asset-list"},t._l(a,function(i){return e("router-link",{key:i.id,staticClass:"asset-link",attrs:{to:t.buildAssetRoute(i)}},[e("entity-thumbnail",{staticClass:"entity-thumbnail",class:{shared:i.shared},attrs:{entity:i,square:!0,"empty-width":103,"empty-height":103,"with-link":!1}}),e("div",{staticClass:"break-word"},[t._v(" "+t._s(i.asset_name)+" "),i.nb_occurences>1?e("span",[t._v(" ("+t._s(i.nb_occurences)+") ")]):t._e()]),e("div",{staticClass:"ready-for flexrow"},[i.ready_for?e("task-type-name",{staticClass:"flexrow-item",attrs:{"task-type":t.taskTypeMap.get(i.ready_for),"current-production-id":t.currentProduction.id,title:"Ready for: "+t.taskTypeMap.get(i.ready_for).name}}):t._e()],1)],1)}),1)])}),0):e("div",{staticClass:"mt1"},[t._v(" "+t._s(t.$t("shots.no_casting"))+" ")])]):e("table-info",{attrs:{"is-loading":t.casting.isLoading,"is-error":t.casting.isError}})],1),t.scheduleItems[0].children.length>0?e("div",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="schedule",expression:"currentSection === 'schedule'"}],staticClass:"schedule mt1"},[e("div",{staticClass:"wrapper"},[e("schedule",{ref:"schedule-widget",attrs:{"start-date":t.tasksStartDate,"end-date":t.tasksEndDate,hierarchy:t.scheduleItems,"zoom-level":t.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1},on:{"item-changed":t.saveTaskScheduleItem,"estimation-changed":a=>t.saveTaskScheduleItem(a.item)}})],1)]):t._e(),t.currentSection==="preview-files"?e("entity-preview-files",{attrs:{entity:t.currentShot}}):t._e(),t.currentSection==="time-logs"?e("entity-time-logs",{attrs:{entity:t.currentShot}}):t._e()],1)]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="infos",expression:"currentSection === 'infos'"}],staticClass:"column side-column"},[e("task-info",{attrs:{task:t.currentTask,"entity-type":"Shot","with-actions":""}},[e("entity-news",{staticClass:"news-column",attrs:{entity:t.currentShot}})],1)],1),e("edit-shot-modal",{ref:"edit-shot-modal",attrs:{active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"shot-to-edit":t.currentShot},on:{cancel:function(a){t.modals.edit=!1},confirm:t.confirmEditShot}})],1)},I=[],M=b(E,L,I,!1,null,"5cac152c");const D=M.exports;export{D as default};
//# sourceMappingURL=Shot-CJ9I0dRt.js.map
