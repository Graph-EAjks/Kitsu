import{a5 as v,C as g,a6 as S,I as C,H as A,a7 as V,m as b,_ as E,r as l,o as n,c as y,e as r,t as p,aa as x,l as _,f as u,d as c,p as I,ab as w,b as L,ac as D,ad as M}from"./index-Dj4C2Zgv.js";import{L as F}from"./ListPageHeader-CMHtnZ9E.js";import{R as B}from"./RouteTabs-CSGnYRGP.js";import{S as U}from"./StatusAutomationList-Cc4bfbba.js";import"./TaskStatusCell-wbgfUv1V.js";const N={name:"edit-status-automation-modal",mixins:[v],components:{Combobox:g,ComboboxBoolean:S,ComboboxStatus:C,ComboboxTaskType:A,ModalFooter:V},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},statusAutomationToEdit:{type:Object,default:()=>{}},taskStatus:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{entityTypeOptions:[{label:"asset",value:"asset"},{label:"shot",value:"shot"}],fieldTypeOptions:[{label:"status",value:"status"},{label:"ready_for",value:"ready_for"}],form:{entityType:"asset",outFieldType:"status",inEntityTaskTypes:[],outEntityTaskTypes:[],inTaskTypeId:"",outTaskTypeId:"",inTaskStatusId:"",outTaskStatusId:"",importLastRevision:"false",archived:"false"}}},computed:{...b(["statusAutomations","statusAutomationsStatusOptions","assetTaskTypes","shotTaskTypes","taskStatuses"]),taskStatusList(){return this.taskStatuses.filter(t=>!t.for_concept)},isEditing(){var t;return(t=this.statusAutomationToEdit)==null?void 0:t.id}},methods:{confirmClicked(){this.$emit("confirm",this.form)},setTaskTypes(t){t==="asset"?(this.form.inEntityTaskTypes=this.assetTaskTypes,this.form.outFieldType==="status"?this.form.outEntityTaskTypes=this.assetTaskTypes:this.form.outEntityTaskTypes=this.shotTaskTypes):t==="shot"&&(this.form.inEntityTaskTypes=this.shotTaskTypes,this.form.outFieldType="status",this.form.outEntityTaskTypes=this.shotTaskTypes)}},watch:{statusAutomationToEdit(){if(this.statusAutomationToEdit){let t=[];this.form.entityType==="asset"?t=this.assetTaskTypes:this.form.entityType==="shot"&&(t=this.shotTaskTypes),this.form={entityType:this.isEditing?this.statusAutomationToEdit.entity_type:"asset",inEntityTaskTypes:t,outEntityTaskTypes:t,inTaskTypeId:this.isEditing?this.statusAutomationToEdit.in_task_type_id:t[0].id,inTaskStatusId:this.isEditing?this.statusAutomationToEdit.in_task_status_id:this.taskStatusList[0].id,outFieldType:this.isEditing?this.statusAutomationToEdit.out_field_type:"status",outTaskTypeId:this.isEditing?this.statusAutomationToEdit.out_task_type_id:t[1].id,outTaskStatusId:this.isEditing?this.statusAutomationToEdit.out_task_status_id:this.taskStatusList[1].id,importLastRevision:this.isEditing?String(this.statusAutomationToEdit.import_last_revision===!0):"false",archived:this.isEditing?String(this.statusAutomationToEdit.archived===!0):"false"}}},"form.entityType":function(t){this.setTaskTypes(t),this.isEditing||(this.form.inTaskTypeId=this.form.inEntityTaskTypes[0].id,this.form.inTaskStatusId=this.taskStatusList[0].id,this.form.outTaskTypeId=this.form.outEntityTaskTypes[1].id,this.form.outTaskStatusId=this.taskStatusList[1].id)},"form.outFieldType":function(t){t==="ready_for"?(this.form.outEntityTaskTypes=this.shotTaskTypes,this.form.outTaskTypeId=this.shotTaskTypes[1].id):t==="status"&&(this.setTaskTypes(this.form.entityType),this.form.outTaskTypeId=this.form.outEntityTaskTypes[1].id)}}},O={class:"modal-content"},R={class:"box"},H={key:0,class:"title"},j={key:1,class:"title"},q={class:"subtitle"},z={key:1,class:"entity-type-name"},G={class:"subtitle"},K={class:"flexrow"},P={class:"subtitle"},J={class:"flexrow"},Q={key:1,class:"flexrow-item"};function W(t,e,d,a,s,i){const m=l("combobox"),f=l("combobox-task-type"),T=l("combobox-status"),h=l("combobox-boolean"),k=l("modal-footer");return n(),y("div",{class:I({modal:!0,"is-active":d.active})},[r("div",{class:"modal-background",onClick:e[0]||(e[0]=o=>t.$emit("cancel"))}),r("div",O,[r("div",R,[i.isEditing?(n(),y("h1",H,p(t.$t("status_automations.edit_title")),1)):(n(),y("h1",j,p(t.$t("status_automations.new_status_automation")),1)),r("form",{onSubmit:e[9]||(e[9]=x(()=>{},["prevent"]))},[r("h3",q,p(t.$t("status_automations.entity_title")),1),i.isEditing?(n(),y("span",z,p(s.form.entityType),1)):(n(),_(m,{key:0,label:t.$t("status_automations.fields.entity_type"),options:s.entityTypeOptions,"locale-key-prefix":"status_automations.entity_types.",onEnter:i.confirmClicked,modelValue:s.form.entityType,"onUpdate:modelValue":e[1]||(e[1]=o=>s.form.entityType=o)},null,8,["label","options","onEnter","modelValue"])),r("h2",G,p(t.$t("status_automations.in_title")),1),r("div",K,[u(f,{class:"flexrow-item",label:t.$t("status_automations.fields.in_task_type"),"task-type-list":s.form.inEntityTaskTypes.filter(({archived:o})=>!o),modelValue:s.form.inTaskTypeId,"onUpdate:modelValue":e[2]||(e[2]=o=>s.form.inTaskTypeId=o),onEnter:i.confirmClicked},null,8,["label","task-type-list","modelValue","onEnter"]),u(T,{class:"flexrow-item",label:t.$t("status_automations.fields.in_task_status"),"task-status-list":i.taskStatusList,modelValue:s.form.inTaskStatusId,"onUpdate:modelValue":e[3]||(e[3]=o=>s.form.inTaskStatusId=o),onEnter:i.confirmClicked},null,8,["label","task-status-list","modelValue","onEnter"])]),r("h2",P,p(t.$t("status_automations.out_title")),1),r("div",J,[!i.isEditing&&s.form.entityType==="asset"?(n(),_(m,{key:0,class:"flexrow-item margin-fix",label:t.$t("status_automations.fields.out_field_type"),options:s.fieldTypeOptions,"locale-key-prefix":"status_automations.field_types.",onEnter:i.confirmClicked,modelValue:s.form.outFieldType,"onUpdate:modelValue":e[4]||(e[4]=o=>s.form.outFieldType=o)},null,8,["label","options","onEnter","modelValue"])):c("",!0),i.isEditing&&s.form.outFieldType==="ready_for"?(n(),y("span",Q,p(t.$t("status_automations.field_types.ready_for")),1)):c("",!0),u(f,{class:"flexrow-item",label:t.$t("status_automations.fields.out_task_type"),"task-type-list":s.form.outEntityTaskTypes.filter(({archived:o})=>!o),"open-top":!0,onEnter:i.confirmClicked,modelValue:s.form.outTaskTypeId,"onUpdate:modelValue":e[5]||(e[5]=o=>s.form.outTaskTypeId=o)},null,8,["label","task-type-list","onEnter","modelValue"]),s.form.outFieldType==="status"?(n(),_(T,{key:2,class:"flexrow-item",label:t.$t("status_automations.fields.out_task_status"),"task-status-list":i.taskStatusList,"open-top":!0,onEnter:i.confirmClicked,modelValue:s.form.outTaskStatusId,"onUpdate:modelValue":e[6]||(e[6]=o=>s.form.outTaskStatusId=o)},null,8,["label","task-status-list","onEnter","modelValue"])):c("",!0)]),u(h,{label:t.$t("status_automations.fields.import_last_revision"),onEnter:i.confirmClicked,modelValue:s.form.importLastRevision,"onUpdate:modelValue":e[7]||(e[7]=o=>s.form.importLastRevision=o)},null,8,["label","onEnter","modelValue"]),i.isEditing?(n(),_(h,{key:2,label:t.$t("main.archived"),onEnter:i.confirmClicked,modelValue:s.form.archived,"onUpdate:modelValue":e[8]||(e[8]=o=>s.form.archived=o)},null,8,["label","onEnter","modelValue"])):c("",!0)],32),u(k,{"error-text":t.$t("status_automations.create_error"),"is-error":d.isError,onConfirm:i.confirmClicked,onCancel:e[10]||(e[10]=o=>t.$emit("cancel"))},null,8,["error-text","is-error","onConfirm"])])])],2)}const X=E(N,[["render",W],["__scopeId","data-v-12a0d05f"]]),Y={name:"status-automations",components:{DeleteModal:w,EditStatusAutomationModal:X,ListPageHeader:F,RouteTabs:B,StatusAutomationList:U},data(){return{activeTab:"active",modals:{edit:!1,del:!1},loading:{edit:!1,del:!1,list:!1},errors:{edit:!1,del:!1,list:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}],statusAutomationToDelete:null,statusAutomationToEdit:null}},computed:{...b(["statusAutomations","archivedStatusAutomations","taskStatusMap","taskTypeMap"]),isActiveTab(){return this.activeTab==="active"},statusAutomationsList(){return this.isActiveTab?this.statusAutomations:this.archivedStatusAutomations},deleteText(){const t=this.statusAutomationToDelete;return t?this.$t("custom_actions.delete_text",{name:t.name}):""}},created(){this.activeTab=this.$route.query.tab||"active",this.loading.list=!0,this.errors.list=!1,this.loadStatusAutomations(t=>{this.loading.list=!1,t&&(this.errors.list=!0)})},methods:{...L(["deleteStatusAutomation","editStatusAutomation","loadTaskStatuses","loadStatusAutomations","newStatusAutomation"]),confirmEditStatusAutomation(t){let e="newStatusAutomation";this.statusAutomationToEdit&&this.statusAutomationToEdit.id&&(e="editStatusAutomation",t.id=this.statusAutomationToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this[e](t).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(d=>{console.error(d),this.errors.edit=!0,this.loading.edit=!1})},confirmDeleteStatusAutomation(){this.loading.del=!0,this.errors.del=!1,this.deleteStatusAutomation(this.statusAutomationToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(t=>{console.error(t),this.errors.del=!0,this.loading.del=!1})},onExportClicked(){const t=D.slugify(this.$t("status_automations.title")),d=[[this.$t("main.type"),this.$t("status_automations.fields.entity_type"),this.$t("status_automations.fields.in_task_type"),this.$t("status_automations.fields.in_task_status"),this.$t("status_automations.fields.out_field_type"),this.$t("status_automations.fields.out_task_type"),this.$t("status_automations.fields.out_task_status"),this.$t("status_automations.fields.import_last_revision")]].concat(this.statusAutomations.map(a=>{var s,i,m,f;return[a.type,a.entity_type,(s=this.taskTypeMap.get(a.in_task_type_id))==null?void 0:s.name,(i=this.taskStatusMap.get(a.in_task_status_id))==null?void 0:i.short_name,a.out_field_type==="ready_for"?this.$t("status_automations.change_ready_for"):this.$t("status_automations.change_status"),(m=this.taskTypeMap.get(a.out_task_type_id))==null?void 0:m.name,a.out_field_type==="status"?(f=this.taskStatusMap.get(a.out_task_status_id))==null?void 0:f.short_name:void 0,a.import_last_revision]}));M.buildCsvFile(t,d)},onNewClicked(){this.statusAutomationToEdit={},this.errors.edit=!1,this.modals.edit=!0},onEditClicked(t){this.statusAutomationToEdit=t,this.errors.edit=!1,this.modals.edit=!0},onDeleteClicked(t){this.statusAutomationToDelete=t,this.errors.del=!1,this.modals.del=!0}},watch:{$route(){this.activeTab=this.$route.query.tab||"active"}},head(){return{title:`${this.$t("status_automations.title")} - Kitsu`}}},Z={class:"status-automations page fixed-page"};function $(t,e,d,a,s,i){const m=l("list-page-header"),f=l("route-tabs"),T=l("status-automation-list"),h=l("edit-status-automation-modal"),k=l("delete-modal");return n(),y("div",Z,[u(m,{title:t.$t("status_automations.title"),"new-entry-label":t.$t("status_automations.new_status_automation"),"is-exportable":i.isActiveTab,onExportClicked:i.onExportClicked,onNewClicked:i.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),u(f,{class:"mt2","active-tab":s.activeTab,tabs:s.tabs,"route-name":"status-automations"},null,8,["active-tab","tabs"]),u(T,{class:"status-automation-list",entries:i.statusAutomationsList,"is-editable":!0,"is-loading":s.loading.list,"is-error":s.errors.list,onEditClicked:i.onEditClicked,onDeleteClicked:i.onDeleteClicked},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked"]),u(h,{active:s.modals.edit,"is-loading":s.loading.edit,"is-error":s.errors.edit,"status-automation-to-edit":s.statusAutomationToEdit,onCancel:e[0]||(e[0]=o=>s.modals.edit=!1),onConfirm:i.confirmEditStatusAutomation},null,8,["active","is-loading","is-error","status-automation-to-edit","onConfirm"]),u(k,{active:s.modals.del,"is-loading":s.loading.del,"is-error":s.errors.del,text:i.deleteText,"error-text":t.$t("status_automations.delete_error"),onCancel:e[1]||(e[1]=o=>s.modals.del=!1),onConfirm:i.confirmDeleteStatusAutomation},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const at=E(Y,[["render",$],["__scopeId","data-v-6c601c06"]]);export{at as default};
//# sourceMappingURL=StatusAutomations-XP1g7sXT.js.map
