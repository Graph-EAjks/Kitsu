import{n as o,K as d,an as r,L as l,M as n,O as c,I as u,T as m,Q as f,m as h,b as v,U as _,W as b}from"./index-CyeclmpI.js";import{L as p}from"./ListPageHeader-K20F5v-g.js";import{R as $}from"./RouteTabs-k0UiFpJX.js";const g={name:"edit-studios-modal",mixins:[d],components:{ColorField:r,ComboboxBoolean:l,ModalFooter:n,TextField:c},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},studioToEdit:{type:Object,default:()=>{}}},data(){return{form:{id:null,name:"",color:"",archived:"false"}}},computed:{isEditing(){var i;return(i=this.studioToEdit)==null?void 0:i.id}},methods:{runConfirmation(){this.$emit("confirm",this.form)}},watch:{active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)},studioToEdit(){this.isEditing?this.form={id:this.studioToEdit.id,name:this.studioToEdit.name,color:this.studioToEdit.color,archived:String(this.studioToEdit.archived===!0)}:this.form={id:null,name:"",color:"",archived:"false"}}}};var C=function(){var t=this,e=t._self._c;return e("div",{staticClass:"modal",class:{"is-active":t.active}},[e("div",{staticClass:"modal-background",on:{click:function(s){return t.$emit("cancel")}}}),e("div",{staticClass:"modal-content"},[e("div",{staticClass:"box"},[t.isEditing?e("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("studios.edit_title"))+" "+t._s(t.studioToEdit.name)+" ")]):e("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("studios.new_studios"))+" ")]),e("form",{on:{submit:function(s){s.preventDefault()}}},[e("text-field",{directives:[{name:"focus",rawName:"v-focus"}],ref:"nameField",attrs:{label:t.$t("studios.fields.name"),maxlength:30},model:{value:t.form.name,callback:function(s){t.$set(t.form,"name",s)},expression:"form.name"}}),e("color-field",{attrs:{label:t.$t("studios.fields.color")},model:{value:t.form.color,callback:function(s){t.$set(t.form,"color",s)},expression:"form.color"}}),t.isEditing?e("combobox-boolean",{attrs:{label:t.$t("main.archived")},on:{enter:t.runConfirmation},model:{value:t.form.archived,callback:function(s){t.$set(t.form,"archived",s)},expression:"form.archived"}}):t._e()],1),e("modal-footer",{attrs:{"error-text":t.$t("studios.create_error"),"is-error":t.isError,"is-loading":t.isLoading},on:{confirm:t.runConfirmation,cancel:function(s){return t.$emit("cancel")}}})],1)])])},T=[],E=o(g,C,T,!1,null,"dbb44d2c");const x=E.exports,k={name:"studio-list",props:["entries","isLoading","isError"],components:{RowActionsCell:u,TableInfo:m}};var w=function(){var t=this,e=t._self._c;return e("div",{staticClass:"data-list"},[e("div",{staticClass:"datatable-wrapper"},[e("table",{staticClass:"datatable"},[e("thead",{staticClass:"datatable-head"},[e("tr",[e("th",{staticClass:"name",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("studios.fields.name"))+" ")]),e("th",{attrs:{scope:"col"}},[t._v(t._s(t.$t("studios.fields.color")))]),e("th",{staticClass:"actions",attrs:{scope:"col"}})])]),t.entries.length>0?e("tbody",{staticClass:"datatable-body"},t._l(t.entries,function(s){return e("tr",{key:s.id,staticClass:"datatable-row"},[e("td",{staticClass:"name"},[t._v(" "+t._s(s.name)+" ")]),e("td",{staticClass:"color"},[e("div",[e("span",{style:{background:s.color}})])]),e("row-actions-cell",{attrs:{"entry-id":s.id},on:{"edit-clicked":function(a){return t.$emit("edit-clicked",s)},"delete-clicked":function(a){return t.$emit("delete-clicked",s)}}})],1)}),0):t._e()])]),e("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}}),e("p",{staticClass:"has-text-centered nb-asset-types"},[t._v(" "+t._s(t.entries.length)+" "+t._s(t.$tc("studios.number",t.entries.length))+" ")])],1)},S=[],y=o(k,w,S,!1,null,"566531b9");const D=y.exports,L={name:"studios",components:{DeleteModal:f,EditStudiosModal:x,ListPageHeader:p,RouteTabs:$,StudioList:D},data(){return{activeTab:"active",studioToEdit:null,studioToDelete:null,errors:{studios:!1,edit:!1,del:!1},loading:{studios:!1,edit:!1,del:!1},modals:{del:!1,edit:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},async mounted(){this.activeTab=this.$route.query.tab||"active",this.loading.studios=!0,this.errors.studios=!1;try{await this.loadStudios()}catch(i){console.log(i),this.errors.studios=!0}this.loading.studios=!1},computed:{...h(["studios","archivedStudios"]),isActiveTab(){return this.activeTab==="active"},studioList(){return this.isActiveTab?this.studios:this.archivedStudios},deleteText(){return this.studioToDelete?this.$t("studios.delete_text",{name:this.studioToDelete.name}):""}},methods:{...v(["deleteStudio","editStudio","loadStudios","newStudio"]),onExportClicked(){const i=_.slugify(this.$t("studios.title")),e=[[this.$t("main.type"),this.$t("studios.fields.name"),this.$t("studios.fields.color")]].concat(this.studios.map(s=>[s.type,s.name,s.color]));b.buildCsvFile(i,e)},onNewClicked(){this.studioToEdit={name:"",color:"#999999"},this.modals.edit=!0},onEditClicked(i){this.studioToEdit=i,this.modals.edit=!0},async confirmEditStudio(i){var t;this.loading.edit=!0,this.errors.edit=!1,i.id=(t=this.studioToEdit)==null?void 0:t.id;try{i.id?await this.editStudio(i):await this.newStudio(i),this.modals.edit=!1}catch(e){console.error(e),this.errors.edit=!0}this.loading.edit=!1},onDeleteClicked(i){this.studioToDelete=i,this.modals.del=!0},async confirmDeleteStudio(){this.loading.del=!0,this.errors.del=!1;try{await this.deleteStudio(this.studioToDelete),this.modals.del=!1}catch(i){console.error(i),this.errors.del=!0}this.loading.del=!1}},watch:{$route(){this.activeTab=this.$route.query.tab}},metaInfo(){return{title:`${this.$t("studios.title")} - Kitsu`}}};var F=function(){var t=this,e=t._self._c;return e("div",{staticClass:"studios page fixed-page"},[e("list-page-header",{attrs:{title:t.$t("studios.title"),"new-entry-label":t.$t("studios.new_studios"),"is-exportable":t.isActiveTab},on:{"export-clicked":t.onExportClicked,"new-clicked":t.onNewClicked}}),e("route-tabs",{staticClass:"mt2",attrs:{"active-tab":t.activeTab,tabs:t.tabs,"route-name":"studios"}}),e("studio-list",{staticClass:"studio-list",attrs:{entries:t.studioList,"is-loading":t.loading.studios,"is-error":t.errors.studios},on:{"edit-clicked":t.onEditClicked,"delete-clicked":t.onDeleteClicked}}),e("edit-studios-modal",{attrs:{active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"studio-to-edit":t.studioToEdit},on:{cancel:function(s){t.modals.edit=!1},confirm:t.confirmEditStudio}}),e("delete-modal",{attrs:{active:t.modals.del,"is-loading":t.loading.del,"is-error":t.errors.del,text:t.deleteText,"error-text":t.$t("studios.delete_error")},on:{cancel:function(s){t.modals.del=!1},confirm:t.confirmDeleteStudio}})],1)},R=[],A=o(L,F,R,!1,null,"8a91a7f0");const N=A.exports;export{N as default};
//# sourceMappingURL=Studios-SmM0VVYM.js.map
