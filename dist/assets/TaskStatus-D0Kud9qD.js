import{_ as T,a7 as w,a6 as y,a8 as V,a9 as F,aO as B,ag as D,aa as U,r as d,j as q,c as b,o as _,e as a,f as o,t as u,ab as A,l as P,d as f,k,n as L,T as N,a2 as x,a3 as g,cs as I,z as M,w as H,a5 as S,m as R,a as j,ac as z,ad as O,ae as $}from"./index-HPQhSyHW.js";import{L as G}from"./ListPageHeader-DRJTPMvq.js";import{R as K}from"./RouteTabs-CDEBKxHY.js";import{B as J}from"./BooleanCell-lXqwx1bI.js";import{T as Q}from"./TaskStatusCell-JSpPQiyv.js";const W={name:"edit-task-status-modal",mixins:[U],components:{BooleanField:D,ColorField:B,ComboboxBoolean:F,ModalFooter:V,TextField:y,TextareaField:w},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},taskStatusToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{name:"",short_name:"",description:"",color:"#999999",is_done:"false",is_feedback_request:"false",is_default:"false",archived:"false"},colors:["#999999","#CCCCCC","#F5F5F5","#CC9999","#FF3860","#E81123","#E74C3C","#FF5722","#FF7043","#FFA000","#FBC02D","#AFB42B","#8BC34A","#66BB6A","#22D160","#4DB6AC","#03A9F4","#3273DC","#3498DB","#2980B9","#607D8B","#8764B8","#AB26FF","#E040FB","#FF80AB"]}},computed:{isEditing(){return this.taskStatusToEdit&&this.taskStatusToEdit.id}},methods:{confirmClicked(){this.$emit("confirm",this.form)},resetForm(){this.taskStatusToEdit&&(this.form={name:this.taskStatusToEdit.name,short_name:this.taskStatusToEdit.short_name,description:this.taskStatusToEdit.description,color:this.taskStatusToEdit.color,is_done:String(this.taskStatusToEdit.is_done),is_retake:String(this.taskStatusToEdit.is_retake||!1),is_artist_allowed:String(this.taskStatusToEdit.is_artist_allowed),is_client_allowed:String(this.taskStatusToEdit.is_client_allowed),is_default:String(this.taskStatusToEdit.is_default||!1),is_feedback_request:String(this.taskStatusToEdit.is_feedback_request||!1),for_concept:String(this.taskStatusToEdit.for_concept||!1),archived:String(this.taskStatusToEdit.archived||!1)})}},watch:{taskStatusToEdit(){this.resetForm()},active(){this.active&&(this.resetForm(),setTimeout(()=>{this.$refs.nameField?.focus()},100))}}},X={class:"modal-content"},Y={class:"box"},Z={key:0,class:"title"},ee={key:1,class:"title"};function te(e,t,r,c,s,i){const h=d("text-field"),E=d("textarea-field"),m=d("boolean-field"),p=d("color-field"),v=d("combobox-boolean"),C=d("modal-footer"),n=q("focus");return _(),b("div",{class:L({modal:!0,"is-active":r.active})},[a("div",{class:"modal-background",onClick:t[0]||(t[0]=l=>e.$emit("cancel"))}),a("div",X,[a("div",Y,[i.isEditing?(_(),b("h1",Z,u(e.$t("task_status.edit_title"))+" "+u(r.taskStatusToEdit.name),1)):(_(),b("h1",ee,u(e.$t("task_status.new_task_status")),1)),a("form",{onSubmit:t[12]||(t[12]=A(()=>{},["prevent"]))},[r.taskStatusToEdit.short_name!=="todo"?P((_(),k(h,{key:0,ref:"nameField","input-class":"task-status-name",label:e.$t("task_status.fields.name"),onEnter:i.confirmClicked,modelValue:s.form.name,"onUpdate:modelValue":t[1]||(t[1]=l=>s.form.name=l)},null,8,["label","onEnter","modelValue"])),[[n]]):f("",!0),r.taskStatusToEdit.short_name!=="todo"?(_(),k(h,{key:1,ref:"shortNameField","input-class":"task-status-short-name",label:e.$t("task_status.fields.short_name"),maxlength:8,onEnter:i.confirmClicked,modelValue:s.form.short_name,"onUpdate:modelValue":t[2]||(t[2]=l=>s.form.short_name=l)},null,8,["label","onEnter","modelValue"])):f("",!0),o(E,{"input-class":"task-status-description",label:e.$t("task_status.fields.description"),onEnter:i.confirmClicked,modelValue:s.form.description,"onUpdate:modelValue":t[3]||(t[3]=l=>s.form.description=l)},null,8,["label","onEnter","modelValue"]),o(m,{class:"mr05 mb05",label:e.$t("task_status.fields.is_default"),onEnter:i.confirmClicked,modelValue:s.form.is_default,"onUpdate:modelValue":t[4]||(t[4]=l=>s.form.is_default=l),disabled:s.form.for_concept==="true"},null,8,["label","onEnter","modelValue","disabled"]),s.form.is_default==="false"?(_(),k(m,{key:2,class:"mr05 mb05",label:e.$t("task_status.fields.is_done"),onEnter:i.confirmClicked,modelValue:s.form.is_done,"onUpdate:modelValue":t[5]||(t[5]=l=>s.form.is_done=l)},null,8,["label","onEnter","modelValue"])):f("",!0),s.form.is_default==="false"?(_(),k(m,{key:3,class:"mr05 mb05",label:e.$t("task_status.fields.is_retake"),onEnter:i.confirmClicked,modelValue:s.form.is_retake,"onUpdate:modelValue":t[6]||(t[6]=l=>s.form.is_retake=l)},null,8,["label","onEnter","modelValue"])):f("",!0),o(m,{class:"mr05 mb05",label:e.$t("task_status.fields.is_artist_allowed"),onEnter:i.confirmClicked,modelValue:s.form.is_artist_allowed,"onUpdate:modelValue":t[7]||(t[7]=l=>s.form.is_artist_allowed=l)},null,8,["label","onEnter","modelValue"]),s.form.for_concept!=="true"?(_(),k(m,{key:4,class:"mr05 mb05",label:e.$t("task_status.fields.is_client_allowed"),onEnter:i.confirmClicked,modelValue:s.form.is_client_allowed,"onUpdate:modelValue":t[8]||(t[8]=l=>s.form.is_client_allowed=l)},null,8,["label","onEnter","modelValue"])):f("",!0),s.form.is_default==="false"?(_(),k(m,{key:5,class:"mr05 mb05",label:e.$t("task_status.fields.is_feedback_request"),onEnter:i.confirmClicked,modelValue:s.form.is_feedback_request,"onUpdate:modelValue":t[9]||(t[9]=l=>s.form.is_feedback_request=l)},null,8,["label","onEnter","modelValue"])):f("",!0),r.taskStatusToEdit.short_name!=="todo"?(_(),k(p,{key:6,class:"mt2",colors:s.colors,column:5,label:e.$t("task_status.fields.color"),modelValue:s.form.color,"onUpdate:modelValue":t[10]||(t[10]=l=>s.form.color=l)},null,8,["colors","label","modelValue"])):f("",!0),i.isEditing?(_(),k(v,{key:7,label:e.$t("main.archived"),onEnter:i.confirmClicked,modelValue:s.form.archived,"onUpdate:modelValue":t[11]||(t[11]=l=>s.form.archived=l)},null,8,["label","onEnter","modelValue"])):f("",!0)],32),o(C,{"error-text":e.$t("task_status.create_error"),"is-error":r.isError,"is-loading":r.isLoading,onConfirm:i.confirmClicked,onCancel:t[13]||(t[13]=l=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const se=T(W,[["render",te],["__scopeId","data-v-b55e52ec"]]),ie={name:"task-status-list",mixins:[M],components:{BooleanCell:J,draggable:I,HelpCircleIcon:g,RowActionsCell:x,TableInfo:N,TaskStatusCell:Q},props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["delete-clicked","edit-clicked","update-priorities"],data(){return{taskStatuses:[]}},mounted(){this.taskStatuses=this.entries},computed:{},methods:{async updateTaskStatusPriorities(){const e=this.taskStatuses.map((t,r)=>({id:t.id,priority:r+1}));this.$emit("update-priorities",e)}},watch:{entries(){this.taskStatuses=this.entries}}},le={class:"data-list"},ae={class:"datatable-wrapper"},oe={class:"datatable"},ne={class:"datatable-head"},re={scope:"col",class:"name"},de={scope:"col",class:"short-name"},ce={scope:"col",class:"is-default"},ue={scope:"col",class:"is-done"},me={scope:"col",class:"is-retake"},_e={scope:"col",class:"is-artist-allowed"},fe={scope:"col",class:"is-client-allowed"},ke={scope:"col",class:"is-feedback-request"},he={class:"datatable-row task-status"},pe={class:"name"},be=["title"],Ee={class:"has-text-centered nb-task-status"};function ve(e,t,r,c,s,i){const h=d("help-circle-icon"),E=d("task-status-cell"),m=d("boolean-cell"),p=d("row-actions-cell"),v=d("draggable"),C=d("table-info");return _(),b("div",le,[a("div",ae,[a("table",oe,[a("thead",ne,[a("tr",null,[a("th",re,u(e.$t("task_status.fields.name")),1),a("th",de,u(e.$t("task_status.fields.short_name")),1),a("th",ce,u(e.$t("task_status.fields.is_default")),1),a("th",ue,u(e.$t("task_status.fields.is_done")),1),a("th",me,u(e.$t("task_status.fields.is_retake")),1),a("th",_e,u(e.$t("task_status.fields.is_artist_allowed")),1),a("th",fe,u(e.$t("task_status.fields.is_client_allowed")),1),a("th",ke,u(e.$t("task_status.fields.is_feedback_request")),1),t[1]||(t[1]=a("th",{scope:"col",class:"actions"},null,-1))])]),o(v,{class:"datatable-body","item-key":"id",tag:"tbody",onEnd:i.updateTaskStatusPriorities,modelValue:s.taskStatuses,"onUpdate:modelValue":t[0]||(t[0]=n=>s.taskStatuses=n)},{item:H(({element:n})=>[a("tr",he,[a("td",pe,[S(u(n.name)+" ",1),n.description?(_(),b("span",{key:0,title:n.description},[o(h,{class:"icon is-small"})],8,be)):f("",!0)]),o(E,{class:"short-name",entry:n},null,8,["entry"]),o(m,{class:"is-default",value:n.is_default},null,8,["value"]),o(m,{class:"is-done",value:n.is_done},null,8,["value"]),o(m,{class:"is-retake",value:n.is_retake},null,8,["value"]),o(m,{class:"is-artist-allowed",value:n.is_artist_allowed},null,8,["value"]),o(m,{class:"is-client-allowed",value:n.is_client_allowed},null,8,["value"]),o(m,{class:"is-feedback-request",value:n.is_feedback_request},null,8,["value"]),o(p,{"entry-id":n.id,"hide-delete":n.is_default===!0||n.for_concept,onEditClicked:l=>e.$emit("edit-clicked",n),onDeleteClicked:l=>e.$emit("delete-clicked",n)},null,8,["entry-id","hide-delete","onEditClicked","onDeleteClicked"])])]),_:1},8,["onEnd","modelValue"])])]),o(C,{"is-loading":r.isLoading,"is-error":r.isError},null,8,["is-loading","is-error"]),a("p",Ee,u(r.entries.length)+" "+u(e.$tc("task_status.number",r.entries.length)),1)])}const Ce=T(ie,[["render",ve],["__scopeId","data-v-f756247e"]]),Te={name:"task-status",components:{DeleteModal:z,EditTaskStatusModal:se,HelpCircleIcon:g,ListPageHeader:G,RouteTabs:K,TaskStatusList:Ce},data(){return{activeTab:"active",taskStatusToDelete:null,taskStatusToEdit:{color:"#000000"},modals:{edit:!1,del:!1},loading:{edit:!1,del:!1,list:!1},errors:{edit:!1,del:!1,list:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},mounted(){this.activeTab=this.$route.query.tab||"active"},computed:{...j(["archivedTaskStatus","taskStatus"]),isActiveTab(){return this.activeTab==="active"},activeTaskStatuses(){return this.isActiveTab?this.taskStatus:this.archivedTaskStatus},taskStatusList(){return this.activeTaskStatuses.filter(e=>!e.for_concept).sort((e,t)=>e.priority-t.priority)},conceptStatusList(){return this.activeTaskStatuses.filter(e=>e.for_concept).sort((e,t)=>e.priority-t.priority)}},methods:{...R(["deleteTaskStatus","updateTaskStatusPriority"]),async updatePriorities(e){for(const t of e)await this.updateTaskStatusPriority(t)},confirmEditTaskStatus(e){const t=!(this.taskStatusToEdit&&this.taskStatusToEdit.id);let r="newTaskStatus";t||(r="saveTaskStatus",e.id=this.taskStatusToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(r,e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(c=>{console.error(c),this.loading.edit=!1,this.errors.edit=!0})},confirmDeleteTaskStatus(){this.loading.del=!0,this.errors.del=!1,this.deleteTaskStatus(this.taskStatusToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(e=>{console.error(e),this.loading.del=!1,this.errors.del=!0})},deleteText(){const e=this.taskStatusToDelete;return e?this.$t("task_status.delete_text",{name:e.name}):""},onExportClicked(){const e=O.slugify(this.$t("task_status.title")),r=[[this.$t("main.type"),this.$t("task_status.fields.name"),this.$t("task_status.fields.short_name"),this.$t("task_status.fields.description"),this.$t("task_status.fields.color"),this.$t("task_status.fields.is_default"),this.$t("task_status.fields.is_done"),this.$t("task_status.fields.is_retake"),this.$t("task_status.fields.is_artist_allowed"),this.$t("task_status.fields.is_client_allowed"),this.$t("task_status.fields.is_feedback_request")]].concat(this.taskStatus.map(c=>[c.type,c.name,c.short_name,c.description,c.color,c.is_default,c.is_done,c.is_retake,c.is_artist_allowed,c.is_client_allowed,c.is_feedback_request]));$.buildCsvFile(e,r)},onNewClicked(){this.taskStatusToEdit={color:"#000000"},this.modals.edit=!0},onEditClicked(e){this.taskStatusToEdit=e,this.modals.edit=!0},onDeleteClicked(e){this.taskStatusToDelete=e,this.modals.del=!0}},watch:{$route(){this.activeTab=this.$route.query.tab||"active"}},head(){return{title:`${this.$t("task_status.title")} - Kitsu`}}},ge={class:"task-status page fixed-page"},Se={class:"column"},we=["title"];function ye(e,t,r,c,s,i){const h=d("list-page-header"),E=d("route-tabs"),m=d("help-circle-icon"),p=d("task-status-list"),v=d("edit-task-status-modal"),C=d("delete-modal");return _(),b("div",ge,[o(h,{title:e.$t("task_status.title"),"new-entry-label":e.$t("task_status.new_task_status"),"is-exportable":i.isActiveTab,onExportClicked:i.onExportClicked,onNewClicked:i.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),o(E,{class:"mt2","active-tab":s.activeTab,tabs:s.tabs},null,8,["active-tab","tabs"]),a("div",Se,[a("h2",null,[S(u(e.$t("task_status.title_entities"))+" ",1),a("span",{class:"help-tooltip",title:e.$t("task_status.help.entities")},[o(m,{class:"icon is-small"})],8,we)]),o(p,{entries:i.taskStatusList,"is-loading":s.loading.list,"is-error":s.errors.list,onEditClicked:i.onEditClicked,onDeleteClicked:i.onDeleteClicked,onUpdatePriorities:i.updatePriorities},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked","onUpdatePriorities"]),a("h2",null,u(e.$t("task_status.title_concepts")),1),o(p,{entries:i.conceptStatusList,"is-loading":s.loading.list,"is-error":s.errors.list,onEditClicked:i.onEditClicked,onDeleteClicked:i.onDeleteClicked,onUpdatePriorities:i.updatePriorities},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked","onUpdatePriorities"])]),o(v,{active:s.modals.edit,"is-loading":s.loading.edit,"is-error":s.errors.edit,"task-status-to-edit":s.taskStatusToEdit,onCancel:t[0]||(t[0]=n=>s.modals.edit=!1),onConfirm:i.confirmEditTaskStatus},null,8,["active","is-loading","is-error","task-status-to-edit","onConfirm"]),o(C,{active:s.modals.del,"is-loading":s.loading.del,"is-error":s.errors.del,text:i.deleteText(),"error-text":e.$t("task_status.delete_error"),onCancel:t[1]||(t[1]=n=>s.modals.del=!1),onConfirm:i.confirmDeleteTaskStatus},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const qe=T(Te,[["render",ye],["__scopeId","data-v-110d89a4"]]);export{qe as default};
//# sourceMappingURL=TaskStatus-D0Kud9qD.js.map
