import{_ as y,T as g,a2 as w,a3 as E,ct as S,z as D,r as c,c as b,o as _,e as a,f as o,t as d,w as $,a5 as P,d as v,m as q,a as L,d0 as x,a7 as N,k as T,a8 as B,a9 as V}from"./index-CKHz3hAB.js";import{L as A}from"./ListPageHeader-FUN6DBDP.js";import{R as U}from"./RouteTabs-BHe4WRnD.js";import{B as H}from"./BooleanCell-CuzNHsKh.js";import{T as I}from"./TaskStatusCell-C7XG6pG0.js";const M={name:"task-status-list",mixins:[D],components:{BooleanCell:H,draggable:S,HelpCircleIcon:E,RowActionsCell:w,TableInfo:g,TaskStatusCell:I},props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["delete-clicked","edit-clicked","update-priorities"],data(){return{taskStatuses:[]}},mounted(){this.taskStatuses=this.entries},computed:{},methods:{async updateTaskStatusPriorities(){const t=this.taskStatuses.map((s,r)=>({id:s.id,priority:r+1}));this.$emit("update-priorities",t)}},watch:{entries(){this.taskStatuses=this.entries}}},R={class:"data-list"},z={class:"datatable-wrapper"},F={class:"datatable"},G={class:"datatable-head"},K={scope:"col",class:"name"},j={scope:"col",class:"short-name"},J={scope:"col",class:"is-default"},O={scope:"col",class:"is-done"},Q={scope:"col",class:"is-retake"},W={scope:"col",class:"is-artist-allowed"},X={scope:"col",class:"is-client-allowed"},Y={scope:"col",class:"is-feedback-request"},Z={class:"datatable-row task-status"},tt={class:"name"},et=["title"],st={class:"has-text-centered nb-task-status"};function it(t,s,r,n,e,l){const k=c("help-circle-icon"),h=c("task-status-cell"),u=c("boolean-cell"),m=c("row-actions-cell"),f=c("draggable"),p=c("table-info");return _(),b("div",R,[a("div",z,[a("table",F,[a("thead",G,[a("tr",null,[a("th",K,d(t.$t("task_status.fields.name")),1),a("th",j,d(t.$t("task_status.fields.short_name")),1),a("th",J,d(t.$t("task_status.fields.is_default")),1),a("th",O,d(t.$t("task_status.fields.is_done")),1),a("th",Q,d(t.$t("task_status.fields.is_retake")),1),a("th",W,d(t.$t("task_status.fields.is_artist_allowed")),1),a("th",X,d(t.$t("task_status.fields.is_client_allowed")),1),a("th",Y,d(t.$t("task_status.fields.is_feedback_request")),1),s[1]||(s[1]=a("th",{scope:"col",class:"actions"},null,-1))])]),o(f,{class:"datatable-body","item-key":"id",tag:"tbody",onEnd:l.updateTaskStatusPriorities,modelValue:e.taskStatuses,"onUpdate:modelValue":s[0]||(s[0]=i=>e.taskStatuses=i)},{item:$(({element:i})=>[a("tr",Z,[a("td",tt,[P(d(i.name)+" ",1),i.description?(_(),b("span",{key:0,title:i.description},[o(k,{class:"icon is-small"})],8,et)):v("",!0)]),o(h,{class:"short-name",entry:i},null,8,["entry"]),o(u,{class:"is-default",value:i.is_default},null,8,["value"]),o(u,{class:"is-done",value:i.is_done},null,8,["value"]),o(u,{class:"is-retake",value:i.is_retake},null,8,["value"]),o(u,{class:"is-artist-allowed",value:i.is_artist_allowed},null,8,["value"]),o(u,{class:"is-client-allowed",value:i.is_client_allowed},null,8,["value"]),o(u,{class:"is-feedback-request",value:i.is_feedback_request},null,8,["value"]),o(m,{"entry-id":i.id,"hide-delete":i.is_default===!0||i.for_concept,onEditClicked:C=>t.$emit("edit-clicked",i),onDeleteClicked:C=>t.$emit("delete-clicked",i)},null,8,["entry-id","hide-delete","onEditClicked","onDeleteClicked"])])]),_:1},8,["onEnd","modelValue"])])]),o(p,{"is-loading":r.isLoading,"is-error":r.isError},null,8,["is-loading","is-error"]),a("p",st,d(r.entries.length)+" "+d(t.$tc("task_status.number",r.entries.length)),1)])}const at=y(M,[["render",it],["__scopeId","data-v-f756247e"]]),lt={name:"task-status",components:{DeleteModal:N,EditTaskStatusModal:x,ListPageHeader:A,RouteTabs:U,TaskStatusList:at},data(){return{activeTab:"active",entityTab:"entities",entityTabs:[{name:"entities",label:this.$t("entities.title")},{name:"concepts",label:this.$t("concepts.title")}],taskStatusToDelete:null,taskStatusToEdit:{color:"#000000"},modals:{edit:!1,del:!1},loading:{edit:!1,del:!1,list:!1},errors:{edit:!1,del:!1,list:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},mounted(){this.activeTab=this.$route.query.tab||"active",this.entityTab=this.$route.query.entity||"entities"},computed:{...L(["archivedTaskStatus","taskStatus"]),isActiveTab(){return this.activeTab==="active"},activeTaskStatuses(){return this.isActiveTab?this.taskStatus:this.archivedTaskStatus},taskStatusList(){return this.activeTaskStatuses.filter(t=>!t.for_concept).sort((t,s)=>t.priority-s.priority)},conceptStatusList(){return this.activeTaskStatuses.filter(t=>t.for_concept).sort((t,s)=>t.priority-s.priority)}},methods:{...q(["deleteTaskStatus","updateTaskStatusPriority"]),async updatePriorities(t){for(const s of t)await this.updateTaskStatusPriority(s)},confirmEditTaskStatus(t){const s=!(this.taskStatusToEdit&&this.taskStatusToEdit.id);let r="newTaskStatus";s||(r="saveTaskStatus",t.id=this.taskStatusToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(r,t).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(n=>{console.error(n),this.loading.edit=!1,this.errors.edit=!0})},confirmDeleteTaskStatus(){this.loading.del=!0,this.errors.del=!1,this.deleteTaskStatus(this.taskStatusToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(t=>{console.error(t),this.loading.del=!1,this.errors.del=!0})},deleteText(){const t=this.taskStatusToDelete;return t?this.$t("task_status.delete_text",{name:t.name}):""},onExportClicked(){const t=B.slugify(this.$t("task_status.title")),r=[[this.$t("main.type"),this.$t("task_status.fields.name"),this.$t("task_status.fields.short_name"),this.$t("task_status.fields.description"),this.$t("task_status.fields.color"),this.$t("task_status.fields.is_default"),this.$t("task_status.fields.is_done"),this.$t("task_status.fields.is_retake"),this.$t("task_status.fields.is_artist_allowed"),this.$t("task_status.fields.is_client_allowed"),this.$t("task_status.fields.is_feedback_request")]].concat(this.taskStatus.map(n=>[n.type,n.name,n.short_name,n.description,n.color,n.is_default,n.is_done,n.is_retake,n.is_artist_allowed,n.is_client_allowed,n.is_feedback_request]));V.buildCsvFile(t,r)},onNewClicked(){this.taskStatusToEdit={color:"#000000"},this.modals.edit=!0},onEditClicked(t){this.taskStatusToEdit=t,this.modals.edit=!0},onDeleteClicked(t){this.taskStatusToDelete=t,this.modals.del=!0}},watch:{$route(){this.activeTab=this.$route.query.tab||"active",this.entityTab=this.$route.query.entity||"entities"}},head(){return{title:`${this.$t("task_status.title")} - Kitsu`}}},ot={class:"task-status page fixed-page"},nt={class:"column"};function rt(t,s,r,n,e,l){const k=c("list-page-header"),h=c("route-tabs"),u=c("task-status-list"),m=c("edit-task-status-modal"),f=c("delete-modal");return _(),b("div",ot,[o(k,{title:t.$t("task_status.library_title"),"new-entry-label":t.$t("task_status.new_task_status"),"is-exportable":l.isActiveTab,onExportClicked:l.onExportClicked,onNewClicked:l.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),o(h,{class:"mt2","active-tab":e.activeTab,tabs:e.tabs},null,8,["active-tab","tabs"]),o(h,{"active-tab":e.entityTab,tabs:e.entityTabs,"route-key":"entity"},null,8,["active-tab","tabs"]),a("div",nt,[e.entityTab==="entities"?(_(),T(u,{key:0,entries:l.taskStatusList,"is-loading":e.loading.list,"is-error":e.errors.list,onEditClicked:l.onEditClicked,onDeleteClicked:l.onDeleteClicked,onUpdatePriorities:l.updatePriorities},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked","onUpdatePriorities"])):v("",!0),e.entityTab==="concepts"?(_(),T(u,{key:1,entries:l.conceptStatusList,"is-loading":e.loading.list,"is-error":e.errors.list,onEditClicked:l.onEditClicked,onDeleteClicked:l.onDeleteClicked,onUpdatePriorities:l.updatePriorities},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked","onUpdatePriorities"])):v("",!0)]),o(m,{active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"task-status-to-edit":e.taskStatusToEdit,onCancel:s[0]||(s[0]=p=>e.modals.edit=!1),onConfirm:l.confirmEditTaskStatus},null,8,["active","is-loading","is-error","task-status-to-edit","onConfirm"]),o(f,{active:e.modals.del,"is-loading":e.loading.del,"is-error":e.errors.del,text:l.deleteText(),"error-text":t.$t("task_status.delete_error"),onCancel:s[1]||(s[1]=p=>e.modals.del=!1),onConfirm:l.confirmDeleteTaskStatus},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const kt=y(lt,[["render",rt],["__scopeId","data-v-758e19c8"]]);export{kt as default};
//# sourceMappingURL=TaskStatus-DewsPSI4.js.map
