(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3f6b4538"],{"3b05":function(t,e,s){},"3c1d":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"episodes page fixed-page"},[s("div",{staticClass:"episode-list-header page-header flexrow"},[s("search-field",{ref:"episode-search-field",staticClass:"flexrow-item mt1",attrs:{placeholder:"ex: e01 s01, anim=wip"},on:{change:t.onSearchChange}}),s("combobox",{staticClass:"mb0 flexrow-item",attrs:{"locale-key-prefix":"statistics.",label:t.$t("statistics.data_mode"),options:t.dataModeOptions},model:{value:t.dataMode,callback:function(e){t.dataMode=e},expression:"dataMode"}}),s("combobox",{staticClass:"mb0 flexrow-item",attrs:{"locale-key-prefix":"statistics.",label:t.$t("statistics.display_mode"),options:t.displayModeOptions},model:{value:t.displayMode,callback:function(e){t.displayMode=e},expression:"displayMode"}}),s("combobox",{staticClass:"mb0 flexrow-item",attrs:{label:t.$t("statistics.count_mode"),"locale-key-prefix":"statistics.",options:t.countModeOptions},model:{value:t.countMode,callback:function(e){t.countMode=e},expression:"countMode"}}),s("span",{staticClass:"filler"}),s("button-simple",{staticClass:"flexrow-item",attrs:{icon:"refresh",title:t.$t("main.reload")},on:{click:t.reset}}),s("button-simple",{staticClass:"flexrow-item",attrs:{icon:"download"},on:{click:t.exportStatisticsToCsv}})],1),s("episode-stats-list",{ref:"episode-list",attrs:{entries:t.displayedEpisodes,"is-loading":t.isLoading,"is-error":t.isLoadingError,"validation-columns":t.episodeValidationColumns,"episode-stats":t.episodeStats,"episode-retakes-stats":t.episodeRetakeStats,"data-mode":t.dataMode,"count-mode":t.countMode,"display-mode":t.displayMode,"show-all":0===t.episodeSearchText.length},on:{"field-changed":t.onFieldChanged,scroll:t.saveScrollPosition}})],1)},i=[],o=s("c1df"),r=s.n(o),n=s("2f62"),l=s("3455"),d=s("8c97"),c=s("de40"),u=s("992f"),p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"data-list"},[s("div",{directives:[{name:"scroll",rawName:"v-scroll",value:t.onBodyScroll,expression:"onBodyScroll"}],ref:"body",staticClass:"datatable-wrapper"},[s("table",{staticClass:"datatable"},[s("thead",{staticClass:"datatable-head"},[s("tr",[s("th",{staticClass:"expander"}),s("th",{ref:"th-episode",staticClass:"name datatable-row-header",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("shots.fields.episode"))+" ")]),s("th",{staticClass:"description",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("shots.fields.description"))+" ")]),s("th",{staticClass:"validation",attrs:{scope:"col"}},[t._v(t._s(t.$t("main.all")))]),t._l(t.validationColumns,(function(e){return s("th",{key:t.taskTypeMap.get(e).id,staticClass:"validation validation-cell",attrs:{scope:"col"}},[s("div",{staticClass:"flexrow validation-content",style:t.getValidationStyle(e)},[t.isCurrentUserClient?s("span",{staticClass:"flexrow-item"},[t._v(" "+t._s(t.taskTypeMap.get(e).name)+" ")]):s("router-link",{staticClass:"flexrow-item",attrs:{to:t.taskTypePath(e)}},[t._v(" "+t._s(t.taskTypeMap.get(e).name)+" ")])],1)])})),s("th",{staticClass:"actions",attrs:{scope:"col"}})],2)]),t.isLoading?t._e():s("tbody",{staticClass:"datatable-body"},[t.showAll&&!t.isEmptyList?s("tr",{staticClass:"all-line datatable-row"},[s("td",{staticClass:"expander"}),s("td",{staticClass:"name datatable-row-header",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("episodes.all_episodes"))+" ")]),s("td",{staticClass:"description"}),s("stats-cell",{attrs:{colors:t.chartColors("all","all"),data:t.chartData("all","all"),"frames-data":t.chartData("all","all","frames"),countMode:t.countMode,displayMode:t.displayMode}}),t._l(t.validationColumns,(function(e){return s("stats-cell",{key:"all-"+e,style:t.getValidationStyle(e),attrs:{colors:t.chartColors("all",e),data:t.chartData("all",e),"frames-data":t.chartData("all",e,"frames"),countMode:t.countMode,displayMode:t.displayMode}})})),s("td",{staticClass:"actions"})],2):t._e(),t._l(t.entries,(function(e){return[s("tr",{key:e.id,staticClass:"datatable-row"},[s("td",{staticClass:"expander",on:{click:function(s){return t.toggleExpanded(e.id)}}},[t.isRetakes&&!0!==t.expanded[e.id]?s("chevron-right-icon"):t._e(),t.isRetakes&&!0===t.expanded[e.id]?s("chevron-down-icon"):t._e()],1),s("td",{staticClass:"name datatable-row-header"},[t._v(" "+t._s(e.name)+" ")]),s("description-cell",{staticClass:"description",attrs:{editable:t.isCurrentUserManager,entry:e},on:{"description-changed":function(s){return t.onDescriptionChanged(e,s)}}}),t.isStats(e.id,"all")?s("stats-cell",{attrs:{colors:t.chartColors(e.id,"all"),data:t.chartData(e.id,"all"),"frames-data":t.chartData(e.id,"all","frames"),countMode:t.countMode,displayMode:t.displayMode}}):s("td"),t._l(t.validationColumns,(function(a){return t.isStats(e.id,a)?s("stats-cell",{key:e.id+a,style:t.getValidationStyle(a),attrs:{colors:t.chartColors(e.id,a),data:t.chartData(e.id,a),"frames-data":t.chartData(e.id,a,"frames"),countMode:t.countMode,displayMode:t.displayMode,label:t.chartLabel(e.id,a),"label-color":t.chartLabelColor(e.id,a)}}):s("td",{style:t.getValidationStyle(a)})})),s("td",{staticClass:"actions"})],2),t.expanded[e.id]?t._l(t.takeRange(e.id),(function(a){return s("tr",{key:a+"-"+e.id,staticClass:"datatable-row"},[s("td",{staticClass:"expander"}),s("td",{staticClass:"name datatable-row-header"},[t._v(" - Take "+t._s(a)+" ")]),s("td",{staticClass:"description"}),s("td"),t._l(t.validationColumns,(function(i){return[t.chartRetakeMaxCount(e.id,i)+1>a?s("stats-cell",{key:a+e.id+i,style:t.getValidationStyle(i),attrs:{colors:t.chartColors(e.id,i),data:t.chartTakeData(e.id,i,a),"frames-data":t.chartTakeData(e.id,i,a,"frames"),countMode:t.countMode,displayMode:t.displayMode}}):t.isStats(e.id,i)&&t.chartRetakeMaxCount(e.id,i)+1===a?s("stats-cell",{key:a+e.id+i,style:t.getValidationStyle(i),attrs:{colors:t.chartColors(e.id,i),data:t.chartData(e.id,i),"frames-data":t.chartData(e.id,i,"frames"),countMode:t.countMode,displayMode:t.displayMode}}):s("td",{key:a+e.id+i,style:t.getValidationStyle(i)})]})),s("td",{staticClass:"actions"})],2)})):t._e()]}))],2)])]),s("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}}),t.isLoading||!t.isEmptyList||t.isCurrentUserClient?t._e():s("div",{staticClass:"has-text-centered"},[t._m(0),s("p",{staticClass:"info"},[t._v(t._s(t.$t("episodes.empty_list")))])]),!t.isLoading&&t.isEmptyList&&t.isCurrentUserClient?s("div",{staticClass:"has-text-centered"},[t._m(1),s("p",{staticClass:"info"},[t._v(t._s(t.$t("episodes.empty_list_client")))])]):t._e(),t.isEmptyList?t._e():s("p",{staticClass:"has-text-centered nb-episodes"},[t._v(" "+t._s(t.displayedEpisodesLength)+" "+t._s(t.$tc("episodes.number",t.displayedEpisodesLength))+" ")])],1)},f=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{staticClass:"info"},[a("img",{attrs:{src:s("732b")}})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{staticClass:"info"},[a("img",{attrs:{src:s("732b")}})])}],h=s("ba4c"),y=s.n(h),b=s("0a35"),m=s("5097"),v=s("3657"),g=s("09d3"),S=s("0fcb"),C=s("b131"),k=s("e60b");function M(t){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(t)}function _(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function x(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?_(Object(s),!0).forEach((function(e){w(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):_(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function w(t,e,s){return e=E(e),e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function E(t){var e=O(t,"string");return"symbol"===M(e)?e:String(e)}function O(t,e){if("object"!==M(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var a=s.call(t,e||"default");if("object"!==M(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var P={name:"episode-list",mixins:[m["a"]],components:{DescriptionCell:S["a"],ChevronDownIcon:b["k"],ChevronRightIcon:b["m"],StatsCell:C["a"],TableInfo:k["a"]},props:{countMode:{type:String,default:"count"},dataMode:{type:String,default:"retakes"},displayMode:{type:String,default:"pie"},entries:{type:Array,default:function(){return[]}},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},showAll:{type:Boolean,default:!1},validationColumns:{type:Array,default:function(){return[]}}},data:function(){return{busy:!1,expanded:{},lastSelection:null,takeLabelColors:["#FB8C00","#EF6C00","#d35400","#e74c3c","#c0392b"]}},mounted:function(){var t=this;this.entries.forEach((function(e){y.a.set(t.expanded,e.id,!1)}))},computed:x(x({},Object(n["c"])(["currentProduction","displayedEpisodesLength","episodeSearchText","episodeStats","episodeRetakeStats","isCurrentUserClient","isCurrentUserManager","isSingleEpisode","taskTypeMap"])),{},{isEmptyList:function(){return this.entries&&0===this.entries.length&&!this.isLoading&&!this.isError&&(!this.episodeSearchText||0===this.episodeSearchText.length)},isRetakes:function(){return"retakes"===this.dataMode}}),methods:x(x({},Object(n["b"])(["displayMoreEpisodes"])),{},{chartColors:function(t,e){return this.isRetakes?["#ff3860","#6f727a","#22d160"]:Object(g["b"])(this.episodeStats,t,e)},chartData:function(t,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"count";return this.isRetakes?Object(g["f"])(this.episodeRetakeStats,t,e,s):Object(g["c"])(this.episodeStats,t,e,s)},chartTakeData:function(t,e,s){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"count",i=this.episodeRetakeStats[t][e].evolution,o=i[s].retake[a],r=i[s].done[a],n=i[s].other[a];return[["retake",o,"#ff3860"],["other",n,"#6f727a"],["done",r,"#22d160"]]},chartLabel:function(t,e){if(this.isRetakes){var s=Object(g["d"])(this.episodeRetakeStats,t,e);return s>=1?"Take ".concat(s+1):""}return""},chartLabelColor:function(t,e){if(this.isRetakes){var s=Object(g["d"])(this.episodeRetakeStats,t,e);return s=Math.min(s,4),this.takeLabelColors[s]}return""},chartRetakeMaxCount:function(t,e){return Object(g["d"])(this.episodeRetakeStats,t,e)},takeRange:function(t){return Object(v["v"])(1,this.chartRetakeMaxCount(t,"all")+1)},isStats:function(t,e){return this.episodeStats[t]&&this.episodeStats[t][e]},onBodyScroll:function(t,e){this.$emit("scroll",e.scrollTop)},setScrollPosition:function(t){this.$refs.body.scrollTop=t},taskTypePath:function(t){var e={name:"task-type",params:{production_id:this.currentProduction.id,task_type_id:t,type:"count"}};return this.isTVShow&&(e.name="episode-task-type",e.params.episode_id=this.currentEpisode.id),e},getPath:function(t,e){var s={name:t,params:{production_id:this.currentProduction.id,episode_id:e}};return s},toggleExpanded:function(t){this.expanded[t]=!this.expanded[t]}}),watch:{entries:function(){var t=this;this.entries.forEach((function(e){var s=t.expanded[e.id]||!1;y.a.set(t.expanded,e.id,s)}))},isRetakes:function(){var t=this;this.isRetakes||this.entries.forEach((function(e){y.a.set(t.expanded,e.id,!1)}))}}},L=P,D=(s("9174"),s("2877")),j=Object(D["a"])(L,p,f,!1,null,"92f092f4",null),T=j.exports,R=s("4d04");function $(t){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$(t)}function V(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function A(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?V(Object(s),!0).forEach((function(e){B(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):V(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function B(t,e,s){return e=U(e),e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function U(t){var e=I(t,"string");return"symbol"===$(e)?e:String(e)}function I(t,e){if("object"!==$(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var a=s.call(t,e||"default");if("object"!==$(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var N={name:"episodes",components:{ButtonSimple:c["a"],Combobox:u["a"],EpisodeStatsList:T,SearchField:R["a"]},data:function(){return{countMode:"count",dataMode:"retakes",displayMode:"pie",episodeToDelete:null,episodeToEdit:null,isLoading:!0,isLoadingError:!1,countModeOptions:[{label:"shots",value:"count"},{label:"frames",value:"frames"}],dataModeOptions:[{label:"retakes",value:"retakes"},{label:"status",value:"status"}],displayModeOptions:[{label:"pie",value:"pie"},{label:"count",value:"count"}],errors:{edit:!1,del:!1},modals:{isNewDisplayed:!1,isDeleteDisplayed:!1},loading:{edit:!1,del:!1}}},mounted:function(){var t=this;this.setDefaultSearchText(),this.setDefaultListScrollPosition(),this.isLoading=!0,this.isLoadingError=!1,this.initEpisodes().then((function(){t.isLoading=!1})).catch((function(e){t.isLoading=!1,t.isLoadingError=!0,console.error(e)}))},computed:A(A({},Object(n["c"])(["currentProduction","displayedEpisodes","episodesPath","isCurrentUserManager","episodes","episodeMap","episodePath","episodeStats","episodeRetakeStats","episodeSearchText","episodeListScrollPosition","episodeValidationColumns","taskStatusMap","taskTypeMap"])),{},{isRetakeDataMode:function(){return"retakes"===this.dataMode}}),methods:A(A({},Object(n["b"])(["computeEpisodeStats","deleteEpisode","editEpisode","hideAssignations","initEpisodes","loadEpisodeStats","loadEpisodeRetakeStats","loadShots","setLastProductionScreen","setEpisodeSearch","setEpisodeListScrollPosition","showAssignations"])),{},{setDefaultSearchText:function(){this.episodeSearchText.length>0&&this.$refs["episode-search-field"].setValue(this.episodeSearchText)},setDefaultListScrollPosition:function(){this.$refs["episode-list"].setScrollPosition(this.episodeListScrollPosition)},navigateToList:function(){this.$router.push(this.episodesPath)},onSearchChange:function(t){var e=this.$refs["episode-search-field"].getValue();this.setEpisodeSearch(e)},saveScrollPosition:function(t){this.setEpisodeListScrollPosition(t)},exportStatisticsToCsv:function(){var t=[r()().format("YYYYMMDD"),this.currentProduction.name,"episodes","statistics"];this.isRetakeDataMode&&t.splice(3,0,"retake");var e=d["a"].slugify(t.join("_"));this.isRetakeDataMode?l["a"].generateRetakeStatReports(e,this.episodeRetakeStats,this.taskTypeMap,this.taskStatusMap,this.episodeMap,this.countMode):l["a"].generateStatReports(e,this.episodeStats,this.taskTypeMap,this.taskStatusMap,this.episodeMap,this.countMode)},onFieldChanged:function(t){var e=t.entry,s=t.fieldName,a=t.value,i={id:e.id};i[s]=a,this.editEpisode(i)},reset:function(){var t=this;this.isLoading=!0,this.isLoadingError=!1,this.loadEpisodeStats(this.currentProduction.id).then((function(){return t.loadEpisodeRetakeStats(t.currentProduction.id)})).then((function(){t.isLoading=!1})).catch((function(e){t.isLoading=!1,t.isLoadingError=!0,console.error(e)}))}}),watch:{displayedEpisodes:function(){},currentProduction:function(){this.$refs["episode-search-field"].setValue(""),this.$store.commit("SET_SEQUENCE_LIST_SCROLL_POSITION",0),this.reset()}},metaInfo:function(){return{title:"".concat(this.currentProduction.name," ").concat(this.$t("episodes.title")," - Kitsu")}}},F=N,Y=Object(D["a"])(F,a,i,!1,null,"7b6d097d",null);e["default"]=Y.exports},"5c26":function(t,e,s){},9174:function(t,e,s){"use strict";s("5c26")},b131:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("td",{staticClass:"validation"},["pie"===t.displayMode?s("div",{staticClass:"flexrow"},[s("pie-chart",{staticClass:"flexrow-item",attrs:{width:"70px",height:"50px",legend:!1,colors:t.colors,data:t.selectedData}}),t.label?s("span",{staticClass:"tag flexrow-item",style:{"background-color":t.labelColor}},[t._v(" "+t._s(t.label)+" ")]):t._e()],1):s("div",[t._l(t.selectedData,(function(e){return e[0]?s("div",{key:e[0]},[s("span",{staticClass:"stats-name",style:{color:e[2]}},[t._v(" "+t._s(e[0])+" ")]),s("span",[t._v(" : ")]),s("span",{staticClass:"stats-value"},[t._v(" "+t._s(e[1])+" ("+t._s(t.percent(e[1]))+"%) ")])]):t._e()})),t.label?s("span",{staticClass:"tag flexrow-item",style:{"background-color":t.labelColor}},[t._v(" "+t._s(t.label)+" ")]):t._e()],2)])},i=[],o={name:"stats-cell",components:{},props:{colors:{type:Array,required:!0},countMode:{type:String,default:"count"},data:{type:Array,default:function(){return[]}},displayMode:{type:String,default:"pie"},framesData:{type:Array,default:function(){return[]}},label:{type:String,default:""},labelColor:{type:String,default:"#e67e22"}},computed:{selectedData:function(){return"frames"===this.countMode?this.framesData:this.data},total:function(){return this.selectedData.reduce((function(t,e){return e[1]?t+e[1]:t}),0)}},methods:{percent:function(t){var e=0;return this.total>0&&(e=t/this.total*100),e.toFixed(2)}}},r=o,n=(s("ee3a"),s("2877")),l=Object(n["a"])(r,a,i,!1,null,"72ceabce",null);e["a"]=l.exports},ee3a:function(t,e,s){"use strict";s("3b05")}}]);
//# sourceMappingURL=chunk-3f6b4538.c4a3a3ca.js.map