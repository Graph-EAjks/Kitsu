(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-56e286d8"],{"06f5":function(t,e,o){"use strict";o("361f")},"0862":function(t,e,o){},"361f":function(t,e,o){},"36b8":function(t,e,o){"use strict";o("6183")},"37b6":function(t,e,o){},6183:function(t,e,o){},"61e4":function(t,e,o){"use strict";o("0862")},8532:function(t,e,o){"use strict";o("37b6")},cd92:function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"columns fixed-page"},[o("div",{staticClass:"column main-column"},[o("div",{staticClass:"flexrow filters"},[o("div",{staticClass:"flexrow-item"},[o("combobox-task-type",{staticClass:"flexrow-item",attrs:{label:t.$t("quota.type_label"),"task-type-list":t.productionShotTaskTypes},model:{value:t.taskTypeId,callback:function(e){t.taskTypeId=e},expression:"taskTypeId"}})],1),o("div",{staticClass:"flexrow-item"},[o("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("quota.detail_label"),options:t.detailLevelOptions},model:{value:t.detailLevelString,callback:function(e){t.detailLevelString=e},expression:"detailLevelString"}})],1),"day"===t.detailLevelString?o("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("quota.month_label"),options:t.monthOptions},model:{value:t.monthString,callback:function(e){t.monthString=e},expression:"monthString"}}):t._e(),o("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("quota.year_label"),options:t.yearOptions},model:{value:t.yearString,callback:function(e){t.yearString=e},expression:"yearString"}}),o("div",{staticClass:"flexrow-item"},[o("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("quota.count_label"),options:t.countModeOptions},model:{value:t.countMode,callback:function(e){t.countMode=e},expression:"countMode"}})],1),o("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("quota.compute_mode"),options:t.computeModeOptions},model:{value:t.computeMode,callback:function(e){t.computeMode=e},expression:"computeMode"}}),o("div",{staticClass:"flexrow-item"},[o("info-question-mark",{staticClass:"mt2",attrs:{text:"weighted"===t.computeMode?t.$t("quota.explaination"):t.$t("quota.explaination_feedback")}})],1),o("div",{staticClass:"filler"}),o("button-simple",{staticClass:"flexrow-item",attrs:{title:t.$t("quota.export_quotas"),icon:"download"},on:{click:t.exportQuotas}})],1),o("div",{staticClass:"flexrow mb2 mt0"},[o("search-field",{ref:"search-field",staticClass:"search-field flexrow-item",on:{change:t.onSearchChange}}),o("span",{staticClass:"label flexrow-item"},[t._v(" "+t._s(t.$t("quota.highlight_quotas"))+" ")]),o("text-field",{staticClass:"flexrow-item max-quota-input",attrs:{type:"number"},model:{value:t.maxQuota,callback:function(e){t.maxQuota=e},expression:"maxQuota"}})],1),o("quota",{ref:"quota-list",attrs:{taskTypeId:t.taskTypeId,detailLevel:t.detailLevelString,year:t.currentYear,month:t.currentMonth,week:t.currentWeek,day:t.currentDay,currentPerson:t.currentPerson,countMode:t.currentMode,computeMode:t.computeMode,searchText:t.searchText,maxQuota:t.maxQuota}})],1),t.showInfo?o("div",{staticClass:"column side-column"},[o("people-quota-info",{attrs:{person:t.currentPerson,year:t.currentYear,month:t.currentMonth,week:t.currentWeek,day:t.currentDay,"is-loading":t.isPersonShotsLoading,"is-loading-error":!1,shots:t.personShots,"count-mode":t.countMode},on:{close:t.hideSideInfo}})],1):t._e()])},r=[],n=o("7f45"),i=o.n(n),s=o("2f62"),u=o("3455"),c=o("8c97"),l=o("3657"),d=o("9d8b"),h=o("de40"),p=o("992f"),f=o("e4fd"),y=o("c009"),m=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"people-timesheet-info"},[o("div",{staticClass:"close"},[o("router-link",{staticClass:"close-button",attrs:{to:t.closeRoute}},[o("x-icon")],1)],1),o("div",{staticClass:"flexrow"},[o("people-avatar",{staticClass:"flexrow-item",attrs:{person:t.person,"no-cache":!0}}),o("page-title",{staticClass:"flexrow-item",attrs:{text:t.person.full_name}})],1),t.isMonthInfo?o("div",{staticClass:"info-date"},[t._v(" "+t._s(t.monthString)+" "+t._s(t.year)+" ")]):t.isWeekInfo?o("div",{staticClass:"info-date"},[t._v(" week "+t._s(t.week)+", "+t._s(t.startDay)+" - "+t._s(t.endDay)+" "+t._s(t.weekMonth)+" "+t._s(t.year)+" ")]):t.isDayInfo?o("div",{staticClass:"info-date"},[t._v(" "+t._s(t.day)+" "+t._s(t.monthString)+" "+t._s(t.year)+" ")]):t._e(),o("quota-shot-list",{staticClass:"time-spent-list",attrs:{"count-mode":t.countMode,shots:t.shots,"is-loading":t.isLoading,"is-error":t.isLoadingError}})],1)},b=[],v=o("0a35"),g=o("8d07"),w=o("eb8c"),M=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"data-list"},[t.isLoading?t._e():o("table",{staticClass:"details table"},[o("thead",[o("tr",[o("th",[t._v(t._s(t.$t("quota.details_name")))]),o("th",[t._v(" "+t._s("seconds"===this.countMode?t.$t("quota.details_seconds"):t.$t("quota.details_frames"))+" ")]),o("th",[t._v(t._s(t.$t("quota.weight")))])])]),o("tbody",t._l(t.shots,(function(e){return o("tr",{key:"shot-quota-"+e.id},[o("td",[t._v(t._s(e.full_name))]),o("td",[t._v(t._s(t.getQuota(e)))]),o("td",[t._v(t._s(e.weight))])])})),0)]),o("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isLoadingError}})],1)},k=[],S=o("bcd2"),_=o("e60b");function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function q(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,a)}return o}function j(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?q(Object(o),!0).forEach((function(e){L(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):q(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function L(t,e,o){return e=x(e),e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function x(t){var e=P(t,"string");return"symbol"===O(e)?e:String(e)}function P(t,e){if("object"!==O(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,e||"default");if("object"!==O(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var C={name:"quota-shot-list",components:{TableInfo:_["a"]},data:function(){return{projectNames:{}}},props:{shots:{type:Array,default:function(){return[]}},isLoading:{type:Boolean,default:!1},isLoadingError:{type:Boolean,default:!1},countMode:{type:String,default:"frames"}},computed:j({},Object(s["c"])(["currentProduction","lastProductionScreen","taskTypeMap"])),methods:j(j({},Object(s["b"])([])),{},{getQuota:function(t){return"seconds"===this.countMode?Object(S["e"])(t.nb_frames,this.currentProduction,t):t.nb_frames}}),watch:{}},$=C,I=(o("61e4"),o("2877")),T=Object(I["a"])($,M,k,!1,null,"08efedbe",null),D=T.exports;function Q(t){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Q(t)}function E(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,a)}return o}function N(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?E(Object(o),!0).forEach((function(e){R(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):E(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function R(t,e,o){return e=Y(e),e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function Y(t){var e=W(t,"string");return"symbol"===Q(e)?e:String(e)}function W(t,e){if("object"!==Q(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,e||"default");if("object"!==Q(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var A={name:"shot-quota-info",components:{XIcon:v["ub"],PageTitle:g["a"],PeopleAvatar:w["a"],QuotaShotList:D},props:{person:{type:Object,default:function(){}},year:{type:Number,default:0},month:{type:Number,default:0},week:{type:Number,default:0},day:{type:Number,default:0},countMode:{type:String,default:"frames"},isLoading:{type:Boolean,default:!1},isLoadingError:{type:Boolean,default:!1},shots:{type:Array,default:function(){return[]}}},computed:N(N({},Object(s["c"])(["currentEpisode","currentProduction"])),{},{startDay:function(){return i()().day("Monday").year(this.year).week(this.week).date()},endDay:function(){return i()().day("Monday").year(this.year).week(this.week).add("days",6).date()},weekMonth:function(){return i()().day("Monday").year(this.year).week(this.week).format("MMM")},monthString:function(){return Object(l["s"])(this.month)},isMonthInfo:function(){return this.$route.path.indexOf("month")>0},isWeekInfo:function(){return this.$route.path.indexOf("week")>0},isDayInfo:function(){return this.$route.path.indexOf("day")>0},closeRoute:function(){if(!this.currentProduction)return{};var t={name:"quota",production_id:this.currentProduction.id};return this.isMonthInfo?t={name:"quota-month",params:{year:this.year}}:this.isWeekInfo?t={name:"quota-week",params:{year:this.year}}:this.isDayInfo&&(t={name:"quota-day",params:{year:this.year,month:this.month}}),this.currentEpisode&&(t.name="episode-".concat(t.name),t.params.episode_id=this.currentEpisode.id),t}}),methods:N(N({},Object(s["b"])([])),{},{onCloseClicked:function(){this.$emit("close")}})},X=A,B=(o("8532"),Object(I["a"])(X,m,b,!1,null,"7a7e03a6",null)),F=B.exports,z=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"data-list"},[o("div",{ref:"body",staticClass:"datatable-wrapper"},[o("table",{staticClass:"datatable"},[o("thead",{staticClass:"datatable-head"},[o("tr",[o("th",{ref:"rowHeaderName",staticClass:"name datatable-row-header",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("quota.name"))+" ")]),o("th",{staticClass:"average datatable-row-header",style:{left:t.averageColumnX},attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("quota.average"))+" ")]),t._l(t.monthRange,(function(e){return"month"===t.detailLevel?o("th",{key:"month-"+e,attrs:{scope:"col"}},[t._v(" "+t._s(t.monthToString(e))+" ")]):t._e()})),t._l(t.weekRange,(function(e){return"week"===t.detailLevel?o("th",{key:"week-"+e,attrs:{scope:"col"}},[t._v(" "+t._s(e)+" ")]):t._e()})),t._l(t.dayRange,(function(e){return"day"===t.detailLevel?o("th",{key:"day-"+e,attrs:{scope:"col"}},[t._v(" "+t._s(e)+" ")]):t._e()}))],2)]),this.quotaLength>0&&!t.isLoading?o("tbody",{staticClass:"datatable-body"},t._l(t.filteredPersonIds,(function(e){return o("tr",{key:"name-"+e,staticClass:"datatable-row"},[o("th",{staticClass:"name datatable-row-header",attrs:{scope:"row"}},[o("div",{staticClass:"flexrow"},[o("people-avatar",{attrs:{size:30,person:t.personMap.get(e)}}),t._v(" "+t._s(t.personMap.get(e).full_name)+" ")],1)]),"month"===t.detailLevel?o("td",{staticClass:"average datatable-row-header",style:{left:t.averageColumnX}},[t._v(" "+t._s(t.getQuotaAverage(e,{year:t.year}))+" ")]):t._e(),"week"===t.detailLevel?o("td",{staticClass:"average datatable-row-header",style:{left:t.averageColumnX}},[t._v(" "+t._s(t.getQuotaAverage(e,{year:t.year}))+" ")]):t._e(),"day"===t.detailLevel?o("td",{staticClass:"average datatable-row-header",style:{left:t.averageColumnX}},[t._v(" "+t._s(t.getQuotaAverage(e,{year:t.year,month:t.month}))+" ")]):t._e(),t._l(t.monthRange,(function(a){return"month"===t.detailLevel?o("td",{key:"month-"+a,class:{selected:t.isMonthSelected(e,t.year,a),"quota-low":t.isMonthQuotaLow(e,t.year,a)}},[t.getQuota(e,{year:t.year,month:a})?o("router-link",{staticClass:"quota-button",attrs:{to:t.episodifyRoute({name:"quota-month-person",params:{person_id:e,year:t.year,month:a}})}},[t._v(" "+t._s("seconds"===t.countMode?t.getQuota(e,{year:t.year,month:a}).toFixed(2):t.getQuota(e,{year:t.year,month:a}))+" ")]):o("span",[t._v("-")])],1):t._e()})),t._l(t.weekRange,(function(a){return"week"===t.detailLevel?o("td",{key:"week-"+a,class:{selected:t.isWeekSelected(e,t.year,a),"quota-low":t.isWeekQuotaLow(e,t.year,t.month)}},[t.getQuota(e,{year:t.year,week:a})?o("router-link",{staticClass:"quota-button",attrs:{to:t.episodifyRoute({name:"quota-week-person",params:{person_id:e,year:t.year,week:a}})}},[t._v(" "+t._s("seconds"===t.countMode?t.getQuota(e,{year:t.year,week:a}).toFixed(2):t.getQuota(e,{year:t.year,week:a}))+" ")]):o("span",[t._v(" - ")])],1):t._e()})),t._l(t.dayRange,(function(a){return"day"===t.detailLevel?o("td",{key:"day-"+a,class:{weekend:t.isWeekend(t.year,t.month,a),selected:t.isDaySelected(e,t.year,t.month,a),"quota-low":t.isDayQuotaLow(e,t.year,t.month,a)}},[t.getQuota(e,{year:t.year,month:t.month,day:a})?o("router-link",{staticClass:"quota-button",attrs:{to:t.episodifyRoute({name:"quota-day-person",params:{person_id:e,year:t.year,month:t.month,day:a}})}},[t._v(" "+t._s("seconds"===t.countMode?t.getQuota(e,{year:t.year,month:t.month,day:a}).toFixed(2):t.getQuota(e,{year:t.year,month:t.month,day:a}))+" ")]):o("span",[t._v(" - ")])],1):t._e()}))],2)})),0):t._e()])]),0!==this.quotaLength||t.isLoading?t._e():o("div",{staticClass:"has-text-centered empty-quota"},[o("p",{staticClass:"info"},[t._v(t._s(t.$t("quota.no_quota")))])]),o("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}})],1)},H=[],J=o("2017");function G(t){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G(t)}function K(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,a)}return o}function U(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?K(Object(o),!0).forEach((function(e){V(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):K(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function V(t,e,o){return e=Z(e),e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function Z(t){var e=tt(t,"string");return"symbol"===G(e)?e:String(e)}function tt(t,e){if("object"!==G(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,e||"default");if("object"!==G(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var et={name:"quota",components:{PeopleAvatar:w["a"],TableInfo:_["a"]},props:{taskTypeId:{type:String,required:!0},detailLevel:{type:String,default:"day",required:!0},countMode:{type:String,default:"frames",required:!0},computeMode:{type:String,default:"weighted",required:!0},year:{type:Number,default:0},month:{type:Number,default:0},week:{type:Number,default:0},day:{type:Number,default:0},searchText:{type:String,default:""},maxQuota:{default:0}},data:function(){return{currentMonth:i()().month()+1,currentYear:i()().year(),currentWeek:i()().week(),detailsTitle:"",detailsMap:{},isPanelShown:!1,isLoading:!0,isError:!1,personIds:[],quotaMap:{},quotaLength:0,selected:void 0,averageColumnX:"12rem"}},mounted:function(){var t=this;this.shotMap.size<2?(this.isLoading=!0,setTimeout((function(){t.loadShots((function(e){e||t.loadData()}))}),100)):(this.isShotsLoading||(this.isLoading=!1),this.loadData())},computed:U(U({},Object(s["c"])(["currentEpisode","isShotsLoading","shotMap","personMap"])),{},{monthRange:function(){return Object(l["n"])(this.year,this.currentYear,this.currentMonth)},dayRange:function(){return Object(l["j"])(this.year,this.month,this.currentYear,this.currentMonth)},weekRange:function(){return Object(l["p"])(this.year,this.currentYear,this.currentWeek)},filteredPersonIds:function(){var t=this.personIds;return this.searchText.length>0&&(t=Object(J["k"])(this.personIndex,this.searchText.split(" ")).map((function(t){return t.id}))),t}}),methods:U(U({},Object(s["b"])(["loadShots","computeQuota","getPeriodDetails"])),{},{episodifyRoute:function(t){return this.currentEpisode&&Object(d["a"])(t,this.currentEpisode.id),t},isWeekend:function(t,e,o){var a=i()("".concat(t,"-").concat(e,"-").concat(o),"YYYY-MM-DD");return o<10&&(a=i()("".concat(t,"-").concat(e,"-0").concat(o),"YYYY-MM-DD")),[0,6].includes(a.day())},loadData:function(){var t=this;this.taskTypeId&&(this.isLoading=!0,this.computeQuota({taskTypeId:this.taskTypeId,detailLevel:this.detailLevel,countMode:this.countMode,computeMode:this.computeMode}).then((function(e){t.quotaMap=e,t.quotaLength=Object.keys(t.quotaMap).length,t.calcAverageColumnX(),t.$nextTick((function(){t.isLoading=!1}))})))},loadDetails:function(t,e){var o=this;this.loadShots((function(a){o.isLoading=!0,a?console.error(a):o.taskTypeId&&o.getPeriodDetails({taskTypeId:o.taskTypeId,detailLevel:o.detailLevel,personId:t,dateString:e}).then((function(t){o.detailsMap=t}))}))},monthToString:l["s"],dateDigit:function(t){return t.toString().padStart(2,"0")},getQuota:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.day){var o="".concat(e.year,"-").concat(this.dateDigit(e.month),"-").concat(this.dateDigit(e.day));return this.quotaMap[t].day[this.countMode][o]}if(e.week){var a="".concat(e.year,"-").concat(e.week);return this.quotaMap[t].week[this.countMode][a]}var r="".concat(e.year,"-").concat(this.dateDigit(e.month));return this.quotaMap[t].month[this.countMode][r]},getQuotaAverage:function(t){var e,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=0,r=0;if("day"===this.detailLevel){var n="".concat(o.year,"-").concat(this.dateDigit(o.month));r=this.quotaMap[t].month[this.countMode][n],e=this.quotaMap[t].day.entries[n]}else if("week"===this.detailLevel){var i=o.year;r=this.quotaMap[t].year[this.countMode][i],e=this.quotaMap[t].week.entries[i]}else if("month"===this.detailLevel){var s=o.year;r=this.quotaMap[t].year[this.countMode][s],e=this.quotaMap[t].month.entries[s]}return a=r/e,a?a.toFixed(2):"-"},isDaySelected:function(t,e,o,a){return this.$route.params.person_id&&this.$route.params.person_id===t&&""+this.$route.params.year===""+e&&""+this.$route.params.month===""+o&&""+this.$route.params.day===""+a},isWeekSelected:function(t,e,o){return this.$route.params.person_id&&this.$route.params.person_id===t&&""+this.$route.params.year===""+e&&""+this.$route.params.week===""+o},isMonthSelected:function(t,e,o){return this.$route.params.person_id&&this.$route.params.person_id===t&&""+this.$route.params.year===""+e&&""+this.$route.params.month===""+o},isDayQuotaLow:function(t,e,o,a){var r=this.getQuota(t,{year:e,month:o,day:a});return null!==r&&this.maxQuota>r},isWeekQuotaLow:function(t,e,o){return this.maxQuota>this.getQuota(t,{year:e,week:o})},isMonthQuotaLow:function(t,e,o){return this.maxQuota>this.getQuota(t,{year:e,month:o})},calcAverageColumnX:function(){this.quotaLength>0&&(this.averageColumnX="".concat(this.$refs.rowHeaderName.offsetWidth,"px"))},resetPersonIds:function(){var t=this,e=Object.keys(this.quotaMap),o=e.map((function(e){return t.personMap.get(e)}));this.personIndex=Object(J["d"])(o),this.personIds=e.sort((function(e,o){var a=t.personMap.get(e).full_name,r=t.personMap.get(o).full_name;return a.localeCompare(r)}))}}),watch:{$route:function(){var t=this,e=document.getElementsByClassName("selected");0===e.length&&setTimeout((function(){t.$refs.body.scrollLeft+=380}),100)},computeMode:function(){this.taskTypeId&&this.loadData()},quotaMap:function(){this.resetPersonIds()},taskTypeId:function(){this.taskTypeId&&this.loadData()}}},ot=et,at=(o("36b8"),Object(I["a"])(ot,z,H,!1,null,"0b0efb76",null)),rt=at.exports,nt=o("4d04"),it=o("7bf8");function st(t){return st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},st(t)}function ut(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,a)}return o}function ct(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ut(Object(o),!0).forEach((function(e){lt(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ut(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function lt(t,e,o){return e=dt(e),e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function dt(t){var e=ht(t,"string");return"symbol"===st(e)?e:String(e)}function ht(t,e){if("object"!==st(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,e||"default");if("object"!==st(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var pt={name:"production-quota",components:{ButtonSimple:h["a"],Combobox:p["a"],ComboboxTaskType:f["a"],InfoQuestionMark:y["a"],PeopleQuotaInfo:F,Quota:rt,SearchField:nt["a"],TextField:it["a"]},data:function(){return{taskTypeId:"",countMode:"frames",countModeOptions:[{label:this.$t("quota.frames"),value:"frames"},{label:this.$t("quota.seconds"),value:"seconds"},{label:this.$t("quota.count"),value:"count"}],detailLevelOptions:[{label:this.$t("quota.day"),value:"day"},{label:this.$t("quota.week"),value:"week"},{label:this.$t("quota.month"),value:"month"}],computeModeOptions:[{label:this.$t("quota.weighted"),value:"weighted"},{label:this.$t("quota.feedback_date"),value:"feedback"}],computeMode:"weighted",currentYear:i()().year(),currentMonth:i()().month()+1,currentWeek:i()().week(),currentDay:i()().date(),currentPerson:this.getCurrentPerson(),currentMode:"frames",detailLevelString:"day",detailLevel:"day",isLoading:!1,isLoadingError:!1,isPersonShotsLoading:!1,maxQuota:0,monthString:"".concat(i()().month()+1),personShots:[],searchText:"",showInfo:!1,yearString:"".concat(i()().year())}},mounted:function(){this.loadRoute()},computed:ct(ct({},Object(s["c"])(["currentEpisode","currentProduction","productionShotTaskTypes","shotTaskTypes","personMap"])),{},{yearOptions:function(){var t=2018,e=i()().year();return Object(l["v"])(t,e).map((function(t){return{label:t,value:"".concat(t)}}))},monthOptions:function(){var t="".concat(i()().year()),e=1,o=i()().month()+1,a=Object(l["v"])(e,12);return t===this.yearString&&(a=Object(l["v"])(e,o)),a.map((function(t){return{label:Object(l["s"])(t),value:"".concat(t)}}))}}),methods:ct(ct({},Object(s["b"])(["getPersonQuotaShots","loadShots"])),{},{getCurrentPerson:function(){var t=this.$route.params.person_id;return t&&this.personMap?this.personMap.get(t):{}},loadRoute:function(){var t=this,e=this.$route.params,o=e.month,a=e.year,r=e.week,n=e.day,i=this.$route.query,s=i.countMode,u=i.taskTypeId,c=i.computeMode;if(this.$route.path.indexOf("week")>0&&(this.detailLevel="week"),this.$route.path.indexOf("month")>0&&(this.detailLevel="month"),this.$route.path.indexOf("day")>0&&(this.detailLevel="day"),this.currentPerson=this.getCurrentPerson(),this.detailLevelString=this.detailLevel,s&&(this.countMode=s,this.currentMode=this.countMode),u)this.taskTypeId=u;else{var l="quota:".concat(this.currentProduction.id,":task-type-id");this.taskTypeId=localStorage.getItem(l)||this.shotTaskTypes[0].id}c&&(this.computeMode=c),o&&(this.currentMonth=Number(o),this.monthString="".concat(o)),a&&(this.currentYear=Number(a),this.yearString="".concat(a)),r&&(this.currentWeek=Number(r),this.weekString="".concat(r)),n&&(this.currentDay=Number(n)),this.$route.path.indexOf("person")>0?(this.isPersonShotsLoading=!0,this.getPersonQuotaShots({personId:this.currentPerson.id,detailLevel:this.detailLevel,taskTypeId:this.taskTypeId,year:a,month:o,week:r,day:n,computeMode:this.computeMode}).then((function(e){t.isPersonShotsLoading=!1,t.personShots=e,t.showSideInfo()}))):this.hideSideInfo()},showSideInfo:function(){this.showInfo=!0},hideSideInfo:function(){this.showInfo=!1},episodifyRoute:function(t){return this.currentEpisode&&Object(d["a"])(t,this.currentEpisode.id),t},exportQuotas:function(){var t=this,e=this.$refs["quota-list"].quotaMap,o=["quotas",this.detailLevel,this.currentYear];"day"===this.detailLevel&&o.push(this.currentMonth);var a=c["a"].slugify(o.join("_")),r=Object.keys(e).map((function(e){return t.personMap.get(e)})).sort((function(t,e){return t.full_name.localeCompare(e.full_name)}));u["a"].generateQuotas(a,e,r,this.countMode,this.detailLevel,i()().year(),i()().month()+1,this.currentYear,this.currentMonth,this.currentWeek)},onSearchChange:function(t){this.searchText=t}}),watch:{detailLevelString:function(){if(this.detailLevel!==this.detailLevelString){var t={name:"quota-".concat(this.detailLevelString),params:{year:this.currentYear},query:{countMode:this.countMode,computeMode:this.computeMode}};"day"===this.detailLevelString&&(t.params.month=this.currentMonth),this.$router.push(this.episodifyRoute(t))}},yearString:function(){var t=Number(this.yearString),e=i()().month()+1;if(this.currentYear!==t){var o={name:"quota-".concat(this.detailLevelString),params:{year:t},query:{countMode:this.countMode,computeMode:this.computeMode}};"day"===this.detailLevelString&&(o.params.month="".concat(Math.min(Number(this.monthString),e))),this.$router.push(this.episodifyRoute(o))}},monthString:function(){if(this.currentMonth!==Number(this.monthString)){var t={name:"quota-day",params:{year:this.currentYear,month:Number(this.monthString)},query:{countMode:this.countMode,computeMode:this.computeMode}};this.$router.push(this.episodifyRoute(t))}},countMode:function(){this.currentMode!==this.countMode&&(this.$route.query.countMode!==this.countMode&&this.$router.push({query:{countMode:this.countMode,computeMode:this.computeMode}}),this.currentMode=this.countMode)},computeMode:function(){this.$route.query.computeMode!==this.computeMode&&this.$router.push({query:{computeMode:this.computeMode}})},taskTypeId:function(){var t="quota:".concat(this.currentProduction.id,":task-type-id");localStorage.setItem(t,this.taskTypeId),this.$route.query.taskTypeId!==this.taskTypeId&&this.$router.push({query:{taskTypeId:this.taskTypeId}})},currentProduction:function(){var t=this;this.isLoading=!0,this.loadShots((function(){t.loadRoute(),t.isLoading=!1}))},currentEpisode:function(){var t=this;this.isLoading=!0,this.loadShots((function(){t.loadRoute(),t.isLoading=!1}))},$route:function(){this.loadRoute()}}},ft=pt,yt=(o("06f5"),Object(I["a"])(ft,a,r,!1,null,"7b326450",null));e["default"]=yt.exports}}]);
//# sourceMappingURL=chunk-56e286d8.5db92717.js.map