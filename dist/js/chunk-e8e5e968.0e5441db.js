(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e8e5e968"],{1056:function(e,t,a){},7887:function(e,t,a){"use strict";a("1056")},9633:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"columns fixed-page"},[a("div",{staticClass:"column main-column"},[a("div",{staticClass:"flexrow project-dates"},[a("div",{staticClass:"flexrow-item"},[a("label",{staticClass:"label"},[e._v(" "+e._s(e.$t("main.start_date"))+" ")]),a("datepicker",{attrs:{"wrapper-class":"datepicker","input-class":"date-input input",language:e.locale,"disabled-dates":{days:[6,0]},"monday-first":!0,format:"yyyy-MM-dd"},model:{value:e.selectedStartDate,callback:function(t){e.selectedStartDate=t},expression:"selectedStartDate"}})],1),a("div",{staticClass:"flexrow-item field"},[a("label",{staticClass:"label"},[e._v(" "+e._s(e.$t("main.end_date"))+" ")]),a("datepicker",{attrs:{"wrapper-class":"datepicker","input-class":"date-input input",language:e.locale,"disabled-dates":{days:[6,0]},"monday-first":!0,format:"yyyy-MM-dd"},model:{value:e.selectedEndDate,callback:function(t){e.selectedEndDate=t},expression:"selectedEndDate"}})],1),a("text-field",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"flexrow-item overall-man-days",attrs:{type:"number",label:e.$t("schedule.overall_man_days"),disabled:!e.isCurrentUserAdmin},model:{value:e.overallManDays,callback:function(t){e.overallManDays=t},expression:"overallManDays"}}),a("combobox-number",{staticClass:"flexrow-item zoom-level",attrs:{label:e.$t("schedule.zoom_level"),options:e.zoomOptions},model:{value:e.zoomLevel,callback:function(t){e.zoomLevel=t},expression:"zoomLevel"}})],1),a("schedule",{attrs:{"start-date":e.startDate,"end-date":e.endDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":e.loading.schedule,"is-error":e.errors.schedule,"hide-man-days":!0},on:{"item-changed":e.scheduleItemChanged,"estimation-changed":e.estimationChanged,"change-zoom":e.changeZoom,"root-element-expanded":e.expandTaskTypeElement}})],1),e.currentTask?a("div",{staticClass:"column side-column is-hidden-mobile hide-small-screen"},[a("task-info",{attrs:{task:e.currentTask,"is-loading":!1}})],1):e._e()])},r=[],s=a("2f62"),o=a("7f45"),i=a.n(o),d=a("2430"),c=a("fa33"),l=a("2229"),u=a("9d8b"),h=a("3657"),m=a("1e4c"),f=a("9d94"),p=a("7bf8"),y=a("d7c7");function D(e){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}function b(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?b(Object(a),!0).forEach((function(t){g(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):b(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function g(e,t,a){return t=_(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _(e){var t=S(e,"string");return"symbol"===D(t)?t:String(t)}function S(e,t){if("object"!==D(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!==D(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var O={name:"production-schedule",components:{ComboboxNumber:m["a"],Datepicker:c["a"],Schedule:y["a"],TaskInfo:f["default"],TextField:p["a"]},data:function(){return{currentTask:null,overallManDays:0,endDate:i()().add(6,"months").endOf("day"),scheduleItems:[],startDate:i()().startOf("day"),selectedStartDate:null,selectedEndDate:null,zoomLevel:1,zoomOptions:[{label:"Week",value:0},{label:"1",value:1},{label:"2",value:2},{label:"3",value:3}],loading:{schedule:!1},errors:{schedule:!1}}},mounted:function(){this.reset()},computed:v(v({},Object(s["c"])(["assetTypeMap","currentEpisode","currentProduction","isCurrentUserAdmin","isCurrentUserManager","isCurrentUserSupervisor","isTVShow","organisation","taskTypeMap","user"])),{},{locale:function(){return"fr_FR"===this.user.locale?d["fr"]:d["en"]}}),methods:v(v({},Object(s["b"])(["editProduction","loadAssetTypeScheduleItems","loadEpisodeScheduleItems","loadMilestones","loadScheduleItems","loadSequenceScheduleItems","saveScheduleItem"])),{},{loadData:function(){var e=this;this.loading.schedule=!0,this.loadScheduleItems(this.currentProduction).then((function(t){var a=Object(h["t"])(e.selectedStartDate),n=Object(h["t"])(e.selectedEndDate);t=t.map((function(t){var r,s,o=e.taskTypeMap.get(t.task_type_id);r=t.start_date?Object(h["t"])(t.start_date):i()(),r.isSameOrAfter(n)&&(r=n.clone().add(-1,"days")),r.isBefore(a)&&(r=a.clone()),s=t.end_date?Object(h["t"])(t.end_date):r.clone().add(1,"days"),s.isSameOrAfter(n)&&(s=n.clone());var d=Object(u["j"])(o.id,e.currentProduction.id,e.currentEpisode?e.currentEpisode.id:null,e.$tc(o.for_entity.toLowerCase(),2));return v(v({},t),{},{color:o.color,for_entity:o.for_entity,name:o.name,priority:o.priority,startDate:r,endDate:s,editable:e.isInDepartment(o),expanded:!1,loading:!1,route:"Shot"===o.for_entity&&e.isTVShow?null:d,children:[]})})),e.scheduleItems=Object(l["o"])(t,e.currentProduction,e.taskTypeMap),e.loading.schedule=!1})).then(this.loadMilestones).catch((function(t){console.error(t),e.loading.schedule=!1}))},changeZoom:function(e){e.wheelDelta<0&&this.zoomLevel>1&&this.zoomLevel--,e.wheelDelta>0&&this.zoomLevel<3&&this.zoomLevel++},reset:function(){this.currentProduction.start_date&&(this.startDate=Object(h["t"])(this.currentProduction.start_date)),this.currentProduction.end_date&&(this.endDate=Object(h["t"])(this.currentProduction.end_date)),this.overallManDays=this.currentProduction.man_days,this.selectedStartDate=this.startDate.toDate(),this.selectedEndDate=this.endDate.toDate(),this.loadData()},convertScheduleItems:function(e,t){var a=this;return t.map((function(t){var n,r;n=t.start_date?Object(h["t"])(t.start_date):i()(),e&&n.isBefore(e.startDate)&&(n=e.startDate.clone()),e&&n.isAfter(e.endDate)&&(n=e.endDate.clone().add(-1,"days")),r=t.end_date?Object(h["t"])(t.end_date):n.clone().add(1,"days"),r.isBefore(n)&&(r=n.clone().add(1,"days"));var s=v(v({},t),{},{startDate:n,endDate:r,expanded:!1,loading:!1,editable:a.isInDepartment(a.taskTypeMap.get(t.task_type_id)),children:[],parentElement:e});return a.isTVShow&&(s.route=Object(u["j"])(t.task_type_id,a.currentProduction.id,t.object_id,a.$tc(e.for_entity.toLowerCase(),2))),s}))},expandTaskTypeElement:function(e){var t=this,a={production:this.currentProduction,taskType:this.taskTypeMap.get(e.task_type_id)};if(e.expanded=!e.expanded,e.expanded){e.loading=!0;var n="loadAssetTypeScheduleItems";"Shot"===e.for_entity&&(n=this.isTVShow?"loadEpisodeScheduleItems":"loadSequenceScheduleItems"),this[n](a).then((function(a){e.loading=!1,e.children=t.convertScheduleItems(e,a)})).catch((function(t){console.error(t),e.loading=!1,e.children=[]}))}},estimationChanged:function(e){var t=e.item,a=e.days;t.man_days=Object(h["b"])(this.organisation,a),this.saveScheduleItem(t)},scheduleItemChanged:function(e){if(e.startDate&&e.endDate&&e.parentElement)e.parentElement.startDate=this.getMinDate(e.parentElement),e.parentElement.endDate=this.getMaxDate(e.parentElement),this.saveScheduleItem(e.parentElement);else if(!e.parentElement){var t=this.getMinDate(e),a=this.getMaxDate(e);e.startDate.isAfter(t)&&(e.startDate=t),e.endDate.isBefore(a)&&(e.endDate=a.add(-1,"days"))}this.saveScheduleItem(e)},getMinDate:function(e){var t=this.endDate.clone();return e.children.forEach((function(e){e.startDate&&e.startDate.isBefore(t)&&(t=e.startDate)})),t.clone()},getMaxDate:function(e){var t=this.startDate.clone();return e.children.forEach((function(e){e.endDate&&e.endDate.isAfter(t)&&(t=e.endDate)})),t.clone()},isInDepartment:function(e){return!!this.isCurrentUserManager||!!this.isCurrentUserSupervisor&&(0===this.user.departments.length||e.department_id&&this.user.departments.includes(e.department_id))}}),socket:{},watch:{selectedStartDate:function(){this.startDate=Object(h["t"])(this.selectedStartDate),this.editProduction(v(v({},this.currentProduction),{},{start_date:this.startDate.format("YYYY-MM-DD")}))},selectedEndDate:function(){this.endDate=Object(h["t"])(this.selectedEndDate),this.editProduction(v(v({},this.currentProduction),{},{end_date:this.endDate.format("YYYY-MM-DD")}))},overallManDays:function(){this.overallManDays!==this.currentProduction.man_days&&this.editProduction(v(v({},this.currentProduction),{},{man_days:this.overallManDays}))},currentProduction:function(){this.reset()}},metaInfo:function(){return{title:"".concat(this.currentProduction.name," ")+"| ".concat(this.$t("schedule.title")," - Kitsu")}}},j=O,w=(a("7887"),a("2877")),k=Object(w["a"])(j,n,r,!1,null,"a24ccbf4",null);t["default"]=k.exports}}]);
//# sourceMappingURL=chunk-e8e5e968.0e5441db.js.map