(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fa9a8f64"],{"129d":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"columns fixed-page"},[r("div",{staticClass:"column main-column"},[r("div",{staticClass:"timesheets page"},[r("div",{staticClass:"page-header flexrow"},[r("page-title",{staticClass:"flexrow-item title",attrs:{text:t.$t("timesheets.title")}}),r("combobox-production",{staticClass:"flexrow-item",attrs:{label:t.$t("main.production"),"production-list":t.productionList},model:{value:t.productionIdString,callback:function(e){t.productionIdString=e},expression:"productionIdString"}}),r("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("timesheets.detail_level"),options:t.detailOptions},model:{value:t.detailLevelString,callback:function(e){t.detailLevelString=e},expression:"detailLevelString"}}),"year"!==t.detailLevelString?r("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("timesheets.year"),options:t.yearOptions},model:{value:t.yearString,callback:function(e){t.yearString=e},expression:"yearString"}}):t._e(),"day"===t.detailLevelString?r("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("timesheets.month"),options:t.monthOptions},model:{value:t.monthString,callback:function(e){t.monthString=e},expression:"monthString"}}):t._e(),r("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("timesheets.unit"),options:t.unitOptions},model:{value:t.unit,callback:function(e){t.unit=e},expression:"unit"}}),r("div",{staticClass:"filler"}),r("button-simple",{staticClass:"flexrow-item",attrs:{title:t.$t("timesheets.export_timesheet"),icon:"download"},on:{click:t.exportTimesheet}}),t.isCurrentUserAdmin?r("button-href-link",{staticClass:"flexrow-item",attrs:{title:t.$t("timesheets.export_timespents"),path:"/api/export/csv/time-spents.csv",icon:"list"}}):t._e()],1),r("people-timesheet-list",{staticClass:"data-list",attrs:{people:t.filteredPeople,timesheet:t.timesheet,"detail-level":t.detailLevel,month:t.currentMonth,year:t.currentYear,unit:t.unit,"is-loading":t.isLoading,"is-error":t.isLoadingError}})],1)]),t.showInfo?r("div",{staticClass:"column side-column"},[r("people-timesheet-info",{attrs:{person:t.currentPerson,production:t.productionId,year:t.currentYear,month:t.currentMonth,week:t.currentWeek,day:t.currentDay,unit:t.unit,"is-loading":t.isInfoLoading,"is-loading-error":t.isInfoLoadingError,tasks:t.tasks,"day-off-count":t.dayOffCount},on:{close:t.hideSideInfo}})],1):t._e()])},i=[],o=r("7f45"),a=r.n(o),s=r("2f62"),u=r("3455"),c=r("3657"),l=r("8c97"),d=r("9355"),p=r("de40"),h=r("992f"),f=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"field"},[t.label.length>0?r("label",{staticClass:"label"},[t._v(" "+t._s(t.label)+" ")]):t._e(),r("div",{staticClass:"production-combo"},[r("div",{staticClass:"flexrow",on:{click:t.toggleProductionList}},[r("div",{staticClass:"selected-production-line flexrow-item"},[t.currentProduction?r("production-name",{attrs:{production:t.currentProduction,"no-link":!0,size:25}}):t._e()],1),r("chevron-down-icon",{staticClass:"down-icon flexrow-item"})],1),t.showProductionList?r("div",{ref:"select",staticClass:"select-input"},t._l(t.productionList,(function(e){return r("div",{key:e.id,staticClass:"production-line",on:{click:function(r){return t.selectProduction(e)}}},[r("production-name",{attrs:{size:25,"no-link":!0,production:e}})],1)})),0):t._e()]),r("combobox-mask",{attrs:{displayed:t.showProductionList},on:{click:t.toggleProductionList}})],1)},y=[],m=r("0a35"),b=r("dbde"),g=r("4736");function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function O(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?O(Object(r),!0).forEach((function(e){w(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function w(t,e,r){return e=k(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function k(t){var e=j(t,"string");return"symbol"===v(e)?e:String(e)}function j(t,e){if("object"!==v(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var S={name:"combobox-production",components:{ChevronDownIcon:m["k"],ComboboxMask:b["a"],ProductionName:g["a"]},data:function(){return{showProductionList:!1}},props:{label:{default:"",type:String},productionList:{required:!0,type:Array},value:{default:"",type:String}},mounted:function(){},computed:_(_({},Object(s["c"])(["openProductions","productionMap"])),{},{currentProduction:function(){return this.value?this.productionMap.get(this.value):this.productionList[0]}}),methods:{selectProduction:function(t){this.$emit("input",t.id),this.showProductionList=!1},toggleProductionList:function(){this.showProductionList=!this.showProductionList}}},P=S,C=(r("96de"),r("2877")),L=Object(C["a"])(P,f,y,!1,null,"353a84d0",null),$=L.exports,I=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"data-list"},[r("div",{ref:"body",staticClass:"datatable-wrapper"},[r("table",{staticClass:"datatable"},[r("thead",{staticClass:"datatable-head"},[r("tr",[r("th",{staticClass:"name datatable-row-header",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("people.list.name"))+" ")]),t._l(t.yearRange,(function(e){return"year"===t.detailLevel?r("th",{key:"year-"+e,staticClass:"time year",attrs:{scope:"col"}},[t._v(" "+t._s(e)+" ")]):t._e()})),t._l(t.monthRange,(function(e){return"month"===t.detailLevel?r("th",{key:"month-"+e,staticClass:"time month",attrs:{scope:"col"}},[t._v(" "+t._s(t.monthToString(e))+" ")]):t._e()})),t._l(t.weekRange,(function(e){return"week"===t.detailLevel?r("th",{key:"week-"+e,staticClass:"daytime",attrs:{scope:"col",title:t.getWeekTitle(e)}},[t._v(" "+t._s(e)+" ")]):t._e()})),t._l(t.dayRange,(function(e){return"day"===t.detailLevel?r("th",{key:"day-"+e,staticClass:"daytime",attrs:{scope:"col"}},[t._v(" "+t._s(e)+" ")]):t._e()})),r("th",{staticClass:"actions",attrs:{scope:"col"}})],2)]),t.isLoading?t._e():r("tbody",{staticClass:"datatable-body"},t._l(t.people,(function(e){return r("tr",{key:e.id,staticClass:"datatable-row"},[r("th",{staticClass:"datatable-row-header name"},[r("div",{staticClass:"flexrow"},[r("people-avatar",{staticClass:"flexrow-item",attrs:{person:e}}),r("people-name",{staticClass:"flexrow-item",attrs:{person:e}})],1)]),t._l(t.yearRange,(function(n){return"year"===t.detailLevel?r("td",{key:"year-"+n+"-"+e.id,class:{time:!0,year:!0,selected:t.isYearSelected(e.id,n)}},[t.yearDuration(n,e.id)>0?r("router-link",{staticClass:"duration",attrs:{to:t.getYearDetailRoute(e,n)}},[t._v(" "+t._s(t.yearDuration(n,e.id))+" ")]):r("span",[t._v(" - ")])],1):t._e()})),t._l(t.monthRange,(function(n){return"month"===t.detailLevel?r("td",{key:"month-"+n+"-"+e.id,class:{time:!0,month:!0,selected:t.isMonthSelected(e.id,t.year,n)}},[t.monthDuration(n,e.id)>0?r("router-link",{staticClass:"duration",attrs:{to:t.getMonthDetailRoute(e,t.year,n)}},[t._v(" "+t._s(t.monthDuration(n,e.id))+" ")]):r("span",[t._v(" - ")])],1):t._e()})),t._l(t.weekRange,(function(n){return"week"===t.detailLevel?r("td",{key:"week-"+n+"-"+e.id,class:{daytime:!0,selected:t.isWeekSelected(e.id,t.year,n)}},[t.weekDuration(n,e.id)>0?r("router-link",{class:{duration:!0,warning:t.weekDuration(n,e.id)>5*t.organisation.hours_by_day},attrs:{to:t.getWeekDetailRoute(e,t.year,n)}},[t._v(" "+t._s(t.weekDuration(n,e.id))+" ")]):r("span",[t._v(" - ")])],1):t._e()})),t._l(t.dayRange,(function(n){return"day"===t.detailLevel?r("td",{key:"day-"+n+"-"+e.id,staticClass:"daytime",class:{daytime:!0,weekend:t.isWeekend(t.year,t.month,n),selected:t.isDaySelected(e.id,t.year,t.month,n)}},[t.dayDuration(n,e.id)>0?r("router-link",{staticClass:"duration",attrs:{to:t.getDayDetailRoute(e,t.year,t.month,n)}},[t._v(" "+t._s(t.dayDuration(n,e.id))+" ")]):t.isDayOff(e.id,n)?r("span",[t._v(" OFF ")]):r("span",[t._v(" - ")])],1):t._e()})),r("td",{staticClass:"actions"})],2)})),0)])]),r("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}}),t.isLoading?t._e():r("p",{staticClass:"has-text-centered footer-info"},[t._v(" "+t._s(t.people.length)+" "+t._s(t.$tc("people.persons",t.people.length))+" ")])],1)},D=[],x=r("eb8c"),M=r("0073"),E=r("e60b");function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function T(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function q(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?T(Object(r),!0).forEach((function(e){N(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function N(t,e,r){return e=R(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function R(t){var e=A(t,"string");return"symbol"===Y(e)?e:String(e)}function A(t,e){if("object"!==Y(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var W={name:"people-timesheet-list",components:{PeopleAvatar:x["a"],PeopleName:M["a"],TableInfo:E["a"]},data:function(){return{currentMonth:a()().month()+1,currentYear:a()().year(),currentWeek:a()().week()}},props:{timesheet:{type:Object,default:function(){}},people:{type:Array,default:function(){return[]}},detailLevel:{type:String,default:"day"},year:{type:Number,default:0},month:{type:Number,default:0},unit:{type:String,default:"hour"},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1}},computed:q(q({},Object(s["c"])(["dayOffMap","isCurrentUserManager","organisation","route"])),{},{yearRange:function(){return Object(c["v"])(2018,a()().year())},monthRange:function(){return Object(c["n"])(this.year,this.currentYear,this.currentMonth)},dayRange:function(){return Object(c["j"])(this.year,this.month,this.currentYear,this.currentMonth)},weekRange:function(){return Object(c["p"])(this.year,this.currentYear,this.currentWeek)},isHours:function(){return"hour"===this.unit}}),methods:q(q({},Object(s["b"])([])),{},{monthToString:c["s"],yearDuration:function(t,e){var r="".concat(t),n=this.getDuration(r,e);return this.isHours?n:Object(c["q"])(this.organisation,n).toFixed(2)},monthDuration:function(t,e){var r="".concat(t),n=this.getDuration(r,e);return this.isHours?n:Object(c["q"])(this.organisation,n).toFixed(2)},weekDuration:function(t,e){var r=this.getDuration(t,e);return this.isHours?r:Object(c["q"])(this.organisation,r).toFixed(2)},dayDuration:function(t,e){if(this.dayOffMap[e]&&!0===this.dayOffMap[e]["".concat(t)])return"OFF";var r=this.getDuration(t,e);return this.isHours?r:Object(c["q"])(this.organisation,r).toFixed(2)},getDuration:function(t,e){return this.timesheet&&this.timesheet[t]&&this.timesheet[t][e]?this.timesheet[t][e]/60:"-"},isWeekend:function(t,e,r){var n=a()("".concat(t,"-").concat(e,"-").concat(r));return r<10&&(n=a()("".concat(t,"-").concat(e,"-0").concat(r))),[0,6].includes(n.day())},isDaySelected:function(t,e,r,n){return this.$route.params.person_id&&this.$route.params.person_id===t&&this.$route.params.year===e&&this.$route.params.month===r&&this.$route.params.day===n},isWeekSelected:function(t,e,r){return this.$route.params.person_id&&this.$route.params.person_id===t&&this.$route.params.year===e&&this.$route.params.week===r},isMonthSelected:function(t,e,r){return this.$route.params.person_id&&this.$route.params.person_id===t&&this.$route.params.year===e&&this.$route.params.month===r},isYearSelected:function(t,e){return this.$route.params.person_id&&this.$route.params.person_id===t&&this.$route.params.year===e},getWeekTitle:function(t){var e=a()(this.currentYear+"-"+t,"YYYY-W"),r=e.clone().add(6,"days");return e.format("YYYY-MM-DD")+" - "+r.format("YYYY-MM-DD")},getYearDetailRoute:function(t,e){return{name:"timesheets-year-person",params:{person_id:t.id,year:e},query:{productionId:this.$route.query.productionId}}},getMonthDetailRoute:function(t,e,r){return{name:"timesheets-month-person",params:{person_id:t.id,year:e,month:r},query:{productionId:this.$route.query.productionId}}},getWeekDetailRoute:function(t,e,r){return{name:"timesheets-week-person",params:{person_id:t.id,year:e,week:r},query:{productionId:this.$route.query.productionId}}},getDayDetailRoute:function(t,e,r,n){return{name:"timesheets-day-person",params:{person_id:t.id,year:e,month:r,day:n},query:{productionId:this.$route.query.productionId}}},isDayOff:function(t,e){var r="".concat(e).padStart(2,"0");return this.dayOffMap[t]&&this.dayOffMap[t][r]}}),watch:{route:function(){var t=document.getElementsByClassName("selected");0===t.length&&(this.$refs.body.scrollLeft+=350)}}},B=W,F=(r("7b75"),Object(C["a"])(B,I,D,!1,null,"9235933a",null)),H=F.exports,U=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"people-timesheet-info"},[r("div",{staticClass:"close"},[r("router-link",{staticClass:"close-button",attrs:{to:t.closeRoute}},[r("x-icon")],1)],1),r("div",{staticClass:"flexrow"},[r("people-avatar",{staticClass:"flexrow-item",attrs:{person:t.person,"no-cache":!0}}),r("page-title",{staticClass:"flexrow-item",attrs:{text:t.person.full_name}})],1),t.isYearInfo?r("div",{staticClass:"info-date"},[t._v(" "+t._s(t.year)+" ")]):t._e(),t.isMonthInfo?r("div",{staticClass:"info-date"},[t._v(" "+t._s(t.monthString)+" "+t._s(t.year)+" ")]):t.isWeekInfo?r("div",{staticClass:"info-date"},[t._v(" week "+t._s(t.week)+", "+t._s(t.startDay)+" - "+t._s(t.endDay)+" "+t._s(t.weekMonth)+" "+t._s(t.year)+" ")]):t._e(),t.isDayInfo?t.isDayInfo?r("div",{staticClass:"info-date"},[t._v(" "+t._s(t.day)+" "+t._s(t.monthString)+" "+t._s(t.year)+" ")]):t._e():r("div",{staticClass:"info-day-off"},[t._v(" "+t._s(t.dayOffCount)+" days off ")]),r("time-spent-task-list",{staticClass:"time-spent-list",attrs:{tasks:t.tasks,"is-loading":t.isLoading,"is-error":t.isLoadingError}})],1)},J=[],z=r("8d07"),K=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"data-list"},[r("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isLoadingError}}),r("div",{staticClass:"aggregated-time-spents"},t._l(Object.keys(t.projects),(function(e){return r("div",{key:e,staticClass:"by-project"},[t.projectNames[e]?r("production-name",{attrs:{production:{id:e,name:t.projectNames[e]}}}):t._e(),t._l(Object.keys(t.projects[e]),(function(n){return r("div",{key:n,staticClass:"by-task-type-id"},[r("task-type-name",{attrs:{"task-type":t.taskTypeMap.get(n)}}),r("div",{staticClass:"table-body"},[r("table",{staticClass:"datatable"},[r("tbody",{staticClass:"datatable-body"},t._l(t.projects[e][n],(function(e){return r("tr",{key:e.id,staticClass:"by-task-type-id datatable-row"},[r("router-link",{attrs:{to:t.getTaskPath(e)}},[r("td",{staticClass:"name"},[t._v(" "+t._s(e.name)+" ")]),r("td",{staticClass:"duration"},[t._v(t._s(e.duration/60))])])],1)})),0)])])],1)}))],2)})),0)],1)},X=[],G=r("2229"),Q=r("9d8b"),V=r("274f");function Z(t){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(t)}function tt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function et(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?tt(Object(r),!0).forEach((function(e){rt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):tt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function rt(t,e,r){return e=nt(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function nt(t){var e=it(t,"string");return"symbol"===Z(e)?e:String(e)}function it(t,e){if("object"!==Z(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var ot={name:"timespent-task-list",components:{TableInfo:E["a"],ProductionName:g["a"],TaskTypeName:V["a"]},data:function(){return{projectNames:{}}},props:{tasks:{type:Array,default:function(){return[]}},isLoading:{type:Boolean,default:!1},isLoadingError:{type:Boolean,default:!1}},computed:et(et({},Object(s["c"])(["currentProduction","lastProductionScreen","productionMap","taskTypeMap"])),{},{projects:function(){var t={};return this.tasks.forEach((function(e){t[e.project_id]||(t[e.project_id]={}),t[e.project_id][e.task_type_id]||(t[e.project_id][e.task_type_id]=[]);var r=e.entity_name;["Shot","Sequence"].includes(e.entity_type_name)?(r="".concat(e.sequence_name," / ").concat(r),e.episode_name&&(r="".concat(e.episode_name," / ").concat(r))):r="".concat(e.entity_type_name," / ").concat(r),t[e.project_id][e.task_type_id].push({id:e.task_id,project_id:e.project_id,task_type_id:e.task_type_id,name:r,duration:e.duration})})),Object.keys(t).forEach((function(e){Object.keys(t[e]).forEach((function(r){t[e][r]=Object(G["d"])(t[e][r])}))})),t}}),methods:et(et({},Object(s["b"])([])),{},{getTaskPath:function(t){var e=this.productionMap.get(t.project_id),r="tvshow"===e.production_type,n={id:e.first_episode_id};return Object(Q["i"])(t,null,r,n,this.taskTypeMap)},onBodyScroll:function(t,e){this.$refs.headerWrapper.style.left="-".concat(e.scrollLeft,"px")}}),watch:{tasks:function(){this.projectNames=this.tasks.reduce((function(t,e){return t[e.project_id]=e.project_name,t}),{})}}},at=ot,st=(r("89dd"),Object(C["a"])(at,K,X,!1,null,"18972314",null)),ut=st.exports;function ct(t){return ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ct(t)}function lt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function dt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?lt(Object(r),!0).forEach((function(e){pt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):lt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function pt(t,e,r){return e=ht(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ht(t){var e=ft(t,"string");return"symbol"===ct(e)?e:String(e)}function ft(t,e){if("object"!==ct(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==ct(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var yt={name:"people-timesheet-info",components:{XIcon:m["sb"],PageTitle:z["a"],PeopleAvatar:x["a"],TimeSpentTaskList:ut},props:{person:{type:Object,default:function(){}},year:{type:Number,default:0},month:{type:Number,default:0},week:{type:Number,default:0},day:{type:Number,default:0},isLoading:{type:Boolean,default:!1},isLoadingError:{type:Boolean,default:!1},tasks:{type:Array,default:function(){return[]}},dayOffCount:{type:Number,default:0}},computed:dt(dt({},Object(s["c"])([])),{},{startDay:function(){return a()().day("Monday").year(this.year).week(this.week).date()},endDay:function(){return a()().day("Monday").year(this.year).week(this.week).add("days",6).date()},weekMonth:function(){return a()().day("Monday").year(this.year).week(this.week).format("MMM")},monthString:function(){return Object(c["s"])(this.month)},isYearInfo:function(){return!this.isMonthInfo&&!this.isWeekInfo&&!this.isDayInfo},isMonthInfo:function(){return this.$route.path.indexOf("month")>0},isWeekInfo:function(){return this.$route.path.indexOf("week")>0},isDayInfo:function(){return this.$route.path.indexOf("day")>0},closeRoute:function(){return this.isMonthInfo?{name:"timesheets-month",params:{year:this.year}}:this.isWeekInfo?{name:"timesheets-week",params:{year:this.year}}:this.isDayInfo?{name:"timesheets-day",params:{year:this.year,month:this.month}}:{name:"timesheets"}}}),methods:dt(dt({},Object(s["b"])([])),{},{onCloseClicked:function(){this.$emit("close")}})},mt=yt,bt=(r("b76e"),Object(C["a"])(mt,U,J,!1,null,"0529431e",null)),gt=bt.exports;function vt(t){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vt(t)}function Ot(t){return jt(t)||kt(t)||wt(t)||_t()}function _t(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function wt(t,e){if(t){if("string"===typeof t)return St(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?St(t,e):void 0}}function kt(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function jt(t){if(Array.isArray(t))return St(t)}function St(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Pt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ct(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Pt(Object(r),!0).forEach((function(e){Lt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Pt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Lt(t,e,r){return e=$t(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function $t(t){var e=It(t,"string");return"symbol"===vt(e)?e:String(e)}function It(t,e){if("object"!==vt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var Dt={name:"people",components:{ButtonSimple:p["a"],ButtonHrefLink:d["a"],Combobox:h["a"],ComboboxProduction:$,PageTitle:z["a"],PeopleTimesheetList:H,PeopleTimesheetInfo:gt},data:function(){return{detailOptions:[{label:"Day",value:"day"},{label:"Week",value:"week"},{label:"Month",value:"month"},{label:"Year",value:"year"}],unitOptions:[{label:"Hour",value:"hour"},{label:"Day",value:"day"}],detailLevelString:"day",detailLevel:"day",productionIdString:"",productionId:"",yearString:"".concat(a()().year()),monthString:"".concat(a()().month()+1),unit:"hour",currentYear:a()().year(),currentMonth:a()().month()+1,currentWeek:a()().week(),currentDay:a()().date(),currentPerson:this.getCurrentPerson(),isLoading:!1,isLoadingError:!1,dayOffCount:0,isInfoLoading:!1,isInfoLoadingError:!1,showInfo:!0,tasks:[]}},created:function(){var t=this;this.isLoading=!0,0===this.people.length?this.loadPeople((function(){t.loadRoute()})):this.loadRoute()},mounted:function(){var t=this,e=this.$route.query.productionId;e&&(this.silent=!0,this.productionId=e,this.productionIdString=e,this.reloadTimesheet().then((function(){t.silent=!1})))},computed:Ct(Ct({},Object(s["c"])(["isCurrentUserAdmin","isCurrentUserManager","openProductions","organisation","people","personMap","timesheet"])),{},{productionList:function(){return[{id:"",name:this.$t("main.all")}].concat(Ot(this.openProductions))},filteredPeople:function(){var t=this;return this.people.filter((function(e){var r=Object.keys(t.timesheet),n=!1,i=0;do{t.timesheet[r[i]]&&(n=void 0!==t.timesheet[r[i]][e.id]),i++}while(!n&&i<r.length);return n}))},yearOptions:function(){var t=2018,e=a()().year();return Object(c["v"])(t,e).map((function(t){return{label:t,value:"".concat(t)}}))},monthOptions:function(){var t="".concat(a()().year()),e=1,r=a()().month()+1,n=Object(c["v"])(e,12);return t===this.yearString&&(n=Object(c["v"])(e,r)),n.map((function(t){return{label:Object(c["s"])(t),value:"".concat(t)}}))}}),methods:Ct(Ct({},Object(s["b"])(["loadPeople","loadAggregatedPersonDaysOff","loadAggregatedPersonTimeSpents","loadTimesheets"])),{},{reloadTimesheet:function(){var t=this;return this.isLoading=!0,this.isLoadingError=!1,this.loadTimesheets({detailLevel:this.detailLevel,year:this.currentYear,month:this.currentMonth,productionId:this.productionId}).then((function(e){return t.isLoading=!1,Promise.resolve()})).catch((function(e){return console.error(e),t.isLoading=!1,t.isLoadingError=!0,Promise.resolve()}))},showSideInfo:function(){this.showInfo=!0},hideSideInfo:function(){this.showInfo=!1},loadRoute:function(){var t=this;this.$options.silent=!0;var e=this.$route.params,r=e.month,n=e.year,i=e.week,o=e.day,a="".concat(this.productionId),s="".concat(this.detailLevel),u="".concat(this.currentMonth),c="".concat(this.currentYear);this.$route.path.indexOf("week")>0&&(this.detailLevel="week"),this.$route.path.indexOf("month")>0&&(this.detailLevel="month"),this.$route.path.indexOf("day")>0&&(this.detailLevel="day"),this.$route.path.indexOf("year")>0&&(this.detailLevel="year"),this.currentPerson=this.getCurrentPerson(),this.detailLevelString=this.detailLevel,r&&(this.currentMonth=Number(r),this.monthString="".concat(r)),n&&(this.currentYear=Number(n),this.yearString="".concat(n)),i&&(this.currentWeek=Number(i),this.weekString="".concat(i)),o&&(this.currentDay=Number(o)),this.productionId=this.$route.query.productionId||"";var l=s!==this.detailLevel,d=0!==u.localeCompare("".concat(this.currentMonth)),p=0!==c.localeCompare("".concat(this.currentYear)),h=0!==a.localeCompare("".concat(this.productionId));this.$nextTick((function(){t.$options.silent=!1})),this.$route.path.indexOf("person")>0?(this.showSideInfo(),this.loadAggregate()):this.hideSideInfo(),(this.isLoading||d||p||l||h)&&this.reloadTimesheet()},loadAggregate:function(){var t=this;this.isInfoLoading=!0,this.isInfoLoadingError=!1,this.tasks=[],this.loadAggregatedPersonTimeSpents({personId:this.$route.params.person_id,detailLevel:this.detailLevel,year:this.$route.params.year,month:this.$route.params.month,week:this.$route.params.week,day:this.$route.params.day,productionId:this.productionId}).then((function(e){return t.tasks=e.filter((function(t){return t.duration>0})),t.loadAggregatedPersonDaysOff({personId:t.$route.params.person_id,detailLevel:t.detailLevel,year:t.$route.params.year,month:t.$route.params.month,week:t.$route.params.week})})).then((function(e){t.dayOffCount=e.length,t.isInfoLoading=!1})).catch((function(e){console.error(e),t.isInfoLoadingError=!0}))},getCurrentPerson:function(){var t=this.$route.params.person_id;return t&&this.personMap?this.personMap.get(t):{}},exportTimesheet:function(){var t=["timesheet",this.detailLevel,this.currentYear];"day"===this.detailLevel&&t.push(this.currentMonth);var e=l["a"].slugify(t.join("_"));u["a"].generateTimesheet(e,this.timesheet,this.filteredPeople,this.unit,this.organisation,this.detailLevel,this.currentYear,this.currentMonth,a()().month()+1,a()().year(),a()().week())}}),watch:{detailLevelString:function(){this.silent||this.detailLevel!==this.detailLevelString&&("month"===this.detailLevelString?this.$router.push({name:"timesheets-month",params:{year:this.currentYear},query:this.$route.query}):"week"===this.detailLevelString?this.$router.push({name:"timesheets-week",params:{year:this.currentYear},query:this.$route.query}):"day"===this.detailLevelString?this.$router.push({name:"timesheets-day",params:{year:this.currentYear,month:this.currentMonth},query:this.$route.query}):"year"===this.detailLevelString&&this.$router.push({name:"timesheets-year",params:{year:this.currentYear},query:this.$route.query}))},yearString:function(){if(!this.silent){var t=Number(this.yearString),e=a()().month();this.currentYear!==t&&("month"===this.detailLevel?this.$router.push({name:"timesheets-month",params:{year:t},query:this.$route.query}):"week"===this.detailLevel?this.$router.push({name:"timesheets-week",params:{year:t},query:this.$route.query}):this.$router.push({name:"timesheets-day",params:{year:t,month:Math.min(Number(this.monthString),e)},query:this.$route.query}))}},monthString:function(){this.silent||this.currentMonth!==Number(this.monthString)&&this.$router.push({name:"timesheets-day",params:{year:this.currentYear,month:Number(this.monthString)},query:this.$route.query})},productionIdString:function(){this.silent||this.$router.push({query:{productionId:this.productionIdString}})},$route:function(){this.loadRoute()}},metaInfo:function(){return{title:"".concat(this.$t("timesheets.title")," - Kitsu")}}},xt=Dt,Mt=(r("c0f7"),Object(C["a"])(xt,n,i,!1,null,"8922988e",null));e["default"]=Mt.exports},2254:function(t,e,r){},2267:function(t,e,r){},"4a0f":function(t,e,r){"use strict";r("9eb4")},"4dac":function(t,e,r){},"7b75":function(t,e,r){"use strict";r("c1f0")},"89dd":function(t,e,r){"use strict";r("4dac")},9355:function(t,e,r){"use strict";var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("a",{staticClass:"button",attrs:{title:t.title,href:t.path,target:t.target}},["plus"===t.icon?r("plus-icon",{staticClass:"icon is-small"}):t._e(),"download"===t.icon?r("download-icon",{staticClass:"icon is-small"}):t._e(),"upload"===t.icon?r("upload-icon",{staticClass:"icon is-small"}):t._e(),"list"===t.icon?r("list-icon",{staticClass:"icon is-small"}):t._e(),t.text?r("span",{staticClass:"text is-hidden-touch"},[t._v(" "+t._s(t.text)+" ")]):t._e()],1)},i=[],o=r("0a35"),a={name:"button-href-link",components:{DownloadIcon:o["v"],ListIcon:o["J"],PlusIcon:o["W"],UploadIcon:o["mb"]},props:{text:{default:"",type:String},path:{default:"",type:String},icon:{default:"",type:String},title:{default:"",type:String},styleclass:{default:"",type:String},target:{default:"_self",type:String}}},s=a,u=(r("4a0f"),r("2877")),c=Object(u["a"])(s,n,i,!1,null,"ebbaf58c",null);e["a"]=c.exports},"96de":function(t,e,r){"use strict";r("2267")},"9eb4":function(t,e,r){},b76e:function(t,e,r){"use strict";r("2254")},c0f7:function(t,e,r){"use strict";r("df40")},c1f0:function(t,e,r){},df40:function(t,e,r){}}]);
//# sourceMappingURL=chunk-fa9a8f64.7c1437fb.js.map